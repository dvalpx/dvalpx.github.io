<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentación de Laravel en español</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    <link rel="icon" href="/favicon.png">
    <script src="/custom.js"></script>
    <meta name="description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
    <meta property="og:url" content="https://documentacion-laravel.com">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Documentación de Laravel en español">
    <meta property="og:description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
    <meta property="og:image" content="https://documentacion-laravel.com/social-preview.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.c83a6d64.css" as="style"><link rel="preload" href="/assets/js/app.453cd102.js" as="script"><link rel="preload" href="/assets/js/3.ec4a9ac9.js" as="script"><link rel="preload" href="/assets/js/58.831ff200.js" as="script"><link rel="prefetch" href="/assets/js/10.86963300.js"><link rel="prefetch" href="/assets/js/11.02d662f5.js"><link rel="prefetch" href="/assets/js/12.3015abcf.js"><link rel="prefetch" href="/assets/js/13.a1894a08.js"><link rel="prefetch" href="/assets/js/14.e50fbc03.js"><link rel="prefetch" href="/assets/js/15.c603bff6.js"><link rel="prefetch" href="/assets/js/16.5e1f421f.js"><link rel="prefetch" href="/assets/js/17.bda6ead2.js"><link rel="prefetch" href="/assets/js/18.b402dfe5.js"><link rel="prefetch" href="/assets/js/19.ade9a9aa.js"><link rel="prefetch" href="/assets/js/20.2df6cfda.js"><link rel="prefetch" href="/assets/js/21.56c189aa.js"><link rel="prefetch" href="/assets/js/22.d6fc6162.js"><link rel="prefetch" href="/assets/js/23.ad6262b4.js"><link rel="prefetch" href="/assets/js/24.2f8d3cf9.js"><link rel="prefetch" href="/assets/js/25.7ddac0e2.js"><link rel="prefetch" href="/assets/js/26.657fd254.js"><link rel="prefetch" href="/assets/js/27.7ff257b2.js"><link rel="prefetch" href="/assets/js/28.b4ed1588.js"><link rel="prefetch" href="/assets/js/29.2216658e.js"><link rel="prefetch" href="/assets/js/30.1622e023.js"><link rel="prefetch" href="/assets/js/31.0e88a853.js"><link rel="prefetch" href="/assets/js/32.02ffd177.js"><link rel="prefetch" href="/assets/js/33.6832adab.js"><link rel="prefetch" href="/assets/js/34.f8fabc68.js"><link rel="prefetch" href="/assets/js/35.6c557188.js"><link rel="prefetch" href="/assets/js/36.a778d935.js"><link rel="prefetch" href="/assets/js/37.842a39f6.js"><link rel="prefetch" href="/assets/js/38.e99286be.js"><link rel="prefetch" href="/assets/js/39.ace761d0.js"><link rel="prefetch" href="/assets/js/4.6cf9f07a.js"><link rel="prefetch" href="/assets/js/40.3c85639e.js"><link rel="prefetch" href="/assets/js/41.3d0a022c.js"><link rel="prefetch" href="/assets/js/42.a25a8fcf.js"><link rel="prefetch" href="/assets/js/43.09f02f2c.js"><link rel="prefetch" href="/assets/js/44.d7d996a1.js"><link rel="prefetch" href="/assets/js/45.aab023f3.js"><link rel="prefetch" href="/assets/js/46.c01fee08.js"><link rel="prefetch" href="/assets/js/47.bb1017b4.js"><link rel="prefetch" href="/assets/js/48.a5ab6dc0.js"><link rel="prefetch" href="/assets/js/49.b95a4857.js"><link rel="prefetch" href="/assets/js/5.4bd4301f.js"><link rel="prefetch" href="/assets/js/50.2f705c7b.js"><link rel="prefetch" href="/assets/js/51.782cc529.js"><link rel="prefetch" href="/assets/js/52.c468366e.js"><link rel="prefetch" href="/assets/js/53.7e7ae22f.js"><link rel="prefetch" href="/assets/js/54.242847d0.js"><link rel="prefetch" href="/assets/js/55.996b67d9.js"><link rel="prefetch" href="/assets/js/56.45b6d9bc.js"><link rel="prefetch" href="/assets/js/57.99346def.js"><link rel="prefetch" href="/assets/js/59.19eb5034.js"><link rel="prefetch" href="/assets/js/6.ebabde72.js"><link rel="prefetch" href="/assets/js/60.ffee3dbb.js"><link rel="prefetch" href="/assets/js/61.c260f4e3.js"><link rel="prefetch" href="/assets/js/62.90688dc4.js"><link rel="prefetch" href="/assets/js/63.d5d04582.js"><link rel="prefetch" href="/assets/js/64.51257cf5.js"><link rel="prefetch" href="/assets/js/65.f5b86d0c.js"><link rel="prefetch" href="/assets/js/66.66ec2e22.js"><link rel="prefetch" href="/assets/js/67.fac1a45f.js"><link rel="prefetch" href="/assets/js/68.064bc05b.js"><link rel="prefetch" href="/assets/js/69.b96a4b65.js"><link rel="prefetch" href="/assets/js/7.3694a647.js"><link rel="prefetch" href="/assets/js/70.cb8c9617.js"><link rel="prefetch" href="/assets/js/71.da75c24f.js"><link rel="prefetch" href="/assets/js/72.6409fdef.js"><link rel="prefetch" href="/assets/js/73.b39d84a0.js"><link rel="prefetch" href="/assets/js/74.abfa52b6.js"><link rel="prefetch" href="/assets/js/75.ba6aec92.js"><link rel="prefetch" href="/assets/js/76.3439c5cb.js"><link rel="prefetch" href="/assets/js/77.c13e02cd.js"><link rel="prefetch" href="/assets/js/78.407158c3.js"><link rel="prefetch" href="/assets/js/79.d7b0a132.js"><link rel="prefetch" href="/assets/js/8.0dd1f07e.js"><link rel="prefetch" href="/assets/js/80.db05f5e0.js"><link rel="prefetch" href="/assets/js/81.a8d47a45.js"><link rel="prefetch" href="/assets/js/9.19fda819.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4b42ec77.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c83a6d64.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en español</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Inicio
</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">
  Índice
</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">
  Glosario
</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">
  Créditos
</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">
  Descargar
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Otras versiones" class="dropdown-title"><span class="title">Otras versiones</span> <span class="arrow down"></span></button> <button type="button" aria-label="Otras versiones" class="mobile-dropdown-title"><span class="title">Otras versiones</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://v7.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Laravel 7
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/stydenet/laravel-spanish-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Inicio
</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">
  Índice
</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">
  Glosario
</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">
  Créditos
</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">
  Descargar
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Otras versiones" class="dropdown-title"><span class="title">Otras versiones</span> <span class="arrow down"></span></button> <button type="button" aria-label="Otras versiones" class="mobile-dropdown-title"><span class="title">Otras versiones</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://v7.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Laravel 7
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/stydenet/laravel-spanish-docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Primeros pasos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Conceptos de arquitectura</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bases de datos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Paquetes oficiales</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/billing.html" class="sidebar-link">Laravel Cashier</a></li><li><a href="/dusk.html" class="sidebar-link">Laravel Dusk</a></li><li><a href="/envoy.html" class="sidebar-link">Laravel Envoy</a></li><li><a href="/horizon.html" class="sidebar-link">Laravel Horizon</a></li><li><a href="/passport.html" aria-current="page" class="active sidebar-link">Laravel Passport</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/passport.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/passport.html#actualizando-passport" class="sidebar-link">Actualizando Passport</a></li><li class="sidebar-sub-header"><a href="/passport.html#instalacion" class="sidebar-link">Instalación</a></li><li class="sidebar-sub-header"><a href="/passport.html#configuracion" class="sidebar-link">Configuración</a></li><li class="sidebar-sub-header"><a href="/passport.html#emitiendo-tokens-de-acceso" class="sidebar-link">Emitiendo tokens de acceso</a></li><li class="sidebar-sub-header"><a href="/passport.html#otorgando-codigos-de-autorizacion-con-pkce" class="sidebar-link">Otorgando códigos de autorización con PKCE</a></li><li class="sidebar-sub-header"><a href="/passport.html#tokens-de-permiso-de-contrasena" class="sidebar-link">Tokens de permiso de contraseña</a></li><li class="sidebar-sub-header"><a href="/passport.html#tokens-de-permiso-implicito" class="sidebar-link">Tokens de permiso implícito</a></li><li class="sidebar-sub-header"><a href="/passport.html#tokens-de-permiso-de-credenciales-de-cliente" class="sidebar-link">Tokens de permiso de credenciales de cliente</a></li><li class="sidebar-sub-header"><a href="/passport.html#tokens-de-acceso-personal" class="sidebar-link">Tokens de acceso personal</a></li><li class="sidebar-sub-header"><a href="/passport.html#protegiendo-rutas" class="sidebar-link">Protegiendo rutas</a></li><li class="sidebar-sub-header"><a href="/passport.html#alcances-de-token" class="sidebar-link">Alcances de token</a></li><li class="sidebar-sub-header"><a href="/passport.html#consumiendo-tu-api-con-javascript" class="sidebar-link">Consumiendo tu API con JavaScript</a></li><li class="sidebar-sub-header"><a href="/passport.html#eventos" class="sidebar-link">Eventos</a></li><li class="sidebar-sub-header"><a href="/passport.html#pruebas" class="sidebar-link">Pruebas</a></li></ul></li><li><a href="/scout.html" class="sidebar-link">Scout para Laravel</a></li><li><a href="/socialite.html" class="sidebar-link">Laravel Socialite</a></li><li><a href="/telescope.html" class="sidebar-link">Laravel Telescope</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="laravel-passport"><a class="header-anchor" href="#laravel-passport">#</a> Laravel Passport</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#upgrading">Actualizando Passport</a></li> <li><a href="#installation">Instalación</a> <ul><li><a href="#frontend-quickstart">Inicio rápido de frontend</a></li> <li><a href="#deploying-passport">Despliegue de passport</a></li></ul></li> <li><a href="#configuration">Configuración</a> <ul><li><a href="#token-lifetimes">Duración de tokens</a></li> <li><a href="#overriding-default-models">Sobrescribiendo modelos predeterminados</a></li></ul></li> <li><a href="#issuing-access-tokens">Emitiendo tokens de acceso</a> <ul><li><a href="#managing-clients">Administrando clientes</a></li> <li><a href="#requesting-tokens">Solicitando tokens</a></li> <li><a href="#refreshing-tokens">Actualización de tokens</a></li> <li><a href="#purging-tokens">Eliminando tokens</a></li></ul></li> <li><a href="#code-grant-pkce">Otorgando código de autorización con PKCE</a> <ul><li><a href="#creating-a-auth-pkce-grant-client">Creando el cliente</a></li> <li><a href="#requesting-auth-pkce-grant-tokens">Solicitando tokens</a></li></ul></li> <li><a href="#password-grant-tokens">Tokens de permiso de contraseña</a> <ul><li><a href="#creating-a-password-grant-client">Creando un cliente con permiso de contraseña</a></li> <li><a href="#requesting-password-grant-tokens">Solicitando tokens</a></li> <li><a href="#requesting-all-scopes">Solicitando todos los alcances</a></li> <li><a href="#customizing-the-username-field">Personalizando el campo username</a></li> <li><a href="#customizing-the-password-validation">Personalizando la validación de la contraseña</a></li></ul></li> <li><a href="#implicit-grant-tokens">Tokens de permiso implícito</a></li> <li><a href="#client-credentials-grant-tokens">Tokens de permiso de credenciales de cliente</a></li> <li><a href="#personal-access-tokens">Tokens de acceso personal</a> <ul><li><a href="#creating-a-personal-access-client">Creando un cliente de acceso personal</a></li> <li><a href="#managing-personal-access-tokens">Administrando tokens de acceso personal</a></li></ul></li> <li><a href="#protecting-routes">Protegiendo rutas</a> <ul><li><a href="#via-middleware">Por medio de middleware</a></li> <li><a href="#passing-the-access-token">Pasando el token de acceso</a></li></ul></li> <li><a href="#token-scopes">Alcances de token</a> <ul><li><a href="#defining-scopes">Definiendo alcances</a></li> <li><a href="#default-scope">Alcance predeterminado</a></li> <li><a href="#assigning-scopes-to-tokens">Asignando alcances a los Tokens</a></li> <li><a href="#checking-scopes">Verificando alcances</a></li></ul></li> <li><a href="#consuming-your-api-with-javascript">Consumiendo tu API con JavaScript</a></li> <li><a href="#events">Eventos</a></li> <li><a href="#testing">Pruebas</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion">#</a> Introducción</h2> <p>Laravel ya facilita la autenticación por medio de formularios de inicio de sesión tradicionales, pero ¿Qué pasa con las APIs? Las APIs típicamente usan tokens para autenticar a los usuarios y no mantienen el estado de sesión entre solicitudes. Laravel hace de la autenticación de API algo muy simple usando Passport de Laravel, el cual proporciona una implementación de servidor OAuth2 completa para tu aplicación Laravel en sólo minutos. Passport está construido sobre el <a href="https://github.com/thephpleague/oauth2-server" target="_blank" rel="noopener noreferrer">servidor League OAuth2<OutboundLink></OutboundLink></a> que es mantenido por Andy Millington y Simon Hamp.</p> <div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Esta documentación asume que estás familiarizado con OAuth2. Si no sabes nada sobre OAuth2, considera familiarizarte con la <a href="https://oauth2.thephpleague.com/terminology/" target="_blank" rel="noopener noreferrer">terminología general<OutboundLink></OutboundLink></a> y las características de Outh2 antes de continuar.</p></div></div><p><a name="upgrading"></a></p> <h2 id="actualizando-passport"><a href="#actualizando-passport" class="header-anchor">#</a> Actualizando Passport</h2> <p>Al actualizar a una nueva versión mayor de Passport, es importante que revises detalladamente <a href="https://github.com/laravel/passport/blob/master/UPGRADE.md" target="_blank" rel="noopener noreferrer">la guía de actualización<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><a name="installation"></a></p> <h2 id="instalacion"><a href="#instalacion" class="header-anchor">#</a> Instalación</h2> <p>Para empezar, instala Passport por medio del gestor de paquetes Composer:</p> <div class="language-php extra-class"><pre class="language-php"><code>composer <span class="token keyword">require</span> laravel<span class="token operator">/</span>passport
</code></pre></div><p>El proveedor de servicio de Passport registra su propio directorio de migración de base de datos con el framework, así que deberías migrar tu base de datos después de instalar el paquete. Las migraciones de Passport crearán las tablas que tu aplicación necesita para almacenar clientes y tokens de acceso:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan migrate
</code></pre></div><p>A continuación, debes ejecutar el comando <code>passport:install</code>. Este comando creará las claves de encriptación necesarias para generar tokens de acceso seguro. Además, el comando creará clientes de &quot;acceso personal&quot; y &quot;permiso de contraseña&quot; los cuales serán usados para generar tokens de acceso:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>install
</code></pre></div><p>Después de ejecutar este comando, agrega el trait <code>Laravel\Passport\HasApiTokens</code> a tu modelo <code>App\User</code>. Este trait proporcionará algunos métodos helper para tu modelo los cuales permitirán que inspecciones el token y alcances del usuario autenticado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notifiable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>HasApiTokens</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasApiTokens</span><span class="token punctuation">,</span> Notifiable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Luego, deberías llamar al método <code>Passport::routes</code> dentro del método <code>boot</code> de tu <code>AuthServiceProvider</code>. Este método registrará las rutas necesarias para suministrar tokens y revocar tokens de acceso, clientes y tokens de acceso personal:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Providers<span class="token punctuation">\</span>AuthServiceProvider</span> <span class="token keyword">as</span> ServiceProvider<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Gate</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The policy mappings for the application.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$policies</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'App\Model'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'App\Policies\ModelPolicy'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Register any authentication / authorization services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Finalmente, en tu archivo de configuración <code>config/auth.php</code>, debes establecer la opción <code>driver</code> del guard de autenticación de <code>api</code> a <code>passport</code>. Esto indicará a tu aplicación que utilice el <code>TokenGuard</code> de Passport al momento de autenticar las solicitudes de API entrantes:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'guards'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'web'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'session'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'provider'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'api'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'passport'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'provider'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="personalizacion-de-la-migracion"><a href="#personalizacion-de-la-migracion" class="header-anchor">#</a> Personalización de la migración</h3> <p>Si no vas a utilizar las migraciones predeterminadas de Passport, debes llamar al método <code>Passport::ignoreMigrations</code> en el método <code>register</code> de tu <code>AppServiceProvider</code>. Puedes exportar las migraciones por defecto usando <code>php artisan vendor:publish --tag=passport-migrations</code>.</p> <p>Por defecto, Passport usa una columna de enteros para almacenar el <code>user_id</code>. Si tu aplicación utiliza un tipo de columna diferente para identificar a los usuarios (por ejemplo: UUID), debes modificar las migraciones de Passport predeterminadas después de publicarlas.</p> <p><a name="frontend-quickstart"></a></p> <h3 id="inicio-rapido-de-frontend"><a href="#inicio-rapido-de-frontend" class="header-anchor">#</a> Inicio rápido de frontend</h3> <div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Para usar los componentes Vue de Passport, debes estar usando el framework de JavaScript <a href="https://vuejs.org" target="_blank" rel="noopener noreferrer">Vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Estos componentes también usarán el framework de CSS Bootstrap. Sin embargo, incluso si no estás usando estas herramientas, los componentes sirven como una referencia valiosa para tu propia implementación de frontend.</p></div> <p>Passport viene con una API JSON que puedes usar para permitir que tus usuarios creen tokens de acceso de clientes y personal. Sin embargo, puede ser que consumas tiempo en codificar un frontend para interactuar con estas APIs. Así que, Passport también incluye componentes de <a href="https://vuejs.org" target="_blank" rel="noopener noreferrer">Vue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pre-construidos que puedes usar como implementación de ejemplo o punto de inicio para tu propia implementación.</p> <p>Para publicar los componentes de Vue de Passport, usa el comando Artisan <code>vendor:publish</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan vendor<span class="token punctuation">:</span>publish <span class="token operator">--</span>tag<span class="token operator">=</span>passport<span class="token operator">-</span>components
</code></pre></div><p>Los componentes publicados serán colocados en tu directorio <code>resources/js/components</code>. Una vez que los componentes han sido publicados, debes registrarlos en tu archivo <code>resources/js/app.js</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>
    <span class="token string">'passport-clients'</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./components/passport/Clients.vue'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>
    <span class="token string">'passport-authorized-clients'</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./components/passport/AuthorizedClients.vue'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>
    <span class="token string">'passport-personal-access-tokens'</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./components/passport/PersonalAccessTokens.vue'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Antes de Laravel v5.7.19, anexar <code>.default</code> al registrar componentes da como resultado un error de consola. Una explicación para este cambio puedes encontrarla en las <a href="https://github.com/JeffreyWay/laravel-mix/releases/tag/v4.0.0" target="_blank" rel="noopener noreferrer">notas de lanzamiento de Laravel Mix v4.0.0<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <p>Después de registrar los componentes, asegúrate de ejecutar <code>npm run dev</code> para recompilar tu código CSS/JS. Una vez que has recompilado tus código CSS/JS, puedes colocar los componentes dentro de una de las plantillas de tu aplicación para empezar a crear tokens de acceso de clientes y personal:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token operator">&lt;</span>passport<span class="token operator">-</span>clients<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>passport<span class="token operator">-</span>clients<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>passport<span class="token operator">-</span>authorized<span class="token operator">-</span>clients<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>passport<span class="token operator">-</span>authorized<span class="token operator">-</span>clients<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>passport<span class="token operator">-</span>personal<span class="token operator">-</span>access<span class="token operator">-</span>tokens<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>passport<span class="token operator">-</span>personal<span class="token operator">-</span>access<span class="token operator">-</span>tokens<span class="token operator">&gt;</span>
</code></pre></div><p><a name="deploying-passport"></a></p> <h3 id="despliegue-de-passport"><a href="#despliegue-de-passport" class="header-anchor">#</a> Despliegue de passport</h3> <p>Al momento de usar Passport en tus servidores de producción por primera vez, es probable que debas ejecutar el comando <code>passport:keys</code>. Este comando genera las claves de encriptación que Passport necesita con el propósito de generar el token de acceso. Las claves generadas normalmente no son guardadas en control de código fuente:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>keys
</code></pre></div><p>De ser necesario, puedes definir la ruta desde donde se deben cargar las claves de Passport. Para lograr esto puedes usar el método <code>Passport::loadKeysFrom</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Register any authentication / authorization services.
*
* @return void
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">loadKeysFrom</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/secret-keys/oauth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Además, puedes publicar el archivo de configuración de Passport usando <code>php artisan vendor:publish --tag=passport-config</code>, el cual proporcionará la opción de cargar las claves de encriptación desde tus variables de entorno:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token constant">PASSPORT_PRIVATE_KEY</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;-----BEGIN RSA PRIVATE KEY-----
&lt;private key here&gt;
-----END RSA PRIVATE KEY-----&quot;</span>

<span class="token constant">PASSPORT_PUBLIC_KEY</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;-----BEGIN PUBLIC KEY-----
&lt;public key here&gt;
-----END PUBLIC KEY-----&quot;</span>
</code></pre></div><p><a name="configuration"></a></p> <h2 id="configuracion"><a href="#configuracion" class="header-anchor">#</a> Configuración</h2> <p><a name="token-lifetimes"></a></p> <h3 id="duracion-de-tokens"><a href="#duracion-de-tokens" class="header-anchor">#</a> Duración de tokens</h3> <p>De forma predeterminada, Passport emite tokens de acceso de larga duración que caducan después de un año. Si prefieres configurar una duración de token más larga o más corta, puedes usar los métodos <code>tokensExpireIn</code>, <code>refreshTokensExpireIn</code> y <code>personalAccessTokensExpireIn</code>. Estos métodos deberían ser llamados desde el método <code>boot</code> de tu <code>AuthServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Register any authentication / authorization services.
*
* @return void
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">tokensExpireIn</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addDays</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">refreshTokensExpireIn</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addDays</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">personalAccessTokensExpireIn</span><span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addMonths</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="overriding-default-models"></a></p> <h3 id="sobrescribiendo-modelos-predeterminados"><a href="#sobrescribiendo-modelos-predeterminados" class="header-anchor">#</a> Sobrescribiendo modelos predeterminados</h3> <p>Eres en libre de extender los modelos usados internamente por Passport:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Client</span> <span class="token keyword">as</span> PassportClient<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token keyword">extends</span> <span class="token class-name">PassportClient</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A continuación, puedes indicarle a Passport que utilice tus modelos personalizados a través de la clase <code>Passport</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>AuthCode</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>PersonalAccessClient</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Token</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Register any authentication / authorization services.
*
* @return void
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">useTokenModel</span><span class="token punctuation">(</span>Token<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">useClientModel</span><span class="token punctuation">(</span>Client<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">useAuthCodeModel</span><span class="token punctuation">(</span>AuthCode<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">usePersonalAccessClientModel</span><span class="token punctuation">(</span>PersonalAccessClient<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="issuing-access-tokens"></a></p> <h2 id="emitiendo-tokens-de-acceso"><a href="#emitiendo-tokens-de-acceso" class="header-anchor">#</a> Emitiendo tokens de acceso</h2> <p>Usar OAuth2 con códigos de autorización es la forma en que la mayoría de los desarrolladores están familiarizados con OAuth2. Al usar códigos de autorización, una aplicación cliente redireccionará un usuario a tu servidor donde aprobará o denegará la solicitud para emitir un token de acceso al cliente.</p> <p><a name="managing-clients"></a></p> <h3 id="administrando-clientes"><a href="#administrando-clientes" class="header-anchor">#</a> Administrando clientes</h3> <p>En primer lugar, los desarrolladores que crean aplicaciones que necesitan interactuar con la API de tu aplicación deberán registrar su aplicación con la tuya creando un &quot;cliente&quot;. Normalmente, esto consiste en proporcionar el nombre de su aplicación y una dirección URL a la que tu aplicación puede redirigir después de que los usuarios aprueben su solicitud de autorización.</p> <h4 id="el-comando-passport-client"><a href="#el-comando-passport-client" class="header-anchor">#</a> El comando <code>passport:client</code></h4> <p>La forma más simple de crear un cliente es usando el comando Artisan <code>passport:client</code>. Este comando puede ser usado para crear tus propios clientes para probar tu funcionalidad OAuth2. Cuando ejecutes el comando <code>client</code>, Passport te pedirá más información sobre tu cliente y te proporcionará un ID y clave secreta de cliente:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>client
</code></pre></div><p><strong>Redirigir URLs</strong></p> <p>Si deseas incluir en la lista blanca varias direcciones URL de redireccionamiento para tu cliente, puedes especificarlas mediante una lista delimitadas por comas cuando se solicite la dirección URL mediante el comando <code>passport:client</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>http<span class="token punctuation">:</span><span class="token comment">//example.com/callback,http://examplefoo.com/callback</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Cualquier URL que contenga comas debe estar codificada.</p></div> <h4 id="api-json"><a href="#api-json" class="header-anchor">#</a> API JSON</h4> <p>Debido a que tus usuarios no podrán utilizar el comando <code>client</code>, Passport proporciona una API JSON que puedes usar para crear clientes. Esto te ahorra la molestia de tener que codificar manualmente los controladores para crear, actualizar y eliminar clientes.</p> <p>Sin embargo, necesitarás acoplar la API JSON de Passport con tu propio frontend para proporcionar un panel de control para que tus usuarios administren sus clientes. A continuación, revisaremos todos los endpoints de API para administrar clientes. Por conveniencia, usaremos <a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">Axios<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para demostrar la forma de hacer las solicitudes HTTP hacia los endpoints.</p> <p>La API JSON está protegida por los middleware <code>web</code> y <code>auth</code>; por lo tanto, sólo puede ser llamada desde tu propia aplicación. No se puede llamar desde una fuente externa.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si no quieres implementar todo el frontend de administración de clientes tu mismo, puedes usar el <a href="#frontend-quickstart">inicio rápido de frontend</a> para tener un frontend completamente funcional en sólo minutos.</p></div> <h4 id="get-oauth-clients"><a href="#get-oauth-clients" class="header-anchor">#</a> <code>GET /oauth/clients</code></h4> <p>Esta ruta devuelve todos los clientes para el usuario autenticado. Esto es útil principalmente para listar todos los clientes del usuario para que puedan editarlos o eliminarlos:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/oauth/clients'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="post-oauth-clients"><a href="#post-oauth-clients" class="header-anchor">#</a> <code>POST /oauth/clients</code></h4> <p>Esta ruta se utiliza para crear nuevos clientes. Requiere dos datos: el <code>name</code> del cliente y un <code>redirect</code> de la URL. El <code>redirect</code> de la URL es donde el usuario será redirigido después de que sea aprobada o rechazada su solicitud de autorización.</p> <p>Cuando se crea un cliente, se emitirá un ID de cliente y una clave secreta. Estos valores se usarán cuando se soliciten tokens de acceso desde tu aplicación. La ruta de creación del cliente devolverá la nueva instancia del cliente:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Client Name'</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token string">'http://example.com/callback'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/oauth/clients'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// List errors on response...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="put-oauth-clients-client-id"><a href="#put-oauth-clients-client-id" class="header-anchor">#</a> <code>PUT /oauth/clients/{client-id}</code></h4> <p>Esta ruta se utiliza para actualizar clientes. Requiere dos datos: el <code>name</code> del cliente y un <code>redirect</code> de la URL. El <code>redirect</code> de la URL es donde el usuario será redirigido después de que sea aprobada o rechazada su solicitud de autorización. La ruta devolverá la instancia de cliente actualizada:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'New Client Name'</span><span class="token punctuation">,</span>
    redirect<span class="token operator">:</span> <span class="token string">'http://example.com/callback'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">'/oauth/clients/'</span> <span class="token operator">+</span> clientId<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// List errors on response...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="delete-oauth-clients-client-id"><a href="#delete-oauth-clients-client-id" class="header-anchor">#</a> <code>DELETE /oauth/clients/{client-id}</code></h4> <p>Esta ruta se utiliza para eliminar clientes:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/oauth/clients/'</span> <span class="token operator">+</span> clientId<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="requesting-tokens"></a></p> <h3 id="solicitando-tokens"><a href="#solicitando-tokens" class="header-anchor">#</a> Solicitando tokens</h3> <h4 id="redireccion-para-autorizacion"><a href="#redireccion-para-autorizacion" class="header-anchor">#</a> Redirección para autorización</h4> <p>Una vez que se ha creado un cliente, los desarrolladores pueden usar el ID de cliente y la clave secreta para solicitar un código de autorización y un token de acceso de la aplicación. En primer lugar, la aplicación consumidora debe realizar una solicitud de redirección a la ruta <code>/oauth/authorize</code> de tu aplicación de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/redirect'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'state'</span><span class="token punctuation">,</span> <span class="token variable">$state</span> <span class="token operator">=</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'redirect_uri'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://example.com/callback'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'response_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'code'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'state'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$state</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/authorize?'</span><span class="token punctuation">.</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Recuerda, la ruta <code>/oauth/authorize</code> ya está definida por el método <code>Passport::routes</code>. No necesitas definir manualmente esta ruta.</p></div> <h4 id="aprobacion-de-la-solicitud"><a href="#aprobacion-de-la-solicitud" class="header-anchor">#</a> Aprobación de la solicitud</h4> <p>Al recibir solicitudes de autorización, Passport mostrará automáticamente una plantilla al usuario que le permite aprobar o rechazar la solicitud de autorización. Si aprueban la solicitud, serán redirigidos de nuevo a la <code>redirect_uri</code> especificada por la aplicación consumidora. La <code>redirect_uri</code> debe coincidir con el <code>redirect</code> de la URL que se especificó cuando se creó el cliente.</p> <p>Si deseas personalizar la pantalla de aprobación de la autorización, puedes publicar las vistas de Passport usando el comando Artisan <code>vendor:publish</code>. Las vistas publicadas serán colocadas en <code>resources/views/vendor/passport</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan vendor<span class="token punctuation">:</span>publish <span class="token operator">--</span>tag<span class="token operator">=</span>passport<span class="token operator">-</span>views
</code></pre></div><p>A veces es posible que desees omitir la pantalla de autorización, como cuando autorizas a un cliente propio. Puedes lograr esto <a href="#overriding-default-models">extendiendo el modelo <code>Client</code></a> y definiendo un método <code>skipsAuthorization</code>. Si <code>skipsAuthorization</code> devuelve <code>true</code> el cliente será aprobado y el usuario será redirigido de nuevo a la <code>redirect_uri</code> inmediatamente.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Client</span> <span class="token keyword">as</span> BaseClient<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token keyword">extends</span> <span class="token class-name">BaseClient</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
        * Determine if the client should skip the authorization prompt.
        *
        * @return bool
        */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">skipsAuthorization</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">firstParty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="conversion-de-codigos-de-autorizacion-a-tokens-de-acceso"><a href="#conversion-de-codigos-de-autorizacion-a-tokens-de-acceso" class="header-anchor">#</a> Conversión de códigos de autorización a tokens de acceso</h4> <p>Si el usuario aprueba la solicitud de autorización, será redirigido de nuevo a la aplicación consumidora. El consumidor debe verificar primero el parámetro <code>state</code> contra el valor almacenado antes de la redirección. Si el parámetro state coincide, el consumidor debe emitir una solicitud <code>POST</code> a tu aplicación para solicitar un token de acceso. La solicitud debe incluir el código de autorización que fue emitido por tu aplicación cuando el usuario aprobó la solicitud de autorización. En este ejemplo, utilizaremos la librería Guzzle HTTP para hacer la solicitud <code>POST</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/callback'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$state</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">throw_unless</span><span class="token punctuation">(</span>
        <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$state</span> <span class="token operator">===</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">state</span><span class="token punctuation">,</span>
        InvalidArgumentException<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$http</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuzzleHttp<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$http</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'grant_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'authorization_code'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'client_secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-secret'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'redirect_uri'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://example.com/callback'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'code'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">code</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Esta ruta <code>/oauth/token</code> devolverá una respuesta JSON que contiene los atributos <code>access_token</code>, <code>refresh_token</code>, y <code>expires_in</code>. El atributo <code>expires_in</code> contiene el número de segundos hasta que el token de acceso expire.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Como la ruta <code>/oauth/authorize</code>, la ruta <code>/oauth/token</code> está definida para ti por el método <code>Passport::routes</code>. No necesitas definir manualmente esta ruta. Por defecto, esta ruta es regulada usando la configuración del middleware <code>ThrottleRequests</code>.</p></div> <p><a name="refreshing-tokens"></a></p> <h3 id="actualizacion-de-tokens"><a href="#actualizacion-de-tokens" class="header-anchor">#</a> Actualización de tokens</h3> <p>Si tu aplicación emite tokens de acceso de corta duración, los usuarios deberán actualizar sus tokens de acceso por medio del token de actualización que se les proporcionó cuando se emitió el token de acceso. En este ejemplo, utilizaremos la librería Guzzle HTTP para actualizar el token:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$http</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuzzleHttp<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$http</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'grant_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'refresh_token'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'refresh_token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'the-refresh-token'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-secret'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Esta ruta <code>/oauth/token</code> devolverá una respuesta JSON que contiene los atributos <code>access_token</code>, <code>refresh_token</code>, y <code>expires_in</code>. El atributo <code>expires_in</code> contiene el número de segundos hasta que el token de acceso expire.</p> <p><a name="purging-tokens"></a></p> <h3 id="eliminando-tokens"><a href="#eliminando-tokens" class="header-anchor">#</a> Eliminando tokens</h3> <p>Cuando los tokens han sido revocados o han expirado, es posible que desees eliminarlos de la base de datos. Passport viene con un comando que puede hacer esto por ti:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token shell-comment comment"># Purge revoked and expired tokens and auth codes...</span>
php artisan passport<span class="token punctuation">:</span>purge

<span class="token shell-comment comment"># Only purge revoked tokens and auth codes...</span>
php artisan passport<span class="token punctuation">:</span>purge <span class="token operator">--</span>revoked 

<span class="token shell-comment comment"># Only purge expired tokens and auth codes...</span>
php artisan passport<span class="token punctuation">:</span>purge <span class="token operator">--</span>expired
</code></pre></div><p>También puedes configurar un <a href="/scheduling.html">trabajo programado</a> en la clase <code>Kernel</code> de tu consola para eliminar automáticamente los tokens según una programación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
    * Define the application's command schedule.
    *
    * @param  \Illuminate\Console\Scheduling\Schedule  $schedule
    * @return void
    */</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span>Schedule <span class="token variable">$schedule</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$schedule</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'passport:purge'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hourly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="code-grant-pkce"></a></p> <h2 id="otorgando-codigos-de-autorizacion-con-pkce"><a href="#otorgando-codigos-de-autorizacion-con-pkce" class="header-anchor">#</a> Otorgando códigos de autorización con PKCE</h2> <p>Otorgar códigos de autorización con &quot;Clave de prueba para el intercambio de código&quot; (Proof Key for Code Exchange o PKCE) es una forma segura de autenticar aplicaciones de una sola página (SPA) o aplicaciones nativas para acceder a tu API. Esta forma de acceso se debe usar cuando no puedas garantizar que la clave secreta del cliente se almacenará de forma confidencial o para mitigar la amenaza de que un atacante intercepte el código de autorización. Una combinación de un &quot;verificador de código&quot; y un &quot;desafío de código&quot; reemplaza la clave secreta del cliente cuando se cambia el código de autorización por un token de acceso.</p> <p><a name="creating-a-auth-pkce-grant-client"></a></p> <h3 id="creando-el-cliente"><a href="#creando-el-cliente" class="header-anchor">#</a> Creando el cliente</h3> <p>Antes que tu aplicación pueda emitir tokens por medio del código de autorización otorgado con PKCE, necesitarás crear un cliente habilitado para PKCE. Puedes hacer esto usando el comando <code>passport:client</code> con la opción <code>--public</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>client <span class="token operator">--</span><span class="token keyword">public</span>
</code></pre></div><p><a name="requesting-auth-pkce-grant-tokens"></a></p> <h3 id="solicitando-tokens-2"><a href="#solicitando-tokens-2" class="header-anchor">#</a> Solicitando tokens</h3> <h4 id="verificador-de-codigo-y-desafio-de-codigo"><a href="#verificador-de-codigo-y-desafio-de-codigo" class="header-anchor">#</a> Verificador de código y desafío de código</h4> <p>Como otorgar esta autorización no proporciona una clave secreta al cliente, los desarrolladores necesitarán generar una combinación de un verificador de código y un desafío de código para solicitar un token.</p> <p>El verificador de código debe ser una cadena aleatoria entre 43 y 128 caracteres que contengan letras, números y <code>&quot;-&quot;</code>, <code>&quot;.&quot;</code>, <code>&quot;_&quot;</code>, <code>&quot;~&quot;</code>, como se define en la <a href="https://tools.ietf.org/html/rfc7636" target="_blank" rel="noopener noreferrer">especificación RFC 7636<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>El desafío de código debe ser una cadena codificada en Base64 con URL y caracteres seguros para el nombre de archivo. Los caracteres <code>'='</code> al final deben ser eliminados y no debe haber saltos de línea, espacios en blanco u otros caracteres adicionales.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$encoded</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$code_verifier</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$codeChallenge</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token function">rtrim</span><span class="token punctuation">(</span><span class="token variable">$encoded</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'='</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'+/'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'-_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="redireccion-para-autorizacion-2"><a href="#redireccion-para-autorizacion-2" class="header-anchor">#</a> Redirección para autorización</h4> <p>Una vez que se ha creado un cliente, puedes usar el ID del cliente, el verificador de código generado y el desafío de código para solicitar un código de autorización y un token de acceso de tu aplicación. En primer lugar, la aplicación consumidora debe hacer una solicitud de redirección a la ruta <code>/oauth/authorize</code> de tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/redirect'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'state'</span><span class="token punctuation">,</span> <span class="token variable">$state</span> <span class="token operator">=</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'code_verifier'</span><span class="token punctuation">,</span> <span class="token variable">$code_verifier</span> <span class="token operator">=</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$codeChallenge</span> <span class="token operator">=</span> <span class="token function">strtr</span><span class="token punctuation">(</span><span class="token function">rtrim</span><span class="token punctuation">(</span>
        <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$code_verifier</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token single-quoted-string string">'='</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'+/'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'-_'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'redirect_uri'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://example.com/callback'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'response_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'code'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'state'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$state</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'code_challenge'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$codeChallenge</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'code_challenge_method'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'S256'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/authorize?'</span><span class="token punctuation">.</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="conversion-de-codigos-de-autorizacion-a-tokens-de-acceso-2"><a href="#conversion-de-codigos-de-autorizacion-a-tokens-de-acceso-2" class="header-anchor">#</a> Conversión de códigos de autorización a tokens de acceso</h4> <p>Si el usuario aprueba la solicitud de autorización, será redirigido de nuevo a la aplicación consumidora. El consumidor debe verificar el parámetro <code>state</code> contra el valor almacenado antes de la redirección, como en el otorgamiento de código de autorización estándar.</p> <p>Si el parámetro state coincide, el consumidor debe emitir una solicitud <code>POST</code> a tu aplicación para solicitar un token de acceso. La solicitud debe incluir el código de autorización que fue emitido por tu aplicación cuando el usuario aprobó la solicitud de autorización junto con el verificador de código generado originalmente:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/callback'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$state</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'state'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$codeVerifier</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'code_verifier'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">throw_unless</span><span class="token punctuation">(</span>
        <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$state</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$state</span> <span class="token operator">===</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">state</span><span class="token punctuation">,</span>
        InvalidArgumentException<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GuzzleHttp<span class="token punctuation">\</span>Client</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'grant_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'authorization_code'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'redirect_uri'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://example.com/callback'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'code_verifier'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$codeVerifier</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'code'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">code</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="password-grant-tokens"></a></p> <h2 id="tokens-de-permiso-de-contrasena"><a href="#tokens-de-permiso-de-contrasena" class="header-anchor">#</a> Tokens de permiso de contraseña</h2> <p>Otorgar contraseña de OAuth2 permite a tus otros clientes externos, como una aplicación móvil, obtener un token de acceso usando una dirección de correo electrónico / nombre de usuario y una contraseña. Esto te permite emitir tokens de acceso de forma segura a tus clientes externos sin necesidad de que tus usuarios pasen por todo el flujo de redirección del código de autorización de OAuth2.</p> <p><a name="creating-a-password-grant-client"></a></p> <h3 id="creando-un-cliente-con-permiso-de-contrasena"><a href="#creando-un-cliente-con-permiso-de-contrasena" class="header-anchor">#</a> Creando un cliente con permiso de contraseña</h3> <p>Antes que tu aplicación pueda emitir tokens por medio de permiso de contraseña, necesitarás crear un cliente con permiso de contraseña. Puedes hacer esto usando el comando <code>passport:client</code> con la opción <code>--password</code>. Si ya has ejecutado el comando <code>passport:install</code>, no necesitas ejecutar este comando:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>client <span class="token operator">--</span>password
</code></pre></div><p><a name="requesting-password-grant-tokens"></a></p> <h3 id="solicitando-tokens-3"><a href="#solicitando-tokens-3" class="header-anchor">#</a> Solicitando tokens</h3> <p>Una vez que se ha creado un cliente con permiso de contraseña, puedes solicitar un token de acceso emitiendo una solicitud <code>POST</code> a la ruta <code>/oauth/token</code> con la dirección de correo electrónico y la contraseña del usuario. Recuerda, esta ruta ya está registrada por el método <code>Passport::routes</code> por lo que no es necesario definirla manualmente. Si la solicitud es exitosa, recibirás un <code>access_token</code> y un <code>refresh_token</code> en la respuesta JSON del servidor:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$http</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuzzleHttp<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$http</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'grant_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'password'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-secret'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'username'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'taylor@laravel.com'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'my-password'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Recuerda, los tokens de acceso son de larga duración de forma predeterminada. Sin embargo, eres libre de <a href="#configuration">configurar la duración máxima del token de acceso</a> si es necesario.</p></div> <p><a name="requesting-all-scopes"></a></p> <h3 id="solicitando-todos-los-alcances"><a href="#solicitando-todos-los-alcances" class="header-anchor">#</a> Solicitando todos los alcances</h3> <p>Al usar el permiso de contraseña o el permiso de credenciales de clientes, es posible que desees autorizar el token para todos los alcances soportados por tu aplicación. Puedes hacer esto solicitando el alcance <code>*</code>. Si solicitas el alcance <code>*</code>, el método <code>can</code> en la instancia del token siempre devolverá <code>true</code>. Este alcance solo puede asignarse a un token que es emitido usando el permiso <code>password</code> o <code>client_credentials</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$http</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'grant_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'password'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-secret'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'username'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'taylor@laravel.com'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'my-password'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'*'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="customizing-the-username-field"></a></p> <h3 id="personalizando-el-campo-username"><a href="#personalizando-el-campo-username" class="header-anchor">#</a> Personalizando el campo username</h3> <p>Al autenticar usando el permiso de contraseña, Passport usará el atributo <code>email</code> de tu modelo como el &quot;username&quot;. Sin embargo, puedes personalizar este comportamiento definiendo un método <code>findForPassport</code> en tu modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notifiable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>HasApiTokens</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasApiTokens</span><span class="token punctuation">,</span> Notifiable<span class="token punctuation">;</span>

    <span class="token comment">/**
        * Find the user instance for the given username.
        *
        * @param  string  $username
        * @return \App\User
        */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">findForPassport</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'username'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="customizing-the-password-validation"></a></p> <h3 id="personalizando-la-validacion-de-la-contrasena"><a href="#personalizando-la-validacion-de-la-contrasena" class="header-anchor">#</a> Personalizando la validación de la contraseña</h3> <p>Al autenticar usando el permiso de contraseña, Passport usará el atributo <code>password</code> de tu modelo para validar la contraseña dada. Si tu modelo no tiene un atributo <code>password</code> o deseas personalizar la lógica de validación de la contraseña, puedes definir un método <code>validateForPassportPasswordGrant</code> en tu modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> Authenticatable<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>Notifiable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Hash</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>HasApiTokens</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">HasApiTokens</span><span class="token punctuation">,</span> Notifiable<span class="token punctuation">;</span>

    <span class="token comment">/**
        * Validate the password of the user for the Passport password grant.
        *
        * @param  string  $password
        * @return bool
        */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">validateForPassportPasswordGrant</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Hash<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="implicit-grant-tokens"></a></p> <h2 id="tokens-de-permiso-implicito"><a href="#tokens-de-permiso-implicito" class="header-anchor">#</a> Tokens de permiso implícito</h2> <p>El permiso implícito es similar al permiso de código de autorización; sin embargo, el token es devuelto al cliente sin intercambiar un código de autorización. Este permiso es usado con mayor frecuencia para Javascript o aplicaciones móviles donde las credenciales del cliente no se pueden almacenar de forma segura. Para habilitar este permiso, llama al método <code>enableImplicitGrant</code> en tu <code>AuthServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
    * Register any authentication / authorization services.
    *
    * @return void
    */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">enableImplicitGrant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Una vez que se ha habilitado un permiso, los desarrolladores pueden usar el ID del cliente para solicitar un token de acceso de tu aplicación. La aplicación consumidora debe hacer una solicitud de redirección a la ruta <code>/oauth/authorize</code> de tu aplicación de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/redirect'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'state'</span><span class="token punctuation">,</span> <span class="token variable">$state</span> <span class="token operator">=</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'redirect_uri'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://example.com/callback'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'response_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'token'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'state'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$state</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/authorize?'</span><span class="token punctuation">.</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Recuerda, la ruta <code>/oauth/authorize</code> ya está definida por el método <code>Passport::routes</code>. No necesitas definir esta ruta manualmente.</p></div> <p><a name="client-credentials-grant-tokens"></a></p> <h2 id="tokens-de-permiso-de-credenciales-de-cliente"><a href="#tokens-de-permiso-de-credenciales-de-cliente" class="header-anchor">#</a> Tokens de permiso de credenciales de cliente</h2> <p>El permiso de credenciales de clientes es adecuado para la autenticación máquina-a-máquina. Por ejemplo, podrías usar este permiso en un trabajo programado que realice una tarea de mantenimiento a través de una API.</p> <p>Antes de que tu aplicación pueda emitir tokens por medio del permiso de credenciales de cliente, necesitarás crear un cliente con permiso de credenciales de clientes. Puedes hacer esto usando la opción <code>--client</code> del comando <code>passport:client</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>client <span class="token operator">--</span>client
</code></pre></div><p>A continuación, para usar este tipo de permiso, necesitas agregar el middleware <code>CheckClientCredentials</code> a la propiedad <code>$routeMiddleware</code> de tu archivo <code>app/Http/Kernel.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>CheckClientCredentials</span><span class="token punctuation">;</span>

<span class="token keyword">protected</span> <span class="token variable">$routeMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'client'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> CheckClientCredentials<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>Ahora, añade al middleware a una ruta:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/orders'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'client'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para el acceso restringido a la ruta a alcances específicos, puedes proporcionar una lista delimitada por comas de los alcances requeridos al añadir el middleware <code>client</code> a la ruta:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/orders'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'client:check-status,your-scope'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="recuperando-tokens"><a href="#recuperando-tokens" class="header-anchor">#</a> Recuperando Tokens</h3> <p>Para recuperar un token usando este tipo de permiso, debes hacer una solicitud al endpoint <code>oauth/token</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$guzzle</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GuzzleHttp<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>

<span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$guzzle</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'grant_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client_credentials'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'client_secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-secret'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'your-scope'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="personal-access-tokens"></a></p> <h2 id="tokens-de-acceso-personal"><a href="#tokens-de-acceso-personal" class="header-anchor">#</a> Tokens de acceso personal</h2> <p>A veces, es posible que tus usuarios quieran emitir tokens de acceso a sí mismos sin pasar por el típico flujo de redirección del código de autorización. Permitir que los usuarios emitan tokens a sí mismos a través de la interfaz de tu aplicación puede ser útil para permitir que los usuarios experimenten con tu API o puede servir como un enfoque más sencillo para emitir tokens de acceso en general.</p> <p><a name="creating-a-personal-access-client"></a></p> <h3 id="creando-un-cliente-de-acceso-personal"><a href="#creando-un-cliente-de-acceso-personal" class="header-anchor">#</a> Creando un cliente de acceso personal</h3> <p>Antes que tu aplicación pueda emitir tokens de acceso personal, necesitarás crear un cliente de acceso personal. Puedes hacer esto usando el comando <code>passport:client</code> con la opción <code>--personal</code>. Si ya has ejecutado el comando <code>passport:install</code>, no necesitas ejecutar este comando:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan passport<span class="token punctuation">:</span>client <span class="token operator">--</span>personal
</code></pre></div><p>Si ya has definido un cliente de acceso personal, puedes indicarle a Passport que lo use mediante el método <code>personalAccessClientId</code>. Normalmente, este método debe ser llamado desde el método <code>boot</code> de tu <code>AuthServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
    * Register any authentication / authorization services.
    *
    * @return void
    */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">personalAccessClientId</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="managing-personal-access-tokens"></a></p> <h3 id="administrando-tokens-de-acceso-personal"><a href="#administrando-tokens-de-acceso-personal" class="header-anchor">#</a> Administrando tokens de acceso personal</h3> <p>Una vez que se ha creado un cliente de acceso personal, puedes enviar tokens para un usuario dado usando el método <code>createToken</code> en la instancia de modelo <code>User</code>. El método <code>createToken</code> acepta el nombre del token como primer argumento y un arreglo opcional de <a href="#token-scopes">alcances</a> como segundo argumento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Creating a token without scopes...</span>
<span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createToken</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Token Name'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">accessToken</span><span class="token punctuation">;</span>

<span class="token comment">// Creating a token with scopes...</span>
<span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createToken</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'My Token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'place-orders'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">accessToken</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="api-json-2"><a href="#api-json-2" class="header-anchor">#</a> API JSON</h4> <p>Passport también incluye un API JSON para administrar tokens de acceso personal. Puedes combinarlo con tu propio frontend para ofrecer a tus usuarios un panel de control para administrar los tokens de acceso personal. A continuación, revisaremos todos los endpoints del API para administrar tokens de acceso personal. Por comodidad, usaremos <a href="https://github.com/mzabriskie/axios" target="_blank" rel="noopener noreferrer">Axios<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> para demostrar cómo realizar solicitudes HTTP a los endpoints.</p> <p>La API JSON está protegida por los middleware <code>web</code> y <code>auth</code>; por lo tanto, sólo puede ser llamada desde tu propia aplicación. No se puede llamar desde una fuente externa.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si no quieres implementar el frontend del token de acceso personal tu mismo, puedes usar el <a href="#frontend-quickstart">inicio rápido de frontend</a> para tener un frontend completamente funcional en sólo minutos.</p></div> <h4 id="get-oauth-scopes"><a href="#get-oauth-scopes" class="header-anchor">#</a> <code>GET /oauth/scopes</code></h4> <p>Esta ruta devuelve todos los <a href="#token-scopes">alcances</a> definidos para tu aplicación. Puedes usar esta ruta para listar los alcances que un usuario puede asignar a un token de acceso personal:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/oauth/scopes'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="get-oauth-personal-access-tokens"><a href="#get-oauth-personal-access-tokens" class="header-anchor">#</a> <code>GET /oauth/personal-access-tokens</code></h4> <p>Esta ruta devuelve todos los tokens de acceso personal que el usuario autenticado ha creado. Esto es útil principalmente para listar todos los tokens del usuario para que puedan editarlos o eliminarlos:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/oauth/personal-access-tokens'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="post-oauth-personal-access-tokens"><a href="#post-oauth-personal-access-tokens" class="header-anchor">#</a> <code>POST /oauth/personal-access-tokens</code></h4> <p>Esta ruta crea nuevos tokens de acceso personal. Requiere dos datos: el <code>name</code> del token y el <code>scopes</code> que debe ser asignado al token:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Token Name'</span><span class="token punctuation">,</span>
    scopes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/oauth/personal-access-tokens'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span> <span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// List errors on response...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="delete-oauth-personal-access-tokens-token-id"><a href="#delete-oauth-personal-access-tokens-token-id" class="header-anchor">#</a> <code>DELETE /oauth/personal-access-tokens/{token-id}</code></h4> <p>Esta ruta se puede usar para eliminar tokens de acceso personal:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'/oauth/personal-access-tokens/'</span> <span class="token operator">+</span> tokenId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="protecting-routes"></a></p> <h2 id="protegiendo-rutas"><a href="#protegiendo-rutas" class="header-anchor">#</a> Protegiendo rutas</h2> <p><a name="via-middleware"></a></p> <h3 id="por-medio-de-middleware"><a href="#por-medio-de-middleware" class="header-anchor">#</a> Por medio de middleware</h3> <p>Passport incluye un <a href="/authentication.html#adding-custom-guards">guard de autenticación</a> que validará los tokens de acceso en las solicitudes entrantes. Una vez que has configurado el guard <code>api</code> para usar el driver <code>passport</code>, sólo necesitas especificar el middleware <code>auth:api</code> en cualquier ruta que requiera token de acceso válido:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'auth:api'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="passing-the-access-token"></a></p> <h3 id="pasando-el-token-de-acceso"><a href="#pasando-el-token-de-acceso" class="header-anchor">#</a> Pasando el token de acceso</h3> <p>Al llamar rutas que son protegidas por Passport, los consumidores del API de tu aplicación deben especificar su token de acceso como un token <code>Bearer</code> en el encabezado <code>Authorization</code> de su solicitud. Por ejemplo, al usar la librería Guzzle HTTP:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'GET'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/api/user'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'headers'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'Accept'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'application/json'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'Authorization'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Bearer '</span><span class="token punctuation">.</span><span class="token variable">$accessToken</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="token-scopes"></a></p> <h2 id="alcances-de-token"><a href="#alcances-de-token" class="header-anchor">#</a> Alcances de token</h2> <p>Los alcances permiten a tus clientes de la API solicitar un conjunto específico de permisos cuando solicitan autorización para acceder a una cuenta. Por ejemplo, si estás construyendo una aplicación de comercio electrónico, no todos los consumidores de la API necesitarán la capacidad de hacer pedidos. En lugar de eso, puedes permitir que los consumidores sólo soliciten autorización para acceder a los estados de envío del pedido. En otras palabras, los alcances permiten a los usuarios de tu aplicación limitar las acciones que una aplicación de terceros puede realizar en su nombre.</p> <p><a name="defining-scopes"></a></p> <h3 id="definiendo-alcances"><a href="#definiendo-alcances" class="header-anchor">#</a> Definiendo alcances</h3> <p>Puedes definir los alcances de tu API usando el método <code>Passport::tokensCan</code> en el método <code>boot</code> de tu <code>AuthServiceProvider</code>. El método <code>tokensCan</code> acepta un arreglo de nombres de alcance y descripciones del alcance. La descripción del alcance puede ser cualquier cosa que desees y se mostrará a los usuarios en la pantalla de aprobación de autorización.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span>

Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">tokensCan</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'place-orders'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Place orders'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'check-status'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Check order status'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="default-scope"></a></p> <h3 id="alcance-predeterminado"><a href="#alcance-predeterminado" class="header-anchor">#</a> Alcance predeterminado</h3> <p>Si un cliente no solicita ningún alcance específico, puedes configurar tu servidor Passport para añadir un alcance predeterminado al token usando el método <code>setDefaultScope</code>. Normalmente, debes llamar a este método desde del método <code>boot</code> de tu <code>AuthServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span>

Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">setDefaultScope</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'check-status'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'place-orders'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="assigning-scopes-to-tokens"></a></p> <h3 id="asignando-alcances-a-los-tokens"><a href="#asignando-alcances-a-los-tokens" class="header-anchor">#</a> Asignando alcances a los Tokens</h3> <h4 id="al-solicitar-codigos-de-autorizacion"><a href="#al-solicitar-codigos-de-autorizacion" class="header-anchor">#</a> Al solicitar códigos de autorización</h4> <p>Al solicitar un token de acceso usando el permiso de código de autorización, los consumidores deben especificar sus alcances deseados como el parámetro de cadena de consulta <code>scope</code>. El parámetro <code>scope</code> debe ser una lista de alcances delimitada por espacios:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/redirect'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token function">http_build_query</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'client_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'client-id'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'redirect_uri'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'http://example.com/callback'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'response_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'code'</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'place-orders check-status'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token function">redirect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'http://your-app.com/oauth/authorize?'</span><span class="token punctuation">.</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="al-emitir-tokens-de-acceso-personal"><a href="#al-emitir-tokens-de-acceso-personal" class="header-anchor">#</a> Al emitir tokens de acceso personal</h4> <p>Si estás emitiendo tokens de acceso personal usando el método <code>createToken</code> del modelo <code>User</code>, puedes pasar el arreglo de alcances deseados como segundo argumento al método:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">createToken</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'My Token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'place-orders'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">accessToken</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="checking-scopes"></a></p> <h3 id="verificando-alcances"><a href="#verificando-alcances" class="header-anchor">#</a> Verificando alcances</h3> <p>Passport incluye dos middleware que pueden ser usados para verificar que una solicitud entrante es autenticada con un token al que se le ha otorgado un alcance dado. Para empezar, agrega el siguiente middleware a la propiedad <code>$routeMiddleware</code> de tu archivo <code>app/Http/Kernel.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'scopes'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> \<span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>CheckScopes</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
<span class="token single-quoted-string string">'scope'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> \<span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>CheckForAnyScope</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="verificar-todos-los-alcances"><a href="#verificar-todos-los-alcances" class="header-anchor">#</a> Verificar todos los alcances</h4> <p>El middleware <code>scopes</code> puede ser asignado a una ruta para verificar que el token de acceso de la solicitud entrante tiene <em>todos</em> los alcances listados:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/orders'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Access token has both &quot;check-status&quot; and &quot;place-orders&quot; scopes...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'auth:api'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'scopes:check-status,place-orders'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="verificar-si-hay-alcances"><a href="#verificar-si-hay-alcances" class="header-anchor">#</a> Verificar si hay alcances</h4> <p>El middleware <code>scope</code> puede ser asignado a una ruta para verificar que el token de acceso de la solicitud entrante tiene <em>al menos uno</em> de los alcances listados:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/orders'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Access token has either &quot;check-status&quot; or &quot;place-orders&quot; scope...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'auth:api'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'scope:check-status,place-orders'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="verificar-alcances-en-una-instancia-de-token"><a href="#verificar-alcances-en-una-instancia-de-token" class="header-anchor">#</a> Verificar alcances en una instancia de token</h4> <p>Una vez que una solicitud autenticada de token de acceso ha entrado en tu aplicación, puedes verificar si el token tiene un alcance dado usando el método <code>tokenCan</code> en la instancia <code>User</code> autenticada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/orders'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">tokenCan</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'place-orders'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="metodos-de-alcance-adicionales"><a href="#metodos-de-alcance-adicionales" class="header-anchor">#</a> Métodos de alcance adicionales</h4> <p>El método <code>scopeIds</code> devolverá un arreglo de todos los IDs / nombres definidos:</p> <div class="language-php extra-class"><pre class="language-php"><code>Laravel\<span class="token package">Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">scopeIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>scopes</code> devolverá un arreglo de todos los alcances definidos como instancias de <code>Laravel\Passport\Scope</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Laravel\<span class="token package">Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">scopes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>El método <code>scopesFor</code> devolverá un arreglo de instancias <code>Laravel\Passport\Scope</code> que coincidan con los IDs / nombres dados:</p> <div class="language-php extra-class"><pre class="language-php"><code>Laravel\<span class="token package">Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">scopesFor</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'place-orders'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'check-status'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes determinar si un alcance dado ha sido definido usando el método <code>hasScope</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Laravel\<span class="token package">Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">hasScope</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'place-orders'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="consuming-your-api-with-javascript"></a></p> <h2 id="consumiendo-tu-api-con-javascript"><a href="#consumiendo-tu-api-con-javascript" class="header-anchor">#</a> Consumiendo tu API con JavaScript</h2> <p>Cuando se construye una API, puede ser extremadamente útil poder consumir tu propia API desde tu aplicación JavaScript. Este enfoque para el desarrollo de la API permite que tu propia aplicación consuma la misma API que estás compartiendo con el mundo. La misma API puede ser consumida por tu aplicación web, aplicaciones móviles, aplicaciones de terceros y cualquier SDK que puedas publicar en varios gestores de paquetes.</p> <p>Normalmente, si quieres consumir tu API desde tu aplicación Javascript, necesitarás enviar manualmente un token de acceso a la aplicación y pasarlo con cada solicitud a tu aplicación. Sin embargo, Passport incluye un middleware que puede manejar esto por ti. Todo lo que necesitas hacer es agregar el middleware <code>CreateFreshApiToken</code> a tu grupo de middleware <code>web</code> en tu archivo <code>app/Http/Kernel.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'web'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token comment">// Other middleware...</span>
    \<span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Middleware<span class="token punctuation">\</span>CreateFreshApiToken</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Debes asegurarte que el middleware <code>CreateFreshApiToken</code> es el último middleware que aparece en tu pila de middleware.</p></div> <p>Este middleware de Passport agregará una cookie <code>laravel_token</code> en tus respuestas salientes. Este cookie contiene un JWT encriptado que Passport utilizará para autenticar las solicitudes de API desde tu aplicación JavaScript. Ahora, puedes hacer solicitudes a la API de tu aplicación sin pasar explícitamente un token de acceso:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="personalizando-el-nombre-de-la-cookie"><a href="#personalizando-el-nombre-de-la-cookie" class="header-anchor">#</a> Personalizando el nombre de la cookie</h4> <p>Si es necesario, puedes personalizar el nombre de la cookie <code>laravel_token</code> usando el método <code>Passport::cookie</code>. Normalmente, deberías llamar a este método desde el método <code>boot</code> de tu <code>AuthServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
    * Register any authentication / authorization services.
    *
    * @return void
    */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'custom_name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="proteccion-csrf"><a href="#proteccion-csrf" class="header-anchor">#</a> Protección CSRF</h4> <p>Al usar este método de autenticación, necesitarás asegurarte que se incluya un encabezado de token CSRF válido en tus solicitudes. El scaffolding Javascript de Laravel por defecto incluye una instancia Axios, que usará automáticamente el valor de la cookie <code>XSRF-TOKEN</code> encriptado para enviar un encabezado <code>X-XSRF-TOKEN</code> en solicitudes del mismo origen.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si eliges enviar el encabezado <code>X-CSRF-TOKEN</code> en lugar de <code>X-XSRF-TOKEN</code>, necesitarás usar el token no encriptado proporcionado por <code>csrf_token()</code>.</p></div> <p><a name="events"></a></p> <h2 id="eventos"><a href="#eventos" class="header-anchor">#</a> Eventos</h2> <p>Passport genera eventos cuando se emiten tokens de acceso y tokens de actualización. Puedes usar estos eventos para eliminar o revocar otros tokens de acceso en tu base de datos. Puedes añadir listeners a estos eventos en el <code>EventServiceProvider</code> de tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
    * The event listener mappings for the application.
    *
    * @var array
    */</span>
<span class="token keyword">protected</span> <span class="token variable">$listen</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'Laravel\Passport\Events\AccessTokenCreated'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'App\Listeners\RevokeOldTokens'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'Laravel\Passport\Events\RefreshTokenCreated'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'App\Listeners\PruneOldTokens'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="testing"></a></p> <h2 id="pruebas"><a href="#pruebas" class="header-anchor">#</a> Pruebas</h2> <p>El método <code>actingAs</code> de Passport puede ser usado para especificar el usuario autenticado actualmente, así como sus alcances. El primer argumento dado al método <code>actingAs</code> es la instancia del usuario y el segundo es un arreglo de alcances que deben ser otorgados al token del usuario:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testServerCreation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">actingAs</span><span class="token punctuation">(</span>
        <span class="token function">factory</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token single-quoted-string string">'create-servers'</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/api/create-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>El método <code>actingAsClient</code> de Passport puede ser usado para especificar el cliente autenticado actualmente, así como sus alcances. El primer argumento dado al método <code>actingAsClient</code> es la instancia del cliente y el segundo es un arreglo de alcances que deben ser otorgados al token del cliente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Laravel<span class="token punctuation">\</span>Passport<span class="token punctuation">\</span>Passport</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testGetOrders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Passport<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">actingAsClient</span><span class="token punctuation">(</span>
        <span class="token function">factory</span><span class="token punctuation">(</span>Client<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token single-quoted-string string">'check-status'</span><span class="token punctuation">]</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/api/orders'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertStatus</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/stydenet/laravel-spanish-docs/edit/6.0_press/docs/passport.md" target="_blank" rel="noopener noreferrer">Editar esta página en GitHub</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Última actualización:</span> <span class="time">9/28/2020, 10:45:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/horizon.html" class="prev">
        Laravel Horizon
      </a></span> <span class="next"><a href="/scout.html">
        Scout para Laravel
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.453cd102.js" defer></script><script src="/assets/js/3.ec4a9ac9.js" defer></script><script src="/assets/js/58.831ff200.js" defer></script>
  </body>
</html>
