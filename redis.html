<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.cf5cbaa5.css" as="style"><link rel="preload" href="/assets/js/app.d18a7e07.js" as="script"><link rel="preload" href="/assets/js/2.8e5ca9eb.js" as="script"><link rel="preload" href="/assets/js/62.7d96c317.js" as="script"><link rel="prefetch" href="/assets/js/10.9d8f190d.js"><link rel="prefetch" href="/assets/js/11.713069e3.js"><link rel="prefetch" href="/assets/js/12.8798d21a.js"><link rel="prefetch" href="/assets/js/13.332045e2.js"><link rel="prefetch" href="/assets/js/14.bda55a54.js"><link rel="prefetch" href="/assets/js/15.1c16c325.js"><link rel="prefetch" href="/assets/js/16.bbe1ecdf.js"><link rel="prefetch" href="/assets/js/17.068bc26e.js"><link rel="prefetch" href="/assets/js/18.d6a2ed70.js"><link rel="prefetch" href="/assets/js/19.9bbd4323.js"><link rel="prefetch" href="/assets/js/20.4a827d15.js"><link rel="prefetch" href="/assets/js/21.932f5ef3.js"><link rel="prefetch" href="/assets/js/22.47d672e1.js"><link rel="prefetch" href="/assets/js/23.63218e36.js"><link rel="prefetch" href="/assets/js/24.2c933036.js"><link rel="prefetch" href="/assets/js/25.2a9ac4af.js"><link rel="prefetch" href="/assets/js/26.b15e2a59.js"><link rel="prefetch" href="/assets/js/27.be0ff65a.js"><link rel="prefetch" href="/assets/js/28.aadf08f5.js"><link rel="prefetch" href="/assets/js/29.0e4ec215.js"><link rel="prefetch" href="/assets/js/3.0101ea7c.js"><link rel="prefetch" href="/assets/js/30.831305bd.js"><link rel="prefetch" href="/assets/js/31.afb33274.js"><link rel="prefetch" href="/assets/js/32.68089cf5.js"><link rel="prefetch" href="/assets/js/33.f7ed913e.js"><link rel="prefetch" href="/assets/js/34.4cddf81d.js"><link rel="prefetch" href="/assets/js/35.afbc7954.js"><link rel="prefetch" href="/assets/js/36.bc235e6d.js"><link rel="prefetch" href="/assets/js/37.cec3e2cc.js"><link rel="prefetch" href="/assets/js/38.177ed69f.js"><link rel="prefetch" href="/assets/js/39.e7e298ee.js"><link rel="prefetch" href="/assets/js/4.a2109108.js"><link rel="prefetch" href="/assets/js/40.f621f4d5.js"><link rel="prefetch" href="/assets/js/41.0994bd46.js"><link rel="prefetch" href="/assets/js/42.4debbf07.js"><link rel="prefetch" href="/assets/js/43.d73341a8.js"><link rel="prefetch" href="/assets/js/44.302a1d16.js"><link rel="prefetch" href="/assets/js/45.df1e9e80.js"><link rel="prefetch" href="/assets/js/46.5da4e78a.js"><link rel="prefetch" href="/assets/js/47.af4aeb70.js"><link rel="prefetch" href="/assets/js/48.1c6cac1a.js"><link rel="prefetch" href="/assets/js/49.73c1cc2c.js"><link rel="prefetch" href="/assets/js/5.886a8536.js"><link rel="prefetch" href="/assets/js/50.3653355c.js"><link rel="prefetch" href="/assets/js/51.f48454e2.js"><link rel="prefetch" href="/assets/js/52.fe1537a5.js"><link rel="prefetch" href="/assets/js/53.f53a4944.js"><link rel="prefetch" href="/assets/js/54.77ad79c0.js"><link rel="prefetch" href="/assets/js/55.a7dce0c8.js"><link rel="prefetch" href="/assets/js/56.2a61f71d.js"><link rel="prefetch" href="/assets/js/57.f958f8cd.js"><link rel="prefetch" href="/assets/js/58.c91cb9c9.js"><link rel="prefetch" href="/assets/js/59.726c9fa1.js"><link rel="prefetch" href="/assets/js/6.f7c00904.js"><link rel="prefetch" href="/assets/js/60.3f31de0a.js"><link rel="prefetch" href="/assets/js/61.7ad03400.js"><link rel="prefetch" href="/assets/js/63.98a36806.js"><link rel="prefetch" href="/assets/js/64.e0445065.js"><link rel="prefetch" href="/assets/js/65.1d583bc8.js"><link rel="prefetch" href="/assets/js/66.1ca08e1b.js"><link rel="prefetch" href="/assets/js/67.a6af6188.js"><link rel="prefetch" href="/assets/js/68.47b5f882.js"><link rel="prefetch" href="/assets/js/69.215666c5.js"><link rel="prefetch" href="/assets/js/7.9e06b9d3.js"><link rel="prefetch" href="/assets/js/70.2c9f04a2.js"><link rel="prefetch" href="/assets/js/71.1eb0d68f.js"><link rel="prefetch" href="/assets/js/72.28241988.js"><link rel="prefetch" href="/assets/js/73.fc04168a.js"><link rel="prefetch" href="/assets/js/74.3d242ebf.js"><link rel="prefetch" href="/assets/js/75.3cda21e9.js"><link rel="prefetch" href="/assets/js/76.785cfa56.js"><link rel="prefetch" href="/assets/js/77.25a3cfe2.js"><link rel="prefetch" href="/assets/js/78.a8f98b1a.js"><link rel="prefetch" href="/assets/js/79.c51ea229.js"><link rel="prefetch" href="/assets/js/8.f19546fb.js"><link rel="prefetch" href="/assets/js/80.21189343.js"><link rel="prefetch" href="/assets/js/9.e056c469.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cf5cbaa5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="redis"><a class="header-anchor" href="#redis">#</a> Redis</h1> <ul><li><a href="#introduction">Introducción</a> <ul><li><a href="#configuration">Configuración</a></li> <li><a href="#predis">Predis</a></li> <li><a href="#phpredis">PhpRedis</a></li></ul></li> <li><a href="#interacting-with-redis">Interactuar con redis</a> <ul><li><a href="#pipelining-commands">Canalizar comandos</a></li></ul></li> <li><a href="#pubsub">Pub / Sub</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion">#</a> Introducción</h2> <p><a href="https://redis.io" target="_blank" rel="noopener noreferrer">Redis<OutboundLink></OutboundLink></a> es un almacenamiento avanzado de pares clave-valor y de código abierto. A menudo se le denomina como un servidor de estructura de datos ya que las claves pueden contener <a href="https://redis.io/topics/data-types#strings" target="_blank" rel="noopener noreferrer">cadenas<OutboundLink></OutboundLink></a>, <a href="https://redis.io/topics/data-types#hashes" target="_blank" rel="noopener noreferrer">hashes<OutboundLink></OutboundLink></a>, <a href="https://redis.io/topics/data-types#lists" target="_blank" rel="noopener noreferrer">listas<OutboundLink></OutboundLink></a>, <a href="https://redis.io/topics/data-types#sets" target="_blank" rel="noopener noreferrer">sets<OutboundLink></OutboundLink></a> y <a href="https://redis.io/topics/data-types#sorted-sets" target="_blank" rel="noopener noreferrer">sets ordenados<OutboundLink></OutboundLink></a>.</p> <p>Antes de utilizar Redis con Laravel, te recomendamos que instales y uses la extensión de PHP <a href="https://github.com/phpredis/phpredis" target="_blank" rel="noopener noreferrer">PhpRedis<OutboundLink></OutboundLink></a> mediante PECL. La extensión es más difícil de instalar, pero contribuirá a un mejor rendimiento en aplicaciones que hacen un uso intensivo de Redis.</p> <p>Alternativamente, puedes instalar el paquete <code>predis/predis</code> mediante Composer:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>composer <span class="token keyword">require</span> predis<span class="token operator">/</span>predis
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">NOTA</p> <p>El mantenimiento de Predis se ha abandonado por su autor original y puede que sea eliminado de Laravel en futuras versiones.</p></div></div><p><a name="configuration"></a></p> <h3 id="configuracion"><a href="#configuracion" class="header-anchor">#</a> Configuración</h3> <p>La configuración de Redis para tu aplicación está ubicada en el archivo de configuración <code>config/database</code>. Dentro de este archivo, podrás ver el arreglo <code>redis</code> que contiene los servidores de Redis utilizados por tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>

    <span class="token single-quoted-string string">'client'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CLIENT'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'phpredis'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'default'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_HOST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PASSWORD'</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PORT'</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_DB'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'cache'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_HOST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PASSWORD'</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PORT'</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CACHE_DB'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>La configuración del servidor por defecto deberá ser suficiente para el entorno de desarrollo. Sin embargo, puedes modificar este arreglo según tu entorno. Cada servidor de Redis definido en tu archivo de configuración debe contener un nombre, host y puerto.</p> <h4 id="configuracion-de-clusters"><a href="#configuracion-de-clusters" class="header-anchor">#</a> Configuración de clusters</h4> <p>Si tu aplicación está utilizando un cluster de servidores Redis, debes definir esos clusters en la clave <code>clusters</code> de tu configuración de Redis:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>

    <span class="token single-quoted-string string">'client'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CLIENT'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'phpredis'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'clusters'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'default'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span>
                <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_HOST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PASSWORD'</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PORT'</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Por defecto, los clusters realizarán el sharding del lado del cliente a través de sus nodos, permitiéndote agrupar nodos y crear una gran cantidad de RAM disponible. Sin embargo, ten en cuenta que el sharding del lado del cliente no gestiona failover; por lo tanto, es principalmente adecuado para datos en caché que estén disponibles desde otro almacenamiento de datos primario. Si deseas utilizar el agrupamiento nativo de Redis, debes especificarlo en la clave <code>options</code> de tu configuración de Redis:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>

    <span class="token single-quoted-string string">'client'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CLIENT'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'phpredis'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'options'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'cluster'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CLUSTER'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'redis'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token single-quoted-string string">'clusters'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><a name="predis"></a></p> <h3 id="predis"><a href="#predis" class="header-anchor">#</a> Predis</h3> <p>Para utilizar la extensión Predis, debes cambiar la variable de entorno <code>REDIS_CLIENT</code> de <code>phpredis</code> a <code>predis</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>

    <span class="token single-quoted-string string">'client'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CLIENT'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'predis'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Rest of Redis configuration...</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Además de las opciones predeterminadas de la configuración del servidor <code>host</code>, <code>port</code>, <code>database</code> y <code>password</code>, Predis admite <a href="https://github.com/nrk/predis/wiki/Connection-Parameters" target="_blank" rel="noopener noreferrer">parámetros de conexión<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> adicionales que pueden ser definidos para cada uno de tus servidores de Redis. Para utilizar estas opciones de configuración adicionales, agrégalos a la configuración del servidor de Redis en el archivo de configuración <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'default'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_HOST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PASSWORD'</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PORT'</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'read_write_timeout'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><a name="phpredis"></a></p> <h3 id="phpredis"><a href="#phpredis" class="header-anchor">#</a> PhpRedis</h3> <p>La extensión PhpRedis está configurada por defecto en el fichero env como <code>REDIS_CLIENT</code> y en tu archivo de configuración <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'redis'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>

    <span class="token single-quoted-string string">'client'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_CLIENT'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'phpredis'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Rest of Redis configuration...</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>Si planeas usar la extensión PhpRedis junto con el alias del Facade <code>Redis</code>, deberías renombrarlo a otra cosa, como <code>RedisManager</code>, para evitar una colisión con la clase Redis. Puedes hacerlo en la sección de alias de tu archivo de configuración <code>app.php</code>.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'RedisManager'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Illuminate\<span class="token package">Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
</code></pre></div><p>Además de las opciones predeterminadas de configuración del servidor <code>host</code>, <code>port</code>, <code>database</code> y <code>password</code>, PhpRedis admite los siguientes parámetros de conexión adicionales: <code>persistent</code>, <code>prefix</code>, <code>read_timeout</code> y <code>timeout</code>. Puedes agregar cualquiera de estas opciones a tu configuración del servidor de Redis en el archivo de configuración <code>config/database.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'default'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'host'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_HOST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'localhost'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PASSWORD'</span><span class="token punctuation">,</span> <span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'port'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">env</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'REDIS_PORT'</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'database'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'read_timeout'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="facade-redis"><a href="#facade-redis" class="header-anchor">#</a> Facade Redis</h4> <p>Para evitar colisiones de nombres de clases con la propia extensión PHP de Redis, necesitarás eliminar o renombrar el alias del Facade <code>Illuminate\Support\Facades\Redis</code> del arreglo <code>aliases</code> de tu archivo de configuración <code>app</code>. Generalmente, deberás eliminar este alias por completo y sólo referenciar el Facade por su nombre de clase completo mientras que uses la extensión Redis PHP.</p> <p><a name="interacting-with-redis"></a></p> <h2 id="interactuar-con-redis"><a href="#interactuar-con-redis" class="header-anchor">#</a> Interactuar con redis</h2> <p>Puedes interactuar con Redis llamando varios métodos en el <a href="/facades.html">facade</a> <code>Redis</code>. El facade <code>Redis</code> admite métodos dinámicos, lo que significa que puedes llamar a cualquier <a href="https://redis.io/commands" target="_blank" rel="noopener noreferrer">comando de Redis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> en el facade y el comando será pasado directamente a Redis. En este ejemplo, vamos a llamar al comando <code>GET</code> de Redis llamando al método <code>get</code> en el facade <code>Redis</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Show the profile for the given user.
    *
    * @param  int  $id
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">showProfile</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$user</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user:profile:'</span><span class="token punctuation">.</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user.profile'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'user'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Como lo mencionamos anteriormente, puedes llamar a cualquier comando de Redis en el facade <code>Redis</code>. Laravel utiliza métodos mágicos para pasar los comandos al servidor de Redis, para que pases los argumentos que espera el comando de Redis:</p> <div class="language-php extra-class"><pre class="language-php"><code>Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Taylor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$values</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'names'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternativamente, también puedes pasar comandos al servidor usando el método <code>command</code>, el cual acepta el nombre del comando como primer argumento, y un arreglo de valores como segundo argumento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$values</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'lrange'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="utilizar-multiples-conexiones-de-redis"><a href="#utilizar-multiples-conexiones-de-redis" class="header-anchor">#</a> Utilizar múltiples conexiones de Redis</h4> <p>Puedes obtener una instancia de Redis llamando al método <code>Redis::connection</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$redis</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Esto te dará una instancia del servidor de Redis predeterminado. También puedes pasar la conexión o nombre del cluster al método <code>connection</code> para obtener un servidor o cluster en específico según lo definido en tu configuración de Redis:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$redis</span> <span class="token operator">=</span> Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">connection</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'my-connection'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="pipelining-commands"></a></p> <h3 id="canalizar-comandos"><a href="#canalizar-comandos" class="header-anchor">#</a> Canalizar comandos</h3> <p>La canalización debe ser utilizada cuando necesites enviar muchos comandos al servidor. El método <code>pipeline</code> acepta un argumento: una <code>Closure</code> que recibe una instancia de Redis. Puedes emitir todos tus comandos a esta instancia de Redis y después éstos serán enviados al servidor proporcionando mejor rendimiento:</p> <div class="language-php extra-class"><pre class="language-php"><code>Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$pipe</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$pipe</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;key:<span class="token interpolation"><span class="token variable">$i</span></span>&quot;</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="pubsub"></a></p> <h2 id="pub-sub"><a href="#pub-sub" class="header-anchor">#</a> Pub / Sub</h2> <p>Laravel proporciona una interfaz conveniente para los comandos <code>publish</code> y <code>subscribe</code> de Redis. Estos comandos de Redis te permiten escuchar mensajes en un &quot;canal&quot; dado. Puedes publicar mensajes en el canal desde otra aplicación, o incluso utilizando otro lenguaje de programación, lo que permite una comunicación sencilla entre aplicaciones y procesos.</p> <p>Primero, configuremos un listener para el canal usando el método <code>subscribe</code>. Vamos a colocar una llamada a este método en un <a href="/artisan.html">comando de Artisan</a> ya que llamar al método <code>subscribe</code> comienza un proceso de larga ejecución:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Commands</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Command</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Redis</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RedisSubscribe</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The name and signature of the console command.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'redis:subscribe'</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * The console command description.
    *
    * @var string
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$description</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'Subscribe to a Redis channel'</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Execute the console command.
    *
    * @return mixed
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'test-channel'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token variable">$message</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Ahora podemos publicar mensajes en el canal usando el método <code>publish</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'publish'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Route logic...</span>

    Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'test-channel'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'foo'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="suscripciones-de-comodines"><a href="#suscripciones-de-comodines" class="header-anchor">#</a> Suscripciones de comodines</h4> <p>Usando el método <code>psubscribe</code>, puedes suscribirte a un canal comodín, el cual puede ser útil para capturar todos los mensajes en todos los canales. El nombre del canal <code>$channel</code> será pasado como segundo argumento al callback <code>Closure</code> proporcionado:</p> <div class="language-php extra-class"><pre class="language-php"><code>Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">psubscribe</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token variable">$channel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$message</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Redis<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">psubscribe</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'users.*'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">,</span> <span class="token variable">$channel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$message</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d18a7e07.js" defer></script><script src="/assets/js/2.8e5ca9eb.js" defer></script><script src="/assets/js/62.7d96c317.js" defer></script>
  </body>
</html>
