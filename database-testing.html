<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.8.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.f7a12d87.css" as="style"><link rel="preload" href="/assets/js/app.237f7d41.js" as="script"><link rel="preload" href="/assets/js/2.648c6578.js" as="script"><link rel="preload" href="/assets/js/23.b6ce1d9c.js" as="script"><link rel="prefetch" href="/assets/js/10.20cff712.js"><link rel="prefetch" href="/assets/js/11.f0ca56a6.js"><link rel="prefetch" href="/assets/js/12.5865c9a5.js"><link rel="prefetch" href="/assets/js/13.8e509b37.js"><link rel="prefetch" href="/assets/js/14.2d9f5c97.js"><link rel="prefetch" href="/assets/js/15.b917edb6.js"><link rel="prefetch" href="/assets/js/16.a13d2a39.js"><link rel="prefetch" href="/assets/js/17.d6b71ec0.js"><link rel="prefetch" href="/assets/js/18.adbe50b4.js"><link rel="prefetch" href="/assets/js/19.a1638529.js"><link rel="prefetch" href="/assets/js/20.393f35ab.js"><link rel="prefetch" href="/assets/js/21.a9dd9148.js"><link rel="prefetch" href="/assets/js/22.087385e4.js"><link rel="prefetch" href="/assets/js/24.a74b28c6.js"><link rel="prefetch" href="/assets/js/25.7a984c35.js"><link rel="prefetch" href="/assets/js/26.cf45c453.js"><link rel="prefetch" href="/assets/js/27.e36a56dc.js"><link rel="prefetch" href="/assets/js/28.358fc226.js"><link rel="prefetch" href="/assets/js/29.f4fd2139.js"><link rel="prefetch" href="/assets/js/3.40d230a8.js"><link rel="prefetch" href="/assets/js/30.564d0795.js"><link rel="prefetch" href="/assets/js/31.0691b4c8.js"><link rel="prefetch" href="/assets/js/32.088de00e.js"><link rel="prefetch" href="/assets/js/33.4d884bb7.js"><link rel="prefetch" href="/assets/js/34.c4be32cd.js"><link rel="prefetch" href="/assets/js/35.b78c77b2.js"><link rel="prefetch" href="/assets/js/36.ceed3144.js"><link rel="prefetch" href="/assets/js/37.f9d6aca2.js"><link rel="prefetch" href="/assets/js/38.67ad3e03.js"><link rel="prefetch" href="/assets/js/39.5e3e70a7.js"><link rel="prefetch" href="/assets/js/4.e81ef12f.js"><link rel="prefetch" href="/assets/js/40.0510efa5.js"><link rel="prefetch" href="/assets/js/41.4e2bcf98.js"><link rel="prefetch" href="/assets/js/42.ebc7d9c8.js"><link rel="prefetch" href="/assets/js/43.e5970289.js"><link rel="prefetch" href="/assets/js/44.f91a9970.js"><link rel="prefetch" href="/assets/js/45.603b4584.js"><link rel="prefetch" href="/assets/js/46.037dce36.js"><link rel="prefetch" href="/assets/js/47.fadd0db4.js"><link rel="prefetch" href="/assets/js/48.457d9287.js"><link rel="prefetch" href="/assets/js/49.da492613.js"><link rel="prefetch" href="/assets/js/5.dc790133.js"><link rel="prefetch" href="/assets/js/50.cab6e13d.js"><link rel="prefetch" href="/assets/js/51.0765def4.js"><link rel="prefetch" href="/assets/js/52.518165a7.js"><link rel="prefetch" href="/assets/js/53.1e887b4a.js"><link rel="prefetch" href="/assets/js/54.bc10b491.js"><link rel="prefetch" href="/assets/js/55.2e54a7e8.js"><link rel="prefetch" href="/assets/js/56.169c81e5.js"><link rel="prefetch" href="/assets/js/57.a4ef4ed1.js"><link rel="prefetch" href="/assets/js/58.78dc0897.js"><link rel="prefetch" href="/assets/js/59.f13515c7.js"><link rel="prefetch" href="/assets/js/6.de2c94ff.js"><link rel="prefetch" href="/assets/js/60.ebfdeb63.js"><link rel="prefetch" href="/assets/js/61.6523e015.js"><link rel="prefetch" href="/assets/js/62.cb19c9bd.js"><link rel="prefetch" href="/assets/js/63.6ae10337.js"><link rel="prefetch" href="/assets/js/64.50298a81.js"><link rel="prefetch" href="/assets/js/65.d1849c5b.js"><link rel="prefetch" href="/assets/js/66.caef6860.js"><link rel="prefetch" href="/assets/js/67.a2788988.js"><link rel="prefetch" href="/assets/js/68.1c43eae0.js"><link rel="prefetch" href="/assets/js/69.e16965c5.js"><link rel="prefetch" href="/assets/js/7.0466c7e3.js"><link rel="prefetch" href="/assets/js/70.e66fe735.js"><link rel="prefetch" href="/assets/js/71.6d49148f.js"><link rel="prefetch" href="/assets/js/72.c3d54f60.js"><link rel="prefetch" href="/assets/js/73.125d4466.js"><link rel="prefetch" href="/assets/js/74.f1ed7f47.js"><link rel="prefetch" href="/assets/js/75.2f92d842.js"><link rel="prefetch" href="/assets/js/76.634dc6b8.js"><link rel="prefetch" href="/assets/js/77.db030077.js"><link rel="prefetch" href="/assets/js/78.ef9b3a22.js"><link rel="prefetch" href="/assets/js/79.a9b05b84.js"><link rel="prefetch" href="/assets/js/8.0435cf5c.js"><link rel="prefetch" href="/assets/js/80.88069fe6.js"><link rel="prefetch" href="/assets/js/9.a952890c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7a12d87.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="pruebas-de-base-de-datos"><a class="header-anchor" href="#pruebas-de-base-de-datos">#</a> Pruebas de Base de Datos</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#generating-factories">Generando factories</a></li> <li><a href="#resetting-the-database-after-each-test">Reiniciando la base de datos después de cada prueba</a></li> <li><a href="#writing-factories">Escribiendo factories</a> <ul><li><a href="#extending-factories">Extendiendo Factories</a></li> <li><a href="#factory-states">Estados de un factory</a></li> <li><a href="#factory-callbacks">LLamadas de retorno de un factory</a></li></ul></li> <li><a href="#using-factories">Usando factories</a> <ul><li><a href="#creating-models">Creando modelos</a></li> <li><a href="#persisting-models">Persistiendo modelos</a></li> <li><a href="#relationships">Relaciones</a></li></ul></li> <li><a href="#using-seeds">Usando Seeders</a></li> <li><a href="#available-assertions">Aserciones disponibles</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion">#</a> Introducción</h2> <p>Laravel proporciona una variedad de herramientas útiles para hacer que sea más fácil probar tus aplicaciones que manejan base de datos. Primero, puedes usar el método (helper) <code>assertDatabaseHas</code> para comprobar que los datos existentes en la base de datos coinciden con un conjunto dado de criterios. Por ejemplo, si quisieras verificar que hay un registro en la tabla <code>users</code> con el valor <code>email</code> de <code>sally@example.com</code>, puedes hacer lo siguiente:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Make call to application...</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertDatabaseHas</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'sally@example.com'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>También podrías usar el método <code>assertDatabaseMissing</code> para comprobar que esos datos no existen en la base de datos.</p> <p>El método <code>assertDatabaseHas</code> y otros métodos como éste son muy convenientes. Eres libre de usar cualquiera de los métodos de aserción integrados de PHPUnit para complementar tus pruebas funcionales (Feature tests).</p> <p><a name="generating-factories"></a></p> <h2 id="generando-factories"><a class="header-anchor" href="#generando-factories">#</a> Generando factories</h2> <p>Para crear un factory, usa el <RouterLink to="/artisan.html">comando Artisan</RouterLink> <code>make:factory</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan <span class="token argument-name">make</span><span class="token punctuation">:</span>factory PostFactory
</code></pre></div><p>El nuevo factory será colocado en tu directorio <code>database/factories</code>.</p> <p>La opción <code>--model</code> puede ser usada para indicar el nombre del modelo creado por el factory. Esta opción pre-completará el archivo de factory generado con el modelo dado:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan <span class="token argument-name">make</span><span class="token punctuation">:</span>factory PostFactory <span class="token operator">--</span>model<span class="token operator">=</span>Post
</code></pre></div><p><a name="resetting-the-database-after-each-test"></a></p> <h2 id="reiniciando-la-base-de-datos-despues-de-cada-prueba"><a class="header-anchor" href="#reiniciando-la-base-de-datos-despues-de-cada-prueba">#</a> Reiniciando la base de datos después de cada prueba</h2> <p>Con frecuencia es útil reinicializar tu base de datos después de cada prueba de modo que los datos de una prueba previa no interfieran con las pruebas subsecuentes. El trait <code>RefreshDatabase</code> toma como enfoque más óptimo migrar tu base de datos de pruebas, dependiendo de si estás usando una base de datos en memoria o una base de datos tradicional. Usa el trait en tu clase de prueba y todo será manejado automáticamente sin que tengas que preocuparte por esto:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">RefreshDatabase</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * A basic functional test example.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testBasicExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="writing-factories"></a></p> <h2 id="escribiendo-factories"><a class="header-anchor" href="#escribiendo-factories">#</a> Escribiendo factories</h2> <p>Al momento de probar, puedes necesitar insertar unos cuantos registros dentro de tu base de datos antes de ejecutar tu prueba. En lugar de especificar manualmente el valor de cada columna cuando crees estos datos de prueba, Laravel permite que definas un conjunto de atributos predeterminados para cada uno de tus <RouterLink to="/eloquent.html">modelos de Eloquent</RouterLink> usando factories de modelos. Para empezar, demos un vistazo al archivo <code>database/factories/UserFactory.php</code> en tu aplicación. De forma predeterminada, este archivo contiene una definición de factory:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span> <span class="token keyword">as</span> Faker<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>

<span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name type-declaration">Faker</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'email'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">safeEmail</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'email_verified_at'</span> <span class="token operator">=&gt;</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'password'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'$2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi'</span><span class="token punctuation">,</span> <span class="token comment">// password</span>
        <span class="token string single-quoted-string">'remember_token'</span> <span class="token operator">=&gt;</span> <span class="token class-name static-context">Str</span><span class="token operator">::</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Dentro del Closure, la cual sirve como la definición del factory, puedes devolver los valores de prueba predeterminados de todos los atributos del modelo. El Closure recibirá una instancia de la librería PHP <a href="https://github.com/fzaninotto/Faker" target="_blank" rel="noopener noreferrer">Faker<OutboundLink></OutboundLink></a>, la cual permitirá que generes convenientemente varios tipos de datos aleatorios para las pruebas.</p> <p>También puedes crear archivos de factories adicionales para cada modelo para una mejor organización. Por ejemplo, podrías crear archivos <code>UserFactory.php</code> y <code>CommentFactory.php</code> dentro de tu directorio <code>database/factories</code>. Todos los archivos dentro del directorio <code>factories</code> serán cargados automáticamente por Laravel.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Puedes establecer la configuración regional de Faker agregando una opción <code>faker_locale</code> a tu archivo de configuración<code>config/app.php</code>.</p></div></div><p><a name="extending-factories"></a></p> <h3 id="extendiendo-factories"><a href="#extendiendo-factories" class="header-anchor">#</a> Extendiendo Factories</h3> <p>Si has extendido un modelo, quizá querrás extender su factory también con el propósito de utilizar los atributos del factory del modelo hijo en las pruebas y los seeders. Para lograr esto, puedes ejecutar el método <code>raw</code> del constructor de factories para obtener el arreglo de atributos sin procesar de un factory dado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>Admin</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified type-declaration">Faker<span class="token punctuation">\</span>Generator</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="factory-states"></a></p> <h3 id="estados-de-un-factory"><a href="#estados-de-un-factory" class="header-anchor">#</a> Estados de un factory</h3> <p>Los estados te permiten definir modificaciones discretas que pueden ser aplicadas a tus factories de modelos en cualquier combinación. Por ejemplo, tu modelo <code>User</code> podría tener un estado <code>delinquent</code> que modifique uno de sus valores de atributo predeterminados. Puedes definir tus transformaciones de estado usando el método <code>state</code>. Para estados simples, puedes pasar un arreglo de modificaciones de atributos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delinquent'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'account_status'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'delinquent'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si tu estado requiere cálculo o una instancia <code>$faker</code>, puedes usar una Closure para calcular las modificaciones de los atributos del estado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'address'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'address'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token property">address</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="factory-callbacks"></a></p> <h3 id="llamadas-de-retorno-de-un-factory"><a href="#llamadas-de-retorno-de-un-factory" class="header-anchor">#</a> LLamadas de retorno de un factory</h3> <p>Las llamadas de retorno (callbacks) de un Factory son registradas usando los métodos <code>afterMaking</code> y <code>afterCreating</code> y te permiten realizar tareas adicionales después de crear un modelo en memoria o persistente. Por ejemplo, puedes usar llamadas de retorno para relacionar modelos adicionales con el modelo creado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">afterMaking</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">afterCreating</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">accounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>Account</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes definir llamadas de retorno para <a href="#factory-states">estados de un factory</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">afterMakingState</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delinquent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">afterCreatingState</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delinquent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="using-factories"></a></p> <h2 id="usando-factories"><a href="#usando-factories" class="header-anchor">#</a> Usando factories</h2> <p><a name="creating-models"></a></p> <h3 id="creando-modelos"><a href="#creando-modelos" class="header-anchor">#</a> Creando modelos</h3> <p>Una vez que hayas definido tus factories, puedes usar la función global <code>factory</code> en tus pruebas funcionales o en archivos seeder para generar instancias de un modelo. Así, vamos a dar un vistazo en unos pocos ejemplos de creación de modelos. Primero, usaremos el método <code>make</code> para crear modelos pero sin guardarlos en la base de datos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Use model in tests...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>También puedes crear una colección de muchos modelos o crear modelos de un tipo dado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Create three App\User instances...</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="aplicando-estados"><a href="#aplicando-estados" class="header-anchor">#</a> Aplicando estados</h4> <p>También puedes aplicar cualquiera de tus <a href="#factory-states">estados</a> a los modelos. Si prefieres aplicar múltiples transformaciones de estado a los modelos, deberías especificar el nombre de cada estado que quisieras aplicar:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">states</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'delinquent'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">states</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'premium'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'delinquent'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sobrescribiendo-atributos"><a href="#sobrescribiendo-atributos" class="header-anchor">#</a> Sobrescribiendo atributos</h4> <p>Si prefieres sobrescribir algunos de los valores predeterminados de tus modelos, puedes pasar un arreglo de valores al método <code>make</code>. Solamente los valores especificados serán reemplazados, mientras que el resto de los valores permanecerán con sus valores predeterminados como se especificó en el factory:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Abigail'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><a href="/eloquent.html#mass-assignment">La protección de asignación masiva</a> es deshabilitada automáticamente al momento de crear modelos usando factories.</p></div> <p><a name="persisting-models"></a></p> <h3 id="persistiendo-modelos"><a href="#persistiendo-modelos" class="header-anchor">#</a> Persistiendo modelos</h3> <p>El método <code>create</code> no solamente crea las instancias de un modelo sino que también los almacena en la base de datos usando el método <code>save</code> de Eloquent:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Create a single App\User instance...</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create three App\User instances...</span>
    <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Use model in tests...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Puedes sobrescribir atributos en el modelo al pasar un arreglo al método <code>create</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'name'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'Abigail'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="relationships"></a></p> <h3 id="relaciones"><a href="#relaciones" class="header-anchor">#</a> Relaciones</h3> <p>En este ejemplo, adjuntaremos una relación para algunos modelos creados. Al momento de usar el método <code>create</code> para crear múltiples modelos, una <a href="/eloquent-collections.html">instancia de colección</a> de Eloquent es devuelta, permitiendo que uses cualquiera de las funciones convenientes proporcionadas por la colección, tales como <code>each</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>Post</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes usar el método <code>createMany</code> para crear varios modelos relacionados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span><span class="token operator">-&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">createMany</span><span class="token punctuation">(</span>
    <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>Post</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="relaciones-y-closures-de-atributos"><a href="#relaciones-y-closures-de-atributos" class="header-anchor">#</a> Relaciones y closures de atributos</h4> <p>También puedes adjuntar relaciones a los modelos en tus definiciones del factory. Por ejemplo, si prefieres crear una nueva instancia <code>User</code> al momento de crear un <code>Post</code>, puedes hacer lo siguiente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>Post</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token property">title</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token property">paragraph</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'user_id'</span> <span class="token operator">=&gt;</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si la relación depende del factory que la define, debes proporcionar un callback que acepte el arreglo de atributos evaluados:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-&gt;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>Post</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'title'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token property">title</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'content'</span> <span class="token operator">=&gt;</span> <span class="token variable">$faker</span><span class="token operator">-&gt;</span><span class="token property">paragraph</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'user_id'</span> <span class="token operator">=&gt;</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'user_type'</span> <span class="token operator">=&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="using-seeds"></a></p> <h2 id="usando-seeders"><a href="#usando-seeders" class="header-anchor">#</a> Usando Seeders</h2> <p>Si prefieres usar <a href="/seeding.html">seeders de bases de datos</a> para rellenar tu base de datos al momento de realizar una prueba funcional, puedes usar el método <code>seed</code>. Por defecto, el método <code>seed</code> retornará <code>DatabaseSeeder</code>, que debería ejecutar todos tus otros seeders. De forma alternativa, pasa un nombre de clase seeder específico al método <code>seed</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OrderStatusesTableSeeder</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">RefreshDatabase</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * Test creating a new order.
     *
     * @return void
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testCreatingANewOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Run the DatabaseSeeder...</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Run a single seeder...</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">seed</span><span class="token punctuation">(</span><span class="token class-name static-context">OrderStatusesTableSeeder</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="available-assertions"></a></p> <h2 id="aserciones-disponibles"><a href="#aserciones-disponibles" class="header-anchor">#</a> Aserciones disponibles</h2> <p>Laravel proporciona varias aserciones de base de datos para tus pruebas funcionales <a href="https://phpunit.de/" target="_blank" rel="noopener noreferrer">PHPUnit<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <table><thead><tr><th>Método</th> <th>Descripción</th></tr></thead> <tbody><tr><td><code>$this-&gt;assertDatabaseHas($table, array $data);</code></td> <td>Comprueba que una tabla en la base de datos contiene los datos dados.</td></tr> <tr><td><code>$this-&gt;assertDatabaseMissing($table, array $data);</code></td> <td>Comprueba que una tabla en la base de datos no contiene los datos dados.</td></tr> <tr><td><code>$this-&gt;assertDeleted($table, array $data);</code></td> <td>Comprueba que el registro dado ha sido eliminado.</td></tr> <tr><td><code>$this-&gt;assertSoftDeleted($table, array $data);</code></td> <td>Comprueba que el registro dado ha sido borrado lógicamente.</td></tr></tbody></table> <p>Por conveniencia, puedes pasar un modelo a los helpers <code>assertDeleted</code> y <code>assertSoftDeleted</code> para comprobar que el registro fue eliminado o borrado lógicamente, respectivamente, de la base de datos en base a la clave primaria del modelo.</p> <p>Por ejemplo, si estás usando un modelo inicializado con factory en tu prueba, puedes pasar este modelo a uno de estos helpers para probar si tu aplicación borró de forma apropiada el registro de la base de datos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified static-context">App<span class="token punctuation">\</span>User</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Make call to application...</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">assertDeleted</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.237f7d41.js" defer></script><script src="/assets/js/2.648c6578.js" defer></script><script src="/assets/js/23.b6ce1d9c.js" defer></script>
  </body>
</html>
