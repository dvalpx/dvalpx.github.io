<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pruebas de Base de Datos | Documentación de Laravel en Español</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
    
    <link rel="preload" href="/assets/css/0.styles.c5b6b298.css" as="style"><link rel="preload" href="/assets/js/app.cd8710f8.js" as="script"><link rel="preload" href="/assets/js/23.4eb7b8cb.js" as="script"><link rel="prefetch" href="/assets/js/10.bdc3dff6.js"><link rel="prefetch" href="/assets/js/11.15d44d0c.js"><link rel="prefetch" href="/assets/js/12.a9d2bd03.js"><link rel="prefetch" href="/assets/js/13.311a5901.js"><link rel="prefetch" href="/assets/js/14.1dfd6fc1.js"><link rel="prefetch" href="/assets/js/15.76b13bf2.js"><link rel="prefetch" href="/assets/js/16.cb3f752c.js"><link rel="prefetch" href="/assets/js/17.6f05c333.js"><link rel="prefetch" href="/assets/js/18.caf4dfb9.js"><link rel="prefetch" href="/assets/js/19.00878890.js"><link rel="prefetch" href="/assets/js/2.79d2e3be.js"><link rel="prefetch" href="/assets/js/20.28af0091.js"><link rel="prefetch" href="/assets/js/21.68dc108b.js"><link rel="prefetch" href="/assets/js/22.920c978d.js"><link rel="prefetch" href="/assets/js/24.2d2dc9a0.js"><link rel="prefetch" href="/assets/js/25.8f62970e.js"><link rel="prefetch" href="/assets/js/26.738d1578.js"><link rel="prefetch" href="/assets/js/27.7cc3174f.js"><link rel="prefetch" href="/assets/js/28.4faacfc5.js"><link rel="prefetch" href="/assets/js/29.f136b7ed.js"><link rel="prefetch" href="/assets/js/3.3c837d7c.js"><link rel="prefetch" href="/assets/js/30.320ed66c.js"><link rel="prefetch" href="/assets/js/31.b15e31e8.js"><link rel="prefetch" href="/assets/js/32.1e4f228f.js"><link rel="prefetch" href="/assets/js/33.bc2abac4.js"><link rel="prefetch" href="/assets/js/34.297c9052.js"><link rel="prefetch" href="/assets/js/35.fd369f14.js"><link rel="prefetch" href="/assets/js/36.42d8dd87.js"><link rel="prefetch" href="/assets/js/37.7202e99d.js"><link rel="prefetch" href="/assets/js/38.2c185353.js"><link rel="prefetch" href="/assets/js/39.b64c0ef1.js"><link rel="prefetch" href="/assets/js/4.5467f96f.js"><link rel="prefetch" href="/assets/js/40.260c90fc.js"><link rel="prefetch" href="/assets/js/41.1cb273f9.js"><link rel="prefetch" href="/assets/js/42.b3418030.js"><link rel="prefetch" href="/assets/js/43.1cac18fc.js"><link rel="prefetch" href="/assets/js/44.044967f8.js"><link rel="prefetch" href="/assets/js/45.366a61c7.js"><link rel="prefetch" href="/assets/js/46.18d2c80d.js"><link rel="prefetch" href="/assets/js/47.f0c6caa1.js"><link rel="prefetch" href="/assets/js/48.a27a8479.js"><link rel="prefetch" href="/assets/js/49.149ac53a.js"><link rel="prefetch" href="/assets/js/5.3a0326b3.js"><link rel="prefetch" href="/assets/js/50.1a566e9a.js"><link rel="prefetch" href="/assets/js/51.57d6d74f.js"><link rel="prefetch" href="/assets/js/52.d0bcd857.js"><link rel="prefetch" href="/assets/js/53.87a13070.js"><link rel="prefetch" href="/assets/js/54.5fb9f712.js"><link rel="prefetch" href="/assets/js/55.20392d02.js"><link rel="prefetch" href="/assets/js/56.9442057d.js"><link rel="prefetch" href="/assets/js/57.e892cc56.js"><link rel="prefetch" href="/assets/js/58.858d6674.js"><link rel="prefetch" href="/assets/js/59.b3fcadf0.js"><link rel="prefetch" href="/assets/js/6.14ff87fe.js"><link rel="prefetch" href="/assets/js/60.6734c58b.js"><link rel="prefetch" href="/assets/js/61.697e4153.js"><link rel="prefetch" href="/assets/js/62.93102aea.js"><link rel="prefetch" href="/assets/js/63.634227cb.js"><link rel="prefetch" href="/assets/js/64.6bf3eca6.js"><link rel="prefetch" href="/assets/js/65.a817e7bc.js"><link rel="prefetch" href="/assets/js/66.29dbeba6.js"><link rel="prefetch" href="/assets/js/67.854a00b6.js"><link rel="prefetch" href="/assets/js/68.480e677c.js"><link rel="prefetch" href="/assets/js/69.6663720b.js"><link rel="prefetch" href="/assets/js/7.cf2ecb35.js"><link rel="prefetch" href="/assets/js/70.6b820016.js"><link rel="prefetch" href="/assets/js/71.268f9218.js"><link rel="prefetch" href="/assets/js/72.afd07e9b.js"><link rel="prefetch" href="/assets/js/73.b3cc27c3.js"><link rel="prefetch" href="/assets/js/74.8f3fe97e.js"><link rel="prefetch" href="/assets/js/75.e384bf9d.js"><link rel="prefetch" href="/assets/js/76.a53ce7f6.js"><link rel="prefetch" href="/assets/js/77.086eca98.js"><link rel="prefetch" href="/assets/js/78.c871a9ce.js"><link rel="prefetch" href="/assets/js/79.ad16bab5.js"><link rel="prefetch" href="/assets/js/8.85f2ea62.js"><link rel="prefetch" href="/assets/js/80.8a7833ff.js"><link rel="prefetch" href="/assets/js/81.e2e02900.js"><link rel="prefetch" href="/assets/js/9.95d47d7b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c5b6b298.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en Español</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Primeros Pasos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Conceptos De Arquitectura</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Bases De Datos</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Pruebas</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/testing.html" class="sidebar-link">Pruebas: Primeros Pasos</a></li><li><a href="/http-tests.html" class="sidebar-link">Pruebas HTTP</a></li><li><a href="/console-tests.html" class="sidebar-link">Pruebas de consola</a></li><li><a href="/dusk.html" class="sidebar-link">Laravel Dusk</a></li><li><a href="/database-testing.html" class="active sidebar-link">Pruebas de Base de Datos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database-testing.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/database-testing.html#generando-factories" class="sidebar-link">Generando Factories</a></li><li class="sidebar-sub-header"><a href="/database-testing.html#reinicializando-la-base-de-datos-despues-de-cada-prueba" class="sidebar-link">Reinicializando la Base de Datos Después de Cada Prueba</a></li><li class="sidebar-sub-header"><a href="/database-testing.html#escribiendo-factories" class="sidebar-link">Escribiendo Factories</a></li><li class="sidebar-sub-header"><a href="/database-testing.html#usando-factories" class="sidebar-link">Usando Factories</a></li><li class="sidebar-sub-header"><a href="/database-testing.html#aserciones-disponibles" class="sidebar-link">Aserciones Disponibles</a></li></ul></li><li><a href="/mocking.html" class="sidebar-link">Mocking</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><div><h1 id="pruebas-de-base-de-datos"><a class="header-anchor" href="#pruebas-de-base-de-datos" aria-hidden="true">#</a> Pruebas de Base de Datos</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#generating-factories">Generando Factories</a></li> <li><a href="#resetting-the-database-after-each-test">Reinicializando la Base de Datos Después de Cada Prueba</a></li> <li><a href="#writing-factories">Escribiendo Factories</a> <ul><li><a href="#factory-states">Estados de un Factory</a></li> <li><a href="#factory-callbacks">LLamadas de retorno de un Factory</a></li></ul></li> <li><a href="#using-factories">Usando Factories</a> <ul><li><a href="#creating-models">Creando Modelos</a></li> <li><a href="#persisting-models">Persistiendo Modelos</a></li> <li><a href="#relationships">Relaciones</a></li></ul></li> <li><a href="#available-assertions">Aserciones Disponibles</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Laravel proporciona una variedad de herramientas útiles para hacer que sea más fácil probar tus aplicaciones que manejan base de datos. Primero, puedes usar el método (helper) <code>assertDatabaseHas</code> para comprobar que los datos existentes en la base de datos coinciden con un conjunto dado de criterios. Por ejemplo, si quisieras verificar que hay un registro en la tabla <code>users</code> con el valor <code>email</code> de <code>sally@example.com</code>, puedes hacer lo siguiente:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Make call to application...</span>

    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertDatabaseHas</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'sally@example.com'</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>También podrías usar el método <code>assertDatabaseMissing</code> para comprobar que esos datos no existen en la base de datos.</p> <p>El método <code>assertDatabaseHas</code> y otros métodos como éste son por conveniencia. Eres libre de usar cualquiera de los métodos de aserción de PHPUnit integrados para complementar tus pruebas.</p> <p><a name="generating-factories"></a></p> <h2 id="generando-factories"><a class="header-anchor" href="#generando-factories" aria-hidden="true">#</a> Generando Factories</h2> <p>Para crear un factory, usa el <a href="/docs/%7B%7Bversion%7D%7D/artisan">comando Artisan</a> <code>make:factory</code>:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>factory PostFactory
</code></pre></div><p>El nuevo factory será colocado en tu directorio <code>database/factories</code>.</p> <p>La opción <code>--model</code> puede ser usada para indicar el nombre del modelo creado por el factory. Esta opción pre-rellenará el archivo de factory generado con el modelo dado:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>factory PostFactory <span class="token operator">--</span>model<span class="token operator">=</span>Post
</code></pre></div><p><a name="resetting-the-database-after-each-test"></a></p> <h2 id="reinicializando-la-base-de-datos-despues-de-cada-prueba"><a class="header-anchor" href="#reinicializando-la-base-de-datos-despues-de-cada-prueba" aria-hidden="true">#</a> Reinicializando la Base de Datos Después de Cada Prueba</h2> <p>Con frecuencia es útil reinicializar tu base de datos después de cada prueba de modo que los datos de una prueba previa no interfieran con las pruebas subsecuentes. El trait <code>RefreshDatabase</code> toma el enfoque más óptimo para migrar tu base de datos de pruebas, dependiendo de si estás usando una base de datos en memoria o una base de datos tradicional. Usa el trait en tu clase de prueba y todo será manejado por ti:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">RefreshDatabase</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * A basic functional test example.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testBasicExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="writing-factories"></a></p> <h2 id="escribiendo-factories"><a class="header-anchor" href="#escribiendo-factories" aria-hidden="true">#</a> Escribiendo Factories</h2> <p>Al momento de probar, puedes necesitar insertar unos pocos registros dentro de tu base de datos antes de ejecutar tu prueba. En lugar de especificar manualmente el valor de cada columna cuando crees estos datos de prueba, Laravel permite que definas un conjunto de atributos predeterminados para cada uno de tus <a href="/docs/%7B%7Bversion%7D%7D/eloquent">modelos de Eloquent</a> usando factories de modelos. Para empezar, echemos un vistazo al archivo <code>database/factories/UserFactory.php</code> en tu aplicación. De forma predeterminada, este archivo contiene una definición de factory:</p> <div class="language-php extra-class"><pre v-pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span> <span class="token keyword">as</span> Faker<span class="token punctuation">;</span>

<span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">define</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Faker <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">safeEmail</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email_verified_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'$2y$10$TKh8H1.PfQx37YgCzwiKb.KjNyWgaHb9cbcoQgdIVFlYg7B77UdFm'</span><span class="token punctuation">,</span> <span class="token comment">// secret</span>
        <span class="token single-quoted-string string">'remember_token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Dentro del Closure, la cual sirve como la definición del factory, puedes devolver los valores de prueba predeterminados de todos los atributos del modelo. El Closure recibirá una instancia de la biblioteca PHP <a href="https://github.com/fzaninotto/Faker" target="_blank" rel="noopener noreferrer">Faker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, la cual permitirá que generes convenientemente varios tipos de datos aleatorios para las pruebas.</p> <p>También puedes crear archivos de factories adicionales para cada modelo para una mejor organización. Por ejemplo, podrías crear archivos <code>UserFactory.php</code> y <code>CommentFactory.php</code> dentro de tu directorio <code>database/factories</code>. Todos los archivos dentro del directorio <code>factories</code> serán cargados automáticamente por Laravel.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Puedes establecer la configuración regional de Faker agregando una opción <code>faker_locale</code> a tu archivo de configuración<code>config/app.php</code>.</p></div></div> <p><a name="factory-states"></a></p> <h3 id="estados-de-un-factory"><a href="#estados-de-un-factory" aria-hidden="true" class="header-anchor">#</a> Estados de un Factory</h3> <p>Los estados te permiten definir modificaciones discretas que pueden ser aplicadas a tus factories de modelos en cualquier combinación. Por ejemplo, tu modelo <code>User</code> podría tener un estado <code>delinquent</code> que modifique uno de sus valores de atributo predeterminados. Puedes definir tus transformaciones de estado usando el método <code>state</code>. Para estados simples, puedes pasar un arreglo de modificaciones de atributos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">state</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delinquent'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'account_status'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'delinquent'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si tu estado requiere cálculo o una instancia <code>$faker</code>, puedes usar un Closure para calcular las modificaciones de los atributos del estado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">state</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'address'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'address'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">address</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="factory-callbacks"></a></p> <h3 id="llamadas-de-retorno-de-un-factory"><a href="#llamadas-de-retorno-de-un-factory" aria-hidden="true" class="header-anchor">#</a> LLamadas de retorno de un Factory</h3> <p>Las llamadas de retorno de un Factory son registradas usando los métodos <code>afterMaking</code> y <code>afterCreating</code> y te permiten realizar tareas adicionales de hacer o crear un modelo. Por ejemplo, puedes usar llamadas de retorno para relacionar modelos adicionales con el modelo creado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">afterMaking</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">afterCreating</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">accounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">Account</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes definir llamadas de retorno para <a href="#factory-states">estados de un factory</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">afterMakingState</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delinquent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">afterCreatingState</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delinquent'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="using-factories"></a></p> <h2 id="usando-factories"><a href="#usando-factories" aria-hidden="true" class="header-anchor">#</a> Usando Factories</h2> <p><a name="creating-models"></a></p> <h3 id="creando-modelos"><a href="#creando-modelos" aria-hidden="true" class="header-anchor">#</a> Creando Modelos</h3> <p>Una vez que has definido tus factories, puedes usar la función global <code>factory</code> en tus pruebas o en archivos seeder para generar instancias de un modelo. Así, vamos a echar un vistazo en unos pocos ejemplos de creación de modelos. Primero, usaremos el método <code>make</code> para crear modelos pero sin guardarlos en la base de datos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Use model in tests...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>También puedes crear una colección de muchos modelos o crear modelos de un tipo dado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Create three App\User instances...</span>
<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="aplicando-estados"><a href="#aplicando-estados" aria-hidden="true" class="header-anchor">#</a> Aplicando Estados</h4> <p>También puedes aplicar cualquiera de tus <a href="#factory-states">estados</a> a los modelos. Si prefieres aplicar múltiples transformaciones de estado a los modelos, deberías especificar el nombre de cada estado que quisieras aplicar:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">states</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'delinquent'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">states</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'premium'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delinquent'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="sobrescribiendo-atributos"><a href="#sobrescribiendo-atributos" aria-hidden="true" class="header-anchor">#</a> Sobrescribiendo Atributos</h4> <p>Si prefieres sobreescribir algunos de los valores predeterminados de tus modelos, puedes pasar un arreglo de valores al método <code>make</code>. Solamente, los valores especificados serán reemplazados mientras que el resto de los valores permanecerán con sus valores predeterminados cómo se especificó en el factory:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Abigail'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="persisting-models"></a></p> <h3 id="persistiendo-modelos"><a href="#persistiendo-modelos" aria-hidden="true" class="header-anchor">#</a> Persistiendo Modelos</h3> <p>El método <code>create</code> no solamente crea las instancias de un modelo sino que también los almacena en la base de datos usando el método <code>save</code> de Eloquent:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Create a single App\User instance...</span>
    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Create three App\User instances...</span>
    <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Use model in tests...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Puedes sobrescribir atributos en el modelo al pasar un arreglo al método <code>create</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Abigail'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="relationships"></a></p> <h3 id="relaciones"><a href="#relaciones" aria-hidden="true" class="header-anchor">#</a> Relaciones</h3> <p>En este ejemplo, adjuntaremos una relación para algunos modelos creados. Al momento de usar el método <code>create</code> para crear múltiples modelos, una <a href="/docs/%7B%7Bversion%7D%7D/eloquent-collections">instancia de colección</a> de Eloquent es devuelta, permitiendo que uses cualquiera de las funciones convenientes proporcionadas por la colección, tales como <code>each</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">posts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="relaciones-y-closures-de-atributos"><a href="#relaciones-y-closures-de-atributos" aria-hidden="true" class="header-anchor">#</a> Relaciones y Closures de Atributos</h4> <p>También puedes adjuntar relaciones a los modelos usando atributos de Closure en tus definiciones del factory. Por ejemplo, si prefieres crear una nueva instancia <code>User</code> al momento de crear un <code>Post</code>, puedes hacer lo siguiente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">define</span><span class="token punctuation">(</span>App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'content'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">paragraph</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'user_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Estas Closures también reciben el arreglo de atributos evaluados del factory que los define:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$factory</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">define</span><span class="token punctuation">(</span>App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$faker</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'title'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">title</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'content'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$faker</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">paragraph</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'user_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">factory</span><span class="token punctuation">(</span>App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'user_type'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token keyword">array</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> App\<span class="token package">User</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">type</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="available-assertions"></a></p> <h2 id="aserciones-disponibles"><a href="#aserciones-disponibles" aria-hidden="true" class="header-anchor">#</a> Aserciones Disponibles</h2> <p>Laravel proporciona varias aserciones de base de datos para tus pruebas <a href="https://phpunit.de/" target="_blank" rel="noopener noreferrer">PHPUnit<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <table><thead><tr><th>Método</th> <th>Descripción</th></tr></thead> <tbody><tr><td><code>$this-&gt;assertDatabaseHas($table, array $data);</code></td> <td>Comprueba que una tabla en la base de datos contiene los datos dados.</td></tr> <tr><td><code>$this-&gt;assertDatabaseMissing($table, array $data);</code></td> <td>Comprueba que una tabla en la base de datos no contiene los datos dados.</td></tr> <tr><td><code>$this-&gt;assertSoftDeleted($table, array $data);</code></td> <td>Comprueba que el registro dado ha sido borrado lógicamente.</td></tr></tbody></table></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/dusk.html" class="prev">
          Laravel Dusk
        </a></span> <span class="next"><a href="/mocking.html">
          Mocking
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.cd8710f8.js" defer></script><script src="/assets/js/23.4eb7b8cb.js" defer></script>
  </body>
</html>
