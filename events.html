<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.cf5cbaa5.css" as="style"><link rel="preload" href="/assets/js/app.d18a7e07.js" as="script"><link rel="preload" href="/assets/js/2.8e5ca9eb.js" as="script"><link rel="preload" href="/assets/js/36.bc235e6d.js" as="script"><link rel="prefetch" href="/assets/js/10.9d8f190d.js"><link rel="prefetch" href="/assets/js/11.713069e3.js"><link rel="prefetch" href="/assets/js/12.8798d21a.js"><link rel="prefetch" href="/assets/js/13.332045e2.js"><link rel="prefetch" href="/assets/js/14.bda55a54.js"><link rel="prefetch" href="/assets/js/15.1c16c325.js"><link rel="prefetch" href="/assets/js/16.bbe1ecdf.js"><link rel="prefetch" href="/assets/js/17.068bc26e.js"><link rel="prefetch" href="/assets/js/18.d6a2ed70.js"><link rel="prefetch" href="/assets/js/19.9bbd4323.js"><link rel="prefetch" href="/assets/js/20.4a827d15.js"><link rel="prefetch" href="/assets/js/21.932f5ef3.js"><link rel="prefetch" href="/assets/js/22.47d672e1.js"><link rel="prefetch" href="/assets/js/23.63218e36.js"><link rel="prefetch" href="/assets/js/24.2c933036.js"><link rel="prefetch" href="/assets/js/25.2a9ac4af.js"><link rel="prefetch" href="/assets/js/26.b15e2a59.js"><link rel="prefetch" href="/assets/js/27.be0ff65a.js"><link rel="prefetch" href="/assets/js/28.aadf08f5.js"><link rel="prefetch" href="/assets/js/29.0e4ec215.js"><link rel="prefetch" href="/assets/js/3.0101ea7c.js"><link rel="prefetch" href="/assets/js/30.831305bd.js"><link rel="prefetch" href="/assets/js/31.afb33274.js"><link rel="prefetch" href="/assets/js/32.68089cf5.js"><link rel="prefetch" href="/assets/js/33.f7ed913e.js"><link rel="prefetch" href="/assets/js/34.4cddf81d.js"><link rel="prefetch" href="/assets/js/35.afbc7954.js"><link rel="prefetch" href="/assets/js/37.cec3e2cc.js"><link rel="prefetch" href="/assets/js/38.177ed69f.js"><link rel="prefetch" href="/assets/js/39.e7e298ee.js"><link rel="prefetch" href="/assets/js/4.a2109108.js"><link rel="prefetch" href="/assets/js/40.f621f4d5.js"><link rel="prefetch" href="/assets/js/41.0994bd46.js"><link rel="prefetch" href="/assets/js/42.4debbf07.js"><link rel="prefetch" href="/assets/js/43.d73341a8.js"><link rel="prefetch" href="/assets/js/44.302a1d16.js"><link rel="prefetch" href="/assets/js/45.df1e9e80.js"><link rel="prefetch" href="/assets/js/46.5da4e78a.js"><link rel="prefetch" href="/assets/js/47.af4aeb70.js"><link rel="prefetch" href="/assets/js/48.1c6cac1a.js"><link rel="prefetch" href="/assets/js/49.73c1cc2c.js"><link rel="prefetch" href="/assets/js/5.886a8536.js"><link rel="prefetch" href="/assets/js/50.3653355c.js"><link rel="prefetch" href="/assets/js/51.f48454e2.js"><link rel="prefetch" href="/assets/js/52.fe1537a5.js"><link rel="prefetch" href="/assets/js/53.f53a4944.js"><link rel="prefetch" href="/assets/js/54.77ad79c0.js"><link rel="prefetch" href="/assets/js/55.a7dce0c8.js"><link rel="prefetch" href="/assets/js/56.2a61f71d.js"><link rel="prefetch" href="/assets/js/57.f958f8cd.js"><link rel="prefetch" href="/assets/js/58.c91cb9c9.js"><link rel="prefetch" href="/assets/js/59.726c9fa1.js"><link rel="prefetch" href="/assets/js/6.f7c00904.js"><link rel="prefetch" href="/assets/js/60.3f31de0a.js"><link rel="prefetch" href="/assets/js/61.7ad03400.js"><link rel="prefetch" href="/assets/js/62.7d96c317.js"><link rel="prefetch" href="/assets/js/63.98a36806.js"><link rel="prefetch" href="/assets/js/64.e0445065.js"><link rel="prefetch" href="/assets/js/65.1d583bc8.js"><link rel="prefetch" href="/assets/js/66.1ca08e1b.js"><link rel="prefetch" href="/assets/js/67.a6af6188.js"><link rel="prefetch" href="/assets/js/68.47b5f882.js"><link rel="prefetch" href="/assets/js/69.215666c5.js"><link rel="prefetch" href="/assets/js/7.9e06b9d3.js"><link rel="prefetch" href="/assets/js/70.2c9f04a2.js"><link rel="prefetch" href="/assets/js/71.1eb0d68f.js"><link rel="prefetch" href="/assets/js/72.28241988.js"><link rel="prefetch" href="/assets/js/73.fc04168a.js"><link rel="prefetch" href="/assets/js/74.3d242ebf.js"><link rel="prefetch" href="/assets/js/75.3cda21e9.js"><link rel="prefetch" href="/assets/js/76.785cfa56.js"><link rel="prefetch" href="/assets/js/77.25a3cfe2.js"><link rel="prefetch" href="/assets/js/78.a8f98b1a.js"><link rel="prefetch" href="/assets/js/79.c51ea229.js"><link rel="prefetch" href="/assets/js/8.f19546fb.js"><link rel="prefetch" href="/assets/js/80.21189343.js"><link rel="prefetch" href="/assets/js/9.e056c469.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cf5cbaa5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="eventos"><a class="header-anchor" href="#eventos">#</a> Eventos</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#registering-events-and-listeners">Registro de eventos y oyentes</a> <ul><li><a href="#generating-events-and-listeners">Generación de eventos y oyentes</a></li> <li><a href="#manually-registering-events">Registro manual de eventos</a></li> <li><a href="#event-discovery">Descubrimiento de eventos</a></li></ul></li> <li><a href="#defining-events">Definiendo eventos</a></li> <li><a href="#defining-listeners">Definiendo oyentes</a></li> <li><a href="#queued-event-listeners">Oyentes de eventos en cola</a> <ul><li><a href="#manually-accessing-the-queue">Accediendo la cola manualmente</a></li> <li><a href="#handling-failed-jobs">Manejo de trabajos fallidos</a></li></ul></li> <li><a href="#dispatching-events">Despachando eventos</a></li> <li><a href="#event-subscribers">Suscriptores de eventos</a> <ul><li><a href="#writing-event-subscribers">Escribiendo suscriptores de eventos</a></li> <li><a href="#registering-event-subscribers">Registrando suscriptores de eventos</a></li></ul></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion">#</a> Introducción</h2> <p>Los eventos de Laravel proporcionan una implementación de observador simple, lo que permite suscribirse y escuchar diversos eventos que ocurren en tu aplicación. Las clases de eventos normalmente se almacenan en el directorio <code>app/Events</code>, mientras que tus oyentes se almacenan en <code>app/Listeners</code>. No te preocupes si no ves estos directorios en tu aplicación, ya que se crearán para ti cuando generes eventos y oyentes utilizando los comandos de consola Artisan.</p> <p>Los eventos sirven como una excelente manera de desacoplar varios aspectos de tu aplicación, ya que un solo evento puede tener múltiples oyentes que no dependen entre sí. Por ejemplo, es posible que desees enviar una notificación de Slack a tu usuario cada vez que se envíe un pedido. En lugar de acoplar tu código de procesamiento de pedidos a tu código de notificación Slack, puedes generar un evento <code>OrderShipped</code>, que un oyente puede recibir y transformar en una notificación Slack.</p> <p><a name="registering-events-and-listeners"></a></p> <h2 id="registro-de-eventos-y-oyentes"><a class="header-anchor" href="#registro-de-eventos-y-oyentes">#</a> Registro de eventos y oyentes</h2> <p>El <code>EventServiceProvider</code> incluido en tu aplicación Laravel proporciona un lugar conveniente para registrar todos los oyentes de eventos de tu aplicación. La propiedad <code>listen</code> contiene un arreglo de todos los eventos (claves) y sus oyentes (valores). Puedes agregar tantos eventos a este arreglo como lo requiera tu aplicación. Por ejemplo, agreguemos un evento <code>OrderShipped</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token comment">/**
* The event listener mappings for the application.
*
* @var array
*/</span>
<span class="token keyword">protected</span> <span class="token variable">$listen</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'App\Events\OrderShipped'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'App\Listeners\SendShipmentNotification'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="generating-events-and-listeners"></a></p> <h3 id="generacion-de-eventos-y-oyentes"><a class="header-anchor" href="#generacion-de-eventos-y-oyentes">#</a> Generación de eventos y oyentes</h3> <p>Por supuesto, crear manualmente los archivos para cada evento y oyente es engorroso. En vez de eso, agrega oyentes y eventos a tu <code>EventServiceProvider</code> y usa el comando <code>event:generate</code>. Este comando generará cualquier evento u oyente que esté listado en tu <code>EventServiceProvider</code>. Los eventos y oyentes que ya existen quedarán intactos:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan event<span class="token punctuation">:</span>generate
</code></pre></div><p><a name="manually-registering-events"></a></p> <h3 id="registro-manual-de-eventos"><a class="header-anchor" href="#registro-manual-de-eventos">#</a> Registro manual de eventos</h3> <p>Normalmente, los eventos deberían registrarse a través del arreglo <code>$listen</code> del <code>EventServiceProvider</code>; sin embargo, también puedes registrar manualmente eventos basados en Closure en el método <code>boot</code> de tu <code>EventServiceProvider</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token comment">/**
* Register any other events for your application.
*
* @return void
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'event.name'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$foo</span><span class="token punctuation">,</span> <span class="token variable">$bar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="oyentes-de-eventos-comodin"><a class="header-anchor" href="#oyentes-de-eventos-comodin">#</a> Oyentes de eventos comodín</h4> <p>Puedes incluso registrar oyentes usando el <code>*</code> como un parámetro comodín, lo que te permite capturar múltiples eventos en el mismo oyente. Los oyentes de comodín reciben el nombre del evento como su primer argumento y el arreglo de datos de eventos completo como su segundo argumento:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'event.*'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$eventName</span><span class="token punctuation">,</span> <span class="token keyword">array</span> <span class="token variable">$data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="event-discovery"></a></p> <h3 id="descubrimiento-de-eventos"><a class="header-anchor" href="#descubrimiento-de-eventos">#</a> Descubrimiento de eventos</h3> <p>En vez de registrar eventos y oyentes (listeners) manualmente en el arreglo <code>$listen</code> del <code>EventServiceProvider</code>, puedes habilitar la detección automática de eventos. Cuando se habilita la detección de eventos, Laravel encontrará y registrará automáticamente tus eventos y oyentes escaneando el directorio <code>Listeners</code> de tu aplicación. Además, todos los eventos definidos explícitamente listados en el <code>EventServiceProvider</code> seguirán registrados.</p> <p>Laravel encuentra los listeners de eventos mediante el escaneo de las clases listener usando reflexión. Cuando Laravel encuentra algún método de clase listener que empieza por <code>handle</code>, Laravel registrará dichos métodos como listeners de eventos para el evento que está escrito en la firma del método:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>PodcastProcessed</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendPodcastProcessedNotification</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Handle the given event.
    *
    * @param  \App\Events\PodcastProcessed
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>PodcastProcessed <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La detección de eventos está deshabilitada de forma predeterminada, pero puedes habilitarla sobrescribiendo el método <code>shouldDiscoverEvents</code> del <code>EventServiceProvider</code> de tu aplicación:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token comment">/**
* Determine if events and listeners should be automatically discovered.
*
* @return bool
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">shouldDiscoverEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Por defecto, se escanearán todos los oyentes dentro del directorio <code>Listeners</code> de tu aplicación. Si deseas definir directorios adicionales para analizar, puedes sobrescribir el método <code>discoverEventsWithin</code> en tu <code>EventServiceProvider</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token comment">/**
* Get the listener directories that should be used to discover events.
*
* @return array
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">discoverEventsWithin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">app</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Listeners'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>En producción, es probable que no desees que el framework analice todos tus oyentes en cada petición. Por lo tanto, durante tu proceso de despliegue, debes ejecutar el comando Artisan <code>event:cache</code> para almacenar en caché un manifiesto de todos los eventos y oyentes de tu aplicación. Este manifiesto será utilizado por el framework para acelerar el proceso de registro de eventos. El comando <code>event:clear</code> puede ser usado para destruir la caché.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>El comando <code>event:list</code> puede ser usado para mostrar una lista de todos los eventos y oyentes registrados por tu aplicación.</p></div></div><p><a name="defining-events"></a></p> <h2 id="definiendo-eventos"><a href="#definiendo-eventos" class="header-anchor">#</a> Definiendo eventos</h2> <p>Una clase de evento es un contenedor de datos que guarda la información relacionada con el evento. Por ejemplo, supongamos que nuestro evento <code>OrderShipped</code> (orden enviada) generado recibe un objeto <a href="/eloquent.html">ORM Eloquent</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Events</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Order</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">OrderShipped</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">SerializesModels</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token variable">$order</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Create a new event instance.
    *
    * @param  \App\Order  $order
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Order <span class="token variable">$order</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Como puedes ver, esta clase de evento no contiene lógica. Es un contenedor para la instancia <code>Order</code> que se compró. El trait <code>SerializesModels</code> utilizado por el evento serializará con elegancia cualquier modelo Eloquent si el objeto del evento se serializa utilizando la función de PHP <code>serialize</code>.</p> <p><a name="defining-listeners"></a></p> <h2 id="definiendo-oyentes"><a href="#definiendo-oyentes" class="header-anchor">#</a> Definiendo oyentes</h2> <p>A continuación, demos un vistazo al oyente de nuestro evento de ejemplo. Los oyentes de eventos reciben la instancia de evento en su método <code>handle</code>. El comando <code>event:generate</code> importará automáticamente la clase de evento adecuada y declarará el tipo de evento en el método <code>handle</code>. Dentro del método <code>handle</code>, puedes realizar las acciones necesarias para responder al evento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendShipmentNotification</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Create the event listener.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Handle the event.
    *
    * @param  \App\Events\OrderShipped  $event
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>OrderShipped <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Access the order using $event-&gt;order...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Tus oyentes de eventos también pueden declarar el tipo de cualquier dependencia que necesiten en sus constructores. Todos los oyentes de eventos se resuelven a través del <a href="/container.html">contenedor de servicio</a> de Laravel, por lo que las dependencias se inyectarán automáticamente.</p></div> <h4 id="deteniendo-la-propagacion-de-un-evento"><a href="#deteniendo-la-propagacion-de-un-evento" class="header-anchor">#</a> Deteniendo la propagación de un evento</h4> <p>A veces, es posible que desees detener la propagación de un evento a otros oyentes. Puedes hacerlo devolviendo <code>false</code> desde el método <code>handle</code> de tu oyente.</p> <p><a name="queued-event-listeners"></a></p> <h2 id="oyentes-de-eventos-en-cola"><a href="#oyentes-de-eventos-en-cola" class="header-anchor">#</a> Oyentes de eventos en cola</h2> <p>Encolar oyentes puede ser beneficioso si tu oyente va a realizar una tarea lenta, como enviar un correo electrónico o realizar una solicitud HTTP. Antes de comenzar con oyentes en cola, asegúrate de <a href="/queues.html">configurar su cola</a> e iniciar un oyente de cola en tu servidor o entorno de desarrollo local.</p> <p>Para especificar que un oyente debe estar en cola, agrega la interfaz <code>ShouldQueue</code> a la clase de oyente. Los oyentes generados por el comando de Artisan <code>event:generate</code> ya tienen esta interfaz importada en el espacio de nombres actual, por lo que puedes usarla inmediatamente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendShipmentNotification</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>¡Eso es! Ahora, cuando este oyente es llamado por un evento, el despachador de eventos lo colocará en cola automáticamente usando el <a href="/queues.html">sistema de colas</a> de Laravel. Si no se lanzan excepciones cuando la cola ejecuta el oyente, el trabajo en cola se eliminará automáticamente una vez que haya terminado de procesarse.</p> <h4 id="personalizando-la-conexion-de-la-cola-y-el-nombre-de-la-cola"><a href="#personalizando-la-conexion-de-la-cola-y-el-nombre-de-la-cola" class="header-anchor">#</a> Personalizando la conexión de la cola y el nombre de la cola</h4> <p>Si deseas personalizar la conexión de cola, el nombre de la cola o el tiempo de demora de la cola de un oyente de eventos, puedes definir las propiedades <code>$connection</code>, <code>$queue</code> o <code>$delay</code> en tu clase de oyente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendShipmentNotification</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The name of the connection the job should be sent to.
    *
    * @var string|null
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$connection</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'sqs'</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * The name of the queue the job should be sent to.
    *
    * @var string|null
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$queue</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'listeners'</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * The time (seconds) before the job should be processed.
    *
    * @var int
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$delay</span> <span class="token operator">=</span> <span class="token number">60</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="cola-condicional-de-listeners"><a href="#cola-condicional-de-listeners" class="header-anchor">#</a> Cola condicional de listeners</h4> <p>Algunas veces, necesitarás determinar si un listener debe ser agregado a una cola en base a datos que sólo están disponibles en tiempo de ejecución. Para lograr esto, un método <code>shouldQueue</code> puede ser agregado a un listener para determinar si el listener debe ser agregado a una cola y ejecutado de forma sincrónica:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderPlaced</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RewardGiftCard</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Reward a gift card to the customer.
    *
    * @param  \App\Events\OrderPlaced  $event
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>OrderPlaced <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Determine whether the listener should be queued.
    *
    * @param  \App\Events\OrderPlaced  $event
    * @return bool
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">shouldQueue</span><span class="token punctuation">(</span>OrderPlaced <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">subtotal</span> <span class="token operator">&gt;=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="manually-accessing-the-queue"></a></p> <h3 id="accediendo-la-cola-manualmente"><a href="#accediendo-la-cola-manualmente" class="header-anchor">#</a> Accediendo la cola manualmente</h3> <p>Si necesitas acceder manualmente a los métodos <code>delete</code> y <code>release</code> de la cola de trabajo subyacente del oyente, puedes hacerlo utilizando el trait <code>Illuminate\Queue\InteractsWithQueue</code>. Este trait se importa de forma predeterminada en los oyentes generados y proporciona acceso a estos métodos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>InteractsWithQueue</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendShipmentNotification</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">InteractsWithQueue</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Handle the event.
    *
    * @param  \App\Events\OrderShipped  $event
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>OrderShipped <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean constant">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="handling-failed-jobs"></a></p> <h3 id="manejo-de-trabajos-fallidos"><a href="#manejo-de-trabajos-fallidos" class="header-anchor">#</a> Manejo de trabajos fallidos</h3> <p>A veces, tus oyentes de eventos en cola pueden fallar. Si el oyente en cola supera el número máximo de intentos según lo define tu trabajador de cola, se llamará al método <code>failed</code> en tu oyente. El método <code>failed</code> recibe la instancia del evento y la excepción que causó el error:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>InteractsWithQueue</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">SendShipmentNotification</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">InteractsWithQueue</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Handle the event.
    *
    * @param  \App\Events\OrderShipped  $event
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>OrderShipped <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Handle a job failure.
    *
    * @param  \App\Events\OrderShipped  $event
    * @param  \Exception  $exception
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">failed</span><span class="token punctuation">(</span>OrderShipped <span class="token variable">$event</span><span class="token punctuation">,</span> <span class="token variable">$exception</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="dispatching-events"></a></p> <h2 id="despachando-eventos"><a href="#despachando-eventos" class="header-anchor">#</a> Despachando eventos</h2> <p>Para enviar un evento, puedes pasar una instancia del evento a la función de ayuda (helper) <code>event</code>. El helper enviará el evento a todos tus oyentes registrados. Dado que el helper <code>event</code> está disponible globalmente, puedes llamarlo desde cualquier lugar de tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Order</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">OrderController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Ship the given order.
    *
    * @param  int  $orderId
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">ship</span><span class="token punctuation">(</span><span class="token variable">$orderId</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$order</span> <span class="token operator">=</span> Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">findOrFail</span><span class="token punctuation">(</span><span class="token variable">$orderId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Order shipment logic...</span>

        <span class="token function">event</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OrderShipped</span><span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Al realizar pruebas, puede ser útil afirmar que ciertos eventos se enviaron sin activar realmente a tus oyentes. Las <a href="/mocking.html#event-fake">funciones de ayuda (helpers) incluidas</a> en Laravel hace que sea fácil de hacerlo.</p></div> <p><a name="event-subscribers"></a></p> <h2 id="suscriptores-de-eventos"><a href="#suscriptores-de-eventos" class="header-anchor">#</a> Suscriptores de eventos</h2> <p><a name="writing-event-subscribers"></a></p> <h3 id="escribiendo-suscriptores-de-eventos"><a href="#escribiendo-suscriptores-de-eventos" class="header-anchor">#</a> Escribiendo suscriptores de eventos</h3> <p>Los suscriptores de eventos son clases que pueden suscribirse a múltiples eventos dentro de la misma clase, lo que te permite definir varios manejadores de eventos dentro de una sola clase. Los suscriptores deben definir un método <code>subscribe</code>, al que se le pasará una instancia de despachador de eventos. Puedes llamar al método <code>listen</code> en el despachador dado para registrar los oyentes de eventos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Listeners</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserEventSubscriber</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Handle user login events.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handleUserLogin</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">/**
    * Handle user logout events.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handleUserLogout</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token comment">/**
    * Register the listeners for the subscriber.
    *
    * @param  \Illuminate\Events\Dispatcher  $events
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token variable">$events</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'Illuminate\Auth\Events\Login'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'App\Listeners\UserEventSubscriber@handleUserLogin'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$events</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">listen</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">'Illuminate\Auth\Events\Logout'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'App\Listeners\UserEventSubscriber@handleUserLogout'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="registering-event-subscribers"></a></p> <h3 id="registrando-suscriptores-de-eventos"><a href="#registrando-suscriptores-de-eventos" class="header-anchor">#</a> Registrando suscriptores de eventos</h3> <p>Después de escribir el suscriptor, estás listo para registrarlo con el despachador de eventos. Puedes registrar suscriptores usando la propiedad <code>$subscribe</code> en el <code>EventServiceProvider</code>. Por ejemplo, vamos a agregar el <code>UserEventSubscriber</code> a la lista:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Providers<span class="token punctuation">\</span>EventServiceProvider</span> <span class="token keyword">as</span> ServiceProvider<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">EventServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The event listener mappings for the application.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$listen</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token comment">//</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * The subscriber classes to register.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$subscribe</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'App\Listeners\UserEventSubscriber'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d18a7e07.js" defer></script><script src="/assets/js/2.8e5ca9eb.js" defer></script><script src="/assets/js/36.bc235e6d.js" defer></script>
  </body>
</html>
