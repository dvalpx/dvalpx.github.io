<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentación de Laravel en español</title>
    <meta name="description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
  <link rel="icon" href="/favicon.png">
  <meta property="og:url" content="https://documentacion-laravel.com">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Documentación de Laravel en español">
  <meta property="og:description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
  <meta property="og:image" content="https://documentacion-laravel.com/social-preview.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.ff366ceb.css" as="style"><link rel="preload" href="/assets/js/app.19461454.js" as="script"><link rel="preload" href="/assets/js/2.86610498.js" as="script"><link rel="preload" href="/assets/js/57.99c00493.js" as="script"><link rel="prefetch" href="/assets/js/10.36c44f87.js"><link rel="prefetch" href="/assets/js/11.b9d8e009.js"><link rel="prefetch" href="/assets/js/12.23717997.js"><link rel="prefetch" href="/assets/js/13.4efab22a.js"><link rel="prefetch" href="/assets/js/14.aa5e7d61.js"><link rel="prefetch" href="/assets/js/15.91397c7f.js"><link rel="prefetch" href="/assets/js/16.399829a2.js"><link rel="prefetch" href="/assets/js/17.de78f43b.js"><link rel="prefetch" href="/assets/js/18.25db323f.js"><link rel="prefetch" href="/assets/js/19.972dccd2.js"><link rel="prefetch" href="/assets/js/20.88a6c75b.js"><link rel="prefetch" href="/assets/js/21.432eff7c.js"><link rel="prefetch" href="/assets/js/22.5bb96d4b.js"><link rel="prefetch" href="/assets/js/23.18fc5ffc.js"><link rel="prefetch" href="/assets/js/24.59446d43.js"><link rel="prefetch" href="/assets/js/25.45cbb34e.js"><link rel="prefetch" href="/assets/js/26.a3ea8e1a.js"><link rel="prefetch" href="/assets/js/27.fdccda30.js"><link rel="prefetch" href="/assets/js/28.71b36a49.js"><link rel="prefetch" href="/assets/js/29.cd4eea4c.js"><link rel="prefetch" href="/assets/js/3.23812574.js"><link rel="prefetch" href="/assets/js/30.4f2928e4.js"><link rel="prefetch" href="/assets/js/31.cb7d4b60.js"><link rel="prefetch" href="/assets/js/32.e6adb4fd.js"><link rel="prefetch" href="/assets/js/33.cf79ca15.js"><link rel="prefetch" href="/assets/js/34.e7c7f43e.js"><link rel="prefetch" href="/assets/js/35.89f9fc52.js"><link rel="prefetch" href="/assets/js/36.e79704b1.js"><link rel="prefetch" href="/assets/js/37.d8b762e9.js"><link rel="prefetch" href="/assets/js/38.de0cd561.js"><link rel="prefetch" href="/assets/js/39.c0a15dcd.js"><link rel="prefetch" href="/assets/js/4.4f1f59b5.js"><link rel="prefetch" href="/assets/js/40.eddc068a.js"><link rel="prefetch" href="/assets/js/41.c47ab494.js"><link rel="prefetch" href="/assets/js/42.a1b067b0.js"><link rel="prefetch" href="/assets/js/43.d42a919e.js"><link rel="prefetch" href="/assets/js/44.5ce8fe6f.js"><link rel="prefetch" href="/assets/js/45.1685de7f.js"><link rel="prefetch" href="/assets/js/46.7f598d43.js"><link rel="prefetch" href="/assets/js/47.64de21c7.js"><link rel="prefetch" href="/assets/js/48.ae233781.js"><link rel="prefetch" href="/assets/js/49.adca7022.js"><link rel="prefetch" href="/assets/js/5.a3e524a6.js"><link rel="prefetch" href="/assets/js/50.238a790a.js"><link rel="prefetch" href="/assets/js/51.417cf34e.js"><link rel="prefetch" href="/assets/js/52.ec6cae3a.js"><link rel="prefetch" href="/assets/js/53.27f65ccc.js"><link rel="prefetch" href="/assets/js/54.fa3dbc8f.js"><link rel="prefetch" href="/assets/js/55.01b4693d.js"><link rel="prefetch" href="/assets/js/56.554072c2.js"><link rel="prefetch" href="/assets/js/58.394ee831.js"><link rel="prefetch" href="/assets/js/59.77edd632.js"><link rel="prefetch" href="/assets/js/6.fbae4a48.js"><link rel="prefetch" href="/assets/js/60.e2138558.js"><link rel="prefetch" href="/assets/js/61.4d4fe81d.js"><link rel="prefetch" href="/assets/js/62.a3b2c92f.js"><link rel="prefetch" href="/assets/js/63.cde2910d.js"><link rel="prefetch" href="/assets/js/64.9382ecb5.js"><link rel="prefetch" href="/assets/js/65.7ff00b49.js"><link rel="prefetch" href="/assets/js/66.06bf0657.js"><link rel="prefetch" href="/assets/js/67.33a64219.js"><link rel="prefetch" href="/assets/js/68.25ac39dc.js"><link rel="prefetch" href="/assets/js/69.a771ace5.js"><link rel="prefetch" href="/assets/js/7.14b6145f.js"><link rel="prefetch" href="/assets/js/70.98667061.js"><link rel="prefetch" href="/assets/js/71.cc0006c5.js"><link rel="prefetch" href="/assets/js/72.58a1fc5a.js"><link rel="prefetch" href="/assets/js/73.3c8df033.js"><link rel="prefetch" href="/assets/js/74.15f97ccb.js"><link rel="prefetch" href="/assets/js/75.0183525a.js"><link rel="prefetch" href="/assets/js/76.081169f3.js"><link rel="prefetch" href="/assets/js/77.12e2d18f.js"><link rel="prefetch" href="/assets/js/78.5c2d134b.js"><link rel="prefetch" href="/assets/js/79.7d2415b1.js"><link rel="prefetch" href="/assets/js/8.72213913.js"><link rel="prefetch" href="/assets/js/80.c67eb297.js"><link rel="prefetch" href="/assets/js/81.194feade.js"><link rel="prefetch" href="/assets/js/82.e34032b1.js"><link rel="prefetch" href="/assets/js/83.b46ce377.js"><link rel="prefetch" href="/assets/js/84.c52c0ef0.js"><link rel="prefetch" href="/assets/js/85.f55fd4e9.js"><link rel="prefetch" href="/assets/js/86.b328674e.js"><link rel="prefetch" href="/assets/js/9.d90e4ccd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ff366ceb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en español</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Primeros pasos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Conceptos de arquitectura</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bases de datos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Pruebas</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/testing.html" class="sidebar-link">Pruebas: Primeros Pasos</a></li><li><a href="/http-tests.html" class="sidebar-link">Pruebas HTTP</a></li><li><a href="/console-tests.html" class="sidebar-link">Pruebas de consola</a></li><li><a href="/dusk.html" class="sidebar-link">Laravel Dusk</a></li><li><a href="/database-testing.html" class="sidebar-link">Pruebas de base de datos</a></li><li><a href="/mocking.html" class="active sidebar-link">Mocking</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/mocking.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/mocking.html#mocking-de-objetos" class="sidebar-link">Mocking de objetos</a></li><li class="sidebar-sub-header"><a href="/mocking.html#fake-de-trabajos-jobs" class="sidebar-link">Fake de trabajos (jobs)</a></li><li class="sidebar-sub-header"><a href="/mocking.html#fake-de-eventos" class="sidebar-link">Fake de eventos</a></li><li class="sidebar-sub-header"><a href="/mocking.html#fake-de-correos-electronicos" class="sidebar-link">Fake de correos electrónicos</a></li><li class="sidebar-sub-header"><a href="/mocking.html#fake-de-notificaciones" class="sidebar-link">Fake de notificaciones</a></li><li class="sidebar-sub-header"><a href="/mocking.html#fake-de-colas" class="sidebar-link">Fake de colas</a></li><li class="sidebar-sub-header"><a href="/mocking.html#fake-de-almacenamiento-de-archivos" class="sidebar-link">Fake de almacenamiento de archivos</a></li><li class="sidebar-sub-header"><a href="/mocking.html#las-clases-facade" class="sidebar-link">Las clases facade</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="mocking"><a class="header-anchor" href="#mocking" aria-hidden="true">#</a> Mocking</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#mocking-objects">Mocking de objectos</a></li> <li><a href="#bus-fake">Fake de trabajos (Jobs)</a></li> <li><a href="#event-fake">Fake de eventos</a> <ul><li><a href="#scoped-event-fakes">Fake de eventos con alcance</a></li></ul></li> <li><a href="#mail-fake">Fake de correos electrónicos</a></li> <li><a href="#notification-fake">Fake de notificaciones</a></li> <li><a href="#queue-fake">Fake de colas</a></li> <li><a href="#storage-fake">Fake de almacenamiento de archivos</a></li> <li><a href="#mocking-facades">Clases facade</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Al momento de probar aplicaciones de Laravel, puedes querer &quot;simular&quot; (mock) ciertos aspectos de tu aplicación de modo que realmente no sean ejecutados durante una prueba dada. Por ejemplo, al momento de probar un controlador que despacha un evento, puedes querer simular los listeners de eventos de modo que realmente no se ejecuten durante la prueba. Esto te permite probar solamente la respuesta HTTP del controlador sin preocuparte por la ejecución de los listeners de eventos, ya que los listeners de eventos pueden ser evaluados en sus propios casos de prueba.</p> <p>Laravel provee funciones helpers para simular eventos, tareas y clases facades predeterminadas. Estos helpers proporcionan principalmente una capa conveniente sobre la clase Mockery de modo que no tengas que hacer manualmente llamadas complicadas a métodos Mockery. Puedes también usar <a href="http://docs.mockery.io/en/latest/" target="_blank" rel="noopener noreferrer">Mockery<OutboundLink></OutboundLink></a> o PHPUnit para crear tus propios mocks o spies.</p> <p><a name="mocking-objects"></a></p> <h2 id="mocking-de-objetos"><a class="header-anchor" href="#mocking-de-objetos" aria-hidden="true">#</a> Mocking de objetos</h2> <p>Cuando hagas mocking de un objeto que vas a inyectar en tu aplicación a través del contenedor de servicio de Laravel, debes enlazar tu instancia a la que le has hecho mocking al contenedor como un enlace de <code>instance</code>. Esto le indicará al contenedor que use tu instancia &quot;mockeada&quot; del objeto en lugar de construir el propio objeto:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">use</span> <span class="token package">Mockery</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">instance</span><span class="token punctuation">(</span>Service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> Mockery<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">mock</span><span class="token punctuation">(</span>Service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$mock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">shouldReceive</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Para hacer esto más conveniente, puedes usar el método <code>mock</code>, que es proporcionado por la clase TestCase base de Laravel:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">mock</span><span class="token punctuation">(</span>Service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$mock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">shouldReceive</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>De forma similar, si quieres espiar un objeto, la clase de prueba base de Laravel ofrece un método <code>spy</code> como un wrapper conveniente del método <code>Mockery::spy</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Service</span><span class="token punctuation">;</span>

<span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">spy</span><span class="token punctuation">(</span>Service<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$mock</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$mock</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">shouldHaveReceived</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'process'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="bus-fake"></a></p> <h2 id="fake-de-trabajos-jobs"><a class="header-anchor" href="#fake-de-trabajos-jobs" aria-hidden="true">#</a> Fake de trabajos (jobs)</h2> <p>Como una alternativa a mocking, puedes usar el método <code>fake</code> de la clase facade <code>Bus</code> para evitar que determinadas tareas sean despachadas. Al momento de usar fakes, las aserciones serán hechas después de que el código bajo prueba sea ejecutado.</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ShipOrder</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Bus</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Bus<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Bus<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span class="token punctuation">(</span>ShipOrder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$job</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$job</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un trabajo no fue enviado...</span>
        Bus<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotDispatched</span><span class="token punctuation">(</span>AnotherJob<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="event-fake"></a></p> <h2 id="fake-de-eventos"><a class="header-anchor" href="#fake-de-eventos" aria-hidden="true">#</a> Fake de eventos</h2> <p>Como una alternativa a mocking, puedes usar el método <code>fake</code> de la clase facade <code>Event</code> para prevenir la ejecución de todos los listeners de eventos. Después puedes comprobar que los eventos fueron despachados e incluso inspeccionar los datos que recibieron. Al momento de usar fakes, las aserciones son hechas después de que el código bajo prueba sea ejecutado:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderFailedToShip</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Test order shipping.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span class="token punctuation">(</span>OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un evento fue enviado dos veces...</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span class="token punctuation">(</span>OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un evento no fue enviado...</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotDispatched</span><span class="token punctuation">(</span>OrderFailedToShip<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Después de llamar a <code>Event::fake()</code>, no se ejecutarán listeners de eventos. Entonces, si tus pruebas usan model factories que dependen de eventos, cómo crear una UUID durante el evento de modelo <code>creating</code>, debes llamar <code>Event::fake()</code> <strong>después</strong> de usar tus factories.</p></div></div><h4 id="haciendo-fake-a-un-subconjunto-de-eventos"><a href="#haciendo-fake-a-un-subconjunto-de-eventos" aria-hidden="true" class="header-anchor">#</a> Haciendo fake a un subconjunto de eventos</h4> <p>Si sólo si deseas hacer fake a listeners de eventos para un grupo específico de eventos, puedes pasarlos a los métodos <code>fake</code> o <code>fakeFor</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Test order process.
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        OrderCreated<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span class="token punctuation">(</span>OrderCreated<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Otros eventos se envían de forma normal...</span>
    <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="scoped-event-fakes"></a></p> <h3 id="fake-de-eventos-con-alcance"><a href="#fake-de-eventos-con-alcance" aria-hidden="true" class="header-anchor">#</a> Fake de eventos con alcance</h3> <p>Si sólo quieres hacer fake a oyentes de eventos para una porción de la prueba, se puede usar el método <code>fakeFor</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Order</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Events<span class="token punctuation">\</span>OrderCreated</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Test order process.
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$order</span> <span class="token operator">=</span> Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fakeFor</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span>Order<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertDispatched</span><span class="token punctuation">(</span>OrderCreated<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token variable">$order</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Los eventos se envían normalmente y los observadores se ejecutarán...</span>
        <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="mail-fake"></a></p> <h2 id="fake-de-correos-electronicos"><a href="#fake-de-correos-electronicos" aria-hidden="true" class="header-anchor">#</a> Fake de correos electrónicos</h2> <p>Puedes usar el método <code>fake</code> de la clase facade <code>Mail</code> para prevenir que los correos sean enviados. Después puedes comprobar qué <a href="/mail.html">correos de clases mailables</a> fueron enviados a los usuarios e incluso inspeccionar los datos que recibieron. Al momento de usar fakes, las aserciones son hechas después de que el código bajo prueba sea ejecutado.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Mail<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Mail</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que no se enviaron mailables...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNothingSent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertSent</span><span class="token punctuation">(</span>OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$mail</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$mail</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un mensaje fue enviado a los usuarios dados...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertSent</span><span class="token punctuation">(</span>OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$mail</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$mail</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasTo</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    <span class="token variable">$mail</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasCc</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'...'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    <span class="token variable">$mail</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hasBcc</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un correo electrónico fue enviado dos veces...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertSent</span><span class="token punctuation">(</span>OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un correo electrónico no fue enviado...</span>
        Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotSent</span><span class="token punctuation">(</span>AnotherMailable<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si estás haciendo colas de mailables para su entrega en segundo plano, deberías usar el método <code>assertQueued</code> en lugar de <code>assertSent</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertQueued</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Mail<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotQueued</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="notification-fake"></a></p> <h2 id="fake-de-notificaciones"><a href="#fake-de-notificaciones" aria-hidden="true" class="header-anchor">#</a> Fake de notificaciones</h2> <p>Puedes usar el método <code>fake</code> de la clase facade <code>Notification</code> para prevenir que se envíen las notificaciones. Después puedes comprobar qué <a href="/notifications.html">notificaciones</a> fueron enviadas a los usuarios e incluso inspeccionar los datos que recibieron. Al momento de usar fakes, las aserciones son hechas después de que el código bajo prueba es ejecutado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>OrderShipped</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Notification</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Notifications<span class="token punctuation">\</span>AnonymousNotifiable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que no se enviaron notificaciones...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNothingSent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token variable">$user</span><span class="token punctuation">,</span>
            OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$notification</span><span class="token punctuation">,</span> <span class="token variable">$channels</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$notification</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que una notificación fue enviada a los usuarios dados...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">,</span> OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que una notificación no fue enviada...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotSentTo</span><span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token variable">$user</span><span class="token punctuation">]</span><span class="token punctuation">,</span> AnotherNotification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que se envió una notificación mediante el método Notification::route ()...</span>
        Notification<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertSentTo</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">AnonymousNotifiable</span><span class="token punctuation">,</span> OrderShipped<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="queue-fake"></a></p> <h2 id="fake-de-colas"><a href="#fake-de-colas" aria-hidden="true" class="header-anchor">#</a> Fake de colas</h2> <p>Como alternativa a mocking, puedes usar el método <code>fake</code> de la clase facade <code>Queue</code> para prevenir que las tareas sean encoladas. Después puedes comprobar que tareas fueron agregadas a la cola e incluso inspeccionar los datos que recibieron. Al momento de usar fakes, las aserciones son hechas después de que el código bajo prueba es ejecutado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Jobs<span class="token punctuation">\</span>ShipOrder</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Queue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testOrderShipping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que no se agregaron trabajos...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNothingPushed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Perform order shipping...</span>

        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertPushed</span><span class="token punctuation">(</span>ShipOrder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$job</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$order</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$job</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$order</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un trabajo fue agregado a una cola dada...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertPushedOn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'queue-name'</span><span class="token punctuation">,</span> ShipOrder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un trabajo fue agregado dos veces...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertPushed</span><span class="token punctuation">(</span>ShipOrder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un trabajo no fue agregado...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertNotPushed</span><span class="token punctuation">(</span>AnotherJob<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que un trabajo fue agregado con una cadena específica...</span>
        Queue<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">assertPushedWithChain</span><span class="token punctuation">(</span>ShipOrder<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            AnotherJob<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            FinalJob<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="storage-fake"></a></p> <h2 id="fake-de-almacenamiento-de-archivos"><a href="#fake-de-almacenamiento-de-archivos" aria-hidden="true" class="header-anchor">#</a> Fake de almacenamiento de archivos</h2> <p>El método fake de la clase facade <code>Storage</code> permite que generes fácilmente un disco falso que, combinado con las utilidades de generación de archivo de la clase <code>UploadedFile</code>, simplifica mucho la prueba de subidas de archivos. Por ejemplo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>UploadedFile</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Storage</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ExampleTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testAlbumUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photos'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'POST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/photos'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            UploadedFile<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photo1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            UploadedFile<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">image</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photo2.jpg'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que uno o más archivos fueron almacenados...</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photos'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertExists</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photo1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photos'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertExists</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'photo1.jpg'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'photo2.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Comprueba que uno o más archivos no fueron almacenados...</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photos'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertMissing</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'missing.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Storage<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">disk</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'photos'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">assertMissing</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'missing.jpg'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'non-existing.jpg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>De forma predeterminada, el método <code>fake</code> borrará todos los archivos en su directorio temporal. Si prefieres mantener estos archivos, puedes usar en su lugar el método &quot;persistentFake&quot;.</p></div> <p><a name="mocking-facades"></a></p> <h2 id="las-clases-facade"><a href="#las-clases-facade" aria-hidden="true" class="header-anchor">#</a> Las clases facade</h2> <p>Diferente de las llamadas de métodos estáticos tradicionales, <a href="/facades.html">las clases facade</a> pueden ser simuladas (mock). Esto proporciona una gran ventaja sobre los métodos estáticos tradicionales y te concede la misma capacidad de prueba que tendrías si estuvieras usando inyección de dependencias. Al momento de probar, con frecuencia puedes querer simular una llamada a una clase facade de Laravel en uno de tus controladores. Por ejemplo, considera la siguiente acción de controlador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Show a list of all users of the application.
    *
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$value</span> <span class="token operator">=</span> Cache<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Podemos simular (mock) la ejecución de la clase facade <code>Cache</code> usando el método <code>shouldReceive</code>, el cual devolverá una instancia mock de la clase <a href="https://github.com/padraic/mockery" target="_blank" rel="noopener noreferrer">Mockery<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Ya que las clases facades realmente son resueltas y administradas por el <a href="/container.html">contenedor de servicios</a> de Laravel, tendrán mucho más capacidad de prueba que una clase estática típica. Por ejemplo, vamos a simular (mock) nuestra llamada al método <code>get</code> de la clase facade <code>Cache</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Tests<span class="token punctuation">\</span>Feature</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Tests<span class="token punctuation">\</span>TestCase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>RefreshDatabase</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>WithoutMiddleware</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserControllerTest</span> <span class="token keyword">extends</span> <span class="token class-name">TestCase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">testGetIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Cache<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">shouldReceive</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'get'</span><span class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'key'</span><span class="token punctuation">)</span>
                    <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">andReturn</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>No deberías hacer mock a la clase facade <code>Request</code>. En lugar de eso, pasa la entrada que deseas dentro de los métodos helper HTTP tales como <code>get</code> y <code>post</code> al momento de ejecutar tus pruebas. Del mismo modo, en lugar de simular (mock) la clase facade <code>Config</code>, ejecuta el método <code>Config::set</code> en tus pruebas.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/database-testing.html" class="prev">Pruebas de base de datos</a></span> <span class="next"><a href="/billing.html">Laravel Cashier</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.19461454.js" defer></script><script src="/assets/js/2.86610498.js" defer></script><script src="/assets/js/57.99c00493.js" defer></script>
  </body>
</html>
