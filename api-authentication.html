<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentación de Laravel</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
  <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.4a3db098.css" as="style"><link rel="preload" href="/assets/js/app.34708d16.js" as="script"><link rel="preload" href="/assets/js/2.21c7bc6a.js" as="script"><link rel="preload" href="/assets/js/10.8b2acdbc.js" as="script"><link rel="prefetch" href="/assets/js/11.58b3c2a4.js"><link rel="prefetch" href="/assets/js/12.758d5732.js"><link rel="prefetch" href="/assets/js/13.d4ab46c5.js"><link rel="prefetch" href="/assets/js/14.ee71d206.js"><link rel="prefetch" href="/assets/js/15.aedb2622.js"><link rel="prefetch" href="/assets/js/16.17cad171.js"><link rel="prefetch" href="/assets/js/17.1e73d1c5.js"><link rel="prefetch" href="/assets/js/18.ad65827a.js"><link rel="prefetch" href="/assets/js/19.5322c1ad.js"><link rel="prefetch" href="/assets/js/20.572112da.js"><link rel="prefetch" href="/assets/js/21.183137f3.js"><link rel="prefetch" href="/assets/js/22.89550517.js"><link rel="prefetch" href="/assets/js/23.30167bad.js"><link rel="prefetch" href="/assets/js/24.9f9ff6fb.js"><link rel="prefetch" href="/assets/js/25.c7d2bf72.js"><link rel="prefetch" href="/assets/js/26.91394937.js"><link rel="prefetch" href="/assets/js/27.dd3fbfad.js"><link rel="prefetch" href="/assets/js/28.7642415b.js"><link rel="prefetch" href="/assets/js/29.e7c602bf.js"><link rel="prefetch" href="/assets/js/3.5cc936cb.js"><link rel="prefetch" href="/assets/js/30.bc734c98.js"><link rel="prefetch" href="/assets/js/31.01319784.js"><link rel="prefetch" href="/assets/js/32.5a7b76cc.js"><link rel="prefetch" href="/assets/js/33.553667be.js"><link rel="prefetch" href="/assets/js/34.d8ebe6c9.js"><link rel="prefetch" href="/assets/js/35.5cd7672c.js"><link rel="prefetch" href="/assets/js/36.bd10d63e.js"><link rel="prefetch" href="/assets/js/37.2620bbb1.js"><link rel="prefetch" href="/assets/js/38.d944f840.js"><link rel="prefetch" href="/assets/js/39.a249b716.js"><link rel="prefetch" href="/assets/js/4.e595a29b.js"><link rel="prefetch" href="/assets/js/40.66c19b4b.js"><link rel="prefetch" href="/assets/js/41.6f635c50.js"><link rel="prefetch" href="/assets/js/42.68fd156e.js"><link rel="prefetch" href="/assets/js/43.c4a3d60c.js"><link rel="prefetch" href="/assets/js/44.da7edf96.js"><link rel="prefetch" href="/assets/js/45.b6063674.js"><link rel="prefetch" href="/assets/js/46.aaf0f750.js"><link rel="prefetch" href="/assets/js/47.5f8f469c.js"><link rel="prefetch" href="/assets/js/48.70bffde5.js"><link rel="prefetch" href="/assets/js/49.cf355577.js"><link rel="prefetch" href="/assets/js/5.62f30d19.js"><link rel="prefetch" href="/assets/js/50.aa2dacd2.js"><link rel="prefetch" href="/assets/js/51.828296d3.js"><link rel="prefetch" href="/assets/js/52.f0074f84.js"><link rel="prefetch" href="/assets/js/53.e1482350.js"><link rel="prefetch" href="/assets/js/54.33c65356.js"><link rel="prefetch" href="/assets/js/55.7670aec3.js"><link rel="prefetch" href="/assets/js/56.773d926f.js"><link rel="prefetch" href="/assets/js/57.fe5a2472.js"><link rel="prefetch" href="/assets/js/58.b2200efc.js"><link rel="prefetch" href="/assets/js/59.de8ee229.js"><link rel="prefetch" href="/assets/js/6.6adc09b1.js"><link rel="prefetch" href="/assets/js/60.febbbea1.js"><link rel="prefetch" href="/assets/js/61.95fc2e36.js"><link rel="prefetch" href="/assets/js/62.1aa0e791.js"><link rel="prefetch" href="/assets/js/63.e30195db.js"><link rel="prefetch" href="/assets/js/64.c2ce6b9b.js"><link rel="prefetch" href="/assets/js/65.ca82bba9.js"><link rel="prefetch" href="/assets/js/66.a17f44a2.js"><link rel="prefetch" href="/assets/js/67.20ee0f4b.js"><link rel="prefetch" href="/assets/js/68.b3ba8de6.js"><link rel="prefetch" href="/assets/js/69.3d4f376c.js"><link rel="prefetch" href="/assets/js/7.63e5bd7b.js"><link rel="prefetch" href="/assets/js/70.90a140af.js"><link rel="prefetch" href="/assets/js/71.2d8fe6b2.js"><link rel="prefetch" href="/assets/js/72.b5a24e93.js"><link rel="prefetch" href="/assets/js/73.df07d4fb.js"><link rel="prefetch" href="/assets/js/74.9879b98c.js"><link rel="prefetch" href="/assets/js/75.af2af324.js"><link rel="prefetch" href="/assets/js/76.a0c78c06.js"><link rel="prefetch" href="/assets/js/77.5aa1d5b0.js"><link rel="prefetch" href="/assets/js/78.a2afac17.js"><link rel="prefetch" href="/assets/js/79.05a5125a.js"><link rel="prefetch" href="/assets/js/8.06394c3a.js"><link rel="prefetch" href="/assets/js/80.32226ede.js"><link rel="prefetch" href="/assets/js/81.bb512b1a.js"><link rel="prefetch" href="/assets/js/82.38081b43.js"><link rel="prefetch" href="/assets/js/83.677b1ea0.js"><link rel="prefetch" href="/assets/js/84.f67af089.js"><link rel="prefetch" href="/assets/js/85.9ad5f043.js"><link rel="prefetch" href="/assets/js/86.165109af.js"><link rel="prefetch" href="/assets/js/9.d5dd7b76.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4a3db098.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Primeros pasos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Conceptos de arquitectura</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Seguridad</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/authentication.html" class="sidebar-link">Autenticación</a></li><li><a href="/api-authentication.html" class="active sidebar-link">Autenticación de API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api-authentication.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/api-authentication.html#configuracion" class="sidebar-link">Configuración</a></li><li class="sidebar-sub-header"><a href="/api-authentication.html#generando-tokens" class="sidebar-link">Generando tokens</a></li><li class="sidebar-sub-header"><a href="/api-authentication.html#protegiendo-rutas" class="sidebar-link">Protegiendo rutas</a></li><li class="sidebar-sub-header"><a href="/api-authentication.html#pasando-tokens-en-peticiones" class="sidebar-link">Pasando tokens En peticiones</a></li></ul></li><li><a href="/authorization.html" class="sidebar-link">Autorización</a></li><li><a href="/verification.html" class="sidebar-link">Verificación de correo electrónico</a></li><li><a href="/encryption.html" class="sidebar-link">Cifrado</a></li><li><a href="/hashing.html" class="sidebar-link">Hashing</a></li><li><a href="/passwords.html" class="sidebar-link">Restablecimiento de contraseñas</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bases de datos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="autenticacion-de-api"><a class="header-anchor" href="#autenticacion-de-api" aria-hidden="true">#</a> Autenticación de API</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#configuration">Configuración</a> <ul><li><a href="#database-preparation">Migraciones de la base de datos</a></li></ul></li> <li><a href="#generating-tokens">Generando tokens</a> <ul><li><a href="#hashing-tokens">Hashing tokens</a></li></ul></li> <li><a href="#protecting-routes">Protegiendo rutas</a></li> <li><a href="#passing-tokens-in-requests">Pasando tokens en peticiones</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Por defecto, Laravel viene con una sencilla solución para autenticación de API mediante tokens aleatorios asignados a cada usuario de tu aplicación. En tu archivo de configuración <code>config/auth.php</code>, un guard <code>api</code> ya está definido y utiliza un driver <code>token</code>. Este driver es responsable de inspeccionar el token de la API en la petición entrante y verificar que coincida con el token asignado al usuario en la base de datos.</p> <blockquote><p><strong>Nota:</strong> Aunque Laravel viene con un sencillo guard de autenticación basado en token, te recomendamos considerar usar <router-link to="/passport.html">Laravel Passport</router-link> para aplicaciones robustas en producción que ofrecen autenticación de API.</p></blockquote> <p><a name="configuration"></a></p> <h2 id="configuracion"><a class="header-anchor" href="#configuracion" aria-hidden="true">#</a> Configuración</h2> <p><a name="database-preparation"></a></p> <h3 id="preparando-la-base-de-datos"><a class="header-anchor" href="#preparando-la-base-de-datos" aria-hidden="true">#</a> Preparando la base de datos</h3> <p>Antes de usar el driver <code>token</code>, necesitarás <router-link to="/migrations.html">crear una migración</router-link> que agrega una columna <code>api_token</code> a tu tabla <code>users</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Schema<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'api_token'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'password'</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">nullable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Una vez que la migración ha sido creada, ejecuta el comando de Artisan <code>migrate</code>.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Si eliges usar un nombre de columna diferente, asegurate de actualizar la opción <code>storage_key</code> de la configuración de tu API en el archivo <code>config/auth.php</code>.</p></div></div><p><a name="generating-tokens"></a></p> <h2 id="generando-tokens"><a href="#generando-tokens" aria-hidden="true" class="header-anchor">#</a> Generando tokens</h2> <p>Una vez que la columna <code>api_token</code> ha sido agregada a tu tabla <code>users</code>, estás listo para asignar tokens de API aleatorios a cada usuario que se registra en tu aplicación. Debes asignar dichos tokens cuando un modelo <code>User</code> es creado para el usuario durante el registro. Al usar el <a href="/authentication.html#authentication-quickstart">scaffolding de autenticación</a> proporcionado por el paquete de composer <code>laravel/ui</code>, esto puede ser hecho en el método <code>create</code> de <code>RegisterController</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Hash</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Create a new user instance after a valid registration.
*
* @param  array  $data
* @return \App\User
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">array</span> <span class="token variable">$data</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'password'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Hash<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">make</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'api_token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="hashing-tokens"></a></p> <h3 id="hashing-tokens"><a href="#hashing-tokens" aria-hidden="true" class="header-anchor">#</a> Hashing tokens</h3> <p>En los ejemplos de arriba, los tokens de API son almacenados en tu base de datos como texto plano. Si te gustaría agregar un hash a tus tokens de API usando hashing SHA-256, puedes establecer la opción <code>hash</code> de la configuración del guard de tu <code>api</code> a <code>true</code>. El guard <code>api</code> está definido en tu archivo de configuración <code>config/auth.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'api'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'driver'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'token'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'provider'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'users'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'hash'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token boolean constant">true</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="generando-tokens-con-hash"><a href="#generando-tokens-con-hash" aria-hidden="true" class="header-anchor">#</a> Generando tokens con hash</h4> <p>Al usar tokens de API con hash, no debes generar tus tokens de API durante el registro del usuario. En su lugar, necesitarás implementar tu propia página de administración de tokens de API dentro de tu aplicación. Esta página debe permitir a los usuarios inicializar y refrescar sus token de API. Cuando un usuario realiza una petición para inicializar o refrescar su token, debes almacenar una copia con hash del token en la base de datos y retornar una copia de texto plano del token a la vista / frontend del cliente para ser mostrado una sola vez.</p> <p>Por ejemplo, un método de controlador que inicializa / refresca el token para un usuario dado y retorna el texto plano del token como una respuesta JSON pudiera verse de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Str</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ApiTokenController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Update the authenticated user's API token.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$token</span> <span class="token operator">=</span> Str<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">forceFill</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'api_token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'sha256'</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$token</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Dado que los tokens de la API en el ejemplo supierior tienen suficiente entropía, es impractico crear &quot;tablas arcoiris&quot; que buscar el valor original del token con hash. Por lo tanto, métodos de hashing lentos como <code>bcrypt</code> son innecesarios.</p></div> <p><a name="protecting-routes"></a></p> <h2 id="protegiendo-rutas"><a href="#protegiendo-rutas" aria-hidden="true" class="header-anchor">#</a> Protegiendo rutas</h2> <p>Laravel incluye un <a href="/authentication.html#adding-custom-guards">guard de autenticación</a> que validará automáticamente tokens de API en peticiones entrantes. Sólo necesitas especificar el middleware <code>auth:api</code> en cualquier ruta que requiera un token de acceso válido:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'auth:api'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="passing-tokens-in-requests"></a></p> <h2 id="pasando-tokens-en-peticiones"><a href="#pasando-tokens-en-peticiones" aria-hidden="true" class="header-anchor">#</a> Pasando tokens En peticiones</h2> <p>Hay muchas formas de pasar el token de la API a tu aplicación. Discutiremos cada una de esas formas mientras usamos el paquete HTTP Guzzle para demostrar su uso. Puedes elegir cualquiera de estas formas dependiendo de las necesidades de tu aplicación.</p> <h4 id="query-string"><a href="#query-string" aria-hidden="true" class="header-anchor">#</a> Query string</h4> <p>Los usuarios de tu API pueden especificar su token como un valor de cadena de consulta <code>api_token</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'GET'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/api/user?api_token='</span><span class="token punctuation">.</span><span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="request-payload"><a href="#request-payload" aria-hidden="true" class="header-anchor">#</a> Request payload</h4> <p>Los usuarios de tu API pueden incluir su token de API en los parametros del formulario de la petición como <code>api_token</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'POST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/api/user'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'headers'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'Accept'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'form_params'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'api_token'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$token</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="bearer-token"><a href="#bearer-token" aria-hidden="true" class="header-anchor">#</a> Bearer token</h4> <p>Los usuarios de tu API pueden proporcionar su token de API como un token <code>Bearer</code> en el encabezado <code>Authorization</code> de la petición:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> <span class="token variable">$client</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'POST'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'/api/user'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'headers'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'Authorization'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'Bearer '</span><span class="token punctuation">.</span><span class="token variable">$token</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'Accept'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/authentication.html" class="prev">Autenticación</a></span> <span class="next"><a href="/authorization.html">Autorización</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.34708d16.js" defer></script><script src="/assets/js/2.21c7bc6a.js" defer></script><script src="/assets/js/10.8b2acdbc.js" defer></script>
  </body>
</html>
