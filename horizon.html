<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentación de Laravel en español</title>
    <meta name="description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
  <link rel="icon" href="/favicon.png">
  <meta property="og:url" content="https://documentacion-laravel.com">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Documentación de Laravel en español">
  <meta property="og:description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
  <meta property="og:image" content="https://documentacion-laravel.com/social-preview.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.04bcc6ff.css" as="style"><link rel="preload" href="/assets/js/app.8d29aeda.js" as="script"><link rel="preload" href="/assets/js/2.13b8df03.js" as="script"><link rel="preload" href="/assets/js/47.562b0d56.js" as="script"><link rel="prefetch" href="/assets/js/10.970e72c5.js"><link rel="prefetch" href="/assets/js/11.7419d8f8.js"><link rel="prefetch" href="/assets/js/12.d82d6fe0.js"><link rel="prefetch" href="/assets/js/13.99982896.js"><link rel="prefetch" href="/assets/js/14.0b33fdbf.js"><link rel="prefetch" href="/assets/js/15.769b8106.js"><link rel="prefetch" href="/assets/js/16.6b387652.js"><link rel="prefetch" href="/assets/js/17.ea9fa620.js"><link rel="prefetch" href="/assets/js/18.cb0680ba.js"><link rel="prefetch" href="/assets/js/19.a8f4ad02.js"><link rel="prefetch" href="/assets/js/20.2a8cde8d.js"><link rel="prefetch" href="/assets/js/21.7f15a92d.js"><link rel="prefetch" href="/assets/js/22.e0b88bc3.js"><link rel="prefetch" href="/assets/js/23.7ba73a79.js"><link rel="prefetch" href="/assets/js/24.5c357a4b.js"><link rel="prefetch" href="/assets/js/25.4ec30a7d.js"><link rel="prefetch" href="/assets/js/26.22fa4ac4.js"><link rel="prefetch" href="/assets/js/27.991dc057.js"><link rel="prefetch" href="/assets/js/28.e25da03b.js"><link rel="prefetch" href="/assets/js/29.44a0658f.js"><link rel="prefetch" href="/assets/js/3.76d1f0d8.js"><link rel="prefetch" href="/assets/js/30.eb143ebb.js"><link rel="prefetch" href="/assets/js/31.ebba4c18.js"><link rel="prefetch" href="/assets/js/32.6b944385.js"><link rel="prefetch" href="/assets/js/33.3c87a981.js"><link rel="prefetch" href="/assets/js/34.23bd3c4d.js"><link rel="prefetch" href="/assets/js/35.a2156a20.js"><link rel="prefetch" href="/assets/js/36.d7b6958e.js"><link rel="prefetch" href="/assets/js/37.40a9500a.js"><link rel="prefetch" href="/assets/js/38.2d6a418c.js"><link rel="prefetch" href="/assets/js/39.106360db.js"><link rel="prefetch" href="/assets/js/4.34ca9cc5.js"><link rel="prefetch" href="/assets/js/40.d1e8e754.js"><link rel="prefetch" href="/assets/js/41.5fb2515b.js"><link rel="prefetch" href="/assets/js/42.1ec6f30c.js"><link rel="prefetch" href="/assets/js/43.7a46a593.js"><link rel="prefetch" href="/assets/js/44.6b288f58.js"><link rel="prefetch" href="/assets/js/45.1a52ed8b.js"><link rel="prefetch" href="/assets/js/46.03834d07.js"><link rel="prefetch" href="/assets/js/48.d7b0cf7d.js"><link rel="prefetch" href="/assets/js/49.6efd2ea7.js"><link rel="prefetch" href="/assets/js/5.c033bdf1.js"><link rel="prefetch" href="/assets/js/50.9bbad9c7.js"><link rel="prefetch" href="/assets/js/51.235c1147.js"><link rel="prefetch" href="/assets/js/52.35c1b6cb.js"><link rel="prefetch" href="/assets/js/53.57fff313.js"><link rel="prefetch" href="/assets/js/54.c5c4e98e.js"><link rel="prefetch" href="/assets/js/55.3661ab26.js"><link rel="prefetch" href="/assets/js/56.d1e7355e.js"><link rel="prefetch" href="/assets/js/57.4df45412.js"><link rel="prefetch" href="/assets/js/58.6f32ca91.js"><link rel="prefetch" href="/assets/js/59.4e89baad.js"><link rel="prefetch" href="/assets/js/6.eb7c7d50.js"><link rel="prefetch" href="/assets/js/60.91e95490.js"><link rel="prefetch" href="/assets/js/61.c602712f.js"><link rel="prefetch" href="/assets/js/62.d918f6bc.js"><link rel="prefetch" href="/assets/js/63.d527ac8a.js"><link rel="prefetch" href="/assets/js/64.6e96c61e.js"><link rel="prefetch" href="/assets/js/65.176e7573.js"><link rel="prefetch" href="/assets/js/66.3f9f462c.js"><link rel="prefetch" href="/assets/js/67.8d3fd648.js"><link rel="prefetch" href="/assets/js/68.1f40ef9e.js"><link rel="prefetch" href="/assets/js/69.fb3aa698.js"><link rel="prefetch" href="/assets/js/7.8ce622ed.js"><link rel="prefetch" href="/assets/js/70.75bb7ef0.js"><link rel="prefetch" href="/assets/js/71.58c0ad98.js"><link rel="prefetch" href="/assets/js/72.0ce9b470.js"><link rel="prefetch" href="/assets/js/73.082904e7.js"><link rel="prefetch" href="/assets/js/74.de4d112a.js"><link rel="prefetch" href="/assets/js/75.b4195be4.js"><link rel="prefetch" href="/assets/js/76.bb05f4d3.js"><link rel="prefetch" href="/assets/js/77.7c1b9de6.js"><link rel="prefetch" href="/assets/js/78.f83aceeb.js"><link rel="prefetch" href="/assets/js/79.45b12103.js"><link rel="prefetch" href="/assets/js/8.9ce9b467.js"><link rel="prefetch" href="/assets/js/80.f13cff14.js"><link rel="prefetch" href="/assets/js/81.38988725.js"><link rel="prefetch" href="/assets/js/82.c469b235.js"><link rel="prefetch" href="/assets/js/83.614f04cd.js"><link rel="prefetch" href="/assets/js/84.fb7b4d8d.js"><link rel="prefetch" href="/assets/js/85.0ab29ed0.js"><link rel="prefetch" href="/assets/js/86.6af52bed.js"><link rel="prefetch" href="/assets/js/9.b3c40c40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.04bcc6ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en español</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Primeros pasos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Conceptos de arquitectura</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bases de datos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Paquetes oficiales</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/billing.html" class="sidebar-link">Laravel Cashier</a></li><li><a href="/dusk.html" class="sidebar-link">Laravel Dusk</a></li><li><a href="/envoy.html" class="sidebar-link">Laravel Envoy</a></li><li><a href="/horizon.html" class="active sidebar-link">Laravel Horizon</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/horizon.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/horizon.html#instalacion" class="sidebar-link">Instalación</a></li><li class="sidebar-sub-header"><a href="/horizon.html#ejecutando-horizon" class="sidebar-link">Ejecutando Horizon</a></li><li class="sidebar-sub-header"><a href="/horizon.html#etiquetas" class="sidebar-link">Etiquetas</a></li><li class="sidebar-sub-header"><a href="/horizon.html#notificaciones" class="sidebar-link">Notificaciones</a></li><li class="sidebar-sub-header"><a href="/horizon.html#metricas" class="sidebar-link">Métricas</a></li></ul></li><li><a href="/passport.html" class="sidebar-link">Laravel Passport</a></li><li><a href="/scout.html" class="sidebar-link">Scout para Laravel</a></li><li><a href="/socialite.html" class="sidebar-link">Laravel Socialite</a></li><li><a href="/telescope.html" class="sidebar-link">Laravel Telescope</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="laravel-horizon"><a class="header-anchor" href="#laravel-horizon">#</a> Laravel Horizon</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#upgrading">Actualización de Horizon</a></li> <li><a href="#installation">Instalación</a> <ul><li><a href="#configuration">Configuración</a></li> <li><a href="#dashboard-authorization">Autorización del dashboard</a></li></ul></li> <li><a href="#running-horizon">Ejecutando Horizon</a> <ul><li><a href="#deploying-horizon">Usando Horizon</a></li></ul></li> <li><a href="#tags">Etiquetas</a></li> <li><a href="#notifications">Notificaciones</a></li> <li><a href="#metrics">Métricas</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion">#</a> Introducción</h2> <p>Horizon proporciona un bonito panel de control y sistema de configuración controlado por código para Laravel, potenciado por colas de Redis. Horizon te permite monitorear fácilmente métricas claves de tu sistema de colas tales como tasa de rendimiento, tiempo de ejecución y fallas de tareas.</p> <p>Toda la configuración de tu worker es almacenada en un solo archivo de configuración sencillo, permitiendo que tu configuración quede en el código fuente donde tu equipo completo pueda colaborar.</p> <p align="center"><img src="https://res.cloudinary.com/dtfbvvkyp/image/upload/v1537195039/photos/Test.png" width="600" height="481"></p> <p><a name="installation"></a></p> <h2 id="instalacion"><a class="header-anchor" href="#instalacion">#</a> Instalación</h2> <div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Debes asegurarte de que tu conexión de cola está establecido a <code>redis</code> en tu archivo de configuración <code>queue</code>.</p></div></div><p>Puedes usar Composer para instalar Horizon en tu proyecto de Laravel:</p> <div class="language-php extra-class"><pre class="language-php"><code>composer <span class="token keyword">require</span> laravel<span class="token operator">/</span>horizon
</code></pre></div><p>Después de instalar Horizon, publica sus assets usando el comando Artisan <code>horizon:install</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan horizon<span class="token punctuation">:</span>install
</code></pre></div><p>Debes también crear la tabla <code>failed_jobs</code> que Laravel usará para almacenar cualquier <a href="/queues.html#dealing-with-failed-jobs">trabajo en cola fallido</a>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan queue<span class="token punctuation">:</span>failed<span class="token operator">-</span>table

php artisan migrate
</code></pre></div><p><a name="upgrading"></a></p> <h4 id="actualizacion-de-horizon"><a href="#actualizacion-de-horizon" class="header-anchor">#</a> Actualización de horizon</h4> <p>Al actualizar a una nueva versión mayor de Horizon, es importante que revises cuidadosamente <a href="https://github.com/laravel/horizon/blob/master/UPGRADE.md" target="_blank" rel="noopener noreferrer">la guía de actualización<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Además, debes volver a publicar los assets de Horizon:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan horizon<span class="token punctuation">:</span>assets
</code></pre></div><p><a name="configuration"></a></p> <h3 id="configuracion"><a href="#configuracion" class="header-anchor">#</a> Configuración</h3> <p>Después de publicar los assets de Horizon, su principal archivo de configuración será colocado en <code>config/horizon.php</code>. Este archivo de configuración permite que configures las opciones del worker y cada opción de configuración incluye una descripción de su propósito, así que asegurate de explorar con gran detalle este archivo.</p> <div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Debes asegurarte de que la porción <code>environments</code> de tu archivo de configuración <code>horizon</code> contiene una entrada para cada entorno en el que planeas ejecutrar Horizon.</p></div> <h4 id="opciones-de-balance"><a href="#opciones-de-balance" class="header-anchor">#</a> Opciones de balance</h4> <p>Horizon permite que elijas entre tres estrategias de balance: <code>simple</code>, <code>auto</code> y <code>false</code>. La estrategia <code>simple</code>, que es la opción por defecto del archivo de configuración, divide los trabajos entrantes de manera uniforme entre procesos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'balance'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'simple'</span><span class="token punctuation">,</span>
</code></pre></div><p>La estrategia <code>auto</code> ajusta el número de procesos trabajadores por cola basado en la carga de trabajo de la cola. Por ejemplo, si tu cola <code>notifications</code> tiene 1.000 trabajos esperando mientras tu cola <code>render</code> está vacía, Horizon asignará mas trabajadores a tu cola <code>notifications</code> hasta que esté vacía. Cuando la opción <code>balance</code> esté establecida a <code>false</code>, el comportamiento predeterminado de Laravel será usado, el cual procesa las colas en el orden que son listadas en tu configuración.</p> <h4 id="recorte-de-trabajos"><a href="#recorte-de-trabajos" class="header-anchor">#</a> Recorte de trabajos</h4> <p>El archivo de configuración <code>horizon</code> te permite configurar cuánto tiempo los trabajos de recientes y fallidos deben ser persistidos (en minutos). Por defecto, los trabajos recientes son mantenidos por una hora mientras que los trabajos fallidos son mantenidos por una semana:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'trim'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'recent'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'failed'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">10080</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><a name="dashboard-authorization"></a></p> <h3 id="autorizacion-del-dashboard"><a href="#autorizacion-del-dashboard" class="header-anchor">#</a> Autorización del dashboard</h3> <p>Horizon muestra un dashboard o panel de control en <code>/horizon</code>. Por defecto, sólo serás capaz de acceder a este dashboard en el entorno <code>local</code>. Dentro de tu archivo <code>app/Providers/HorizonServiceProvider.php</code>, hay un método <code>gate</code>. Este gate de autorización controla el acceso a Horizon en entornos <strong>no locales</strong>. Eres libre de modificar este gate como sea necesario para restringir el acceso a tu instalación de Horizon:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Register the Horizon gate.
*
* This gate determines who can access Horizon in non-local environments.
*
* @return void
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">gate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'viewHorizon'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'taylor@laravel.com'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="running-horizon"></a></p> <h2 id="ejecutando-horizon"><a href="#ejecutando-horizon" class="header-anchor">#</a> Ejecutando Horizon</h2> <p>Una vez que has configurado tus workers en el archivo de configuración <code>config/horizon.php</code>, puedes ejecutar Horizon usando el comando Artisan <code>horizon</code>. Este único comando iniciará todos tus workers configurados:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan horizon
</code></pre></div><p>Puedes pausar los procesos de Horizon e instruirlo para continuar procesando trabajos usando los comandos Artisan <code>horizon:pause</code> y <code>horizon:continue</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan horizon<span class="token punctuation">:</span>pause

<span class="token package">php</span> artisan horizon<span class="token punctuation">:</span><span class="token keyword">continue</span>
</code></pre></div><p>Puedes terminar elegantemente el proceso maestro de Horizon en tu máquina usando el comando Artisan <code>horizon:terminate</code>. Cualquiera de los trabajos que Horizon esté procesando actualmente será completado y después Horizon parará:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan horizon<span class="token punctuation">:</span>terminate
</code></pre></div><p><a name="deploying-horizon"></a></p> <h3 id="usando-horizon"><a href="#usando-horizon" class="header-anchor">#</a> Usando Horizon</h3> <p>Si estás usando Horizon en un servidor activo, deberías configurar un monitor de proceso para monitorear el comando <code>php artisan horizon</code> y reiniciarlo si éste sale inesperadamente. Al momento de usar código reciente en tu servidor, necesitarás instruir el proceso maestro de Horizon para que termine así puede ser reiniciado por tu monitor de proceso y recibir tu cambios de código.</p> <h4 id="configuracion-de-supervisor"><a href="#configuracion-de-supervisor" class="header-anchor">#</a> Configuración de Supervisor</h4> <p>Si estás usando el monitor de procesos de Supervisor para administrar tu proceso <code>horizon</code>, el siguiente archivo de configuración debería ser suficiente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">[</span>program<span class="token punctuation">:</span>horizon<span class="token punctuation">]</span>
process_name<span class="token operator">=</span><span class="token operator">%</span><span class="token punctuation">(</span>program_name<span class="token punctuation">)</span>s
command<span class="token operator">=</span>php <span class="token operator">/</span>home<span class="token operator">/</span>forge<span class="token operator">/</span>app<span class="token punctuation">.</span>com<span class="token operator">/</span>artisan horizon
autostart<span class="token operator">=</span><span class="token boolean constant">true</span>
autorestart<span class="token operator">=</span><span class="token boolean constant">true</span>
user<span class="token operator">=</span>forge
redirect_stderr<span class="token operator">=</span><span class="token boolean constant">true</span>
stdout_logfile<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>forge<span class="token operator">/</span>app<span class="token punctuation">.</span>com<span class="token operator">/</span>horizon<span class="token punctuation">.</span>log
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si no estás cómodo administrando tus propios servidores, considera usar <a href="https://forge.laravel.com" target="_blank" rel="noopener noreferrer">Laravel Forge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Forge aprovisiona tus propios servidores PHP 7+ con todo lo que necesitas para administrar modernas aplicaciones robustas de Laravel con Horizon.</p></div> <p><a name="tags"></a></p> <h2 id="etiquetas"><a href="#etiquetas" class="header-anchor">#</a> Etiquetas</h2> <p>Horizon permite que asignes “etiquetas” a los trabajos, incluyendo correos válidos, difusiones de eventos, notificaciones y listeners de eventos encolados. De hecho, Horizon etiquetará inteligente y automáticamente la mayoría de los trabajos dependiendo de los modelos Eloquent que estén adjuntos al trabajo. Por ejemplo, echemos un vistazo al siguiente worker:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Jobs</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Video</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Queueable</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>SerializesModels</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>InteractsWithQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Queue<span class="token punctuation">\</span>ShouldQueue</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatchable</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RenderVideo</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Dispatchable</span><span class="token punctuation">,</span> InteractsWithQueue<span class="token punctuation">,</span> Queueable<span class="token punctuation">,</span> SerializesModels<span class="token punctuation">;</span>

    <span class="token comment">/**
    * The video instance.
    *
    * @var \App\Video
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$video</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Create a new job instance.
    *
    * @param  \App\Video  $video
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span>Video <span class="token variable">$video</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">video</span> <span class="token operator">=</span> <span class="token variable">$video</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Execute the job.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Si este trabajo es encolado con una instancia <code>App\Video</code> que tenga un <code>id</code> de <code>1</code>, recibirá automáticamente la etiqueta <code>App\Video:1</code>. Esto es debido a que Horizon examinará las propiedades del trabajo para cualquier modelo Eloquent. Si los modelos Eloquent son encontrados, Horizon etiquetará inteligentemente el trabajo usando el nombre de la clase y la clave primaria del modelo.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$video</span> <span class="token operator">=</span> App\<span class="token package">Video</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

App\<span class="token package">Jobs<span class="token punctuation">\</span>RenderVideo</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$video</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="etiquetado-manual"><a href="#etiquetado-manual" class="header-anchor">#</a> Etiquetado manual</h4> <p>Si prefieres definir manualmente las etiquetas para uno de tus objetos encolables, puedes definir un método <code>tags</code> en la clase:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name">RenderVideo</span> <span class="token keyword">implements</span> <span class="token class-name">ShouldQueue</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Get the tags that should be assigned to the job.
    *
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'render'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'video:'</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">video</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="notifications"></a></p> <h2 id="notificaciones"><a href="#notificaciones" class="header-anchor">#</a> Notificaciones</h2> <blockquote><p><strong>Note:</strong> Al momento de configurar Horizon para enviar notificaciones de Slack o SMS, también deberías revisar los <a href="/notifications.html">prerequisitos para el manejador de notificaciones relevante</a>.</p></blockquote> <p>Si prefieres ser notificado cuando una de tus colas tenga un largo tiempo de inactividad, puedes usar los métodos <code>Horizon::routeMailNotificationsTo</code>, <code>Horizon::routeSlackNotificationsTo</code> y <code>Horizon::routeSmsNotificationsTo</code>. Puedes ejecutar estos métodos desde el <code>HorizonServiceProvider</code> de tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code>Horizon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routeMailNotificationsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'example@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Horizon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routeSlackNotificationsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'slack-webhook-url'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'#channel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Horizon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">routeSmsNotificationsTo</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'15556667777'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="configurando-las-notificaciones-de-umbrales-de-tiempo-de-inactividad"><a href="#configurando-las-notificaciones-de-umbrales-de-tiempo-de-inactividad" class="header-anchor">#</a> Configurando las notificaciones de umbrales de tiempo de inactividad</h4> <p>Puedes configurar cuántos segundos son considerados un &quot;tiempo de inactividad&quot; dentro de tu archivo de configuración <code>config/horizon.php</code>. La opción de configuración <code>waits</code> dentro de este archivo permite que controles el umbral de tiempo de inactividad para cada combinación conexión / cola:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'waits'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'redis:default'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">60</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p><a name="metrics"></a></p> <h2 id="metricas"><a href="#metricas" class="header-anchor">#</a> Métricas</h2> <p>Horizon incluye un panel de métricas, el cual proporciona información de tus tiempos de trabajo y de espera en cola y tasa de rendimiento. Con el propósito de agregar contenido a este panel, deberías configurar el comando Artisan <code>snapshot</code> de Horizon para que se ejecute cada 5 minutos por medio del <a href="/scheduling.html">planificador</a> de tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Define the application's command schedule.
*
* @param  \Illuminate\Console\Scheduling\Schedule  $schedule
* @return void
*/</span>
<span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span>Schedule <span class="token variable">$schedule</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$schedule</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'horizon:snapshot'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">everyFiveMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/envoy.html" class="prev">Laravel Envoy</a></span> <span class="next"><a href="/passport.html">Laravel Passport</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8d29aeda.js" defer></script><script src="/assets/js/2.13b8df03.js" defer></script><script src="/assets/js/47.562b0d56.js" defer></script>
  </body>
</html>
