<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentación de Laravel</title>
    <meta name="description" content="Documentación de Laravel en Español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
  <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.1d810b70.css" as="style"><link rel="preload" href="/assets/js/app.235cc398.js" as="script"><link rel="preload" href="/assets/js/2.8f57d70e.js" as="script"><link rel="preload" href="/assets/js/33.baa640d1.js" as="script"><link rel="prefetch" href="/assets/js/10.7938642f.js"><link rel="prefetch" href="/assets/js/11.461eb020.js"><link rel="prefetch" href="/assets/js/12.f18cbc71.js"><link rel="prefetch" href="/assets/js/13.5e0a5f24.js"><link rel="prefetch" href="/assets/js/14.716cc2f2.js"><link rel="prefetch" href="/assets/js/15.101f24d3.js"><link rel="prefetch" href="/assets/js/16.7d729c7d.js"><link rel="prefetch" href="/assets/js/17.3369e52a.js"><link rel="prefetch" href="/assets/js/18.b64057ad.js"><link rel="prefetch" href="/assets/js/19.fd9838bd.js"><link rel="prefetch" href="/assets/js/20.a746ec9b.js"><link rel="prefetch" href="/assets/js/21.52aa9734.js"><link rel="prefetch" href="/assets/js/22.53339c00.js"><link rel="prefetch" href="/assets/js/23.6b0cb45c.js"><link rel="prefetch" href="/assets/js/24.93c8a909.js"><link rel="prefetch" href="/assets/js/25.117b3835.js"><link rel="prefetch" href="/assets/js/26.69cc1975.js"><link rel="prefetch" href="/assets/js/27.7c03833d.js"><link rel="prefetch" href="/assets/js/28.d8cd7c15.js"><link rel="prefetch" href="/assets/js/29.3c433a6b.js"><link rel="prefetch" href="/assets/js/3.37d22ff0.js"><link rel="prefetch" href="/assets/js/30.51df909b.js"><link rel="prefetch" href="/assets/js/31.3e424427.js"><link rel="prefetch" href="/assets/js/32.723aca49.js"><link rel="prefetch" href="/assets/js/34.df138466.js"><link rel="prefetch" href="/assets/js/35.5cbb65af.js"><link rel="prefetch" href="/assets/js/36.2e171db2.js"><link rel="prefetch" href="/assets/js/37.bec18e54.js"><link rel="prefetch" href="/assets/js/38.a7a776ca.js"><link rel="prefetch" href="/assets/js/39.ca7ad47c.js"><link rel="prefetch" href="/assets/js/4.95b68b43.js"><link rel="prefetch" href="/assets/js/40.2246938f.js"><link rel="prefetch" href="/assets/js/41.4ac23302.js"><link rel="prefetch" href="/assets/js/42.5ad9fa0f.js"><link rel="prefetch" href="/assets/js/43.b047d897.js"><link rel="prefetch" href="/assets/js/44.5768076f.js"><link rel="prefetch" href="/assets/js/45.d2626b04.js"><link rel="prefetch" href="/assets/js/46.64b5b83e.js"><link rel="prefetch" href="/assets/js/47.db1a199f.js"><link rel="prefetch" href="/assets/js/48.64f86db5.js"><link rel="prefetch" href="/assets/js/49.869a49e7.js"><link rel="prefetch" href="/assets/js/5.f56202c2.js"><link rel="prefetch" href="/assets/js/50.4c133fa7.js"><link rel="prefetch" href="/assets/js/51.f5403961.js"><link rel="prefetch" href="/assets/js/52.ce6bc429.js"><link rel="prefetch" href="/assets/js/53.af2db022.js"><link rel="prefetch" href="/assets/js/54.81aa9908.js"><link rel="prefetch" href="/assets/js/55.70090109.js"><link rel="prefetch" href="/assets/js/56.c1292b02.js"><link rel="prefetch" href="/assets/js/57.af8c7f72.js"><link rel="prefetch" href="/assets/js/58.dc04f379.js"><link rel="prefetch" href="/assets/js/59.d6084587.js"><link rel="prefetch" href="/assets/js/6.7ed940c0.js"><link rel="prefetch" href="/assets/js/60.ca4183e4.js"><link rel="prefetch" href="/assets/js/61.f8caddf4.js"><link rel="prefetch" href="/assets/js/62.c2681bcb.js"><link rel="prefetch" href="/assets/js/63.a797a0a8.js"><link rel="prefetch" href="/assets/js/64.aa808f04.js"><link rel="prefetch" href="/assets/js/65.faf253ca.js"><link rel="prefetch" href="/assets/js/66.f6fff51f.js"><link rel="prefetch" href="/assets/js/67.24486d46.js"><link rel="prefetch" href="/assets/js/68.54d7ea98.js"><link rel="prefetch" href="/assets/js/69.836842cc.js"><link rel="prefetch" href="/assets/js/7.56fcaf4f.js"><link rel="prefetch" href="/assets/js/70.2162f7cb.js"><link rel="prefetch" href="/assets/js/71.e740d466.js"><link rel="prefetch" href="/assets/js/72.cd2c768b.js"><link rel="prefetch" href="/assets/js/73.e5ae99e8.js"><link rel="prefetch" href="/assets/js/74.940c12d4.js"><link rel="prefetch" href="/assets/js/75.79bc3b75.js"><link rel="prefetch" href="/assets/js/76.aa5495f9.js"><link rel="prefetch" href="/assets/js/77.405991e7.js"><link rel="prefetch" href="/assets/js/78.2487519c.js"><link rel="prefetch" href="/assets/js/79.8f864857.js"><link rel="prefetch" href="/assets/js/8.c7de5777.js"><link rel="prefetch" href="/assets/js/80.0571f734.js"><link rel="prefetch" href="/assets/js/81.d2036601.js"><link rel="prefetch" href="/assets/js/82.87cc02ef.js"><link rel="prefetch" href="/assets/js/83.569392ab.js"><link rel="prefetch" href="/assets/js/84.f690ba1e.js"><link rel="prefetch" href="/assets/js/85.dca0f9e9.js"><link rel="prefetch" href="/assets/js/9.52de0ad8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1d810b70.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Primeros pasos</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/installation.html" class="sidebar-link">/installation.html</a></li><li><a href="/configuration.html" class="sidebar-link">/configuration.html</a></li><li><a href="/structure.html" class="sidebar-link">/structure.html</a></li><li><a href="/homestead.html" class="sidebar-link">/homestead.html</a></li><li><a href="/valet.html" class="sidebar-link">/valet.html</a></li><li><a href="/deployment.html" class="sidebar-link">/deployment.html</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Conceptos de arquitectura</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Seguridad</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bases de datos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="eloquent-recursos-api"><a class="header-anchor" href="#eloquent-recursos-api" aria-hidden="true">#</a> Eloquent: Recursos API</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#generating-resources">Generación de recursos</a></li> <li><a href="#concept-overview">Descripción general del concepto</a> <ul><li><a href="#resource-collections">Colecciones de recursos</a></li></ul></li> <li><a href="#writing-resources">Escritura de recursos</a> <ul><li><a href="#data-wrapping">Envoltura de datos</a></li> <li><a href="#pagination">Paginación</a></li> <li><a href="#conditional-attributes">Atributos condicionales</a></li> <li><a href="#conditional-relationships">Relaciones condicionales</a></li> <li><a href="#adding-meta-data">Añadiendo metadatos</a></li></ul></li> <li><a href="#resource-responses">Respuestas de recursos</a></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Al crear una API, es posible que necesites una capa de transformación que se ubique entre tus modelos Eloquent y las respuestas JSON que realmente se devuelven a los usuarios de tu aplicación. Las clases de recursos de Laravel te permiten transformar tus modelos y colecciones de modelos de forma expresiva y sencilla en JSON.</p> <p><a name="generating-resources"></a></p> <h2 id="generacion-de-recursos"><a class="header-anchor" href="#generacion-de-recursos" aria-hidden="true">#</a> Generación de recursos</h2> <p>Para generar un clase recurso, puedes usar el comando de Artisan <code>make:resource</code>. Por defecto, los recursos estará localizado en el directorio <code>app/Http/Resources</code> de tu aplicación. Los Recursos extiende de la clase <code>Illuminate\Http\Resources\Json\JsonResource</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan make<span class="token punctuation">:</span>resource User
</code></pre></div><h4 id="colecciones-de-recurso"><a class="header-anchor" href="#colecciones-de-recurso" aria-hidden="true">#</a> Colecciones de recurso</h4> <p>Además de generar recursos que transforman modelos individuales, puedes generar recursos que sean responsables de transformar colecciones de modelos. Esto permite que tu respuesta incluya enlaces y otra metainformación relevante para una colección completa de un recurso determinado.</p> <p>Para crear una colección de recursos, debes utilizar la opción <code>--collection</code> al crear el recurso. O, incluir la palabra <code>Colección</code> en el nombre del recurso que le indicará a Laravel que debe crear un recurso de colección. Los recursos de colección extienden la clase <code>Illuminate\Http\Resources\Json\ResourceCollection</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan make<span class="token punctuation">:</span>resource Users <span class="token operator">--</span>collection

php artisan make<span class="token punctuation">:</span>resource UserCollection
</code></pre></div><p><a name="concept-overview"></a></p> <h2 id="descripcion-general-del-concepto"><a class="header-anchor" href="#descripcion-general-del-concepto" aria-hidden="true">#</a> Descripción general del concepto</h2> <div class="tip custom-block"><p>Esta es una explicación general de recursos y colecciones de recursos. Te recomendamos que leas las otras secciones de esta documentación para obtener una comprensión más profunda de la personalización y el poder que te ofrecen los recursos.</p></div></div><p>Antes de sumergirse en todas las opciones disponibles para escribir recursos, primero analicemos cómo se utilizan los recursos dentro de Laravel. Una clase de recurso representa un modelo único que debe transformarse en una estructura JSON. Por ejemplo, aquí hay una clase de recurso <code>User</code> simple:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>JsonResource</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">JsonResource</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">updated_at</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Cada clase de recurso define un método <code>toArray</code> que devuelve el arreglo de atributos que deben convertirse a JSON al enviar la respuesta. Observa que podemos acceder a las propiedades del modelo directamente desde la variable <code>$this</code>. Esto es porque la clase del recurso va a redirigir de manera automática el acceso de propiedades y métodos al modelo asignado. Una vez que se define el recurso, se puede devolver desde una ruta o controlador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserResource</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="resource-collections"></a></p> <h3 id="colecciones-de-recurso-2"><a href="#colecciones-de-recurso-2" aria-hidden="true" class="header-anchor">#</a> Colecciones de recurso</h3> <p>Si estás devolviendo una colección de recursos o una respuesta paginada, puedes usar el método <code>collection</code> al crear la instancia de recursos en tu ruta o controlador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> UserResource<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Observa que esto no permite ninguna adición de metadatos que pueden necesitar ser retornados con la colección. Si deseas personalizar la respuesta de la colección de recursos, puedes crear un recurso dedicado para representar la colección:</p> <div class="language-php extra-class"><pre class="language-php"><code>php artisan make<span class="token punctuation">:</span>resource UserCollection
</code></pre></div><p>Una vez que se ha generado la clase de colección de recursos, puedes definir fácilmente los metadatos que deben incluirse con la respuesta:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>ResourceCollection</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserCollection</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceCollection</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource collection into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">collection</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'links'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                <span class="token single-quoted-string string">'self'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'link-value'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Después de definir tu colección de recursos, ésta la puedes devolver desde una ruta o controlador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>UserCollection</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserCollection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="preservando-la-coleccion-de-llaves"><a href="#preservando-la-coleccion-de-llaves" aria-hidden="true" class="header-anchor">#</a> Preservando la colección de llaves</h4> <p>Cuando se retorna un recurso de colección desde una ruta, Laravel reinicia las llaves de la colección para que éstas estén en un simple orden numérico. Sin embargo, puedes añadir una propiedad <code>preserveKeys</code> a tu clase de recurso indicando si esta colección de llaves debería preservarse:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>JsonResource</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">JsonResource</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Indicates if the resource's collection keys should be preserved.
    *
    * @var bool
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$preserveKeys</span> <span class="token operator">=</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Cuando la propiedad <code>preserveKeys</code> es colocada en <code>true</code>, la colección de llaves será preservada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> UserResource<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">keyBy</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="personalizacion-de-la-clase-de-recurso-subyacente"><a href="#personalizacion-de-la-clase-de-recurso-subyacente" aria-hidden="true" class="header-anchor">#</a> Personalización de la clase de recurso subyacente</h4> <p>Normalmente, la propiedad <code>$this-&gt;collection</code> de una colección de recursos se rellena automáticamente con el resultado de la asignación de cada elemento de la colección a su clase de recurso singular. Se asume que la clase de recurso singular es el nombre de clase de la colección sin la cadena <code>Collection</code> al final.</p> <p>Por ejemplo, <code>UserCollection</code> intentará asignar las instancias de usuario dadas al recurso <code>User</code>. Para personalizar este comportamiento, puedes anular la propiedad <code>$collects</code> de tu colección de recursos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>ResourceCollection</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserCollection</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceCollection</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The resource that this resource collects.
    *
    * @var string
    */</span>
    <span class="token keyword">public</span> <span class="token variable">$collects</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'App\Http\Resources\Member'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="writing-resources"></a></p> <h2 id="escritura-de-recursos"><a href="#escritura-de-recursos" aria-hidden="true" class="header-anchor">#</a> Escritura de recursos</h2> <div class="tip custom-block"><p>Si no has leído la <a href="#concept-overview">descripción general del concepto</a>, te recomendamos que lo hagas antes de continuar con esta documentación.</p></div> <p>En esencia, los recursos son simples. Solo necesitan transformar un modelo dado en un arreglo. Por lo tanto, cada recurso contiene un método <code>toArray</code> que traduce los atributos de tu modelo en un arreglo amigable con la API que se puede devolver a sus usuarios:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>JsonResource</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">JsonResource</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">updated_at</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Una vez que has definido un recurso, lo puedes devolver directamente desde una ruta o controlador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserResource</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="relaciones"><a href="#relaciones" aria-hidden="true" class="header-anchor">#</a> Relaciones</h4> <p>Si deseas incluir recursos relacionados en tu respuesta, puedes agregarlos al arreglo devuelto por tu método <code>toArray</code>. En este ejemplo, usaremos el método <code>collection</code> del recurso <code>Post</code> para agregar las publicaciones del blog del usuario a la respuesta del recurso:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'posts'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> PostResource<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">posts</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">updated_at</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p>Si deseas incluir relaciones solo cuando ya se han cargado, consulte la documentación sobre <a href="#conditional-relationships">relaciones condicionales</a>.</p></div> <h4 id="colecciones-de-recurso-3"><a href="#colecciones-de-recurso-3" aria-hidden="true" class="header-anchor">#</a> Colecciones de recurso</h4> <p>Si bien los recursos traducen un modelo único en un arreglo, las colecciones de recursos traducen una colección de modelos en un arreglo. No es absolutamente necesario definir una clase de colección de recursos para cada uno de los tipos de modelo ya que todos los recursos proporcionan un método <code>collection</code> para generar una colección de recursos &quot;ad-hoc&quot; sobre la marcha:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> UserResource<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sin embargo, si necesitas personalizar los metadatos devueltos con la colección, será necesario definir una colección de recursos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>ResourceCollection</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserCollection</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceCollection</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource collection into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">collection</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'links'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                <span class="token single-quoted-string string">'self'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'link-value'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Al igual que los recursos singulares, las colecciones de recursos se pueden devolver directamente desde las rutas o los controladores:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>UserCollection</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserCollection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="data-wrapping"></a></p> <h3 id="envoltura-de-datos"><a href="#envoltura-de-datos" aria-hidden="true" class="header-anchor">#</a> Envoltura de datos</h3> <p>Por defecto, tu recurso más externo está envuelto en una clave <code>data</code> cuando la respuesta del recurso se convierte a JSON. Entonces, por ejemplo, una respuesta típica de colección de recursos se parece a lo siguiente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">{</span>
    <span class="token double-quoted-string string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Eladio Schroeder Sr.&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;therese28@example.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Liliana Mayert&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;evandervort@example.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si deseas deshabilitar la envoltura del recurso más externo, puede usar el método <code>withoutWrapping</code> en la clase de recurso base. Por lo general, debes llamar a este método desde su <code>AppServiceProvider</code> u otro <a href="/providers.html">proveedor de servicios</a> que se carga en cada solicitud a tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>ServiceProvider</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>Resource</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AppServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Perform post-registration booting of services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Resource<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">withoutWrapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Register bindings in the container.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>El método <code>withoutWrapping</code> solo afecta a la respuesta más externa y no eliminará las claves<code>data</code> que agregues manualmente a tus propias colecciones de recursos.</p></div> <h3 id="envoltura-de-recursos-anidados"><a href="#envoltura-de-recursos-anidados" aria-hidden="true" class="header-anchor">#</a> Envoltura de recursos anidados</h3> <p>Tienes total libertad para determinar cómo se envuelven las relaciones de tus recursos. Si deseas que todas las colecciones de recursos se envuelvan en una clave <code>data</code>, independientemente de su anidamiento, debes definir una clase de colección de recursos para cada recurso y devolver la colección dentro de una clave<code>data</code>.</p> <p>Puedes que te estés preguntando si esto hará que tu recurso más externo se incluya en dos claves <code>data</code>. No te preocupes, Laravel nunca permitirá que tus recursos se envuelvan por error, por lo que no tienes que preocuparte por el nivel de anidamiento de la colección de recursos que estás transformando:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>ResourceCollection</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommentsCollection</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceCollection</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource collection into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">collection</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="envoltura-de-datos-y-paginacion"><a href="#envoltura-de-datos-y-paginacion" aria-hidden="true" class="header-anchor">#</a> Envoltura de datos y paginación</h3> <p>Al devolver colecciones paginadas en una respuesta de recursos, Laravel ajustará tus datos de recursos en una clave <code>data</code> incluso si se ha llamado al método<code>withoutWrapping</code>. Esto se debe a que las respuestas paginadas siempre contienen claves <code>meta</code> y<code>links</code> con información sobre el estado del paginador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">{</span>
    <span class="token double-quoted-string string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Eladio Schroeder Sr.&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;therese28@example.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Liliana Mayert&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;evandervort@example.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token double-quoted-string string">&quot;links&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token double-quoted-string string">&quot;first&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;http://example.com/pagination?page=1&quot;</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;last&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;http://example.com/pagination?page=1&quot;</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;prev&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;next&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token double-quoted-string string">&quot;meta&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token double-quoted-string string">&quot;current_page&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;from&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;last_page&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;path&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;http://example.com/pagination&quot;</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;per_page&quot;</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;to&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="pagination"></a></p> <h3 id="paginacion"><a href="#paginacion" aria-hidden="true" class="header-anchor">#</a> Paginación</h3> <p>Siempre puedes pasar una instancia del paginador al método <code>collection</code> de un recurso o a una colección de recursos personalizada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>UserCollection</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserCollection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Las respuestas paginadas siempre contienen claves <code>meta</code> y <code>links</code> con información sobre el estado del paginador:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token punctuation">{</span>
    <span class="token double-quoted-string string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Eladio Schroeder Sr.&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;therese28@example.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
            <span class="token double-quoted-string string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;Liliana Mayert&quot;</span><span class="token punctuation">,</span>
            <span class="token double-quoted-string string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;evandervort@example.com&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token double-quoted-string string">&quot;links&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token double-quoted-string string">&quot;first&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;http://example.com/pagination?page=1&quot;</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;last&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;http://example.com/pagination?page=1&quot;</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;prev&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;next&quot;</span><span class="token punctuation">:</span> <span class="token constant">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token double-quoted-string string">&quot;meta&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token double-quoted-string string">&quot;current_page&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;from&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;last_page&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;path&quot;</span><span class="token punctuation">:</span> <span class="token double-quoted-string string">&quot;http://example.com/pagination&quot;</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;per_page&quot;</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;to&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token double-quoted-string string">&quot;total&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="conditional-attributes"></a></p> <h3 id="atributos-condicionales"><a href="#atributos-condicionales" aria-hidden="true" class="header-anchor">#</a> Atributos condicionales</h3> <p>En ocasiones, es posible que desees incluir solo un atributo en una respuesta de recurso si se cumple una condición determinada. Por ejemplo, es posible que desee incluir solo un valor si el usuario actual es un &quot;administrador&quot;. Laravel proporciona una variedad de métodos de ayuda para ayudarlo en esta situación. El método <code>when</code> se puede usar para agregar condicionalmente un atributo a una respuesta de recurso:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">when</span><span class="token punctuation">(</span>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'secret-value'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">updated_at</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>En este ejemplo, la clave <code>secret</code> solo se devolverá en la respuesta final del recurso si el método <code>isAdmin</code> del usuario autenticado devuelve <code>true</code>. Si el método devuelve <code>false</code>, la clave <code>secret</code> se eliminará de la respuesta del recurso por completo antes de que se envíe de nuevo al cliente. El método <code>when</code> te permite definir expresivamente tus recursos sin tener que recurrir a sentencias condicionales al construir el arreglo.</p> <p>El método <code>when</code> también acepta un Closure como segundo argumento, lo que te permite calcular el valor resultante solo si la condición dada es<code>true</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token single-quoted-string string">'secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">when</span><span class="token punctuation">(</span>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token single-quoted-string string">'secret-value'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="fusionar-atributos-condicionales"><a href="#fusionar-atributos-condicionales" aria-hidden="true" class="header-anchor">#</a> Fusionar atributos condicionales</h4> <p>En ocasiones, es posible que tenga varios atributos que solo deben incluirse en la respuesta del recurso según la misma condición. En este caso, puede usar el método <code>mergeWhen</code> para incluir los atributos en la respuesta solo cuando la condición dada es <code>true</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">mergeWhen</span><span class="token punctuation">(</span>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'first-secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'value'</span><span class="token punctuation">,</span>
            <span class="token single-quoted-string string">'second-secret'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'value'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">updated_at</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Nuevamente, si la condición dada es <code>false</code>, estos atributos se eliminarán de la respuesta del recurso por completo antes de que se envíe al cliente.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>El método <code>mergeWhen</code> no debe usarse dentro de arreglos que mezclen claves de cadenas de caracteres y claves numéricas. Además, no se debe utilizar dentro de arreglos con claves numéricas que no están ordenadas secuencialmente.</p></div> <p><a name="conditional-relationships"></a></p> <h3 id="relaciones-condicionales"><a href="#relaciones-condicionales" aria-hidden="true" class="header-anchor">#</a> Relaciones condicionales</h3> <p>Además de cargar condicionalmente los atributos, puedes incluir condicionalmente relaciones en tus respuestas de recursos en función de si la relación ya se ha cargado en el modelo. Esto permite que tu controlador decida qué relaciones deben cargarse en el modelo y tu recurso puede incluirlas fácilmente solo cuando realmente se hayan cargado.</p> <p>Fundamentalmente, esto hace que sea más fácil evitar los problemas de consulta &quot;N + 1&quot; dentro de tus recursos. El método <code>whenLoaded</code> puede usarse para cargar condicionalmente una relación. Para evitar cargar relaciones innecesariamente, este método acepta el nombre de la relación en lugar de la relación en sí:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'email'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">email</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'posts'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> PostResource<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whenLoaded</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'created_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">created_at</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'updated_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">updated_at</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>En este ejemplo, si la relación no se ha cargado, la clave <code>posts</code> se eliminará de la respuesta del recurso por completo antes de que se envíe al cliente.</p> <h4 id="informacion-de-pivote-condicional"><a href="#informacion-de-pivote-condicional" aria-hidden="true" class="header-anchor">#</a> Información de pivote condicional</h4> <p>Además de incluir condicionalmente la información de la relación en tus respuestas de recursos, puedes incluir condicionalmente datos de las tablas intermedias de relaciones de muchos a muchos utilizando el método <code>whenPivotLoaded</code>. El método <code>whenPivotLoaded</code> acepta el nombre de la tabla pivote como su primer argumento. El segundo argumento debe ser un Closure que defina el valor que se devolverá si la información pivote está disponible en el modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'expires_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whenPivotLoaded</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'role_user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">pivot</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">expires_at</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si tu tabla intermedia utiliza un accesador distinto de <code>pivot</code>, puede usar el método<code>whenPivotLoadedAs</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'name'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'expires_at'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">whenPivotLoadedAs</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'subscription'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'role_user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">subscription</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">expires_at</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="adding-meta-data"></a></p> <h3 id="anadiendo-metadatos"><a href="#anadiendo-metadatos" aria-hidden="true" class="header-anchor">#</a> Añadiendo metadatos</h3> <p>Algunos estándares de API de JSON requieren la adición de metadatos a tus respuestas de recursos y colecciones de recursos. Esto a menudo incluye cosas como <code>links</code> al recurso o recursos relacionados, o metadatos sobre el recurso en sí. Si necesitas devolver metadatos adicionales sobre un recurso, inclúyelos en tu método <code>toArray</code>. Por ejemplo, puedes incluir información de <code>link</code> al transformar una colección de recursos:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Transform the resource into an array.
*
* @param  \Illuminate\Http\Request  $request
* @return array
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">collection</span><span class="token punctuation">,</span>
        <span class="token single-quoted-string string">'links'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'self'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'link-value'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Al devolver metadatos adicionales de sus recursos, nunca tendrás que preocuparte por anular accidentalmente las claves <code>links</code> o<code>meta</code> que Laravel agrega automáticamente al devolver las respuestas paginadas. Cualquier <code>links</code> adicional que definas se fusionará con los enlaces proporcionados por el paginador.</p> <h4 id="metadatos-de-nivel-superior"><a href="#metadatos-de-nivel-superior" aria-hidden="true" class="header-anchor">#</a> Metadatos de nivel superior</h4> <p>A veces, es posible que desees incluir solo ciertos metadatos con una respuesta de recurso si el recurso es el recurso más externo que se devuelve. Por lo general, esto incluye información meta sobre la respuesta como un todo. Para definir estos metadatos, agrega un método <code>with</code> a tu clase de recurso. Este método debería devolver un arreglo de metadatos que se incluirá con la respuesta del recurso solo cuando el recurso sea el recurso más externo que se está llamando:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>ResourceCollection</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserCollection</span> <span class="token keyword">extends</span> <span class="token class-name">ResourceCollection</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource collection into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Get additional data that should be returned with the resource array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">with</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'meta'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'value'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="anadiendo-metadatos-al-construir-recursos"><a href="#anadiendo-metadatos-al-construir-recursos" aria-hidden="true" class="header-anchor">#</a> Añadiendo metadatos al construir recursos</h4> <p>También puedes agregar datos de nivel superior al construir de instancias de recursos en tu ruta o controlador. El método <code>additional</code>, que está disponible en todos los recursos, acepta un arreglo de datos que deberían agregarse a la respuesta del recurso:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserCollection</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'roles'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">additional</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'meta'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
                    <span class="token single-quoted-string string">'key'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'value'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="resource-responses"></a></p> <h2 id="respuestas-de-recurso"><a href="#respuestas-de-recurso" aria-hidden="true" class="header-anchor">#</a> Respuestas de Recurso</h2> <p>Como ya has leído, los recursos pueden devolverse directamente desde las rutas y los controladores:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserResource</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Sin embargo, a veces es posible que necesites personalizar la respuesta HTTP saliente antes de enviarla al cliente. Hay dos maneras de lograr esto. Primero, puedes encadenar el método <code>response</code> en el recurso. Este método devolverá una instancia de <code>Illuminate\Http\Response</code>, que te permite un control total de los encabezados de la respuesta:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>User</span> <span class="token keyword">as</span> UserResource<span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserResource</span><span class="token punctuation">(</span>User<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'X-Value'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'True'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternativamente, puedes definir un método <code>withResponse</code> dentro del propio recurso. Este método se llamará cuando el recurso se devuelva como el recurso más externo en una respuesta:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Resources<span class="token punctuation">\</span>Json<span class="token punctuation">\</span>JsonResource</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">JsonResource</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Transform the resource into an array.
    *
    * @param  \Illuminate\Http\Request  $request
    * @return array
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token single-quoted-string string">'id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Customize the outgoing response for the resource.
    *
    * @param  \Illuminate\Http\Request  $request
    * @param  \Illuminate\Http\Response  $response
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">withResponse</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$response</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'X-Value'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'True'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.235cc398.js" defer></script><script src="/assets/js/2.8f57d70e.js" defer></script><script src="/assets/js/33.baa640d1.js" defer></script>
  </body>
</html>
