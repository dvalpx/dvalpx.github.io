(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{367:function(a,t,s){"use strict";s.r(t);var e=s(42),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("div",{pre:!0},[s("h1",{pre:!0,attrs:{id:"laravel-cashier"}},[s("a",{pre:!0,attrs:{class:"header-anchor",href:"#laravel-cashier"}},[a._v("#")]),a._v(" Laravel Cashier")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#introduction"}},[a._v("Introducción")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#upgrading-cashier"}},[a._v("Actualizando cashier")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#installation"}},[a._v("Instalación")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#configuration"}},[a._v("Configuración")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#billable-model"}},[a._v("Modelo Billable")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#api-keys"}},[a._v("API Keys")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#currency-configuration"}},[a._v("Configuración de moneda")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#logging"}},[a._v("Logging")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#customers"}},[a._v("Clientes")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#retrieving-customers"}},[a._v("Buscar clientes")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#creating-customers"}},[a._v("Crear clientes")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#updating-customers"}},[a._v("Actualizar clientes")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#custom-email-addresses"}},[a._v("Personalizar la dirección de correo")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#payment-methods"}},[a._v("Formas de pago")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#storing-payment-methods"}},[a._v("Almacenar formas de pago")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#retrieving-payment-methods"}},[a._v("Buscar formas de pago")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#check-for-a-payment-method"}},[a._v("Determinar si un usuario tiene una forma de pago")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#updating-the-default-payment-method"}},[a._v("Actualizar la forma de pago predeterminada")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#adding-payment-methods"}},[a._v("Agregar formas de pago")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#deleting-payment-methods"}},[a._v("Eliminando formas de pago")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#subscriptions"}},[a._v("Suscripciones")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#creating-subscriptions"}},[a._v("Creando suscripciones")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#checking-subscription-status"}},[a._v("Verificando el estado de suscripción")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#changing-plans"}},[a._v("Cambiando planes")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#subscription-quantity"}},[a._v("Cantidad de suscripción")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#subscription-taxes"}},[a._v("Impuestos de suscripción")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#subscription-anchor-date"}},[a._v("Fecha de inicio de suscripción")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#cancelling-subscriptions"}},[a._v("Cancelando suscripciones")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#resuming-subscriptions"}},[a._v("Reanudando suscripciones")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#subscription-trials"}},[a._v("Períodos de prueba de suscripción")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#with-payment-method-up-front"}},[a._v("Con información anticipada de la forma de pago")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#without-payment-method-up-front"}},[a._v("Sin información anticipada de la forma de pago")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#extending-trials"}},[a._v("Extender el período de prueba")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#handling-stripe-webhooks"}},[a._v("Manejando webhooks de Stripe")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#defining-webhook-event-handlers"}},[a._v("Definiendo manejadores de eventos de webhooks")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#handling-failed-subscriptions"}},[a._v("Suscripciones fallidas")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#verifying-webhook-signatures"}},[a._v("Verificando las firmas del webhook")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#single-charges"}},[a._v("Cargos únicos")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#simple-charge"}},[a._v("Cargo simple")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#charge-with-invoice"}},[a._v("Cargo con factura")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#refunding-charges"}},[a._v("Reembolsar cargos")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#invoices"}},[a._v("Facturas")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#generating-invoice-pdfs"}},[a._v("Generando PDFs de facturas")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#strong-customer-authentication"}},[a._v("Autenticación reforzada de cliente (SCA)")]),a._v(" "),s("ul",[s("li",[s("a",{pre:!0,attrs:{href:"#payments-requiring-additional-confirmation"}},[a._v("Pagos que requieren confirmación adicional")])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#off-session-payment-notifications"}},[a._v("Notificaciones de pago de fuera-de-sesión")])])])]),a._v(" "),s("li",[s("a",{pre:!0,attrs:{href:"#stripe-sdk"}},[a._v("SDK de Stripe")])])]),a._v(" "),s("p",[s("a",{pre:!0,attrs:{name:"introduction"}})]),a._v(" "),s("h2",{pre:!0,attrs:{id:"introduccion"}},[s("a",{pre:!0,attrs:{class:"header-anchor",href:"#introduccion"}},[a._v("#")]),a._v(" Introducción")]),a._v(" "),s("p",[a._v("Laravel Cashier proporciona una expresiva interfaz fluida para los servicios de pagos en línea por suscripción de "),s("a",{pre:!0,attrs:{href:"https://stripe.com",target:"_blank",rel:"noopener noreferrer"}},[a._v("Stripe"),s("OutboundLink",{pre:!0})],1),a._v('. Maneja casi todo el código de facturación de suscripción que estás teniendo pavor de escribir. Además de la gestión de suscripción, Cashier puede manejar cupones, cambio de suscripciones, "cantidades" de suscripción, cancelación de períodos de gracia e incluso generar PDFs de facturas.')]),a._v(" "),s("p",[s("a",{pre:!0,attrs:{name:"upgrading-cashier"}})]),a._v(" "),s("h2",{pre:!0,attrs:{id:"actualizando-cashier"}},[s("a",{pre:!0,attrs:{class:"header-anchor",href:"#actualizando-cashier"}},[a._v("#")]),a._v(" Actualizando Cashier")]),a._v(" "),s("p",[a._v("Al actualizar a una versión nueva de Cashier, es importante que revises cuidadosamente "),s("a",{pre:!0,attrs:{href:"https://github.com/laravel/cashier/blob/master/UPGRADE.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("la guía de actualización"),s("OutboundLink",{pre:!0})],1),a._v(".")]),a._v(" "),s("div",{pre:!0,attrs:{class:"custom-block danger"}},[s("p",{pre:!0,attrs:{class:"custom-block-title"}},[a._v("Nota")]),a._v(" "),s("p",[a._v("Para prevenir errores por cambios de actualización, Cashier usa una versión API de Stripe fija. Cashier 10.1 utiliza la versión "),s("code",[a._v("2019-08-14")]),a._v(" de la API para Stripe. La versión API para Stripe será actualizada con los cambios menores en los lanzamientos de software (releases) con el propósito de asegurar la incorporación de las mejoras y nuevas funcionalidades de Stripe.")])])]),s("p",[s("a",{attrs:{name:"installation"}})]),a._v(" "),s("h2",{attrs:{id:"instalacion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#instalacion"}},[a._v("#")]),a._v(" Instalación")]),a._v(" "),s("p",[a._v("Primero, instala el paquete de Cashier para Stripe Con Composer:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[a._v("composer "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("require")]),a._v(" laravel"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("cashier\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Para asegurar que Cashier maneje todos los eventos de Stripe apropiadamente, recuerda "),s("a",{attrs:{href:"#handling-stripe-webhooks"}},[a._v("configurar el manejo de webhook de Cashier")]),a._v(".")])]),a._v(" "),s("p",[s("a",{attrs:{name:"database-migrations"}})]),a._v(" "),s("h4",{attrs:{id:"migraciones-de-bases-de-datos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#migraciones-de-bases-de-datos"}},[a._v("#")]),a._v(" Migraciones de bases de datos")]),a._v(" "),s("p",[a._v("El proveedor de servicio de Cashier registra su propio directorio de migración de base de datos, así que recuerda migrar tu base de datos después de instalar el paquete. Las migraciones de Cashier añadirán varias columnas a tu tabla "),s("code",[a._v("users")]),a._v(" al igual que crearán una nueva tabla "),s("code",[a._v("subscriptions")]),a._v(" para manejar todas las suscripciones de tus clientes:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[a._v("php artisan migrate\n")])])]),s("p",[a._v("Si necesitas sobrescribir las migraciones que vienen con el paquete de Cashier, puedes publicarlas usando el comando Artisan "),s("code",[a._v("vendor:publish")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[a._v("php artisan vendor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("publish "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("tag"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"cashier-migrations"')]),a._v("\n")])])]),s("p",[a._v("Si prefieres prevenir que las migraciones de Cashier se ejecuten completamente, puedes usar el método "),s("code",[a._v("ignoreMigrations")]),a._v(" proporcionado por Cashier. Típicamente, este método debería ser ejecutado en el método "),s("code",[a._v("register")]),a._v(" de tu "),s("code",[a._v("AppServiceProvider")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Laravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nCashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ignoreMigrations")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Stripe recomienda que cualquier columna usada para almacenar los identificadores de Stripe debería ser sensible a mayúsculas. Como consecuencia, deberías asegurarte que el ordenamiento de columna para la columna "),s("code",[a._v("stripe_id")]),a._v(" sea puesto a, por ejemplo, "),s("code",[a._v("utf8_bin")]),a._v(" en MySQL. Puedes buscar más información "),s("a",{attrs:{href:"https://stripe.com/docs/upgrades#what-changes-does-stripe-consider-to-be-backwards-compatible",target:"_blank",rel:"noopener noreferrer"}},[a._v("en la documentación de Stripe"),s("OutboundLink")],1),a._v(".")])]),a._v(" "),s("p",[s("a",{attrs:{name:"configuration"}})]),a._v(" "),s("h2",{attrs:{id:"configuracion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuracion"}},[a._v("#")]),a._v(" Configuración")]),a._v(" "),s("p",[s("a",{attrs:{name:"billable-model"}})]),a._v(" "),s("h3",{attrs:{id:"modelo-billable"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#modelo-billable"}},[a._v("#")]),a._v(" Modelo Billable")]),a._v(" "),s("p",[a._v("Antes de usar Cashier, agrega el trait "),s("code",[a._v("Billable")]),a._v(" a tu definición de modelo. Este trait proporciona varios métodos para permitirte realizar tareas comunes de facturación, tales como crear suscripciones, aplicar cupones y actualizar la información de las formas de pago:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Laravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Billable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Authenticatable")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Billable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Cashier asume que tu modelo Billable será la clase "),s("code",[a._v("App\\User")]),a._v(" que viene con Laravel. Si deseas cambiar esto, puedes especificar un modelo distinto en tu archivo "),s("code",[a._v(".env")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CASHIER_MODEL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("App\\"),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("User")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Si estás usando un modelo distinto al modelo "),s("code",[a._v("App\\User")]),a._v(" proporcionado por Laravel, necesitarás publicar y modificar las "),s("a",{attrs:{href:"#installation"}},[a._v("migraciones")]),a._v(" proporcionadas para que coincidan con el nombre de la tabla de tu modelo alternativo.")])]),a._v(" "),s("p",[s("a",{attrs:{name:"api-keys"}})]),a._v(" "),s("h3",{attrs:{id:"claves-de-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#claves-de-api"}},[a._v("#")]),a._v(" Claves de API")]),a._v(" "),s("p",[a._v("Seguidamente, deberías configurar tu clave de Stripe en tu archivo "),s("code",[a._v(".env")]),a._v(". Puedes encontrar tus claves de API de Stripe desde el panel de control de Stripe.")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STRIPE_KEY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("your"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("stripe"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("key\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("STRIPE_SECRET")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("your"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("stripe"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("secret\n")])])]),s("p",[s("a",{attrs:{name:"currency-configuration"}})]),a._v(" "),s("h3",{attrs:{id:"configuracion-de-moneda"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuracion-de-moneda"}},[a._v("#")]),a._v(" Configuración de moneda")]),a._v(" "),s("p",[a._v("La moneda predeterminada de Cashier es Dólares estadounidenses (USD). Puedes cambiar la moneda predeterminada colocándola en la variable de entorno "),s("code",[a._v("CASHIER_CURRENCY")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CASHIER_CURRENCY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("eur\n")])])]),s("p",[a._v("Además de configurar la moneda de Cashier, también puedes especificar una configuración regional que se utilizará al momento de dar formato a los valores de moneda que se muestran en las facturas. Internamente, Cashier utiliza "),s("a",{attrs:{href:"https://www.php.net/manual/en/class.numberformatter.php",target:"_blank",rel:"noopener noreferrer"}},[a._v("la clase "),s("code",[a._v("NumberFormatter")]),a._v(" de PHP"),s("OutboundLink")],1),a._v(" para establecer la configuración regional de la moneda:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CASHIER_CURRENCY_LOCALE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nl_BE\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Para usar configuraciones regionales distintas de "),s("code",[a._v("en")]),a._v(", asegúrate que tienes instalada y configurada la extensión de PHP "),s("code",[a._v("ext-intl")]),a._v(" en tu servidor.")])]),a._v(" "),s("p",[s("a",{attrs:{name:"logging"}})]),a._v(" "),s("h4",{attrs:{id:"logging"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[a._v("#")]),a._v(" Logging")]),a._v(" "),s("p",[a._v("Cashier permite que especifiques el canal de log para registrar todas las excepciones relacionadas con Stripe. Puedes especificar el canal de log al usar la variable de entorno "),s("code",[a._v("CASHIER_LOGGER")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CASHIER_LOGGER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("stack\n")])])]),s("p",[s("a",{attrs:{name:"customers"}})]),a._v(" "),s("h2",{attrs:{id:"clientes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#clientes"}},[a._v("#")]),a._v(" Clientes")]),a._v(" "),s("p",[s("a",{attrs:{name:"retrieving-customers"}})]),a._v(" "),s("h3",{attrs:{id:"buscar-clientes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#buscar-clientes"}},[a._v("#")]),a._v(" Buscar clientes")]),a._v(" "),s("p",[a._v("Puedes buscar los datos de un cliente por su ID de Stripe usando el método "),s("code",[a._v("Cashier::findBillable")]),a._v(". Este devolverá una instancia del modelo Billable:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Laravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findBillable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"creating-customers"}})]),a._v(" "),s("h3",{attrs:{id:"crear-clientes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#crear-clientes"}},[a._v("#")]),a._v(" Crear clientes")]),a._v(" "),s("p",[a._v("Ocasionalmente, puedes desear crear un cliente de Stripe sin empezar una suscripción. Puedes completar esta tarea usando el método "),s("code",[a._v("createAsStripeCustomer")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeCustomer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("createAsStripeCustomer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Una vez que el cliente ha sido creado en Stripe, puedes empezar una suscripción en una momento posterior. También puedes usar un arreglo opcional "),s("code",[a._v("$options")]),a._v(" para pasar parámetros adicionales que sean soportados por la API de Stripe:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeCustomer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("createAsStripeCustomer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("También puedes usar el método "),s("code",[a._v("createOrGetStripeCustomer")]),a._v(" si quieres devolver el objeto del cliente si la entidad billable ya existe como un cliente dentro de Stripe.")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeCustomer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("createOrGetStripeCustomer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"updating-customers"}})]),a._v(" "),s("h3",{attrs:{id:"actualizar-clientes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#actualizar-clientes"}},[a._v("#")]),a._v(" Actualizar clientes")]),a._v(" "),s("p",[a._v("Ocasionalmente, podrías querer actualizar el cliente de Stripe directamente con información adicional. Puedes completar esto usando el método "),s("code",[a._v("updateStripeCustomer")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeCustomer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateStripeCustomer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"custom-email-addresses"}})]),a._v(" "),s("h3",{attrs:{id:"personalizar-la-direccion-de-correo-electronico"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#personalizar-la-direccion-de-correo-electronico"}},[a._v("#")]),a._v(" Personalizar la dirección de correo electrónico")]),a._v(" "),s("p",[a._v("De forma predeterminada, Cashier usará el atributo "),s("code",[a._v("email")]),a._v(" de tu modelo Billable para crear los clientes dentro de Stripe. Puedes sobrescribir esto usando el método "),s("code",[a._v("stripeEmail")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * Get the email address used to create the customer in Stripe.\n *\n * @return string|null\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("stripeEmail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("email")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("También puedes elegir que devuelva "),s("code",[a._v("null")]),a._v(" ya que una dirección de correo electrónico no es obligatoria para crear un cliente dentro de Stripe. Si no proporcionas una dirección de correo electrónico, las funcionalidades dentro de Stripe como correos de cobro, recordatorios de pagos fallidos, y otras funcionalidades relacionadas con el correo electrónico no estarán disponibles.")]),a._v(" "),s("p",[s("a",{attrs:{name:"payment-methods"}})]),a._v(" "),s("h2",{attrs:{id:"formas-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#formas-de-pago"}},[a._v("#")]),a._v(" Formas de pago")]),a._v(" "),s("p",[s("a",{attrs:{name:"storing-payment-methods"}})]),a._v(" "),s("h3",{attrs:{id:"almacenar-formas-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#almacenar-formas-de-pago"}},[a._v("#")]),a._v(" Almacenar formas de pago")]),a._v(" "),s("p",[a._v('Con el propósito de crear las suscripciones o efectuar cargos de "pago único" con Stripe, necesitarás almacenar una forma de pago y buscar su identificador desde Stripe. El enfoque utilizado para lograrlo difiere basado en si planeas usar la forma de pago para suscripciones o cargos únicos, así que vamos a examinar ambos a continuación.')]),a._v(" "),s("h4",{attrs:{id:"formas-de-pago-para-suscripciones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#formas-de-pago-para-suscripciones"}},[a._v("#")]),a._v(" Formas de pago para suscripciones")]),a._v(" "),s("p",[a._v('Al momento de almacenar las tarjetas de crédito a un cliente para uso futuro, debe usarse la API de Intentos de Configuración de Stripe (Stripe Setup Intents API) para asignar de forma segura los detalles de la forma de pago del cliente. Un "Intento de Configuración" (Setup Intent) indica a Stripe la intención de cargar una forma de pago del cliente. El trait '),s("code",[a._v("Billable")]),a._v(" de Cashier incluye el método "),s("code",[a._v("createSetupIntent")]),a._v(" para crear fácilmente un nuevo Intento de Configuración (Setup Intent). Deberías ejecutar este método desde la ruta o controlador que renderizará el formulario que asigna los detalles de la forma de pago del cliente:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("view")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'update-payment-method'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'intent'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("createSetupIntent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v('Después de crear el Intento de Configuración y pasarlo a la vista, deberías adjuntar su secreto al elemento que asignará la forma de pago. Por ejemplo, considera este formulario para "actualizar la forma de pago":')]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("input id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"card-holder-name"')]),a._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"text"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" Stripe Elements Placeholder "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("div id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"card-element"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("div"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("button id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"card-button"')]),a._v(" data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("secret"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"{{ '),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$intent")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("client_secret")])]),a._v(' }}"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    Update Payment Method\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("button"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("Seguidamente, la librería Stripe.js puede ser usada para adjuntar un Elemento de Stripe al formulario y asignar de forma segura los detalles de pago del cliente:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"https://js.stripe.com/v3/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" stripe "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Stripe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'stripe-public-key'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" elements "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" stripe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("elements")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cardElement "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" elements"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    cardElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'#card-element'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v('Luego, la tarjeta puede ser verificada y puede buscarse un "identificador de forma de pago" seguro desde Stripe usando '),s("a",{attrs:{href:"https://stripe.com/docs/js/setup_intents/confirm_card_setup",target:"_blank",rel:"noopener noreferrer"}},[a._v("el método "),s("code",[a._v("confirmCardSetup")]),a._v(" de Stripe"),s("OutboundLink")],1),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cardHolderName "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card-holder-name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cardButton "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card-button'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" clientSecret "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" cardButton"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dataset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("secret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\ncardButton"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" async "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" setupIntent"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" error "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" await stripe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("confirmCardSetup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        clientSecret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            payment_method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                card"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cardElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                billing_details"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cardHolderName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// Display "error.message" to the user...')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// The card has been verified successfully...")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Después que la tarjeta ha sido verificada por Stripe, puedes pasar el identificador "),s("code",[a._v("setupIntent.payment_method")]),a._v(" que resulta a tu aplicación de Laravel, donde puede ser adjuntado al cliente. La forma de pago puede o ser "),s("a",{attrs:{href:"#adding-payment-methods"}},[a._v("agregada como una nueva forma de pago")]),a._v(" o "),s("a",{attrs:{href:"#updating-the-default-payment-method"}},[a._v("usada para actualizar la forma de pago predeterminada")]),a._v(". También puedes usar inmediatamente el identificador de la forma de pago para "),s("a",{attrs:{href:"#creating-subscriptions"}},[a._v("crear una nueva suscripción")]),a._v(".")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Si quieres más información sobre los Intentos de Configuración (Setup Intents) y los detalles de pago de cliente por favor "),s("a",{attrs:{href:"https://stripe.com/docs/payments/save-and-reuse#php",target:"_blank",rel:"noopener noreferrer"}},[a._v("revisa este resumen proporcionado por Stripe"),s("OutboundLink")],1),a._v(".")])]),a._v(" "),s("h4",{attrs:{id:"formas-de-pago-para-cargos-unicos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#formas-de-pago-para-cargos-unicos"}},[a._v("#")]),a._v(" Formas de pago para cargos únicos")]),a._v(" "),s("p",[a._v("Ciertamente, al momento de hacer un cargo único contra una forma de pago del cliente solamente necesitaremos un identificador de forma de pago una sola vez. Debido a las limitaciones de Stripe, no puedes usar la forma de pago almacenada de forma predeterminada a un cliente para cargos únicos. Debes permitirle al cliente que introduzca los detalles de su forma de pago usando la librería Stripe.js . Por ejemplo, considera el siguiente formulario:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("input id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"card-holder-name"')]),a._v(" type"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"text"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v(" Stripe Elements Placeholder "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("div id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"card-element"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("div"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("button id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"card-button"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    Process Payment\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("button"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("Luego, la librería Stripe.js puede usarse para adjuntar un Elemento de Stripe al formulario y asignar de forma segura los detalles de pago del cliente:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("script src"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"https://js.stripe.com/v3/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" stripe "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Stripe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'stripe-public-key'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" elements "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" stripe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("elements")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cardElement "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" elements"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    cardElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mount")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'#card-element'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("script"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v('Seguidamente, la tarjeta puede ser verificada y un "identificador de forma de pago" seguro puede ser buscado desde Stripe usando '),s("a",{attrs:{href:"https://stripe.com/docs/stripe-js/reference#stripe-create-payment-method",target:"_blank",rel:"noopener noreferrer"}},[a._v("el método "),s("code",[a._v("createPaymentMethod")]),a._v(" de Stripe"),s("OutboundLink")],1),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cardHolderName "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card-holder-name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" cardButton "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getElementById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card-button'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\ncardButton"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'click'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" async "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" paymentMethod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" error "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" await stripe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("createPaymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'card'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" cardElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            billing_details"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cardHolderName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("value "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// Display "error.message" to the user...')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// The card has been verified successfully...")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Si la tarjeta es verificada exitosamente, puedes pasar el "),s("code",[a._v("paymentMethod.id")]),a._v(" a tu aplicación de Laravel y procesar un "),s("a",{attrs:{href:"#simple-charge"}},[a._v("cargo único")]),a._v(".")]),a._v(" "),s("p",[s("a",{attrs:{name:"retrieving-payment-methods"}})]),a._v(" "),s("h3",{attrs:{id:"buscar-formas-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#buscar-formas-de-pago"}},[a._v("#")]),a._v(" Buscar formas de pago")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("paymentMethods")]),a._v(" en la instancia de modelo Billable devuelve una colección de instancias "),s("code",[a._v("Laravel\\Cashier\\PaymentMethod")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethods")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("paymentMethods")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Para buscar la forma de pago predeterminada, puede usarse el método "),s("code",[a._v("defaultPaymentMethod")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("defaultPaymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("También puedes buscar una forma de pago específica que se posea en el modelo Billable usando el método "),s("code",[a._v("findPaymentMethod")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findPaymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethodId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"check-for-a-payment-method"}})]),a._v(" "),s("h3",{attrs:{id:"determinar-si-un-usuario-tiene-una-forma-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#determinar-si-un-usuario-tiene-una-forma-de-pago"}},[a._v("#")]),a._v(" Determinar si un usuario tiene una forma de pago")]),a._v(" "),s("p",[a._v("Para determinar si un modelo Billable tiene una forma de pago adjuntada a su cuenta, usa el método "),s("code",[a._v("hasPaymentMethod")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("hasPaymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"updating-the-default-payment-method"}})]),a._v(" "),s("h3",{attrs:{id:"actualizar-la-forma-de-pago-predeterminada"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#actualizar-la-forma-de-pago-predeterminada"}},[a._v("#")]),a._v(" Actualizar la forma de pago predeterminada")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("updateDefaultPaymentMethod")]),a._v(" puede usarse para actualizar la información de la forma de pago predeterminada del cliente. Este método acepta un identificador de forma de pago de Stripe y asignará la nueva forma de pago como forma de pago predeterminada de facturación.")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateDefaultPaymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Para sincronizar tu información de forma de pago predeterminada con la información de forma de pago predeterminada del cliente en Stripe, puedes usar el método "),s("code",[a._v("updateDefaultPaymentMethodFromStripe")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateDefaultPaymentMethodFromStripe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("La forma de pago predeterminada de un cliente solamente puede ser usada para facturación y creación de suscripciones nuevas. Dado las limitaciones de Stripe, no pueden ser usadas para cargos únicos.")])]),a._v(" "),s("p",[s("a",{attrs:{name:"adding-payment-methods"}})]),a._v(" "),s("h3",{attrs:{id:"agregar-formas-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#agregar-formas-de-pago"}},[a._v("#")]),a._v(" Agregar formas de pago")]),a._v(" "),s("p",[a._v("Para agregar una nueva forma de pago, puedes ejecutar el método "),s("code",[a._v("addPaymentMethod")]),a._v(" en el usuario billable, pasando el identificador de forma de pago:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addPaymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("Para aprender cómo buscar un identificador de forma de pago, por favor revisa la "),s("a",{attrs:{href:"#storing-payment-methods"}},[a._v("documentación sobre almacenamiento de forma de pago")]),a._v(".")])]),a._v(" "),s("p",[s("a",{attrs:{name:"deleting-payment-methods"}})]),a._v(" "),s("h3",{attrs:{id:"eliminando-formas-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eliminando-formas-de-pago"}},[a._v("#")]),a._v(" Eliminando formas de pago")]),a._v(" "),s("p",[a._v("Para eliminar una forma de pago, puedes ejecutar el método "),s("code",[a._v("delete")]),a._v(" en la instancia de "),s("code",[a._v("Laravel\\Cashier\\PaymentMethod")]),a._v(" que deseas eliminar:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("deletePaymentMethods")]),a._v(" eliminará toda la información de forma de pago para el modelo Billable:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("deletePaymentMethods")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Si un  usuario tiene una suscripción activa, deberías prevenirlo de eliminar su forma de pago predeterminada.")])]),a._v(" "),s("p",[s("a",{attrs:{name:"subscriptions"}})]),a._v(" "),s("h2",{attrs:{id:"suscripciones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#suscripciones"}},[a._v("#")]),a._v(" Suscripciones")]),a._v(" "),s("p",[s("a",{attrs:{name:"creating-subscriptions"}})]),a._v(" "),s("h3",{attrs:{id:"creando-suscripciones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#creando-suscripciones"}},[a._v("#")]),a._v(" Creando suscripciones")]),a._v(" "),s("p",[a._v("Para crear una suscripción, primero obtén una instancia de tu modelo billable o de facturación, el cual será típicamente una instancia de "),s("code",[a._v("App\\User")]),a._v(". Una vez que has obtenido la instancia de modelo, puedes usar el método "),s("code",[a._v("newSubscription")]),a._v(" para crear la suscripción del modelo:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'premium'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("El primer argumento pasado al método "),s("code",[a._v("newSubscription")]),a._v(" debería ser el nombre de la suscripción. Si tu aplicación sólo ofrece una única suscripción, puedes llamarla "),s("code",[a._v("default")]),a._v(" o "),s("code",[a._v("primary")]),a._v(". El segundo argumento es el plan específico al que el usuario se está suscribiendo. Este valor debería corresponder al identificador del plan en Stripe.")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("create")]),a._v(", el cual acepta "),s("a",{attrs:{href:"#storing-payment-methods"}},[a._v("un identificador de forma de pago de Stripe")]),a._v(" o un objeto "),s("code",[a._v("PaymentMethod")]),a._v(" de Stripe, comenzará la suscripción al igual que actualizará tu base de datos con el ID del cliente y otra información de facturación relevante.")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Pasar un identificador de forma de pago directamente al método para crear una suscripción "),s("code",[a._v("create()")]),a._v(", también lo agregará automáticamente a las formas de pago almacenadas del usuario.")])]),a._v(" "),s("h4",{attrs:{id:"detalles-de-usuario-adicionales"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#detalles-de-usuario-adicionales"}},[a._v("#")]),a._v(" Detalles de usuario adicionales")]),a._v(" "),s("p",[a._v("Si prefieres especificar detalles de cliente adicionales, puedes hacerlo pasándolos como segundo argumento del método "),s("code",[a._v("create")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'email'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$email")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Para aprender más sobre los campos adicionales soportados por Stripe, revisa la "),s("a",{attrs:{href:"https://stripe.com/docs/api#create_customer",target:"_blank",rel:"noopener noreferrer"}},[a._v("documentación sobre la creación de clientes"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("h4",{attrs:{id:"cupones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cupones"}},[a._v("#")]),a._v(" Cupones")]),a._v(" "),s("p",[a._v("Si prefieres aplicar un cupón al momento de crear la suscripción, puedes usar el método "),s("code",[a._v("withCoupon")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("withCoupon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'code'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n     "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"checking-subscription-status"}})]),a._v(" "),s("h3",{attrs:{id:"verificando-el-estado-de-la-suscripcion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verificando-el-estado-de-la-suscripcion"}},[a._v("#")]),a._v(" Verificando el estado de la suscripción")]),a._v(" "),s("p",[a._v("Una vez que un usuario está suscrito a tu aplicación, puedes verificar fácilmente su estado de suscripción usando una variedad conveniente de métodos. Primero, el método "),s("code",[a._v("subscribed")]),a._v(" devuelve "),s("code",[a._v("true")]),a._v(" si el usuario tiene una suscripción activa, incluso si la suscripción está actualmente en su período de prueba:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("subscribed")]),a._v(" también constituye un gran candidato para un "),s("RouterLink",{attrs:{to:"/middleware.html"}},[a._v("middleware de ruta")]),a._v(", permitiéndote filtrar el acceso a rutas y controladores basados en el estado de suscripción del usuario:")],1),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Closure "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// This user is not a paying customer...")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("redirect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'billing'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Si prefieres determinar si un usuario está aún dentro de su período de prueba, puedes usar el método "),s("code",[a._v("onTrial")]),a._v(". Este método puede ser útil para mostrar una advertencia al usuario que todavía está en su período de prueba:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("subscribedToPlan")]),a._v(" puede ser usado para determinar si el usuario está suscrito a un plan dado basado en un ID de plan Stripe proporcionado. En este ejemplo, determinaremos si la suscripción "),s("code",[a._v("default")]),a._v(" del usuario está activa para el plan "),s("code",[a._v("monthly")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribedToPlan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Al pasar un arreglo al método "),s("code",[a._v("subscribedToPlan")]),a._v(", puedes determinar si la suscripción "),s("code",[a._v("default")]),a._v(" del usuario está activa para el plan "),s("code",[a._v("monthly")]),a._v(" o "),s("code",[a._v("yearly")])]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscribedToPlan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'yearly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("recurring")]),a._v(" puede ser usado para determinar si el usuario está actualmente suscrito y ya no está dentro de su periodo de prueba:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("recurring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h4",{attrs:{id:"estado-de-suscripcion-cancelada"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#estado-de-suscripcion-cancelada"}},[a._v("#")]),a._v(" Estado de suscripción cancelada")]),a._v(" "),s("p",[a._v("Para determinar si el usuario fue alguna vez un suscriptor activo, pero que ha cancelado su suscripción, puedes usar el método "),s("code",[a._v("cancelled")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cancelled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v('También puedes determinar si un usuario ha cancelado su suscripción, pero todavía está en su "período de gracia" hasta que la suscripción caduque totalmente. Por ejemplo, si un usuario cancela una suscripción el 5 de Marzo que fue planificada para expirar originalmente el 10 de Marzo, el usuario está en su "período de gracia" hasta el 10 de Marzo. Nota que el método '),s("code",[a._v("subscribed")]),a._v(" aún devuelve "),s("code",[a._v("true")]),a._v(" durante este tiempo:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onGracePeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v('Para determinar si el usuario que ha cancelado su suscripción ya no está dentro del "periodo de gracia", puedes usar el método '),s("code",[a._v("ended")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ended")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"incomplete-and-past-due-status"}})]),a._v(" "),s("h4",{attrs:{id:"estado-de-deuda-vencida-o-incompleta"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#estado-de-deuda-vencida-o-incompleta"}},[a._v("#")]),a._v(" Estado de deuda vencida o incompleta")]),a._v(" "),s("p",[a._v("Si una suscripción requiere una acción de pago secundaria después de la creación de la suscripción será marcada como incompleta "),s("code",[a._v("incomplete")]),a._v(". Los estados de suscripción son almacenados en la columna "),s("code",[a._v("stripe_status")]),a._v(" en la tabla de bases de datos "),s("code",[a._v("subscriptions")]),a._v(" de Cashier.")]),a._v(" "),s("p",[a._v("De forma similar, si una acción de pago secundaria es requerida al momento de intercambiar los planes, la suscripción será marcada como "),s("code",[a._v("past_due")]),a._v(" o deuda vencida. Cuando tu suscripción esté en alguno de estos estados, no estará activa hasta que el cliente haya confirmado su pago. La comprobación de si una suscripción tiene un pago incompleto se puede hacer usando el método "),s("code",[a._v("hasIncompletePayment")]),a._v(" en el modelo Billable o una instancia de suscripción:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("hasIncompletePayment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("hasIncompletePayment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Cuando una suscripción tenga un pago incompleto, deberías dirigir al usuario a la página de confirmación de pago de Cashier, pasando el identificador de "),s("code",[a._v("latestPayment")]),a._v(". Puedes usar el método "),s("code",[a._v("latestPayment")]),a._v(" disponible en una instancia de suscripción para buscar su identificador:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("a href"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v("\"{{ route('cashier.payment', "),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("latestPayment")])]),a._v('()->id) }}"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    Please confirm your payment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("Si prefieres que la suscripción aún permanezca activa cuando esté en un estado "),s("code",[a._v("past_due")]),a._v(", puedes usar el método "),s("code",[a._v("keepPastDueSubscriptionsActive")]),a._v(" proporcionado por Cashier. Típicamente, este método debería ejecutarse en el método "),s("code",[a._v("register")]),a._v(" de tu "),s("code",[a._v("AppServiceProvider")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Laravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n * Register any application services.\n *\n * @return void\n */")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("keepPastDueSubscriptionsActive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Cuando una suscripción esté en un estado "),s("code",[a._v("incomplete")]),a._v(" no puede ser cambiada hasta que el pago sea confirmado. Por lo tanto, los métodos "),s("code",[a._v("swap")]),a._v(" y "),s("code",[a._v("updateQuantity")]),a._v(" arrojarán una excepción cuando la suscripción esté en un estado "),s("code",[a._v("incomplete")]),a._v(".")])]),a._v(" "),s("p",[s("a",{attrs:{name:"changing-plans"}})]),a._v(" "),s("h3",{attrs:{id:"cambiando-planes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cambiando-planes"}},[a._v("#")]),a._v(" Cambiando planes")]),a._v(" "),s("p",[a._v("Después que un usuario esté suscrito en tu aplicación, ocasionalmente puede querer cambiar a un nuevo plan de suscripción. Para cambiar un usuario a una nueva suscripción, pasa el identificador de plan al método "),s("code",[a._v("swap")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" App\\"),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'provider-plan-id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v('Si el usuario está en período de prueba, se mantendrá el período de prueba. También, si una "cantidad" existe para la suscripción, esa cantidad también será conservada.')]),a._v(" "),s("p",[a._v("Si prefieres cambiar planes y cancelar cualquier período de prueba en donde esté el usuario actualmente, puedes usar el método "),s("code",[a._v("skipTrial")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("skipTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'provider-plan-id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Si prefieres cambiar de plan y facturar inmediatamente al usuario en lugar de esperar por su próximo período de facturación, puedes usar el método "),s("code",[a._v("swapAndInvoice")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" App\\"),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swapAndInvoice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'provider-plan-id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("h4",{attrs:{id:"prorrateo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prorrateo"}},[a._v("#")]),a._v(" Prorrateo")]),a._v(" "),s("p",[a._v("De forma predeterminada, Stripe prorratea los cargos (calcula parcialmente los cargos) al momento de un intercambio de planes. El método "),s("code",[a._v("noProrate")]),a._v(" puede ser usado para actualizar la suscripción sin prorratear los cargos:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("noProrate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'provider-plan-id'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Para más información sobre el prorrateo de suscripción, consulta la "),s("a",{attrs:{href:"https://stripe.com/docs/billing/subscriptions/prorations",target:"_blank",rel:"noopener noreferrer"}},[a._v("documentación de Stripe"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("p",[s("a",{attrs:{name:"subscription-quantity"}})]),a._v(" "),s("h3",{attrs:{id:"cantidad-de-la-suscripcion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cantidad-de-la-suscripcion"}},[a._v("#")]),a._v(" Cantidad de la suscripción")]),a._v(" "),s("p",[a._v('Algunas veces las suscripciones son afectadas por la "cantidad". Por ejemplo, tu aplicación podría cargar $10 por mes '),s("strong",[a._v("por usuario")]),a._v(" en una cuenta. Para incrementar o disminuir fácilmente tu cantidad en la suscripción, usa los métodos "),s("code",[a._v("incrementQuantity")]),a._v(" y "),s("code",[a._v("decrementQuantity")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("incrementQuantity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Add five to the subscription's current quantity...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("incrementQuantity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("decrementQuantity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Subtract five to the subscription's current quantity...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("decrementQuantity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Alternativamente, puedes establecer una cantidad específica usando el método "),s("code",[a._v("updateQuantity")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateQuantity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("noProrate")]),a._v(" puede ser usado para actualizar la cantidad de la suscripción sin prorratear los cargos:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("noProrate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("updateQuantity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Para más información sobre cantidades de suscripción, consulta la "),s("a",{attrs:{href:"https://stripe.com/docs/subscriptions/quantities",target:"_blank",rel:"noopener noreferrer"}},[a._v("documentación de Stripe"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("p",[s("a",{attrs:{name:"subscription-taxes"}})]),a._v(" "),s("h3",{attrs:{id:"impuestos-de-suscripcion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#impuestos-de-suscripcion"}},[a._v("#")]),a._v(" Impuestos de suscripción")]),a._v(" "),s("p",[a._v("Para especificar el porcentaje de impuesto que un usuario paga en una suscripción, implementa el método "),s("code",[a._v("taxPercentage")]),a._v(" en tu modelo billable (facturable) y devuelve un valor numérico entre 0 y 100, sin más de 2 posiciones decimales.")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("taxPercentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("taxPercentage")]),a._v(" te permite aplicar una tasa de impuesto modelo por modelo, lo que puede ser útil para una base de usuarios que abarca varios países y tasas de impuestos.")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("taxPercentage")]),a._v(' solamente aplica para cargos por suscripción. Si usas Cashier para hacer cargos de "pago único", necesitarás especificar manualmente la tasa de impuesto en ese momento.')])]),a._v(" "),s("h4",{attrs:{id:"sincronizando-los-porcentajes-del-impuesto"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sincronizando-los-porcentajes-del-impuesto"}},[a._v("#")]),a._v(" Sincronizando los porcentajes del impuesto")]),a._v(" "),s("p",[a._v("Al cambiar el valor retornado por el método "),s("code",[a._v("taxPercentage")]),a._v(", las configuraciones de impuesto en cualquier suscripción existente del usuario permanecerán igual. Si deseas actualizar el valor del impuesto para un suscripción existente con el valor "),s("code",[a._v("taxPercentage")]),a._v(" retornado, debes llamar al método "),s("code",[a._v("syncTaxPercentage")]),a._v(" en la instancia de suscripción del usuario:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("syncTaxPercentage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"subscription-anchor-date"}})]),a._v(" "),s("h3",{attrs:{id:"fecha-de-inicio-de-la-suscripcion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fecha-de-inicio-de-la-suscripcion"}},[a._v("#")]),a._v(" Fecha de inicio de la suscripción")]),a._v(" "),s("p",[a._v("Por defecto, el inicio del período de facturación es la fecha en que se creó la suscripción o, si se usa un período de prueba, la fecha en que finaliza la prueba. Si deseas modificar la fecha de inicio de facturación, puedes usar el método "),s("code",[a._v("anchorBillingCycleOn")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Carbon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Carbon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$anchor")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Carbon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'first day of next month'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'premium'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("anchorBillingCycleOn")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$anchor")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("startOfDay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Para más información sobre administrar períodos de facturación, consulta la "),s("a",{attrs:{href:"https://stripe.com/docs/billing/subscriptions/billing-cycle",target:"_blank",rel:"noopener noreferrer"}},[a._v("documentación del período de facturación de Stripe"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("p",[s("a",{attrs:{name:"cancelling-subscriptions"}})]),a._v(" "),s("h3",{attrs:{id:"cancelando-suscripciones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cancelando-suscripciones"}},[a._v("#")]),a._v(" Cancelando suscripciones")]),a._v(" "),s("p",[a._v("Para cancelar una suscripción, ejecuta el método "),s("code",[a._v("cancel")]),a._v(" en la suscripción del usuario:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cancel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Cuando una suscripción es cancelada, Cashier establecerá automáticamente la columna "),s("code",[a._v("ends_at")]),a._v(" en tu base de datos. Esta columna es usada para conocer cuando el método "),s("code",[a._v("subscribed")]),a._v(" debería empezar a devolver el valor de "),s("code",[a._v("false")]),a._v(". Por ejemplo, si un cliente cancela una suscripción el 1 de Marzo, pero la suscripción no estaba planificada para finalizar sino para el 5 de Marzo, el método "),s("code",[a._v("subscribed")]),a._v(" continuará devolviendo "),s("code",[a._v("true")]),a._v(" hasta el 5 de Marzo.")]),a._v(" "),s("p",[a._v('Puedes determinar si un usuario ha cancelado su suscripción pero aún está en su "período de gracia" usando el método '),s("code",[a._v("onGracePeriod")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onGracePeriod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Si deseas cancelar una suscripción inmediatamente, ejecuta el método "),s("code",[a._v("cancelNow")]),a._v(" en la suscripción del usuario:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cancelNow")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"resuming-subscriptions"}})]),a._v(" "),s("h3",{attrs:{id:"reanudando-suscripciones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reanudando-suscripciones"}},[a._v("#")]),a._v(" Reanudando suscripciones")]),a._v(" "),s("p",[a._v("Si un usuario ha cancelado su suscripción y deseas reanudarla, usa el método "),s("code",[a._v("resume")]),a._v(". El usuario "),s("strong",[a._v("debe")]),a._v(" estar aún en su período de gracia para reanudar una suscripción:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("resume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Si el usuario cancela una suscripción y después reanuda esa suscripción antes que la suscripción haya expirado completamente, no será facturada inmediatamente. En lugar de eso, su suscripción será reactivada y será facturada en el período de facturación original.")]),a._v(" "),s("p",[s("a",{attrs:{name:"subscription-trials"}})]),a._v(" "),s("h2",{attrs:{id:"periodos-de-prueba-de-suscripcion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#periodos-de-prueba-de-suscripcion"}},[a._v("#")]),a._v(" Períodos de prueba de suscripción")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Cashier maneja las fechas de períodos de prueba por suscripciones y no las deriva desde los planes de Stripe. Por lo tanto, deberías configurar tu plan en Stripe para que tenga un período de prueba de cero días de modo que Cashier pueda manejar los períodos de prueba en su lugar.")])]),a._v(" "),s("p",[s("a",{attrs:{name:"with-payment-method-up-front"}})]),a._v(" "),s("h3",{attrs:{id:"con-informacion-anticipada-de-la-forma-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#con-informacion-anticipada-de-la-forma-de-pago"}},[a._v("#")]),a._v(" Con información anticipada de la forma de pago")]),a._v(" "),s("p",[a._v("Si prefieres ofrecer períodos de prueba a tus clientes mientras continuas coleccionando información anticipada de la forma de pago, deberías usar el método "),s("code",[a._v("trialDays")]),a._v(" al momento de crear tus suscripciones:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("trialDays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Este método establecerá la fecha de finalización del período de prueba en el registro de suscripción dentro de la base de datos, al igual que le indicará a Stripe a no empezar a facturar al cliente hasta después de esta fecha. Al usar el método "),s("code",[a._v("trialDays")]),a._v(", Cashier sobrescribirá cualquier período de prueba por defecto configurado para el plan en Stripe.")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Si la suscripción del cliente no es cancelada antes de la fecha de finalización del período de prueba, será cargada tan pronto como expire el período de prueba, así que deberías asegurarte de notificar a tus usuarios de la fecha de finalización de su período de prueba.")])]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("trialUntil")]),a._v(" te permite proporcionar una instancia "),s("code",[a._v("DateTime")]),a._v(" para especificar cuando el periodo de prueba debería terminar:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Carbon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Carbon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("trialUntil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Carbon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addDays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Puedes determinar si el usuario está dentro de su período de prueba utilizando el método "),s("code",[a._v("onTrial")]),a._v(" de la instancia del usuario o el método "),s("code",[a._v("onTrial")]),a._v(" de la instancia de suscripción. Los dos ejemplos que siguen son idénticos:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("subscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"without-payment-method-up-front"}})]),a._v(" "),s("h3",{attrs:{id:"sin-informacion-anticipada-de-la-forma-de-pago"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sin-informacion-anticipada-de-la-forma-de-pago"}},[a._v("#")]),a._v(" Sin información anticipada de la forma de pago")]),a._v(" "),s("p",[a._v("Si prefieres ofrecer períodos de prueba sin coleccionar la información anticipada del método de pago del usuario, puedes establecer la columna "),s("code",[a._v("trial_ends_at")]),a._v(" en el registro del usuario con la fecha de finalización del período de prueba deseado. Esto es hecho típicamente durante el proceso de registro del usuario:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Populate other user properties...")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'trial_ends_at'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addDays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Asegúrate de agregar un "),s("RouterLink",{attrs:{to:"/eloquent-mutators.html#date-mutators"}},[a._v("mutador de fecha")]),a._v(" para "),s("code",[a._v("trial_ends_at")]),a._v(" en tu definición de modelo.")],1)]),a._v(" "),s("p",[a._v('Cashier se refiere a este tipo de período de prueba como un "período de prueba genérico", debido a que no está conectado a ninguna suscripción existente. El método '),s("code",[a._v("onTrial")]),a._v(" en la instancia "),s("code",[a._v("User")]),a._v(" devolverá "),s("code",[a._v("true")]),a._v(" si la fecha actual no es mayor al valor de "),s("code",[a._v("trial_ends_at")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// User is within their trial period...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("También puedes usar el método "),s("code",[a._v("onGenericTrial")]),a._v(' si deseas conocer específicamente que el usuario está dentro de su período de prueba "genérico" y no ha creado una suscripción real todavía:')]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("onGenericTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// User is within their "generic" trial period...')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("Una vez que estés listo para crear una suscripción real para el usuario, puedes usar el método "),s("code",[a._v("newSubscription")]),a._v(" como es usual:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" User"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'monthly'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"extending-trials"}})]),a._v(" "),s("h3",{attrs:{id:"extender-el-periodo-de-prueba"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#extender-el-periodo-de-prueba"}},[a._v("#")]),a._v(" Extender el período de prueba")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("extendTrial")]),a._v(" permite que extiendas el período de prueba de una suscripción después que haya sido creada:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// End the trial 7 days from now...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("extendTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addDays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Add an additional 5 days to the trial...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("extendTrial")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("trial_ends_at")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("addDays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Si el período de prueba ya ha expirado y el cliente ya ha recibido el cobro por la suscripción, todavía puedes ofrecerle un período de prueba extendido. El tiempo que gastó dentro del período de prueba será descontado de la próxima factura del cliente.")]),a._v(" "),s("p",[s("a",{attrs:{name:"handling-stripe-webhooks"}})]),a._v(" "),s("h2",{attrs:{id:"manejando-webhooks-de-stripe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#manejando-webhooks-de-stripe"}},[a._v("#")]),a._v(" Manejando webhooks de Stripe")]),a._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v("Puedes usar "),s("a",{attrs:{href:"https://stripe.com/docs/stripe-cli",target:"_blank",rel:"noopener noreferrer"}},[a._v("la interfaz de línea de comandos o CLI de Stripe"),s("OutboundLink")],1),a._v(" para ayudar a realizar pruebas con webhooks durante el desarrollo local.")])]),a._v(" "),s("p",[a._v("Stripe puede notificar a tu aplicación de una variedad de eventos por medio de webhooks. De forma predeterminada, una ruta que apunta al controlador de webhook de Cashier es configurada a través del proveedor de servicio de Cashier. Este controlador manejará todas las solicitudes de webhook entrantes.")]),a._v(" "),s("p",[a._v("De forma predeterminada, este controlador manejará automáticamente la cancelación de suscripciones que tengan demasiados cargos fallados (como sea definido por tu configuración de Stripe), las actualizaciones de clientes, las eliminaciones de clientes, las actualizaciones de suscripción y los cambios de forma de pago; sin embargo, como vamos a descubrir pronto, puedes extender este controlador para que maneje cualquier evento de webhook que desees.")]),a._v(" "),s("p",[a._v("Para asegurar que tu aplicación pueda manejar los webhooks de Stripe, asegúrate de configurar la URL de webhook en el panel de control de Stripe. La lista completa de todos los webhooks que deberías configurar en el panel de control de Stripe son:")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("customer.subscription.updated")])]),a._v(" "),s("li",[s("code",[a._v("customer.subscription.deleted")])]),a._v(" "),s("li",[s("code",[a._v("customer.updated")])]),a._v(" "),s("li",[s("code",[a._v("customer.deleted")])]),a._v(" "),s("li",[s("code",[a._v("invoice.payment_action_required")])])]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Asegúrate de proteger las solicitudes entrantes con el middleware "),s("a",{attrs:{href:"#verifying-webhook-signatures"}},[a._v("webhook de verificación de firmas")]),a._v(" incluido en Cashier.")])]),a._v(" "),s("h4",{attrs:{id:"webhooks-proteccion-csrf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webhooks-proteccion-csrf"}},[a._v("#")]),a._v(" Webhooks & Protección CSRF")]),a._v(" "),s("p",[a._v("Ya que los webhooks de Stripe necesitan pasar por alto la "),s("RouterLink",{attrs:{to:"/csrf.html"}},[a._v("protección CSRF")]),a._v(" de Laravel, asegúrate de listar la URI como una excepción en tu middleware "),s("code",[a._v("VerifyCsrfToken")]),a._v(" o lista la ruta fuera del grupo de middleware "),s("code",[a._v("web")]),a._v(":")],1),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$except")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'stripe/*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"defining-webhook-event-handlers"}})]),a._v(" "),s("h3",{attrs:{id:"definiendo-manejadores-de-eventos-de-webhooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#definiendo-manejadores-de-eventos-de-webhooks"}},[a._v("#")]),a._v(" Definiendo manejadores de eventos de webhooks")]),a._v(" "),s("p",[a._v("Cashier maneja automáticamente la cancelación de suscripción por cargos fallidos, pero si tienes eventos de webhook adicionales que te gustaría manejar, extiende el controlador de Webhook. Tus nombres de métodos deberían corresponder con la convención esperada por Cashier, específicamente, los métodos deberían tener como prefijo "),s("code",[a._v("handle")]),a._v(' y el nombre "camel case" del webhook que deseas manejar. Por ejemplo, si deseas manejar el webhook '),s("code",[a._v("invoice.payment_succeeded")]),a._v(", deberías agregar un método "),s("code",[a._v("handleInvoicePaymentSucceeded")]),a._v(" al controlador:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token php language-php"}},[s("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Laravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("WebhookController")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("as")]),a._v(" CashierController"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WebhookController")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CashierController")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Handle invoice payment succeeded.\n    *\n    * @param  array  $payload\n    * @return \\Symfony\\Component\\HttpFoundation\\Response\n    */")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("handleInvoicePaymentSucceeded")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$payload")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Handle The Event")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),s("p",[a._v("Luego, define una ruta a tu controlador de Cashier dentro de tu archivo "),s("code",[a._v("routes/web.php")]),a._v(". Esto sobrescribirá la ruta predeterminada de entrega:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[a._v("Route"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'stripe/webhook'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'\\App\\Http\\Controllers\\WebhookController@handleWebhook'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Cashier emite un evento "),s("code",[a._v("Laravel\\Cashier\\Events\\WebhookReceived")]),a._v("cuando se recibe un webhook, y un evento "),s("code",[a._v("Laravel\\Cashier\\Events\\WebhookHandled")]),a._v(" cuando un webhook fue manejado por Cashier. Ambos eventos contienen la porción de los datos completa (payload) del webhook de Stripe.")]),a._v(" "),s("p",[s("a",{attrs:{name:"handling-failed-subscriptions"}})]),a._v(" "),s("h3",{attrs:{id:"suscripciones-fallidas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#suscripciones-fallidas"}},[a._v("#")]),a._v(" Suscripciones fallidas")]),a._v(" "),s("p",[a._v("¿Qué sucedería si una tarjeta de crédito expira? No importa - el controlador Webhook de Cashier cancelará la suscripción del cliente por ti. Los pagos fallidos serán capturados y manejados por el controlador automáticamente. El controlador cancelará la suscripción del cliente cuando Stripe determina que la suscripción ha fallado (normalmente después de tres intentos de pagos fallidos).")]),a._v(" "),s("p",[s("a",{attrs:{name:"verifying-webhook-signatures"}})]),a._v(" "),s("h3",{attrs:{id:"verificando-las-firmas-de-los-webhooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#verificando-las-firmas-de-los-webhooks"}},[a._v("#")]),a._v(" Verificando las firmas de los webhooks")]),a._v(" "),s("p",[a._v("Para asegurar tus webhooks, puedes usar "),s("a",{attrs:{href:"https://stripe.com/docs/webhooks/signatures",target:"_blank",rel:"noopener noreferrer"}},[a._v("las firmas de webhook de Stripe"),s("OutboundLink")],1),a._v(". Por conveniencia, Cashier automáticamente incluye un middleware que verifica si la petición del webhook de Stripe entrante es válida.")]),a._v(" "),s("p",[a._v("Para habilitar la verificación de webhook, asegúrate de que la variable de entorno "),s("code",[a._v("STRIPE_WEBHOOK_SECRET")]),a._v(" está declarada en tu archivo "),s("code",[a._v(".env")]),a._v(". El valor "),s("code",[a._v("secret")]),a._v(" de webhook puede ser buscado desde el panel de control de tu cuenta de Stripe.")]),a._v(" "),s("p",[s("a",{attrs:{name:"single-charges"}})]),a._v(" "),s("h2",{attrs:{id:"cargos-unicos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cargos-unicos"}},[a._v("#")]),a._v(" Cargos únicos")]),a._v(" "),s("p",[s("a",{attrs:{name:"simple-charge"}})]),a._v(" "),s("h3",{attrs:{id:"cargo-simple"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cargo-simple"}},[a._v("#")]),a._v(" Cargo simple")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("charge")]),a._v(" acepta la cantidad que prefieras cargar en el "),s("strong",[a._v("denominador más bajo de la moneda usada por tu aplicación")]),a._v(".")])]),a._v(" "),s("p",[a._v('Si desea realizar un "cargo único" a la forma de pago de un cliente suscrito, puedes usar el método '),s("code",[a._v("charge")]),a._v(" en una instancia de modelo billable (facturable). Deberás "),s("a",{attrs:{href:"#storing-payment-methods"}},[a._v("proporcionar un identificador de forma de pago")]),a._v(" como segundo argumento:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Stripe Accepts Charges In Cents...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeCharge")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("charge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("charge")]),a._v(" acepta un arreglo como tercer argumento, permitiendo que pases algunas opciones que desees para la creación de cargo de Stripe subyacente. Consulta la documentación de Stripe sobre las opciones disponibles al crear cargos:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("charge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'custom_option'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("El método "),s("code",[a._v("charge")]),a._v(" arrojará una excepción si el cargo falla. Si el cargo es exitoso, una instancia de "),s("code",[a._v("Laravel\\Cashier\\Payment")]),a._v(" será devuelta por el método:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$payment")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("charge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Exception "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"charge-with-invoice"}})]),a._v(" "),s("h3",{attrs:{id:"cargo-con-factura"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cargo-con-factura"}},[a._v("#")]),a._v(" Cargo con factura")]),a._v(" "),s("p",[a._v("Algunas veces puedes necesitar hacer un cargo único pero también generar una factura por el cargo de modo que puedas ofrecer un recibo PDF a tu cliente. El método "),s("code",[a._v("invoiceFor")]),a._v(' permite que hagas justamente eso. Por ejemplo, vamos a facturar al cliente $5.00 por una "cuota única":')]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Stripe Accepts Charges In Cents...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("invoiceFor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'One Time Fee'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("La factura será cargada inmediatamente contra la forma de pago predeterminada del usuario. El método "),s("code",[a._v("invoiceFor")]),a._v(" también acepta un arreglo como su tercer argumento. Este arreglo contiene las opciones de facturación para el elemento de la factura. El cuarto argumento aceptado por el método es también un arreglo. Este argumento final acepta las opciones de facturación de la factura en sí:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("invoiceFor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'Stickers'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'quantity'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'tax_percent'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("El método "),s("code",[a._v("invoiceFor")]),a._v(" creará una factura de Stripe la cual reintentará intentos de facturación fallidos. Si no quieres que las facturas reintenten cargos fallidos, necesitarás cerrarlas usando la API de Stripe después del primer cargo fallido.")])]),a._v(" "),s("p",[s("a",{attrs:{name:"refunding-charges"}})]),a._v(" "),s("h3",{attrs:{id:"reembolsando-cargos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reembolsando-cargos"}},[a._v("#")]),a._v(" Reembolsando cargos")]),a._v(" "),s("p",[a._v("Si necesitas reembolsar un cargo de Stripe, puedes usar el método "),s("code",[a._v("refund")]),a._v(". Este método acepta el ID del Intento de Pago de Stripe como su primer argumento:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$payment")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("charge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("refund")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$payment")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"invoices"}})]),a._v(" "),s("h2",{attrs:{id:"facturas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#facturas"}},[a._v("#")]),a._v(" Facturas")]),a._v(" "),s("p",[a._v("Puedes obtener fácilmente un arreglo de facturas de modelo billable usando el método "),s("code",[a._v("invoices")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoices")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("invoices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Include pending invoices in the results...")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoices")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("invoicesIncludingPending")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[a._v("Al momento de listar las facturas para el cliente, puedes usar los métodos helper de factura para mostrar la información de factura relevante. Por ejemplo, puedes querer listar todas las facturas en una tabla, permitiendo que el usuario descargue fácilmente algunas de ellas:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("table"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    @"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("foreach")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoices")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("as")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("tr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("td"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoice")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("toFormattedDateString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("td"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("td"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoice")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("total")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("td"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("td"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("a href"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[a._v('"/user/invoice/{{ '),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoice")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("id")])]),a._v(' }}"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("Download"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("td"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("tr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    @"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("endforeach")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("table"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"generating-invoice-pdfs"}})]),a._v(" "),s("h3",{attrs:{id:"generando-pdfs-de-facturas"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#generando-pdfs-de-facturas"}},[a._v("#")]),a._v(" Generando PDFs de facturas")]),a._v(" "),s("p",[a._v("Dentro de una ruta o controlador, usa el método "),s("code",[a._v("downloadInvoice")]),a._v(" para generar una descarga en PDF de la factura. Este método generará automáticamente la respuesta HTTP apropiada para enviar la descarga al navegador:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nRoute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'user/invoice/{invoice}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Request "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoiceId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("user")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("downloadInvoice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$invoiceId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'vendor'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'Your Company'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'product'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'Your Product'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),s("p",[s("a",{attrs:{name:"strong-customer-authentication"}})]),a._v(" "),s("h2",{attrs:{id:"autenticacion-reforzada-de-cliente"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#autenticacion-reforzada-de-cliente"}},[a._v("#")]),a._v(" Autenticación reforzada de cliente")]),a._v(" "),s("p",[a._v("Si tu empresa se encuentra en Europa necesitarás cumplir con las regulaciones de autenticación reforzada de clientes (SCA). Estas regulaciones fueron impuestas en Septiembre de 2019 por la Unión Europea para prevenir el fraude. Afortunadamente, Stripe y Cashier están preparados para construir aplicaciones que cumplen con SCA.")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v("Antes de empezar, revisa "),s("a",{attrs:{href:"https://stripe.com/en-be/guides/strong-customer-authentication",target:"_blank",rel:"noopener noreferrer"}},[a._v("la guía de Stripe sobre PSD2 y SCA"),s("OutboundLink")],1),a._v(" así como su "),s("a",{attrs:{href:"https://stripe.com/docs/strong-customer-authentication",target:"_blank",rel:"noopener noreferrer"}},[a._v("documentación sobre la nueva guía de API SCA"),s("OutboundLink")],1),a._v(".")])]),a._v(" "),s("p",[s("a",{attrs:{name:"payments-requiring-additional-confirmation"}})]),a._v(" "),s("h3",{attrs:{id:"pagos-que-requieren-confirmacion-adicional"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pagos-que-requieren-confirmacion-adicional"}},[a._v("#")]),a._v(" Pagos que requieren confirmación adicional")]),a._v(" "),s("p",[a._v("Las regulaciones SCA frecuentemente requieren verificación extra con el propósito de confirmar y procesar un pago. Cuando esto pasa, Cashier arrojará una excepción "),s("code",[a._v("IncompletePayment")]),a._v(" que te informa que esta verificación extra es necesaria. Después de capturar esta excepción, tienes dos opciones de cómo proceder.")]),a._v(" "),s("p",[a._v("Primero, podrías redirigir tu cliente a la página dedicada para confirmación de pago que viene incluida con Cashier. Esta página ya tiene una ruta asociada que es registrada por medio del proveedor de servicio de Cashier. Así, puedes capturar la excepción "),s("code",[a._v("IncompletePayment")]),a._v(" y redirigir a la página de confirmación de pago:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Laravel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Exceptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("IncompletePayment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("newSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$planId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$paymentMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("IncompletePayment "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$exception")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("redirect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'cashier.payment'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$exception")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("payment")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'redirect'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'home'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v('En la página de confirmación de pago, el cliente será informado para que introduzca su información de tarjeta de crédito nuevamente y ejecute algunas acciones adicionales requeridas por Stripe, tales como la confirmación "3D Secure" (Seguridad 3D). Después de confirmar su pago, el usuario será redirigido a la URL proporcionada en el parámetro '),s("code",[a._v("redirect")]),a._v(" especificado anteriormente.")]),a._v(" "),s("p",[a._v("Alternativamente, podrías permitir que Stripe maneje la confirmación de pago por ti. En este caso, en lugar de redirigir a la página de confirmación de pago, puedes "),s("a",{attrs:{href:"https://dashboard.stripe.com/account/billing/automatic",target:"_blank",rel:"noopener noreferrer"}},[a._v("configurar el envío de correos de facturación automático de Stripe"),s("OutboundLink")],1),a._v(" en tu panel de control de Stripe. Sin embargo, si una excepción "),s("code",[a._v("IncompletePayment")]),a._v(" es capturada, aún deberías informar al usuario que ellos recibirán un correo con instrucciones de confirmación de pago adicional.")]),a._v(" "),s("p",[a._v("Las excepciones de pago incompletas pueden ser arrojadas por los métodos siguientes: "),s("code",[a._v("charge")]),a._v(", "),s("code",[a._v("invoiceFor")]),a._v(" e "),s("code",[a._v("invoice")]),a._v(" en el usuario "),s("code",[a._v("Billable")]),a._v(". Al momento de manejar las suscripciones, el método "),s("code",[a._v("create")]),a._v(" del "),s("code",[a._v("SubscriptionBuilder")]),a._v(", y los métodos "),s("code",[a._v("incrementAndInvoice")]),a._v(" y "),s("code",[a._v("swapAndInvoice")]),a._v(" en el modelo "),s("code",[a._v("Subscription")]),a._v(" pueden arrojar excepciones.")]),a._v(" "),s("h4",{attrs:{id:"estado-de-deuda-incompleta-y-vencida"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#estado-de-deuda-incompleta-y-vencida"}},[a._v("#")]),a._v(" Estado de deuda incompleta y vencida")]),a._v(" "),s("p",[a._v("Cuando un pago necesita confirmación adicional, la suscripción permanecerá en un estado "),s("code",[a._v("incomplete")]),a._v(" o "),s("code",[a._v("past_due")]),a._v(" como lo indica su columna de base de datos "),s("code",[a._v("stripe_status")]),a._v(". Cashier activará automáticamente la suscripción del cliente por medio de un webhook tan pronto como la confirmación de pago se complete.")]),a._v(" "),s("p",[a._v("Para más información sobre los estados "),s("code",[a._v("incomplete")]),a._v(" e "),s("code",[a._v("past_due")]),a._v(", por favor revisa "),s("a",{attrs:{href:"#incomplete-and-past-due-status"}},[a._v("nuestra documentación adicional")]),a._v(".")]),a._v(" "),s("p",[s("a",{attrs:{name:"off-session-payment-notifications"}})]),a._v(" "),s("h3",{attrs:{id:"notificaciones-de-pago-de-fuera-de-sesion"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#notificaciones-de-pago-de-fuera-de-sesion"}},[a._v("#")]),a._v(" Notificaciones de pago de fuera-de-sesión")]),a._v(" "),s("p",[a._v("Debido a que las regulaciones SCA requieren que los clientes verifiquen ocasionalmente sus detalles de pago aun cuando su suscripción esté activa, Cashier puede enviar una notificación de pago al cliente al momento que sea requerida la confirmación de pago fuera-de-sesión. Por ejemplo, esto puede ocurrir cuando una suscripción se está renovando. La notificación de pago de Cashier puede ser activada al establecer la variable de entorno "),s("code",[a._v("CASHIER_PAYMENT_NOTIFICATION")]),a._v(" a una clase de notificación. De forma predeterminada, esta notificación es desactivada. Ciertamente, Cashier incluye una clase de notificación que puedes usar para este propósito, pero eres libre de proporcionar tu propia clase de notificación si lo deseas:")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("CASHIER_PAYMENT_NOTIFICATION")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("Laravel\\"),s("span",{pre:!0,attrs:{class:"token package"}},[a._v("Cashier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Notifications"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ConfirmPayment")]),a._v("\n")])])]),s("p",[a._v("Para asegurar que las notificaciones de confirmación de pago fuera-de-sesión sean entregadas, verifica que "),s("a",{attrs:{href:"#handling-stripe-webhooks"}},[a._v("los webhooks de Stripe estén configurados")]),a._v(" para tu aplicación y el webhook "),s("code",[a._v("invoice.payment_action_required")]),a._v(" esté habilitado en tu panel de control de Stripe. Además, tu modelo "),s("code",[a._v("Billable")]),a._v(" también debería usar el trait "),s("code",[a._v("Illuminate\\Notifications\\Notifiable")]),a._v(" de Laravel.")]),a._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),s("p",[a._v('Las notificaciones serán enviadas aún cuando los clientes estén haciendo manualmente un pago que requiera confirmación adicional. Desafortunadamente, no hay manera que Stripe conozca si el pago fue hecho manualmente o "fuera-de-sesión". Por otra parte, un cliente simplemente verá un mensaje de "Pago Exitoso" si visita la página de pago después que haya confirmación de su pago. El cliente no tiene permitido que accidentalmente confirme el mismo pago dos veces e incurra en un segundo cargo accidental.')])]),a._v(" "),s("p",[s("a",{attrs:{name:"stripe-sdk"}})]),a._v(" "),s("h2",{attrs:{id:"sdk-de-stripe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sdk-de-stripe"}},[a._v("#")]),a._v(" SDK de Stripe")]),a._v(" "),s("p",[a._v("Muchos de los objetos de Cashier son envoltorios de objetos SDK de Stripe. Si deseas interactuar con los objetos de Stripe directamente, puedes invocarlos convenientemente usando el método "),s("code",[a._v("asStripe")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-php extra-class"},[s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeSubscription")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("asStripeSubscription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$stripeSubscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$subscription")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("stripe_id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'application_fee_percent'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);