(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{378:function(a,s,t){"use strict";t.r(s);var e=t(42),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("div",{pre:!0},[t("h1",{pre:!0,attrs:{id:"colas-de-trabajos"}},[t("a",{pre:!0,attrs:{class:"header-anchor",href:"#colas-de-trabajos"}},[a._v("#")]),a._v(" Colas De Trabajos")]),a._v(" "),t("ul",[t("li",[t("a",{pre:!0,attrs:{href:"#introduction"}},[a._v("Introducción")]),a._v(" "),t("ul",[t("li",[t("a",{pre:!0,attrs:{href:"#connections-vs-queues"}},[a._v("Conexiones vs. colas")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#driver-prerequisites"}},[a._v("Notas y requisitos previos del driver")])])])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#creating-jobs"}},[a._v("Creación de trabajos")]),a._v(" "),t("ul",[t("li",[t("a",{pre:!0,attrs:{href:"#generating-job-classes"}},[a._v("Generación de clases de trabajos")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#class-structure"}},[a._v("Estructura de clases")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#job-middleware"}},[a._v("Middleware job")])])])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#dispatching-jobs"}},[a._v("Despachar trabajos")]),a._v(" "),t("ul",[t("li",[t("a",{pre:!0,attrs:{href:"#delayed-dispatching"}},[a._v("Despacho postergado")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#synchronous-dispatching"}},[a._v("Despacho sincrónico")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#job-chaining"}},[a._v("Encadenamiento de trabajos")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#customizing-the-queue-and-connection"}},[a._v("Personalizar la cola y conexión")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#max-job-attempts-and-timeout"}},[a._v("Especificar intentos máximos de trabajos / valores de timeout")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#rate-limiting"}},[a._v("Límites de rango")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#error-handling"}},[a._v("Manejo de errores")])])])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#queueing-closures"}},[a._v("Closures de colas")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#running-the-queue-worker"}},[a._v("Ejecutar el worker de cola")]),a._v(" "),t("ul",[t("li",[t("a",{pre:!0,attrs:{href:"#queue-priorities"}},[a._v("Prioridades en cola")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#queue-workers-and-deployment"}},[a._v("Workers de cola y despliegue")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#job-expirations-and-timeouts"}},[a._v("Expiraciones de trabajo y tiempos de espera")])])])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#supervisor-configuration"}},[a._v("Configuración de Supervisor")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#dealing-with-failed-jobs"}},[a._v("Manejo de trabajos fallidos")]),a._v(" "),t("ul",[t("li",[t("a",{pre:!0,attrs:{href:"#cleaning-up-after-failed-jobs"}},[a._v("Remediando trabajos fallidos")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#failed-job-events"}},[a._v("Eventos de trabajos fallidos")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#retrying-failed-jobs"}},[a._v("Reintentando trabajos fallidos")])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#ignoring-missing-models"}},[a._v("Ignorando modelos faltantes")])])])]),a._v(" "),t("li",[t("a",{pre:!0,attrs:{href:"#job-events"}},[a._v("Eventos de trabajo")])])]),a._v(" "),t("p",[t("a",{pre:!0,attrs:{name:"introduction"}})]),a._v(" "),t("h2",{pre:!0,attrs:{id:"introduccion"}},[t("a",{pre:!0,attrs:{class:"header-anchor",href:"#introduccion"}},[a._v("#")]),a._v(" Introducción")]),a._v(" "),t("div",{pre:!0,attrs:{class:"custom-block tip"}},[t("p",{pre:!0,attrs:{class:"custom-block-title"}},[a._v("TIP")]),a._v(" "),t("p",[a._v("Laravel ahora ofrece Horizon, un hermoso tablero y sistema de configuración para las colas motorizadas por Redis. Entra en "),t("RouterLink",{pre:!0,attrs:{to:"/horizon.html"}},[a._v("Horizon documentation")]),a._v(" para más información.")],1)])]),t("p",[a._v("Las colas de Laravel brindan una API unificada a través de una variedad de backends de cola diferentes como Beanstalk, Amazon SQS, Redis, o incluso una base de datos relacional. Las colas permiten diferir el procesamiento de una tarea que consume tiempo, como enviar un correo electrónico, para un momento posterior. Diferir estas tareas acelera drásticamente las solicitudes web en tu aplicación.")]),a._v(" "),t("p",[a._v("La configuración de cola está almacenada en "),t("code",[a._v("config/queue.php")]),a._v(". En este archivo encontrarás configuraciones de conexión para cada driver de cola incluido en el framework, que comprende una base de datos, "),t("a",{attrs:{href:"https://beanstalkd.github.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Beanstalkd"),t("OutboundLink")],1),a._v(", "),t("a",{attrs:{href:"https://aws.amazon.com/sqs/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Amazon SQS"),t("OutboundLink")],1),a._v(", "),t("a",{attrs:{href:"https://redis.io",target:"_blank",rel:"noopener noreferrer"}},[a._v("Redis"),t("OutboundLink")],1),a._v(", y un controlador sincrónico que ejecutará trabajos inmediatamente (para uso local). Un driver de cola "),t("code",[a._v("null")]),a._v(" también está incluido, que descarta los trabajos completados de la cola.")]),a._v(" "),t("p",[t("a",{attrs:{name:"connections-vs-queues"}})]),a._v(" "),t("h3",{attrs:{id:"conexiones-vs-colas"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conexiones-vs-colas"}},[a._v("#")]),a._v(" Conexiones vs. colas")]),a._v(" "),t("p",[a._v('Antes de empezar con las colas de Laravel, es importante entender la distinción entre "conexiones" y "colas". En tu archivo de configuración '),t("code",[a._v("config/queue.php")]),a._v(", hay una opción de configuración "),t("code",[a._v("connections")]),a._v('. Esta opción define una conexión particular a un servicio de backend como Amazon SQS, Beanstalk o Redis. Sin embargo, cualquier conexión de cola dada puede tener múltiples "colas" las cuales pueden considerarse como diferentes pilas de trabajos en espera.')]),a._v(" "),t("p",[a._v("Ten en cuenta que cada ejemplo de configuración de conexión en el archivo de configuración "),t("code",[a._v("queue")]),a._v(" contiene un atributo "),t("code",[a._v("queue")]),a._v(". Ésta es la cola por defecto a la cual los trabajos serán despachados cuando son enviados a una conexión dada. En otras palabras, si despachas un trabajo sin definir explícitamente a cuál cola debe ser despachado, el trabajo será colocado en la cola definida en el atributo "),t("code",[a._v("queue")]),a._v(" de la configuración de conexión:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// This job is sent to the default queue...")]),a._v("\nJob"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// This job is sent to the "emails" queue...')]),a._v("\nJob"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'emails'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("Algunas aplicaciones quizá no necesiten nunca insertar trabajos en múltiples colas, prefiriendo en su lugar tener una cola simple. Sin embargo, empujar trabajos a múltiples colas puede ser especialmente útil para aplicaciones que deseen priorizar o segmentar el procesamiento de sus trabajos, puesto que el worker de cola de Laravel permite especificar cuáles colas deben ser procesadas de acuerdo a su prioridad. Por ejemplo, si se insertan trabajos a una cola "),t("code",[a._v("high")]),a._v(", se puede ejecutar un worker que les dé mayor prioridad de procesamiento:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("queue"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("high"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"driver-prerequisites"}})]),a._v(" "),t("h3",{attrs:{id:"notas-y-requisitos-previos-del-driver"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#notas-y-requisitos-previos-del-driver"}},[a._v("#")]),a._v(" Notas y requisitos previos del driver")]),a._v(" "),t("h4",{attrs:{id:"base-de-datos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#base-de-datos"}},[a._v("#")]),a._v(" Base de datos")]),a._v(" "),t("p",[a._v("Para utilizar el driver de cola "),t("code",[a._v("database")]),a._v(", necesitarás una tabla de base de datos para mantener los trabajos. Para generar una migración que cree esta tabla, ejecuta el comando Artisan "),t("code",[a._v("queue:table")]),a._v(". Una vez creada la migración, puedes migrar la base de datos mediante el comando "),t("code",[a._v("migrate")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("table\n\nphp artisan migrate\n")])])]),t("h4",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[a._v("#")]),a._v(" Redis")]),a._v(" "),t("p",[a._v("Para usar el controlador de cola "),t("code",[a._v("redis")]),a._v(", debes configurar una conexión a una base de datos Redis en tu archivo de configuración "),t("code",[a._v("config/database.php")]),a._v(".")]),a._v(" "),t("p",[t("strong",[a._v("Redis Cluster")])]),a._v(" "),t("p",[a._v("Si tu conexión de cola Redis usa un Redis Cluster, tus nombres de cola deben contener un "),t("a",{attrs:{href:"https://redis.io/topics/cluster-spec#keys-hash-tags",target:"_blank",rel:"noopener noreferrer"}},[a._v("key hash tag"),t("OutboundLink")],1),a._v(". Esto es requerido para asegurar que todas las llaves Redis para una determinada cola sean colocadas en el mismo hash slot:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'redis'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'driver'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'redis'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'connection'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'queue'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'{default}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'retry_after'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])])]),t("p",[t("strong",[a._v("Bloqueo")])]),a._v(" "),t("p",[a._v("Al usar la cola Redis, se puede usar la opción de configuración "),t("code",[a._v("block_for")]),a._v(" para especificar por cuánto tiempo debería esperar el controlador para que un trabajo esté disponible antes de repetirse a través del bucle del worker y volver a consultar la base de datos Redis.")]),a._v(" "),t("p",[a._v("Ajustar este valor en la carga de cola puede ser más eficiente que consultar continuamente la base de datos Redis buscando nuevos trabajos. Por ejemplo, puedes establecer el valor en "),t("code",[a._v("5")]),a._v(" para indicar que el controlador debe bloquearse por cinco segundos mientras espera a que un trabajo esté disponible:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'redis'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'driver'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'redis'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'connection'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'queue'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'default'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'retry_after'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'block_for'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n")])])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("Establecer "),t("code",[a._v("block_for")]),a._v(" a "),t("code",[a._v("0")]),a._v(" causará que los trabajadores de una cola se bloqueen de forma indefinida hasta que una tarea esté disponible. Esto también evitará que señales como "),t("code",[a._v("SIGTERM")]),a._v(" sean manejadas hasta que la siguiente tarea sea procesada.")])]),a._v(" "),t("h4",{attrs:{id:"requisitos-previos-para-otros-controladores"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#requisitos-previos-para-otros-controladores"}},[a._v("#")]),a._v(" Requisitos previos para otros controladores")]),a._v(" "),t("p",[a._v("Las siguientes dependencias son necesarias para sus controladores respectivos:")]),a._v(" "),t("ul",[t("li",[a._v("Amazon SQS: "),t("code",[a._v("aws/aws-sdk-php ~3.0")])]),a._v(" "),t("li",[a._v("Beanstalkd: "),t("code",[a._v("pda/pheanstalk ~4.0")])]),a._v(" "),t("li",[a._v("Redis: "),t("code",[a._v("predis/predis ~1.0")]),a._v(" o la extensión de PHP phpredis")])]),a._v(" "),t("p",[t("a",{attrs:{name:"creating-jobs"}})]),a._v(" "),t("h2",{attrs:{id:"creacion-de-trabajos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#creacion-de-trabajos"}},[a._v("#")]),a._v(" Creación de trabajos")]),a._v(" "),t("p",[t("a",{attrs:{name:"generating-job-classes"}})]),a._v(" "),t("h3",{attrs:{id:"generacion-de-clases-de-trabajos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#generacion-de-clases-de-trabajos"}},[a._v("#")]),a._v(" Generación de clases de trabajos")]),a._v(" "),t("p",[a._v("Por defecto, todos los trabajos que se pueden poner en cola para la aplicación son almacenados en el directorio "),t("code",[a._v("app/Jobs")]),a._v(". Si el directorio "),t("code",[a._v("app/Jobs")]),a._v(" no existe, será creado cuando se ejecute el comando Artisan "),t("code",[a._v("make:job")]),a._v(". Puedes generar un nuevo trabajo en cola utilizando la CLI Artisan:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan make"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("job ProcessPodcast\n")])])]),t("p",[a._v("La clase generada implementará la interfaz "),t("code",[a._v("Illuminate\\Contracts\\Queue\\ShouldQueue")]),a._v(", indicando a Laravel que el trabajo debe ser insertado a la cola de forma asíncrona.")]),a._v(" "),t("p",[t("a",{attrs:{name:"class-structure"}})]),a._v(" "),t("h3",{attrs:{id:"estructura-de-clases"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#estructura-de-clases"}},[a._v("#")]),a._v(" Estructura de clases")]),a._v(" "),t("p",[a._v("Las clases de trabajo son muy sencillas, normalmente contienen  un único método "),t("code",[a._v("handle")]),a._v(" que se llama cuando la cola procesa el trabajo. Para empezar, demos un vistazo a una clase de trabajo de ejemplo. En este ejemplo, vamos a pretender que administramos un servicio de publicación de podcasts y necesitamos procesar los archivos de podcast cargados antes de que se publiquen:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("AudioProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queueable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Contracts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ShouldQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Foundation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Dispatchable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("InteractsWithQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("SerializesModels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessPodcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Dispatchable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" InteractsWithQueue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Queueable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" SerializesModels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Create a new job instance.\n    *\n    * @param  Podcast  $podcast\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("__construct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Podcast "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token property"}},[a._v("podcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Execute the job.\n    *\n    * @param  AudioProcessor  $processor\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AudioProcessor "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$processor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Process uploaded podcast...")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[a._v("En este ejemplo, ten en cuenta que hemos podido pasar un "),t("RouterLink",{attrs:{to:"/eloquent.html"}},[a._v("modelo Eloquent")]),a._v(" directamente hacia el constructor del trabajo en cola. Debido al trait "),t("code",[a._v("SerializesModels")]),a._v(" que el trabajo está usando, los modelos Eloquent y sus relaciones cargadas serán serializados y deserializados correctamente cuando el trabajo se esté procesando. Si tu trabajo en cola acepta un modelo Eloquent en su constructor, sólo el identificador para el modelo será serializado en la cola. Cuando el trabajo se maneja realmente, el sistema de cola volverá a recuperar automáticamente la instancia del modelo completo y sus relaciones cargadas desde la base de datos. Todo es totalmente transparente a tu aplicación y previene inconvenientes que pueden surgir de serializar instancias de modelos Eloquent completas.")],1),a._v(" "),t("p",[a._v("El método "),t("code",[a._v("handle")]),a._v(" es llamado cuando el trabajo es procesado por la cola. Ten en cuenta que podemos declarar el tipo de dependencias en el método "),t("code",[a._v("handle")]),a._v(" del trabajo. El "),t("RouterLink",{attrs:{to:"/container.html"}},[a._v("contenedor de servicios")]),a._v(" de Laravel automáticamente inyecta estas dependencias.")],1),a._v(" "),t("p",[a._v("Si te gustaría tomar control sobre cómo el contenedor inyecta dependencias en el método "),t("code",[a._v("handle")]),a._v(", puedes usar el método "),t("code",[a._v("bindMethod")]),a._v(" del contenedor. El método "),t("code",[a._v("bindMethod")]),a._v(" acepta una función de retorno (callback) que recibe el trabajo y el contenedor. Dentro del callback, eres libre de invocar al método "),t("code",[a._v("handle")]),a._v(" de la forma que desees. Típicamente, deberías llamar a este método desde un "),t("RouterLink",{attrs:{to:"/providers.html"}},[a._v("proveedor de servicios")]),a._v(":")],1),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ProcessPodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token property"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("bindMethod")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'@handle'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AudioProcessor"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("Los datos binarios, como los contenidos de imagen, deben ser pasados a través de la función "),t("code",[a._v("base64_encode")]),a._v(" antes de ser pasados a un trabajo en cola. De otra forma, el trabajo podría no serializarse correctamente a JSON cuando es colocado en la cola.")])]),a._v(" "),t("h4",{attrs:{id:"manejando-relaciones"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manejando-relaciones"}},[a._v("#")]),a._v(" Manejando relaciones")]),a._v(" "),t("p",[a._v("Dado que las relaciones cargadas también son serializadas, la cadena serializada de la tarea puede volverse algo larga. Para evitar que las relaciones sean serializadas, puedes llamar al método "),t("code",[a._v("withoutRelations")]),a._v(" en el modelo al momento de establecer el valor de una propiedad. Este método retornará una instancia del modelo sin cargar ninguna relación:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n* Create a new job instance.\n*\n* @param  \\App\\Podcast  $podcast\n* @return void\n*/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("__construct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Podcast "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token property"}},[a._v("podcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("withoutRelations")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"job-middleware"}})]),a._v(" "),t("h3",{attrs:{id:"middleware-job"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#middleware-job"}},[a._v("#")]),a._v(" Middleware job")]),a._v(" "),t("p",[a._v("El middleware job te permite envolver lógica personalizada alrededor de la ejecución de trabajos en cola, reduciendo el boilerplate en los mismos. Por ejemplo, considera el siguiente método "),t("code",[a._v("handle")]),a._v(" el cual depende de las características de limitación de Redis para permitir que se procese sólo un trabajo cada cinco segundos:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n* Execute the job.\n*\n* @return void\n*/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("throttle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'key'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("block")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("allow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("every")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("info")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'Lock obtained...'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Handle job...")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Could not obtain lock...")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("Aunque este código es válido, la estructura del método "),t("code",[a._v("handle")]),a._v(" se vuelve ruidosa dado que está llena de lógica de limitación de Redis. Además, esta lógica de limitación debe ser duplicada para cualquier otro trabajo que queramos limitar.")]),a._v(" "),t("p",[a._v("En lugar de limitar en el método handle, podemos definir un middleware job que maneje el límite. Laravel no tiene una ubicación por defecto para el middleware job, así que eres bienvenido a colocar el middleware job en cualquier sitio de tu aplicación. En este ejemplo, colocaremos el middleware en un directorio "),t("code",[a._v("app/Jobs/Middleware")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Middleware")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Support"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Facades"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Redis")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RateLimited")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Process the queued job.\n    *\n    * @param  mixed  $job\n    * @param  callable  $next\n    * @return mixed\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("throttle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'key'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("block")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("allow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("every")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Lock obtained...")]),a._v("\n\n                    "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Could not obtain lock...")]),a._v("\n\n                    "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$job")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[a._v("Como puedes ver, al igual que "),t("RouterLink",{attrs:{to:"/middleware.html"}},[a._v("el middleware route")]),a._v(", el middleware job recibe el trabajo siendo procesado y un callback que debe ser invocado para continuar procesando el trabajo.")],1),a._v(" "),t("p",[a._v("Luego de crear el middleware job, este puede ser agregado a una tarea retornándolo desde el método "),t("code",[a._v("middleware")]),a._v(" de la tarea. Este método no existe en tareas creadas con el comando de Artisan "),t("code",[a._v("make:job")]),a._v(", así que necesitarás agregarlo a tu propia definición de clase de la tarea:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Middleware"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("RateLimited")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n* Get the middleware the job should pass through.\n*\n* @return array\n*/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("middleware")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RateLimited")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"dispatching-jobs"}})]),a._v(" "),t("h2",{attrs:{id:"despachar-trabajos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#despachar-trabajos"}},[a._v("#")]),a._v(" Despachar trabajos")]),a._v(" "),t("p",[a._v("Una vez escrita tu clase de trabajo, se puede despachar usando el método "),t("code",[a._v("dispatch")]),a._v(" en el mismo trabajo. Los argumentos pasados a "),t("code",[a._v("dispatch")]),a._v(" serán entregados al constructor del trabajo:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ProcessPodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PodcastController")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Controller")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Store a new podcast.\n    *\n    * @param  Request  $request\n    * @return Response\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("store")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Request "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create podcast...")]),a._v("\n\n        ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[t("a",{attrs:{name:"delayed-dispatching"}})]),a._v(" "),t("h3",{attrs:{id:"despacho-postergado"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#despacho-postergado"}},[a._v("#")]),a._v(" Despacho postergado")]),a._v(" "),t("p",[a._v("Si quieres postergar la ejecución de un trabajo en cola, puedes utilizar el método "),t("code",[a._v("delay")]),a._v(" al despachar un trabajo. Por ejemplo, especifiquemos que un trabajo no debería estar disponible para procesamiento hasta 10 minutos después que haya sido despachado:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ProcessPodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PodcastController")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Controller")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Store a new podcast.\n    *\n    * @param  Request  $request\n    * @return Response\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("store")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Request "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create podcast...")]),a._v("\n\n        ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("delay")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addMinutes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("El servicio de cola Amazon SQS tiene un tiempo máximo de retraso de 15 minutos.")])]),a._v(" "),t("p",[t("a",{attrs:{name:"synchronous-dispatching"}})]),a._v(" "),t("h3",{attrs:{id:"despacho-sincronico"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#despacho-sincronico"}},[a._v("#")]),a._v(" Despacho sincrónico")]),a._v(" "),t("p",[a._v("Si deseas enviar un trabajo inmediatamente (sincrónicamente), puedes usar el método "),t("code",[a._v("dispatchNow")]),a._v(". Al usar este método, el trabajo no se pondrá en cola y se ejecutará inmediatamente dentro del proceso actual:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ProcessPodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PodcastController")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Controller")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Store a new podcast.\n    *\n    * @param  Request  $request\n    * @return Response\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("store")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Request "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create podcast...")]),a._v("\n\n        ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatchNow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[t("a",{attrs:{name:"job-chaining"}})]),a._v(" "),t("h3",{attrs:{id:"encadenamiento-de-trabajos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#encadenamiento-de-trabajos"}},[a._v("#")]),a._v(" Encadenamiento de trabajos")]),a._v(" "),t("p",[a._v("El encadenamiento de trabajos te permite especificar una lista de trabajos en cola que deben ser ejecutados en secuencia después de que el trabajo principal se haya ejecutado correctamente. Si un trabajo en la secuencia falla, el resto no será ejecutado. Para ejecutar una cadena de trabajos en cola, puedes utilizar el método "),t("code",[a._v("withChain")]),a._v(" en cualquier trabajo a enviar:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("withChain")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OptimizePodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ReleasePodcast")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("La eliminación de trabajos mediante el método "),t("code",[a._v("$this->delete()")]),a._v(" no impedirá que se procesen los trabajos encadenados. La cadena sólo dejará de ejecutarse si falla un trabajo en la cadena.")])]),a._v(" "),t("h4",{attrs:{id:"cola-y-conexion-en-cadena"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cola-y-conexion-en-cadena"}},[a._v("#")]),a._v(" Cola y conexión en cadena")]),a._v(" "),t("p",[a._v("Si quieres especificar la cola y conexión por defecto que debe ser usada para los trabajos encadenados, se puede usar los métodos  "),t("code",[a._v("allOnConnection")]),a._v(" and "),t("code",[a._v("allOnQueue")]),a._v(". Estos métodos especifican la conexión y nombre de cola que debe ser usado a menos que el trabajo en cola sea asignado explícitamente a una diferente conexión / cola:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("withChain")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OptimizePodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ReleasePodcast")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("allOnConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'redis'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("allOnQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'podcasts'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"customizing-the-queue-and-connection"}})]),a._v(" "),t("h3",{attrs:{id:"personalizar-la-cola-y-la-conexion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#personalizar-la-cola-y-la-conexion"}},[a._v("#")]),a._v(" Personalizar La Cola Y La Conexión")]),a._v(" "),t("h4",{attrs:{id:"despachar-a-una-cola-especifica"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#despachar-a-una-cola-especifica"}},[a._v("#")]),a._v(" Despachar a una cola específica")]),a._v(" "),t("p",[a._v('Al insertar trabajos en diferentes colas, puedes "categorizar" los trabajos en cola e incluso priorizar cuántos workers son asignados a las distintas colas. Sin embargo, es preciso resaltar que esto no inserta trabajos en diferentes "conexiones" de cola definidas en tu archivo de configuración de colas, sino en colas específicas dentro de una sola conexión. Para especificar la cola, usa el método '),t("code",[a._v("onQueue")]),a._v(" al despachar un trabajo:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ProcessPodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PodcastController")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Controller")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Store a new podcast.\n    *\n    * @param  Request  $request\n    * @return Response\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("store")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Request "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create podcast...")]),a._v("\n\n        ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'processing'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("h4",{attrs:{id:"despachar-a-una-conexion-especifica"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#despachar-a-una-conexion-especifica"}},[a._v("#")]),a._v(" Despachar a una conexión específica")]),a._v(" "),t("p",[a._v("Si estás trabajando con múltiples conexiones de cola, puedes especificar en cuál conexión deseas insertar un trabajo. Para especificar la conexión, utiliza el método "),t("code",[a._v("onConnection")]),a._v(" al despachar el trabajo:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controllers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Controller")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ProcessPodcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PodcastController")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Controller")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Store a new podcast.\n    *\n    * @param  Request  $request\n    * @return Response\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("store")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Request "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$request")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create podcast...")]),a._v("\n\n        ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'sqs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[a._v("Puedes encadenar los métodos "),t("code",[a._v("onConnection")]),a._v(" y "),t("code",[a._v("onQueue")]),a._v(" para especificar la conexión y cola de un trabajo:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("ProcessPodcast"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n              "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onConnection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'sqs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n              "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'processing'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("Alternativamente, puedes especificar "),t("code",[a._v("connection")]),a._v(" como una propiedad en la clase del trabajo:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessPodcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n        * The queue connection that should handle the job.\n        *\n        * @var string\n        */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$connection")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'sqs'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[t("a",{attrs:{name:"max-job-attempts-and-timeout"}})]),a._v(" "),t("h3",{attrs:{id:"especificar-intentos-maximos-de-un-trabajo-y-valores-de-tiempos-de-espera-timeout"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#especificar-intentos-maximos-de-un-trabajo-y-valores-de-tiempos-de-espera-timeout"}},[a._v("#")]),a._v(" Especificar intentos máximos de un trabajo y valores de tiempos de espera (timeout)")]),a._v(" "),t("h4",{attrs:{id:"numero-de-intentos-maximo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#numero-de-intentos-maximo"}},[a._v("#")]),a._v(" Número de intentos máximo")]),a._v(" "),t("p",[a._v("Una forma de especificar el número máximo de veces que un trabajo puede ser intentado es mediante la opción "),t("code",[a._v("--tries")]),a._v(" en la línea de comandos Artisan:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("tries"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n")])])]),t("p",[a._v("Sin embargo, puedes tomar un camino más granular definiendo el número máximo de intentos dentro de la propia clase de trabajo. Si el número máximo de intentos está especificado en el trabajo, precederá sobre el valor provisto en la línea de comandos:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessPodcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * The number of times the job may be attempted.\n    *\n    * @var int\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$tries")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[t("a",{attrs:{name:"time-based-attempts"}})]),a._v(" "),t("h4",{attrs:{id:"intentos-basados-en-tiempo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#intentos-basados-en-tiempo"}},[a._v("#")]),a._v(" Intentos basados en tiempo")]),a._v(" "),t("p",[a._v("Como alternativa a definir cuántas veces un trabajo puede ser intentado antes de que falle, puedes definir en qué momento el trabajo debería pasar a tiempo de espera (timeout). Esto permite intentar un trabajo cualquier cantidad de veces dentro de un marco de tiempo dado. Para definir el momento en el que un trabajo debería pasar a timeout, agrega un método "),t("code",[a._v("retryUntil")]),a._v(" en tu clase de trabajos:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n* Determine the time at which the job should timeout.\n*\n* @return \\DateTime\n*/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("retryUntil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("now")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addSeconds")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("También puedes definir un método "),t("code",[a._v("retryUntil")]),a._v(" en los listeners de eventos en cola.")])]),a._v(" "),t("h4",{attrs:{id:"tiempo-de-espera-timeout"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tiempo-de-espera-timeout"}},[a._v("#")]),a._v(" Tiempo de espera (timeout)")]),a._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("La característica "),t("code",[a._v("timeout")]),a._v(" está optimizada para PHP 7.1+ y la extensión "),t("code",[a._v("pcntl")]),a._v(".")])]),a._v(" "),t("p",[a._v("De igual modo, el número máximo de segundos para ejecutar un trabajo pueden ser especificados usando la opción "),t("code",[a._v("--timeout")]),a._v(" en la línea de comandos Artisan:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v("\n")])])]),t("p",[a._v("Sin embargo, es posible querer definir el número máximo de segundos para ejecutar un trabajo dentro de su clase. Si el timeout está especificado en el trabajo, prevalecerá sobre cualquier otro timeout especificado en la línea de comandos:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessPodcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * The number of seconds the job can run before timing out.\n    *\n    * @var int\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$timeout")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("120")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[t("a",{attrs:{name:"rate-limiting"}})]),a._v(" "),t("h3",{attrs:{id:"limite-de-rango"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#limite-de-rango"}},[a._v("#")]),a._v(" Límite de rango")]),a._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("Esta característica requiere que tu aplicación pueda interactuar con un "),t("RouterLink",{attrs:{to:"/redis.html"}},[a._v("Redis server")]),a._v(".")],1)]),a._v(" "),t("p",[a._v("Si tu aplicación interactúa con Redis, puedes regular los trabajos en cola por tiempo o concurrencia. Esta característica puede ser de ayuda cuando los trabajos en cola interactúan con APIs que también poseen límite de frecuencia.")]),a._v(" "),t("p",[a._v("Por ejemplo, usando el método "),t("code",[a._v("throttle")]),a._v(", puedes regular cierto tipo de trabajo para que se ejecute sólo diez veces por minuto. Si no se puede obtener un bloqueo, normalmente debes liberar el trabajo de vuelta a la cola para que pueda volver a intentarlo más tarde:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("throttle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'key'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("allow")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("every")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Job logic...")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Could not obtain lock...")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("En el ejemplo anterior, "),t("code",[a._v("key")]),a._v(" puede ser cualquier cadena que identifique únicamente el tipo de trabajo que se quiere limitar. Por ejemplo, puedes desear construir la key basada en el nombre de clase del trabajo y las IDS de los modelos Eloquent en los cuáles opera.")])]),a._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("Liberar un trabajo limitado de vuelta a la cola seguirá incrementando el número total de "),t("code",[a._v("attempts")]),a._v(" del trabajo.")])]),a._v(" "),t("p",[a._v("Alternativamente, puedes especificar el número máximo de workers que pueden procesar simultáneamente un trabajo determinado. Esto puede ser útil cuando un trabajo en cola está modificando un recurso que solo debe ser modificado por un trabajo a la vez. Por ejemplo, utilizando el método "),t("code",[a._v("funnel")]),a._v(", puedes limitar los trabajos de un tipo dado para que solo sean procesados por un worker a la vez:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("Redis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("funnel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'key'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("limit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("then")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Job logic...")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Could not obtain lock...")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("release")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("Al utilizar límite de frecuencias, el número de intentos que el trabajo necesitará para ejecutarse exitosamente puede ser difícil de determinar. Por lo tanto, es útil combinar límite de frecuencias con "),t("a",{attrs:{href:"#time-based-attempts"}},[a._v("intentos basados en el tiempo")]),a._v(".")])]),a._v(" "),t("p",[t("a",{attrs:{name:"error-handling"}})]),a._v(" "),t("h3",{attrs:{id:"manejo-de-errores"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manejo-de-errores"}},[a._v("#")]),a._v(" Manejo de errores")]),a._v(" "),t("p",[a._v("Si una excepción es lanzada mientras el trabajo está siendo procesado, el trabajo será automáticamente liberado a la cola para que pueda ser intentado de nuevo. EL trabajo continuará siendo liberado hasta que haya sido intentado el número de veces máximo permitido por tu aplicación. El número máximo de intentos es definido por la opción "),t("code",[a._v("--tries")]),a._v(" usada en el comando Artisan "),t("code",[a._v("queue:work")]),a._v(". De forma alternativa, el número máximo de intentos puede ser definido en la clase de trabajos en sí. Más información acerca de ejecutar el worker de cola "),t("a",{attrs:{href:"#running-the-queue-worker"}},[a._v("se puede encontrar a continuación")]),a._v(".")]),a._v(" "),t("p",[t("a",{attrs:{name:"queueing-closures"}})]),a._v(" "),t("h2",{attrs:{id:"closures-de-colas"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#closures-de-colas"}},[a._v("#")]),a._v(" Closures de colas")]),a._v(" "),t("p",[a._v("En lugar de enviar una clase de trabajo a la cola, también puedes enviar una Closure. Esto es ideal para tareas rápidas y simples que deben ejecutarse fuera del ciclo de solicitud actual:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" App\\"),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("publish")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("Al enviar Closures a la cola, el contenido del código del Closure está firmado criptográficamente para que no se pueda modificar en tránsito.")]),a._v(" "),t("p",[t("a",{attrs:{name:"running-the-queue-worker"}})]),a._v(" "),t("h2",{attrs:{id:"ejecutar-el-worker-de-cola"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ejecutar-el-worker-de-cola"}},[a._v("#")]),a._v(" Ejecutar el worker de cola")]),a._v(" "),t("p",[a._v("Laravel incluye un worker de cola que procesará trabajos nuevos a medida que éstos son insertados en la cola. Puedes ejecutar el worker usando el comando Artisan "),t("code",[a._v("queue:work")]),a._v(". Ten en cuenta que una vez iniciado "),t("code",[a._v("queue:work")]),a._v(", continuará ejecutándose hasta que sea detenido manualmente o hasta que la terminal sea cerrada:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("Para mantener el proceso "),t("code",[a._v("queue:work")]),a._v(" ejecutándose permanentemente en segundo plano, debes usar un monitor de procesos como "),t("a",{attrs:{href:"#supervisor-configuration"}},[a._v("Supervisor")]),a._v(" para asegurar que el worker de cola no deja de ejecutarse.")])]),a._v(" "),t("p",[a._v("Recuerda, los workers en cola son procesos de larga duración y almacenan el estado de la aplicación iniciada en la memoria. Como resultado, no notarán cambios en la base de código después de que se han iniciado. Por lo tanto, durante el proceso de despliegue, asegúrate de "),t("a",{attrs:{href:"#queue-workers-and-deployment"}},[a._v("reiniciar los workers de cola")]),a._v(". Además, recuerda que cualquier estado estático creado o modificado por tu aplicación no será automáticamente reseteado entre tareas.")]),a._v(" "),t("p",[a._v("Alternativamente, puedes ejecutar el comando "),t("code",[a._v("queue:listen")]),a._v(". Al usar el comando "),t("code",[a._v("queue:listen")]),a._v(", no tienes que reiniciar manualmente el worker cuando quieras recargar tu código actualizado o resetear el estado de la aplicación; sin embargo, este comando no es tan eficiente como "),t("code",[a._v("queue:work")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("listen\n")])])]),t("h4",{attrs:{id:"especificando-la-conexion-y-cola"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#especificando-la-conexion-y-cola"}},[a._v("#")]),a._v(" Especificando la conexión y cola")]),a._v(" "),t("p",[a._v("También puedes especificar qué conexión de cola debe utilizar el worker. El nombre de conexión pasado al comando "),t("code",[a._v("work")]),a._v(" debe corresponder a una de las conexiones definidas en tu archivo de configuración "),t("code",[a._v("config/queue.php")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work redis\n")])])]),t("p",[a._v("Puedes personalizar tu worker de colas más allá al solo procesar colas particulares para una conexión dada. Por ejemplo, si todos tus correos electrónicos son procesados en una cola "),t("code",[a._v("emails")]),a._v(" en tu cola de conexión "),t("code",[a._v("redis")]),a._v(", puedes emitir el siguiente comando para iniciar un worker que solo procesa dicha cola:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work redis "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("queue"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("emails\n")])])]),t("h4",{attrs:{id:"procesar-un-solo-trabajo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#procesar-un-solo-trabajo"}},[a._v("#")]),a._v(" Procesar un sólo trabajo")]),a._v(" "),t("p",[a._v("La opción "),t("code",[a._v("--once")]),a._v(" puede ser usada para indicarle al worker que procese sólo un trabajo de la cola:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("once\n")])])]),t("h4",{attrs:{id:"procesar-todos-los-trabajos-en-cola-y-luego-salir"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#procesar-todos-los-trabajos-en-cola-y-luego-salir"}},[a._v("#")]),a._v(" Procesar todos los trabajos en cola y luego salir")]),a._v(" "),t("p",[a._v("La opción "),t("code",[a._v("--stop-when-empty")]),a._v(" puede ser usada para indicarle al worker procesar todos los trabajos y luego salir elegantemente. Esta opción puede ser útil al trabajar colas de Laravel con un contenedor Docker si deseas desactivar el contenedor cuando la cola esté vacía:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("stop"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("when"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("empty")]),a._v("\n")])])]),t("h4",{attrs:{id:"consideraciones-de-recursos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#consideraciones-de-recursos"}},[a._v("#")]),a._v(" Consideraciones de recursos")]),a._v(" "),t("p",[a._v('Los Daemon de workers de cola no "reinician" el framework antes de procesar cada trabajo. Por lo tanto, debes liberar cualquier recurso pesado luego de que cada trabajo sea completado. Por ejemplo, si estás realizando manipulación de imágenes con la librería GD, debes liberar la memoria cuando se termine con '),t("code",[a._v("imagedestroy")]),a._v(".")]),a._v(" "),t("p",[t("a",{attrs:{name:"queue-priorities"}})]),a._v(" "),t("h3",{attrs:{id:"prioridades-de-cola"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prioridades-de-cola"}},[a._v("#")]),a._v(" Prioridades de cola")]),a._v(" "),t("p",[a._v("A veces puedes desear priorizar cómo se procesan las colas. Por ejemplo, en tu "),t("code",[a._v("config/queue.php")]),a._v(" puedes establecer la "),t("code",[a._v("queue")]),a._v(" predeterminada para tu conexión "),t("code",[a._v("redis")]),a._v(" en "),t("code",[a._v("low")]),a._v(". Sin embargo, ocasionalmente puedes desear insertar un trabajo en una cola de prioridad "),t("code",[a._v("high")]),a._v(" de esta forma:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dispatch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Job")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("onQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[a._v("'high'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("Para iniciar un worker que verifique que todos los trabajos en la cola "),t("code",[a._v("high")]),a._v(" sean procesados antes de continuar con los trabajos en "),t("code",[a._v("low")]),a._v(", pasa una lista de nombres de colas delimitada por comas al comando "),t("code",[a._v("work")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("queue"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("high"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("low\n")])])]),t("p",[t("a",{attrs:{name:"queue-workers-and-deployment"}})]),a._v(" "),t("h3",{attrs:{id:"workers-de-cola-y-despliegue"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#workers-de-cola-y-despliegue"}},[a._v("#")]),a._v(" Workers de Cola y despliegue")]),a._v(" "),t("p",[a._v("Debido a que los workers de cola son procesos de vida útil larga, no detectarán cambios en el código sin ser reiniciados.  Así que la forma más sencilla de poner en producción una aplicación utilizando workers de cola es reiniciando los workers durante el proceso de despliegue. Puedes con elegancia reiniciar todos los workers ejecutando el comando "),t("code",[a._v("queue:restart")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("restart\n")])])]),t("p",[a._v('Este comando indicará a todos los workers de cola que "mueran" luego de terminar el procesamiento de su trabajo actual para que ningún trabajo existente se pierda. Como los workers de cola morirán cuando se ejecute el comando '),t("code",[a._v("queue:restart")]),a._v(", un administrador de procesos debe estar en ejecución, como "),t("a",{attrs:{href:"#supervisor-configuration"}},[a._v("Supervisor")]),a._v(" para reiniciar automáticamente los workers de la cola.")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("La cola utiliza "),t("RouterLink",{attrs:{to:"/cache.html"}},[a._v("caché")]),a._v(" para almacenar señales de reinicio, por lo que debes verificar si un driver de caché está configurado debidamente en tu aplicación antes de utilizar esta característica.")],1)]),a._v(" "),t("p",[t("a",{attrs:{name:"job-expirations-and-timeouts"}})]),a._v(" "),t("h3",{attrs:{id:"expiraciones-de-trabajo-y-tiempos-de-espera"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expiraciones-de-trabajo-y-tiempos-de-espera"}},[a._v("#")]),a._v(" Expiraciones De Trabajo Y Tiempos De Espera")]),a._v(" "),t("h4",{attrs:{id:"expiracion-de-trabajos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#expiracion-de-trabajos"}},[a._v("#")]),a._v(" Expiración de trabajos")]),a._v(" "),t("p",[a._v("En tu archivo de configuración "),t("code",[a._v("config/queue.php")]),a._v(", cada conexión de cola define una opción "),t("code",[a._v("retry_after")]),a._v(". Esta opción especifica cuántos segundos debe esperar la conexión de cola antes de reintentar un trabajo que está siendo procesado. Por ejemplo, si el valor de "),t("code",[a._v("retry_after")]),a._v(" es establecido en "),t("code",[a._v("90")]),a._v(", el trabajo será liberado de nuevo a la cola si se ha estado procesando por 90 segundos sin haber sido eliminado. Generalmente, debes fijar el valor de "),t("code",[a._v("retry_after")]),a._v(" al número máximo de segundos que le toma razonablemente a tus trabajos ser completamente procesados.")]),a._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("La única conexión de cola que no contiene un valor "),t("code",[a._v("retry_after")]),a._v(" es Amazon SQS. SQS reintentará el trabajo basándose en el "),t("a",{attrs:{href:"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/AboutVT.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Default Visibility Timeout"),t("OutboundLink")],1),a._v(" que es administrado dentro de la consola de AWS.")])]),a._v(" "),t("h4",{attrs:{id:"worker-timeouts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worker-timeouts"}},[a._v("#")]),a._v(" Worker timeouts")]),a._v(" "),t("p",[a._v("El comando Artisan "),t("code",[a._v("queue:work")]),a._v(" expone una opción "),t("code",[a._v("--timeout")]),a._v(". "),t("code",[a._v("--timeout")]),a._v(' especifica qué tanto el proceso maestro de cola de Laravel esperará antes de detener un worker de cola hijo que está procesando un trabajo. A veces un proceso de cola hijo puede "congelarse" por varias razones. La opción '),t("code",[a._v("--timeout")]),a._v(" remueve los procesos congelados que han excedido el tiempo límite especificado:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60")]),a._v("\n")])])]),t("p",[a._v("La opción de configuración "),t("code",[a._v("retry_after")]),a._v(" y la opción CLI "),t("code",[a._v("--timeout")]),a._v(" son diferentes, pero trabajan juntas para asegurar que los trabajos no se pierdan y que los trabajos se procesen exitosamente sólo una vez.")]),a._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("El valor "),t("code",[a._v("--timeout")]),a._v(" siempre debe ser al menos unos segundos menor que el valor de configuración "),t("code",[a._v("retry_after")]),a._v(". Esto asegurará que un worker procesando un trabajo determinado siempre sea detenido antes que el trabajo se reintente. Si la opción "),t("code",[a._v("--timeout")]),a._v(" es mayor al valor de configuración "),t("code",[a._v("retry_after")]),a._v(", los trabajos podrían ser procesados dos veces.")])]),a._v(" "),t("h4",{attrs:{id:"duracion-de-descanso-del-worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#duracion-de-descanso-del-worker"}},[a._v("#")]),a._v(" Duración de descanso del worker")]),a._v(" "),t("p",[a._v("Cuando hay trabajos disponibles en cola, el worker seguirá procesando trabajos sin retraso entre ellos. Sin embargo, la opción "),t("code",[a._v("sleep")]),a._v(' determina por cuánto tiempo (en segundos) "dormirá" el worker si no hay nuevos trabajos disponibles. Mientras duerme, el worker no procesará trabajos nuevos - los trabajos serán procesados luego de que el worker despierte.')]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("sleep"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"supervisor-configuration"}})]),a._v(" "),t("h2",{attrs:{id:"configuracion-de-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuracion-de-supervisor"}},[a._v("#")]),a._v(" Configuración De Supervisor")]),a._v(" "),t("h4",{attrs:{id:"instalar-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#instalar-supervisor"}},[a._v("#")]),a._v(" Instalar Supervisor")]),a._v(" "),t("p",[a._v("Supervisor es un monitor de procesos para el sistema operativo Linux y reiniciará automáticamente tu proceso "),t("code",[a._v("queue:work")]),a._v(" si éste falla. Para instalar Supervisor en Ubuntu, se puede usar el siguiente comando:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("sudo apt"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("get install supervisor\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("Si configurar Supervisor por ti mismo suena abrumador, considera usar "),t("a",{attrs:{href:"https://forge.laravel.com",target:"_blank",rel:"noopener noreferrer"}},[a._v("Laravel Forge"),t("OutboundLink")],1),a._v(", el cual instalará y configurará Supervisor automáticamente para tus proyectos en Laravel.")])]),a._v(" "),t("h4",{attrs:{id:"configurar-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configurar-supervisor"}},[a._v("#")]),a._v(" Configurar Supervisor")]),a._v(" "),t("p",[a._v("Los archivos de configuración de Supervisor están almacenados generalmente en el directorio "),t("code",[a._v("/etc/supervisor/conf.d")]),a._v(". Dentro de este directorio, puedes crear cualquier número de archivos de configuración que le instruyan a Supervisor cómo monitorear los procesos.  Por ejemplo, creemos un archivo de configuración "),t("code",[a._v("laravel-worker.conf")]),a._v(" que inicie y monitoree el proceso "),t("code",[a._v("queue:work")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("program"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("worker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\nprocess_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("program_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("s_"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("%")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("process_num"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("02")]),a._v("d\ncommand"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("php "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("home"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("forge"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work sqs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("sleep"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("tries"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\nautostart"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean constant"}},[a._v("true")]),a._v("\nautorestart"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean constant"}},[a._v("true")]),a._v("\nuser"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("forge\nnumprocs"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\nredirect_stderr"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean constant"}},[a._v("true")]),a._v("\nstdout_logfile"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("home"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("forge"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("worker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("log\nstopwaitsecs"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3600")]),a._v("\n")])])]),t("p",[a._v("En este ejemplo, la directiva "),t("code",[a._v("numprocs")]),a._v(" le indicará a Supervisor ejecutar ocho procesos "),t("code",[a._v("queue:work")]),a._v(" y monitorearlos todos, reiniciándolos automáticamente si fallan. Debes cambiar la porción "),t("code",[a._v("queue:work sqs")]),a._v(" de la directiva "),t("code",[a._v("command")]),a._v(" para reflejar la conexión de cola deseada.")]),a._v(" "),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("Debes asegurarte de que el valor de "),t("code",[a._v("stopwaitsecs")]),a._v(" es mayor que el número de segundos consumido por tu tarea de más larga duración. De otra forma, Supervisor podría detener la tarea antes de que se termine de procesar.")])]),a._v(" "),t("h4",{attrs:{id:"iniciar-supervisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iniciar-supervisor"}},[a._v("#")]),a._v(" Iniciar Supervisor")]),a._v(" "),t("p",[a._v("Una vez que el archivo de configuración haya sido creado, puedes actualizar la configuración de Supervisor e iniciar los procesos usando los siguientes comandos:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("sudo supervisorctl reread\n\nsudo supervisorctl update\n\nsudo supervisorctl start laravel"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("worker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),a._v("\n")])])]),t("p",[a._v("Para más información acerca de Supervisor, consulta "),t("a",{attrs:{href:"http://supervisord.org/index.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("la documentación de Supervisor"),t("OutboundLink")],1),a._v(".")]),a._v(" "),t("p",[t("a",{attrs:{name:"dealing-with-failed-jobs"}})]),a._v(" "),t("h2",{attrs:{id:"manejo-de-trabajos-fallidos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manejo-de-trabajos-fallidos"}},[a._v("#")]),a._v(" Manejo de trabajos fallidos")]),a._v(" "),t("p",[a._v("Algunas veces los trabajos en cola fallarán. Esto no es problema, ¡las cosas no siempre salen como esperamos! Laravel incluye una forma conveniente de especificar el número máximo de veces que un trabajo debe ser intentado. Luego que un trabajo haya excedido esta cantidad de intentos, será insertado en la tabla de base de datos "),t("code",[a._v("failed_jobs")]),a._v(". Para crear una migración para la tabla "),t("code",[a._v("failed_jobs")]),a._v(" puedes usar el comando "),t("code",[a._v("queue:failed-table")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("failed"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("table\n\nphp artisan migrate\n")])])]),t("p",[a._v("Entonces, al ejecutar el "),t("a",{attrs:{href:"#running-the-queue-worker"}},[a._v("worker de cola")]),a._v(", debes especificar el número máximo de veces que un trabajo debe intentarse usando la opción "),t("code",[a._v("--tries")]),a._v(" en el comando "),t("code",[a._v("queue:work")]),a._v(". Si no especificas un valor para la opción "),t("code",[a._v("--tries")]),a._v(", los trabajos se intentarán indefinidamente:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work redis "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("tries"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n")])])]),t("p",[a._v("Adicionalmente, puedes especificar cuántos segundos debe esperar Laravel antes de volver a intentar un trabajo que ha fallado usando la opción "),t("code",[a._v("--delay")]),a._v(". Por defecto, un trabajo se vuelve a intentar inmediatamente:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("work redis "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("tries"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("delay"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("\n")])])]),t("p",[a._v("Si te gustaría configurar la demora del trabajo fallido por cada trabajo, puedes hacerlo definiendo una propiedad "),t("code",[a._v("retryAfter")]),a._v(" en tu clase de cola de trabajos:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n* The number of seconds to wait before retrying the job.\n*\n* @var int\n*/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$retryAfter")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"cleaning-up-after-failed-jobs"}})]),a._v(" "),t("h3",{attrs:{id:"limpiar-despues-de-un-trabajo-fallido"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#limpiar-despues-de-un-trabajo-fallido"}},[a._v("#")]),a._v(" Limpiar después de un trabajo fallido")]),a._v(" "),t("p",[a._v("Se puede definir un método "),t("code",[a._v("failed")]),a._v(" directamente en la clase de trabajo, permitiendo realizar una limpieza específica de trabajo cuando una falla ocurre. Esta es la ubicación perfecta para enviar una alerta a tus usuarios o revertir cualquier acción realizada por el trabajo. La "),t("code",[a._v("Exception")]),a._v(" que causó la falla en el trabajo será pasada al método "),t("code",[a._v("failed")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Jobs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("AudioProcessor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Exception")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Bus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queueable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Contracts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ShouldQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("InteractsWithQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("SerializesModels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ProcessPodcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("implements")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ShouldQueue")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("InteractsWithQueue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" Queueable"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" SerializesModels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("protected")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Create a new job instance.\n    *\n    * @param  Podcast  $podcast\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("__construct")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Podcast "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$this")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token property"}},[a._v("podcast")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$podcast")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Execute the job.\n    *\n    * @param  AudioProcessor  $processor\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("AudioProcessor "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$processor")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Process uploaded podcast...")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * The job failed to process.\n    *\n    * @param  Exception  $exception\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("failed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("Exception "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$exception")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Send user notification of failure, etc...")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("div",{staticClass:"custom-block danger"},[t("p",{staticClass:"custom-block-title"},[a._v("Nota")]),a._v(" "),t("p",[a._v("El método "),t("code",[a._v("failed")]),a._v(" no será llamado si la tarea fue despachada usando el método "),t("code",[a._v("dispatchNow")]),a._v(".")])]),a._v(" "),t("p",[t("a",{attrs:{name:"failed-job-events"}})]),a._v(" "),t("h3",{attrs:{id:"eventos-de-trabajo-fallido"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eventos-de-trabajo-fallido"}},[a._v("#")]),a._v(" Eventos de trabajo fallido")]),a._v(" "),t("p",[a._v("Si quieres registrar un evento para ser llamado cuando un trabajo falle, puedes usar el método "),t("code",[a._v("Queue::failing")]),a._v(". Este evento representa una gran oportunidad para notificarle a tu equipo por correo electrónico o por "),t("a",{attrs:{href:"https://www.slack.com",target:"_blank",rel:"noopener noreferrer"}},[a._v("Slack"),t("OutboundLink")],1),a._v(". Por ejemplo, puedes adjuntar una función de retorno (callback) a este evento desde el "),t("code",[a._v("AppServiceProvider")]),a._v(" incluido en Laravel:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Providers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Support"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Facades"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Support"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ServiceProvider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("JobFailed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AppServiceProvider")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ServiceProvider")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Register any application services.\n    *\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Bootstrap any application services.\n    *\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("boot")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("failing")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("JobFailed "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->connectionName")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->job")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->exception")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[t("a",{attrs:{name:"retrying-failed-jobs"}})]),a._v(" "),t("h3",{attrs:{id:"reintentando-trabajos-fallidos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reintentando-trabajos-fallidos"}},[a._v("#")]),a._v(" Reintentando trabajos fallidos")]),a._v(" "),t("p",[a._v("Para visualizar todos los trabajos fallidos insertados en la tabla de base de datos "),t("code",[a._v("failed_jobs")]),a._v(", puedes usar el comando Artisan "),t("code",[a._v("queue:failed")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("failed\n")])])]),t("p",[a._v("El comando "),t("code",[a._v("queue:failed")]),a._v(" listará la ID del trabajo, su conexión, cola y el tiempo en el cual falló. La ID del trabajo puede ser usada para reintentar el trabajo fallido. Por ejemplo, para reintentar un trabajo fallido con una ID "),t("code",[a._v("5")]),a._v(", ejecuta el siguiente comando:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("retry "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n")])])]),t("p",[a._v("Para reintentar todos tus trabajos fallidos, ejecuta el comando "),t("code",[a._v("queue:retry")]),a._v(" y pasa "),t("code",[a._v("all")]),a._v(" como ID:")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("retry all\n")])])]),t("p",[a._v("Si deseas borrar un trabajo fallido, puedes usar el comando "),t("code",[a._v("queue:forget")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("forget "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n")])])]),t("p",[a._v("Para eliminar todos los trabajos fallidos, puedes usar el comando "),t("code",[a._v("queue:flush")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("php artisan queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("flush\n")])])]),t("p",[t("a",{attrs:{name:"ignoring-missing-models"}})]),a._v(" "),t("h3",{attrs:{id:"ignorando-modelos-faltantes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ignorando-modelos-faltantes"}},[a._v("#")]),a._v(" Ignorando modelos faltantes")]),a._v(" "),t("p",[a._v("Cuando inyectas un modelo Eloquent en un trabajo, se serializa automáticamente antes de colocarlo en la cola y se restaura cuando se procesa el trabajo. Sin embargo, si el modelo ha sido eliminado mientras el trabajo estaba esperando a ser procesado por un worker, tu trabajo puede fallar con la excepción "),t("code",[a._v("ModelNotFoundException")]),a._v(".")]),a._v(" "),t("p",[a._v("Por conveniencia, puedes elegir eliminar automáticamente los trabajos con modelos faltantes configurando la propiedad "),t("code",[a._v("deleteWhenMissingModels")]),a._v(" de tu trabajo en "),t("code",[a._v("true")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n* Delete the job if its models no longer exist.\n*\n* @var bool\n*/")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$deleteWhenMissingModels")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean constant"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[t("a",{attrs:{name:"job-events"}})]),a._v(" "),t("h2",{attrs:{id:"eventos-de-trabajo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eventos-de-trabajo"}},[a._v("#")]),a._v(" Eventos de trabajo")]),a._v(" "),t("p",[a._v("Usando los métodos "),t("code",[a._v("before")]),a._v(" y "),t("code",[a._v("after")]),a._v(" en la "),t("RouterLink",{attrs:{to:"/facades.html"}},[a._v("facade")]),a._v(" "),t("code",[a._v("Queue")]),a._v(", puedes especificar funciones de retorno (callbacks) para que sean ejecutadas antes o después de que un trabajo en cola sea procesado. Estas callbacks son una gran oportunidad para realizar registro adicional o incrementar estadísticas para un panel de control. Generalmente, debes llamar a estos métodos desde un "),t("RouterLink",{attrs:{to:"/providers.html"}},[a._v("proveedor de servicios")]),a._v(". Por ejemplo, puedes usar el "),t("code",[a._v("AppServiceProvider")]),a._v(" incluido en Laravel:")],1),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token php language-php"}},[t("span",{pre:!0,attrs:{class:"token delimiter important"}},[a._v("<?php")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("namespace")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("App"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Providers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Support"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Facades"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Support"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("ServiceProvider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("JobProcessed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("use")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token package"}},[a._v("Illuminate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("Events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("JobProcessing")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("AppServiceProvider")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ServiceProvider")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Register any application services.\n    *\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("register")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n    * Bootstrap any application services.\n    *\n    * @return void\n    */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("boot")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("before")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("JobProcessing "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->connectionName")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->job")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->job->payload()")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n        Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("after")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("JobProcessed "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$event")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->connectionName")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->job")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// $event->job->payload()")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])])]),t("p",[a._v("Usando el método "),t("code",[a._v("looping")]),a._v(" en la "),t("RouterLink",{attrs:{to:"/facades.html"}},[a._v("facade")]),a._v(" "),t("code",[a._v("Queue")]),a._v(", puedes especificar funciones de retorno (callbacks) que se ejecuten antes que el worker intente recuperar un trabajo de una cola. Por ejemplo, quizás necesites registrar una Closure para deshacer cualquier transacción abierta por un trabajo fallido anteriormente:")],1),a._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[a._v("Queue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("looping")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("transactionLevel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("DB")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("rollBack")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);