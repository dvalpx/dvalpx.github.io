<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Documentación de Laravel en español</title>
    <meta name="description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Catamaran:300,700|Miriam+Libre">
  <link rel="icon" href="/favicon.png">
  <meta property="og:url" content="https://documentacion-laravel.com">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Documentación de Laravel en español">
  <meta property="og:description" content="Traducción no oficial de la documentación de Laravel 6.* al español">
  <meta property="og:image" content="https://documentacion-laravel.com/social-preview.jpeg">
    
    <link rel="preload" href="/assets/css/0.styles.cf3cfaad.css" as="style"><link rel="preload" href="/assets/js/app.32fd5622.js" as="script"><link rel="preload" href="/assets/js/2.54a7c931.js" as="script"><link rel="preload" href="/assets/js/13.2115cee4.js" as="script"><link rel="prefetch" href="/assets/js/10.efe51994.js"><link rel="prefetch" href="/assets/js/11.eef2a566.js"><link rel="prefetch" href="/assets/js/12.6ea00ff1.js"><link rel="prefetch" href="/assets/js/14.805eae9b.js"><link rel="prefetch" href="/assets/js/15.2d0d52d3.js"><link rel="prefetch" href="/assets/js/16.a70be2c5.js"><link rel="prefetch" href="/assets/js/17.b641c781.js"><link rel="prefetch" href="/assets/js/18.98f71c0d.js"><link rel="prefetch" href="/assets/js/19.8f359ff2.js"><link rel="prefetch" href="/assets/js/20.cccbae01.js"><link rel="prefetch" href="/assets/js/21.015d3af2.js"><link rel="prefetch" href="/assets/js/22.5a382c49.js"><link rel="prefetch" href="/assets/js/23.33c5ece1.js"><link rel="prefetch" href="/assets/js/24.6d44530a.js"><link rel="prefetch" href="/assets/js/25.2a7e8a9d.js"><link rel="prefetch" href="/assets/js/26.e4e63188.js"><link rel="prefetch" href="/assets/js/27.e06fd770.js"><link rel="prefetch" href="/assets/js/28.73fca122.js"><link rel="prefetch" href="/assets/js/29.72ae259d.js"><link rel="prefetch" href="/assets/js/3.0b22dbdc.js"><link rel="prefetch" href="/assets/js/30.a103833e.js"><link rel="prefetch" href="/assets/js/31.da3f5f75.js"><link rel="prefetch" href="/assets/js/32.d9d3c76f.js"><link rel="prefetch" href="/assets/js/33.b6f0c51c.js"><link rel="prefetch" href="/assets/js/34.817b37ed.js"><link rel="prefetch" href="/assets/js/35.396ac8da.js"><link rel="prefetch" href="/assets/js/36.c02fe838.js"><link rel="prefetch" href="/assets/js/37.adb163ed.js"><link rel="prefetch" href="/assets/js/38.671aa558.js"><link rel="prefetch" href="/assets/js/39.52ae390d.js"><link rel="prefetch" href="/assets/js/4.1b4e1d6d.js"><link rel="prefetch" href="/assets/js/40.708a60b6.js"><link rel="prefetch" href="/assets/js/41.2be99a59.js"><link rel="prefetch" href="/assets/js/42.098ed995.js"><link rel="prefetch" href="/assets/js/43.a1c44eb1.js"><link rel="prefetch" href="/assets/js/44.a2eafefb.js"><link rel="prefetch" href="/assets/js/45.464274f7.js"><link rel="prefetch" href="/assets/js/46.b01d5bcf.js"><link rel="prefetch" href="/assets/js/47.676ed439.js"><link rel="prefetch" href="/assets/js/48.0ba08d6e.js"><link rel="prefetch" href="/assets/js/49.ef52a111.js"><link rel="prefetch" href="/assets/js/5.bb976917.js"><link rel="prefetch" href="/assets/js/50.1404704c.js"><link rel="prefetch" href="/assets/js/51.fcd3ae83.js"><link rel="prefetch" href="/assets/js/52.8dc89123.js"><link rel="prefetch" href="/assets/js/53.71df81ed.js"><link rel="prefetch" href="/assets/js/54.405ea888.js"><link rel="prefetch" href="/assets/js/55.420715e6.js"><link rel="prefetch" href="/assets/js/56.cd284365.js"><link rel="prefetch" href="/assets/js/57.9d5e5b33.js"><link rel="prefetch" href="/assets/js/58.91fa69d8.js"><link rel="prefetch" href="/assets/js/59.4f49a2d9.js"><link rel="prefetch" href="/assets/js/6.fe881c7f.js"><link rel="prefetch" href="/assets/js/60.b83f4381.js"><link rel="prefetch" href="/assets/js/61.7eb1e037.js"><link rel="prefetch" href="/assets/js/62.977e53dd.js"><link rel="prefetch" href="/assets/js/63.cece3028.js"><link rel="prefetch" href="/assets/js/64.6710ceef.js"><link rel="prefetch" href="/assets/js/65.6d63e7ff.js"><link rel="prefetch" href="/assets/js/66.91f74b68.js"><link rel="prefetch" href="/assets/js/67.ecb0474b.js"><link rel="prefetch" href="/assets/js/68.6f79a4d6.js"><link rel="prefetch" href="/assets/js/69.63473858.js"><link rel="prefetch" href="/assets/js/7.7d11811f.js"><link rel="prefetch" href="/assets/js/70.e8d9e306.js"><link rel="prefetch" href="/assets/js/71.adfa4100.js"><link rel="prefetch" href="/assets/js/72.7166c5cc.js"><link rel="prefetch" href="/assets/js/73.9771f0f3.js"><link rel="prefetch" href="/assets/js/74.86543265.js"><link rel="prefetch" href="/assets/js/75.00177166.js"><link rel="prefetch" href="/assets/js/76.f79b3515.js"><link rel="prefetch" href="/assets/js/77.af478c18.js"><link rel="prefetch" href="/assets/js/78.70298989.js"><link rel="prefetch" href="/assets/js/79.a158b091.js"><link rel="prefetch" href="/assets/js/8.5ac64f1f.js"><link rel="prefetch" href="/assets/js/80.4fc144dd.js"><link rel="prefetch" href="/assets/js/81.4f45fd97.js"><link rel="prefetch" href="/assets/js/82.7e5d964c.js"><link rel="prefetch" href="/assets/js/83.8cc265fb.js"><link rel="prefetch" href="/assets/js/84.0ebba7c1.js"><link rel="prefetch" href="/assets/js/85.853e96b6.js"><link rel="prefetch" href="/assets/js/86.9dc8c7a9.js"><link rel="prefetch" href="/assets/js/9.a631933e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cf3cfaad.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Documentación de Laravel en español</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Inicio</a></div><div class="nav-item"><a href="/documentation.html" class="nav-link">Índice</a></div><div class="nav-item"><a href="/glossary.html" class="nav-link">Glosario</a></div><div class="nav-item"><a href="/credits.html" class="nav-link">Créditos</a></div><div class="nav-item"><a href="/descargar-documentacion.html" class="nav-link">Descargar documentación</a></div><div class="nav-item"><a href="https://v5.documentacion-laravel.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Documentación de Laravel 5.8
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://styde.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Styde
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Primeros pasos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Conceptos de arquitectura</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Fundamentos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Frontend</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Seguridad</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/authentication.html" class="sidebar-link">Autenticación</a></li><li><a href="/api-authentication.html" class="sidebar-link">Autenticación de API</a></li><li><a href="/authorization.html" class="active sidebar-link">Autorización</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/authorization.html#introduccion" class="sidebar-link">Introducción</a></li><li class="sidebar-sub-header"><a href="/authorization.html#gates" class="sidebar-link">Gates</a></li><li class="sidebar-sub-header"><a href="/authorization.html#creando-politicas" class="sidebar-link">Creando políticas</a></li><li class="sidebar-sub-header"><a href="/authorization.html#escribiendo-politicas" class="sidebar-link">Escribiendo políticas</a></li><li class="sidebar-sub-header"><a href="/authorization.html#autorizando-acciones-usando-politicas" class="sidebar-link">Autorizando acciones usando políticas</a></li></ul></li><li><a href="/verification.html" class="sidebar-link">Verificación de correo electrónico</a></li><li><a href="/encryption.html" class="sidebar-link">Cifrado</a></li><li><a href="/hashing.html" class="sidebar-link">Hashing</a></li><li><a href="/passwords.html" class="sidebar-link">Restablecimiento de contraseñas</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Profundizando</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Bases de datos</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ORM Eloquent</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pruebas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Paquetes oficiales</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="autorizacion"><a class="header-anchor" href="#autorizacion" aria-hidden="true">#</a> Autorización</h1> <ul><li><a href="#introduction">Introducción</a></li> <li><a href="#gates">Gates</a> <ul><li><a href="#writing-gates">Escribiendo gates</a></li> <li><a href="#authorizing-actions-via-gates">Autorizando acciones</a></li> <li><a href="#gate-responses">Respuestas de gates</a></li> <li><a href="#intercepting-gate-checks">Interceptando comprobaciones de gates</a></li></ul></li> <li><a href="#creating-policies">Creando políticas</a> <ul><li><a href="#generating-policies">Generando políticas</a></li> <li><a href="#registering-policies">Registrando políticas</a></li></ul></li> <li><a href="#writing-policies">Escribiendo políticas</a> <ul><li><a href="#policy-methods">Métodos de política</a></li> <li><a href="#policy-responses">Respuestas de políticas</a></li> <li><a href="#methods-without-models">Métodos sin modelos</a></li> <li><a href="#guest-users">Usuarios invitados</a></li> <li><a href="#policy-filters">Filtros de política</a></li></ul></li> <li><a href="#authorizing-actions-using-policies">Autorizando acciones usando políticas</a> <ul><li><a href="#via-the-user-model">Vía el modelo de usuario</a></li> <li><a href="#via-middleware">Vía middleware</a></li> <li><a href="#via-controller-helpers">Vía helpers del controlador</a></li> <li><a href="#via-blade-templates">Vía plantillas de blade</a></li> <li><a href="#supplying-additional-context">Proporcionando contexto adicional</a></li></ul></li></ul> <p><a name="introduction"></a></p> <h2 id="introduccion"><a class="header-anchor" href="#introduccion" aria-hidden="true">#</a> Introducción</h2> <p>Además de proveer servicios de <router-link to="/authentication.html">autenticación</router-link> por defecto, Laravel además provee una forma simple de autorizar acciones del usuario contra un recurso dado. Como con la autenticación, el enfoque de Laravel para la autorización es simple, y hay dos maneras principales de autorizar acciones: <strong>gates</strong> y <strong>policies</strong> (puertas y políticas).</p> <p>Piensa en los gates y políticas como rutas y controladores. Los Gates proveen una manera simple, basada en funciones anónimas, para definir las reglas de autorización; mientras que las políticas, como los controladores, agrupan la lógica para un modelo o recurso en específico. Vamos a explorar los gates primero y luego las políticas.</p> <p>No necesitas elegir entre el uso exclusivo de gates o de políticas cuando construyas una aplicación. Lo más probable es que la mayoría de las aplicaciones contengan una mezcla de gates y de políticas ¡Y eso está completamente bien! Los gates son más aplicables a acciones que no estén relacionadas a ningún modelo o recurso, como por ejemplo ver un tablero en el panel de administración. Por otro lado, las políticas deberan ser usadas cuando desees autorizar una acción para un modelo o recurso en particular.</p> <p><a name="gates"></a></p> <h2 id="gates"><a class="header-anchor" href="#gates" aria-hidden="true">#</a> Gates</h2> <p><a name="writing-gates"></a></p> <h3 id="escribiendo-gates"><a class="header-anchor" href="#escribiendo-gates" aria-hidden="true">#</a> Escribiendo gates</h3> <p>Los gates son funciones anónimas (Closures) que determinan si un usuario está autorizado para ejecutar una acción dada y típicamente son definidos en la clase <code>App\Providers\AuthServiceProvider</code> usando el facade <code>Gate</code>. Los gates siempre reciben la instancia del usuario conectado como el primer argumento y pueden, opcionalmente, recibir argumentos adicionales que sean relevantes, como por ejemplo un modelo de Eloquent:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token comment">/**
* Register any authentication / authorization services.
*
* @return void
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'edit-settings'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">isAdmin</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Los gates además pueden ser definidos escribiendo la clase y método a llamar como una cadena de texto <code>Class@method</code>, como cuando definimos controladores en las rutas:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token comment">/**
* Register any authentication / authorization services.
*
* @return void
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\Policies\PostPolicy@update'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="gates-de-recursos"><a class="header-anchor" href="#gates-de-recursos" aria-hidden="true">#</a> Gates de recursos</h4> <p>También puedes definir las habilidades de múltiples gates a la vez usando el método <code>resource</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\Policies\PostPolicy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Esto es idéntico a definir los siguientes Gates uno por uno:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts.view'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\Policies\PostPolicy@view'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts.create'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\Policies\PostPolicy@create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts.update'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\Policies\PostPolicy@update'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts.delete'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'App\Policies\PostPolicy@delete'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Por defecto, las habilidades <code>view</code>, <code>create</code>, <code>update</code>, y <code>delete</code> serán definidas. Además puedes sobrescribir las habilidades por defecto pasando un arreglo como tercer argumento al método <code>resource</code>. Las llaves del arreglo definen los nombres de las habilidades mientras que los valores definen los nombres de los métodos. Por ejemplo, el siguiente código creará dos nuevas definiciones de Gate - <code>posts.image</code> y <code>posts.photo</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">resource</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'posts'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'PostPolicy'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'image'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'updateImage'</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'photo'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'updatePhoto'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="authorizing-actions-via-gates"></a></p> <h3 id="autorizando-acciones"><a class="header-anchor" href="#autorizando-acciones" aria-hidden="true">#</a> Autorizando acciones</h3> <p>Para autorizar una acción usando gates, deberías usar los métodos <code>allows</code> o <code>denies</code>. Nota que no necesitas pasar el usuario autenticado cuando llames a estos métodos. Laravel se ocupará de esto por ti de forma automática:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">allows</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'edit-settings'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The current user can edit settings</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">allows</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The current user can update the post...</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">denies</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The current user can't update the post...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si quisieras determinar si un usuario en particular está autorizado para ejecutar una acción, puedes llamar al método <code>forUser</code> del facade <code>Gate</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">forUser</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allows</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user can update the post...</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">forUser</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">denies</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user can't update the post...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Puedes autorizar múltiples acciones a la vez con los métodos <code>any</code> o <code>none</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delete-post'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user can update or delete the post</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">none</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delete-post'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user cannot update or delete the post</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="autorizando-o-mostrando-excepciones"><a class="header-anchor" href="#autorizando-o-mostrando-excepciones" aria-hidden="true">#</a> Autorizando o mostrando excepciones</h4> <p>Si te gustaría intentar autorizar una acción y automáticamente mostrar un <code>Illuminate\Auth\Access\AuthorizationException</code> si el usuario no está habilitado para realizar la acción dada, puedes usar el método <code>Gate::authorize</code>. Las instancias de <code>AuthorizationException</code> son convertidas automáticamente a una respuesta HTTP <code>403</code>:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update-post'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The action is authorized...</span>
</code></pre></div><h4 id="proporcionando-contexto-adicional"><a class="header-anchor" href="#proporcionando-contexto-adicional" aria-hidden="true">#</a> Proporcionando contexto adicional</h4> <p>Los métodos gate para autorizar habilidades (<code>allows</code>, <code>denies</code>, <code>check</code>, <code>any</code>, <code>none</code>, <code>authorize</code>, <code>can</code>, <code>cannot</code>) y las <a href="#via-blade-templates">directivas de Blade</a> para autorización (<code>@can</code>, <code>@cannot</code>, <code>@canany</code>) pueden recibir un arreglo como segundo argumento. Dichos elementos del arreglo son pasados como parametros al gate, y pueden ser usados como contexto adicional al tomar decisiones de autorización:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create-post'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$category</span><span class="token punctuation">,</span> <span class="token variable">$extraFlag</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$category</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">group</span> <span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$extraFlag</span> <span class="token operator">===</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create-post'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$category</span><span class="token punctuation">,</span> <span class="token variable">$extraFlag</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The user can create the post...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="gate-responses"></a></p> <h3 id="respuestas-de-gates"><a class="header-anchor" href="#respuestas-de-gates" aria-hidden="true">#</a> Respuestas de gates</h3> <p>Hasta el momento, sólo hemos examinado gates que retornan simples valores booleanos. Sin embargo, algunas veces podrías querer retornar una respuesta más detallada, incluyendo un mensaje de error. Para hacer eso, puedes retornar un <code>Illuminate\Auth\Access\Response</code> desde tu gate:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>Access<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Gate</span><span class="token punctuation">;</span>

Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'edit-settings'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">isAdmin</span>
                <span class="token operator">?</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">allow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">:</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">deny</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'You must be a super administrator.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Al retornar una respuesta de autorización desde tu gate, el método <code>Gate::allows</code> aún retornará un
valor booleano simple; sin embargo, puedes usar el método <code>Gate::inspect</code> para obtener la respuesta
de autorización completa retornada por el gate:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">inspect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'edit-settings'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The action is authorized...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Por supuesto, al usar el método <code>Gate::authorize</code> para mostrar una <code>AuthorizationException</code> si
la acción no está autorizada, el mensaje de error proporcionado por la respuesta de autorización
será propagada a la respuesta HTTP:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'edit-settings'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The action is authorized...</span>
</code></pre></div><p><a name="intercepting-gate-checks"></a></p> <h3 id="interceptando-comprobaciones-de-gates"><a class="header-anchor" href="#interceptando-comprobaciones-de-gates" aria-hidden="true">#</a> Interceptando comprobaciones de gates</h3> <p>Algunas veces, puedes querer otorgar todas las habilidades a un usuario en especifico. Puedes usar el método <code>before</code> para definir un callback que es ejecutado antes de todas las demás comprobaciones de autorización:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$ability</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSuperAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si el callback <code>before</code> retorna un resultado que no es null dicho resultado será considerado el resultado de la comprobación.</p> <p>Puedes usar el método <code>after</code> para definir un callback que será ejecutado luego de todas las demás comprobaciones de autorización:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$ability</span><span class="token punctuation">,</span> <span class="token variable">$result</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSuperAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Similar a la comprobación <code>before</code>, si el callback <code>after</code> retorna un resultado que no sea null dicho resultado será considerado el resultado de la comprobación.</p> <p><a name="creating-policies"></a></p> <h2 id="creando-politicas"><a class="header-anchor" href="#creando-politicas" aria-hidden="true">#</a> Creando políticas</h2> <p><a name="generating-policies"></a></p> <h3 id="generando-politicas"><a class="header-anchor" href="#generando-politicas" aria-hidden="true">#</a> Generando políticas</h3> <p>Los políticas son clases que organizan la lógica de autorización para un modelo o recurso en particular. Por ejemplo, si tu aplicación es un blog, puedes tener un modelo <code>Post</code> con su correspondiente <code>PostPolicy</code> para autorizar acciones de usuario como crear o actualizar posts.</p> <p>Puedes generar una política usando el <router-link to="/artisan.html">comando de Artisan</router-link> <code>make:policy</code>. La política generada será ubicada en el directorio <code>app/Policies</code>. Si el directorio no existe en tu aplicación, Laravel lo creará por ti:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan make<span class="token punctuation">:</span>policy PostPolicy
</code></pre></div><p>El comando <code>make:policy</code> genera una clase de política vacía. Si quieres generar una clase con los métodos de política para un &quot;CRUD&quot; básico ya incluidos en la clase, puedes especificar la opción <code>--model</code> al ejecutar el comando:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code>php artisan make<span class="token punctuation">:</span>policy PostPolicy <span class="token operator">--</span>model<span class="token operator">=</span>Post
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Todas las políticas son resueltas a través del <router-link to="/container.html">contenedor de servicios de Laravel</router-link>, lo que te permite especificar las dependencias necesarias en el constructor de la política y estas serán automaticamente inyectadas.</p></div></div><p><a name="registering-policies"></a></p> <h3 id="registrando-politicas"><a href="#registrando-politicas" aria-hidden="true" class="header-anchor">#</a> Registrando políticas</h3> <p>Una vez que la política exista, ésta necesita ser registrada. La clase <code>AuthServiceProvider</code> incluída con las aplicaciones de Laravel contiene una propiedad <code>policies</code> que mapea tus modelos de Eloquent a sus políticas correspondientes. Registrar una política le indicará a Laravel qué política utilizar para autorizar acciones contra un modelo dado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Policies<span class="token punctuation">\</span>PostPolicy</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Providers<span class="token punctuation">\</span>AuthServiceProvider</span> <span class="token keyword">as</span> ServiceProvider<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Gate</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AuthServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * The policy mappings for the application.
    *
    * @var array
    */</span>
    <span class="token keyword">protected</span> <span class="token variable">$policies</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span> <span class="token operator">=</span><span class="token operator">&gt;</span> PostPolicy<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">/**
    * Register any application authentication / authorization services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">registerPolicies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="politica-de-auto-descubrimiento"><a href="#politica-de-auto-descubrimiento" aria-hidden="true" class="header-anchor">#</a> Política de auto-descubrimiento</h4> <p>En lugar de registrar manualmente politicas de modelos, Laravel puede auto-descubrir politicas siempre y cuando el modelo y la politica sigan la convención de nombre estándar de Laravel. Especificamente, las politicas deben estar en un directorio <code>Policies</code> dentro del directorio que contiene los modelos. Así que, por ejemplo, los modelos pueden ser ubicados en el directorio <code>app</code> mientras que las politicas pueden tener un sufijo. Así que, un modelo <code>User</code> corresponderá a una clase <code>UserPolicy</code>.</p> <p>Si te gustaría proporcionar tu propia lógica para descubrir politicas, puedes registar un callback personalizado usando el método <code>Gate::guessPolicyNamesUsing</code>. Típicamente, este método debe ser llamado desde el método <code>boot</code> del <code>AuthServiceProvider</code> de tu aplicación:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Gate</span><span class="token punctuation">;</span>

Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">guessPolicyNamesUsing</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$modelClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// return policy class name...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>Cualquier politica que está explicitamente mapeada en tu <code>AuthServiceProvider</code> tendrá precendencia sobre cualquier posible politica auto-descubierta.</p></div> <p><a name="writing-policies"></a></p> <h2 id="escribiendo-politicas"><a href="#escribiendo-politicas" aria-hidden="true" class="header-anchor">#</a> Escribiendo políticas</h2> <p><a name="policy-methods"></a></p> <h3 id="metodos-de-politica"><a href="#metodos-de-politica" aria-hidden="true" class="header-anchor">#</a> Métodos de política</h3> <p>Una vez que la política haya sido registrada, puedes agregar métodos para cada acción a autorizar. Por ejemplo, vamos a definir un método <code>update</code> en nuestro <code>PostPolicy</code> para detirminar si un <code>User</code> dado puede actualizar una instancia de un <code>Post</code>.</p> <p>El método <code>update</code> recibirá una instancia de <code>User</code> y de <code>Post</code> como sus argumentos y debería retornar <code>true</code> o <code>false</code> indicando si el usuario está autorizado para actualizar el <code>Post</code> o no. En el siguiente ejemplo, vamos a verificar si el <code>id</code> del usuario concuerda con el atributo <code>user_id</code> del post:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Policies</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostPolicy</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Determine if the given post can be updated by the user.
    *
    * @param  \App\User  $user
    * @param  \App\Post  $post
    * @return bool
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> Post <span class="token variable">$post</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Puedes continuar definiendo métodos adicionales en la política como sea necesario para las diferentes acciones que este autorice. Por ejemplo, puedes definir métodos <code>view</code> o <code>delete</code> para autorizar varias acciones de <code>Post</code>, pero recuerda que eres libre de darle los nombres que quieras a los métodos de la política.</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Si usas la opción <code>--model</code> cuando generes tu política con el comando de Artisan, éste contendrá métodos para las acciones <code>view</code>, <code>create</code>, <code>update</code>, <code>delete</code>, <code>restore</code> y <code>forceDelete</code>.</p></div> <p><a name="policy-responses"></a></p> <h3 id="respuestas-de-politicas"><a href="#respuestas-de-politicas" aria-hidden="true" class="header-anchor">#</a> Respuestas de políticas</h3> <p>Hasta el momento, sólo hemos examinado métodos de políticas que retornan simples valores booleanos. Sin embargo, algunas veces puedes querer retornar una respuesta más detallada, incluyendo un mensaje de error. Para hacer eso, puedes retornar un <code>Illuminate\Auth\Access\Response</code> desde el método de tu política:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>Access<span class="token punctuation">\</span>Response</span><span class="token punctuation">;</span>

<span class="token comment">/**
* Determine if the given post can be updated by the user.
*
* @param  \App\User  $user
* @param  \App\Post  $post
* @return bool
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> Post <span class="token variable">$post</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span>
                <span class="token operator">?</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">allow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">:</span> Response<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">deny</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'You do not own this post.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Al retornar una respuesta de autorización desde tu política, el método <code>Gate::alows</code> aún retornará
un booleano simple; sin embargo, puedesde usar el método <code>Gate::inspect</code> para obtener la respuesta de autorización completa retornada por el gate:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span> <span class="token operator">=</span> Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">inspect</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">allowed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The action is authorized...</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Por supuesto, al usar el método <code>Gate::authorize</code> para mostrar un <code>AuthorizationException</code> si la acción no está autorizada, el mensaje de error proporcionado por la respuesta de autorización será propagado a la respuesta HTTP:</p> <div class="language-php extra-class"><pre class="language-php"><code>Gate<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// The action is authorized...</span>
</code></pre></div><p><a name="methods-without-models"></a></p> <h3 id="metodos-sin-modelos"><a href="#metodos-sin-modelos" aria-hidden="true" class="header-anchor">#</a> Métodos sin modelos</h3> <p>Algunos métodos de políticas solo reciben el usuario autenticado y no una instancia del modelo que autorizan. Esta situación es común cuando autorizamos acciones <code>create</code>. Por ejemplo, si estás creando un blog, puedes querer revisar si un usuario está autorizado para crear nuevos posts o no.</p> <p>Cuando definas métodos de política que no recibirán una instancia de otro modelo, así como el método <code>create</code>, debes definir el método con el usuario como único parámetro:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Determine if the given user can create posts.
*
* @param  \App\User  $user
* @return bool
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="guest-users"></a></p> <h3 id="usuarios-invitados"><a href="#usuarios-invitados" aria-hidden="true" class="header-anchor">#</a> Usuarios invitados</h3> <p>Por defecto, todos los gates y políticas automáticamente retornan <code>false</code> si la petición HTTP entrante no fue iniciada por un usuario autenticado. Sin embargo, puedes permitir que estas comprobaciones de autorización sean pasadas a tus gates y políticas con una declaración de tipo &quot;opcional&quot; o suministrando un valor por defecto <code>null</code> para la definición del argumento de usuario:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Policies</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostPolicy</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Determine if the given post can be updated by the user.
    *
    * @param  \App\User  $user
    * @param  \App\Post  $post
    * @return bool
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">?</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> Post <span class="token variable">$post</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p><a name="policy-filters"></a></p> <h3 id="filtros-de-politica"><a href="#filtros-de-politica" aria-hidden="true" class="header-anchor">#</a> Filtros de política</h3> <p>Es posible que quieras autorizar todas las acciones para algunos usuarios en un política dada. Para lograr esto, define un método <code>before</code> en la política. El método <code>before</code> será ejecutado antes de los otros métodos en la política, dándote la oportunidad de autorizar la acción antes que el método destinado de la política sea llamado. Esta característica es comunmente usada para otorgar autorización a los administradores de la aplicación para que ejecuten cualquier acción:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">,</span> <span class="token variable">$ability</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">isSuperAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean constant">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si quisieras denegar todas las autorizaciones para un usuario deberías retornar <code>false</code> en el método <code>before</code>. Si retornas <code>null</code>, la decisión de autorización recaerá sobre el método de la política.</p> <div class="danger custom-block"><p class="custom-block-title">Nota</p> <p>El método <code>before</code> de una clase política no será llamado si la clase no contiene un método con un nombre que concuerde con el nombre de la habilidad siendo revisada.</p></div> <p><a name="authorizing-actions-using-policies"></a></p> <h2 id="autorizando-acciones-usando-politicas"><a href="#autorizando-acciones-usando-politicas" aria-hidden="true" class="header-anchor">#</a> Autorizando acciones usando políticas</h2> <p><a name="via-the-user-model"></a></p> <h3 id="via-el-modelo-user"><a href="#via-el-modelo-user" aria-hidden="true" class="header-anchor">#</a> Vía el modelo user</h3> <p>El modelo <code>User</code> que se incluye por defecto en tu aplicación de Laravel trae dos métodos para autorizar acciones: <code>can</code> y <code>cant</code> (puede y no puede). El método <code>can</code> acepta el nombre de la acción que deseas autorizar y el modelo relevante. Por ejemplo, vamos a determinar si un usuario está autorizado para actualizar un <code>Post</code> dado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Si una <a href="#registering-policies">política está registrado</a> para el modelo dado, el método <code>can</code> automáticamente llamará a la política apropiada y retornará un resultado boleano. Si no se ha registrado una política para el modelo dado, el método <code>can</code> intentará llamar al Gate basado en Closures que coincida con la acción dada.</p> <h4 id="acciones-que-no-requieren-modelos"><a href="#acciones-que-no-requieren-modelos" aria-hidden="true" class="header-anchor">#</a> Acciones que no requieren modelos</h4> <p>Recuerda, algunas acciones como <code>create</code> pueden no requerir de la instancia de un modelo. En estas situaciones, puedes pasar el nombre de una clase al método <code>can</code>. El nombre de la clase ser usado para determinar cuál política usar cuando se autorice la acción:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Executes the &quot;create&quot; method on the relevant policy...</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a name="via-middleware"></a></p> <h3 id="via-middleware"><a href="#via-middleware" aria-hidden="true" class="header-anchor">#</a> Vía middleware</h3> <p>Laravel incluye un middleware que puede autorizar acciones antes de que la petición entrante alcance tus rutas o controladores. Por defecto, el middleware <code>Illuminate\Auth\Middleware\Authorize</code> es asignado a la llave <code>can</code> de tu clase <code>App\Http\Kernel</code>. Vamos a explorar un ejemplo usando el middleware <code>can</code> para autorizar que un usuario pueda actualizar un post de un blog:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>

Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/post/{post}'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>Post <span class="token variable">$post</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The current user may update the post...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'can:update,post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>En este ejemplo, estamos pasando al middleware <code>can</code> dos argumentos, el primero es el nombre de la acción que deseamos autorizar y el segundo es el parámetro de la ruta que deseamos pasar al método de la política. En este caso, como estamos usando <a href="/routing.html#implicit-binding">implicit model binding</a>, un modelo <code>Post</code> será pasado al método de la política. Si el usuario no está autorizado a ejecutar la acción dada, el middleware generará una respuesta HTTP con el código de estatus <code>403</code>.</p> <h4 id="acciones-que-no-requieren-modelos-2"><a href="#acciones-que-no-requieren-modelos-2" aria-hidden="true" class="header-anchor">#</a> Acciones que no requieren modelos</h4> <p>Como mencionamos antes, algunas acciones como <code>create</code> pueden no requerir de una instancia de un modelo. En estas situaciones, puedes pasar el nombre de la clase al middleware. El nombre de la clase será usado para determinar cuál política usar para autorizar la acción:</p> <div class="language-php extra-class"><pre class="language-php"><code>Route<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'/post'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The current user may create posts...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">middleware</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'can:create,App\Post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="via-controller-helpers"></a></p> <h3 id="via-helpers-de-controladores"><a href="#via-helpers-de-controladores" aria-hidden="true" class="header-anchor">#</a> Vía helpers de controladores</h3> <p>Además de proveer métodos útiles en el modelo <code>User</code>, Laravel también provee un método muy útil llamado <code>authorize</code> en cualquier controlador que extienda la clase base <code>App\Http\Controllers\Controller</code>. Como el método <code>can</code>, este método acepta el nombre de la acción que quieras autorizar y el modelo relevante. Si la acción no es autorizada, el método <code>authorize</code> arrojará una excepción de tipo <code>Illuminate\Auth\Access\AuthorizationException</code>, la cual será convertida por el manejador de excepciones por defecto de Laravel en una respuesta HTTP con un código <code>403</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Update the given blog post.
    *
    * @param  Request  $request
    * @param  Post  $post
    * @return Response
    * @throws \Illuminate\Auth\Access\AuthorizationException
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Post <span class="token variable">$post</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// The current user can update the blog post...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="acciones-que-no-requieren-modelos-3"><a href="#acciones-que-no-requieren-modelos-3" aria-hidden="true" class="header-anchor">#</a> Acciones que no requieren modelos</h4> <p>Como hemos discutido previamente, algunas acciones como <code>create</code> pueden no requerir una instancia de un modelo. En estas situaciones, deberías pasar el nombre de la clase al método <code>authorize</code>. El nombre de la clase determinará la política a usar para autorizar la acción:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Create a new blog post.
*
* @param  Request  $request
* @return Response
* @throws \Illuminate\Auth\Access\AuthorizationException
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">,</span> Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The current user can create blog posts...</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="autorizando-controladores-de-recursos"><a href="#autorizando-controladores-de-recursos" aria-hidden="true" class="header-anchor">#</a> Autorizando controladores de recursos</h4> <p>Si estás utilizando <a href="/controllers.html#resource-controllers">controladores de recursos</a>, puedes hacer uso del método <code>authorizeResource</code> en el constructor del controlador. Este método agregará las deficiones de middleware <code>can</code> apropiadas a los métodos del controlador de recursos.</p> <p>El método <code>authorizeResource</code> acepta el nombre de clase del modelo como primer argumento y el nombre del parametro de ruta / petición que contendrá el ID del modelo como segundo argumento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers<span class="token punctuation">\</span>Controller</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PostController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">authorizeResource</span><span class="token punctuation">(</span>Post<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Los siguientes métodos de controlador serán mapeados con su método de política respectivo:</p> <table><thead><tr><th>Método de controlador</th> <th>Método de política</th></tr></thead> <tbody><tr><td>index</td> <td>viewAny</td></tr> <tr><td>show</td> <td>view</td></tr> <tr><td>create</td> <td>create</td></tr> <tr><td>store</td> <td>create</td></tr> <tr><td>edit</td> <td>update</td></tr> <tr><td>update</td> <td>update</td></tr> <tr><td>destroy</td> <td>delete</td></tr></tbody></table> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Puedes usar el comando <code>make:policy</code> con la opción <code>--model</code> para generar rápidamente una clase de política para un modelo dado: <code>php artisan make:policy PostPolicy --model=Post</code>.</p></div> <p><a name="via-blade-templates"></a></p> <h3 id="via-plantillas-de-blade"><a href="#via-plantillas-de-blade" aria-hidden="true" class="header-anchor">#</a> Vía plantillas de blade</h3> <p>Cuando escribas plantillas de Blade, puedes querer mostrar una porción de la página solo si el usuario está autorizado para ejecutar una acción determinada. Por ejemplo, puedes querer mostrar un formulario para actualizar un post solo si el usuario puede actualizar el post. En situaciones así, puedes usar las directivas <code>@can</code> y <code>@cannot</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>@<span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can Update The Post <span class="token operator">--</span><span class="token operator">&gt;</span>
@<span class="token function">elsecan</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">,</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can Create <span class="token keyword">New</span> Post <span class="token operator">--</span><span class="token operator">&gt;</span>
@endcan

@<span class="token function">cannot</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can<span class="token single-quoted-string string">'t Update The Post --&gt;
@elsecannot('</span>create<span class="token single-quoted-string string">', App\Post::class)
    &lt;!-- The Current User Can'</span>t Create <span class="token keyword">New</span> Post <span class="token operator">--</span><span class="token operator">&gt;</span>
@endcannot
</code></pre></div><p>Estas directivas son accesos directos convenientes para no tener que escribir sentencias <code>@if</code> y <code>@unless</code>. Las sentencias <code>@can</code> y <code>@cannot</code> de arriba son equivalentes a las siguientes sentencias, respectivamente:</p> <div class="language-php extra-class"><pre class="language-php"><code>@<span class="token keyword">if</span> <span class="token punctuation">(</span>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can Update The Post <span class="token operator">--</span><span class="token operator">&gt;</span>
@<span class="token keyword">endif</span>

@unless <span class="token punctuation">(</span>Auth<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can't Update The Post <span class="token operator">--</span><span class="token operator">&gt;</span>
@endunless
</code></pre></div><p>También puedes determinar si un usuario tiene habilidad de autorización desde una lista de habilidades dadas. Para lograr esto, usa la directiva <code>@canary</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code>@<span class="token function">canany</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'view'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'delete'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$post</span><span class="token punctuation">)</span>
    <span class="token comment">// The current user can update, view, or delete the post</span>
@<span class="token function">elsecanany</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> \<span class="token package">App<span class="token punctuation">\</span>Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token comment">// The current user can create a post</span>
@endcanany
</code></pre></div><h4 id="acciones-que-no-requieren-modelos-4"><a href="#acciones-que-no-requieren-modelos-4" aria-hidden="true" class="header-anchor">#</a> Acciones que no requieren modelos</h4> <p>Así como otros métodos de autorización, puedes pasar el nombre de una clase a las directivas <code>@can</code> y <code>@cannot</code> si la acción no requiere una instancia de un modelo:</p> <div class="language-php extra-class"><pre class="language-php"><code>@<span class="token function">can</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">,</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can Create Posts <span class="token operator">--</span><span class="token operator">&gt;</span>
@endcan

@<span class="token function">cannot</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'create'</span><span class="token punctuation">,</span> App\<span class="token package">Post</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> The Current User Can't Create Posts <span class="token operator">--</span><span class="token operator">&gt;</span>
@endcannot
</code></pre></div><p><a name="supplying-additional-context"></a></p> <h3 id="proporcionando-contexto-adicional-2"><a href="#proporcionando-contexto-adicional-2" aria-hidden="true" class="header-anchor">#</a> Proporcionando contexto adicional</h3> <p>Al autorizar acciones usando políticas, puedes pasar un arreglo como segundo argumento a las
diferentes funciones y helpers de autorización. El primer elemento en el arreglo será usado para
determinar que política debe ser invocada, mientras que el resto de los elementos del arreglo son
pasados como parametros al método de la política y puede ser usado como contexto adicional al tomar decisiones de autorización. Por ejemplo, considera la siguiente definición de método <code>PostPolicy</code> que contiene un parametro adicional <code>$category</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Determine if the given post can be updated by the user.
*
* @param  \App\User  $user
* @param  \App\Post  $post
* @param  int  $category
* @return bool
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">,</span> Post <span class="token variable">$post</span><span class="token punctuation">,</span> int <span class="token variable">$category</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span> <span class="token operator">===</span> <span class="token variable">$post</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span> <span class="token operator">&amp;&amp;</span> 
           <span class="token variable">$category</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Al intentar determinar si el usuario autenticado puede actualizar un post dado, podemos invocar este método de política de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* Update the given blog post.
*
* @param  Request  $request
* @param  Post  $post
* @return Response
* @throws \Illuminate\Auth\Access\AuthorizationException
*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Post <span class="token variable">$post</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">authorize</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'update'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$post</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'category'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// The current user can update the blog post...</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/api-authentication.html" class="prev">Autenticación de API</a></span> <span class="next"><a href="/verification.html">Verificación de correo electrónico</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.32fd5622.js" defer></script><script src="/assets/js/2.54a7c931.js" defer></script><script src="/assets/js/13.2115cee4.js" defer></script>
  </body>
</html>
