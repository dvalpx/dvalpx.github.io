<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="generator" content="VuePress 1.8.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.f7a12d87.css" as="style"><link rel="preload" href="/assets/js/app.e3311cd2.js" as="script"><link rel="preload" href="/assets/js/2.648c6578.js" as="script"><link rel="preload" href="/assets/js/14.2d9f5c97.js" as="script"><link rel="prefetch" href="/assets/js/10.f234decd.js"><link rel="prefetch" href="/assets/js/11.f0ca56a6.js"><link rel="prefetch" href="/assets/js/12.5865c9a5.js"><link rel="prefetch" href="/assets/js/13.8e509b37.js"><link rel="prefetch" href="/assets/js/15.b917edb6.js"><link rel="prefetch" href="/assets/js/16.a13d2a39.js"><link rel="prefetch" href="/assets/js/17.d6b71ec0.js"><link rel="prefetch" href="/assets/js/18.adbe50b4.js"><link rel="prefetch" href="/assets/js/19.a1638529.js"><link rel="prefetch" href="/assets/js/20.393f35ab.js"><link rel="prefetch" href="/assets/js/21.a9dd9148.js"><link rel="prefetch" href="/assets/js/22.087385e4.js"><link rel="prefetch" href="/assets/js/23.b6ce1d9c.js"><link rel="prefetch" href="/assets/js/24.a74b28c6.js"><link rel="prefetch" href="/assets/js/25.7a984c35.js"><link rel="prefetch" href="/assets/js/26.cf45c453.js"><link rel="prefetch" href="/assets/js/27.e36a56dc.js"><link rel="prefetch" href="/assets/js/28.358fc226.js"><link rel="prefetch" href="/assets/js/29.f4fd2139.js"><link rel="prefetch" href="/assets/js/3.40d230a8.js"><link rel="prefetch" href="/assets/js/30.564d0795.js"><link rel="prefetch" href="/assets/js/31.0691b4c8.js"><link rel="prefetch" href="/assets/js/32.088de00e.js"><link rel="prefetch" href="/assets/js/33.4d884bb7.js"><link rel="prefetch" href="/assets/js/34.c4be32cd.js"><link rel="prefetch" href="/assets/js/35.b78c77b2.js"><link rel="prefetch" href="/assets/js/36.ceed3144.js"><link rel="prefetch" href="/assets/js/37.f9d6aca2.js"><link rel="prefetch" href="/assets/js/38.67ad3e03.js"><link rel="prefetch" href="/assets/js/39.5e3e70a7.js"><link rel="prefetch" href="/assets/js/4.e81ef12f.js"><link rel="prefetch" href="/assets/js/40.0510efa5.js"><link rel="prefetch" href="/assets/js/41.4e2bcf98.js"><link rel="prefetch" href="/assets/js/42.ebc7d9c8.js"><link rel="prefetch" href="/assets/js/43.e5970289.js"><link rel="prefetch" href="/assets/js/44.f91a9970.js"><link rel="prefetch" href="/assets/js/45.603b4584.js"><link rel="prefetch" href="/assets/js/46.037dce36.js"><link rel="prefetch" href="/assets/js/47.fadd0db4.js"><link rel="prefetch" href="/assets/js/48.457d9287.js"><link rel="prefetch" href="/assets/js/49.da492613.js"><link rel="prefetch" href="/assets/js/5.dc790133.js"><link rel="prefetch" href="/assets/js/50.cab6e13d.js"><link rel="prefetch" href="/assets/js/51.0765def4.js"><link rel="prefetch" href="/assets/js/52.518165a7.js"><link rel="prefetch" href="/assets/js/53.1e887b4a.js"><link rel="prefetch" href="/assets/js/54.bc10b491.js"><link rel="prefetch" href="/assets/js/55.2e54a7e8.js"><link rel="prefetch" href="/assets/js/56.169c81e5.js"><link rel="prefetch" href="/assets/js/57.a4ef4ed1.js"><link rel="prefetch" href="/assets/js/58.78dc0897.js"><link rel="prefetch" href="/assets/js/59.f13515c7.js"><link rel="prefetch" href="/assets/js/6.de2c94ff.js"><link rel="prefetch" href="/assets/js/60.ebfdeb63.js"><link rel="prefetch" href="/assets/js/61.6523e015.js"><link rel="prefetch" href="/assets/js/62.cb19c9bd.js"><link rel="prefetch" href="/assets/js/63.6ae10337.js"><link rel="prefetch" href="/assets/js/64.50298a81.js"><link rel="prefetch" href="/assets/js/65.d1849c5b.js"><link rel="prefetch" href="/assets/js/66.caef6860.js"><link rel="prefetch" href="/assets/js/67.a2788988.js"><link rel="prefetch" href="/assets/js/68.1c43eae0.js"><link rel="prefetch" href="/assets/js/69.e16965c5.js"><link rel="prefetch" href="/assets/js/7.0466c7e3.js"><link rel="prefetch" href="/assets/js/70.e66fe735.js"><link rel="prefetch" href="/assets/js/71.6d49148f.js"><link rel="prefetch" href="/assets/js/72.c3d54f60.js"><link rel="prefetch" href="/assets/js/73.125d4466.js"><link rel="prefetch" href="/assets/js/74.f1ed7f47.js"><link rel="prefetch" href="/assets/js/75.2f92d842.js"><link rel="prefetch" href="/assets/js/76.634dc6b8.js"><link rel="prefetch" href="/assets/js/77.db030077.js"><link rel="prefetch" href="/assets/js/78.ef9b3a22.js"><link rel="prefetch" href="/assets/js/79.a9b05b84.js"><link rel="prefetch" href="/assets/js/8.0435cf5c.js"><link rel="prefetch" href="/assets/js/80.88069fe6.js"><link rel="prefetch" href="/assets/js/9.d31992a0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f7a12d87.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><div><h1 id="cache"><a class="header-anchor" href="#cache">#</a> Caché</h1> <ul><li><a href="#configuration">Configuración</a> <ul><li><a href="#driver-prerequisites">Prerrequisitos del controlador</a></li></ul></li> <li><a href="#cache-usage">Uso de caché</a> <ul><li><a href="#obtaining-a-cache-instance">Obtener una instancia de caché</a></li> <li><a href="#retrieving-items-from-the-cache">Recuperar elementos de caché</a></li> <li><a href="#storing-items-in-the-cache">Almacenar elementos en caché</a></li> <li><a href="#removing-items-from-the-cache">Eliminar elementos de caché</a></li> <li><a href="#atomic-locks">Bloqueos atómicos</a></li> <li><a href="#the-cache-helper">El helper cache</a></li></ul></li> <li><a href="#cache-tags">Etiquetas de caché</a> <ul><li><a href="#storing-tagged-cache-items">Almacenar elementos de caché etiquetados</a></li> <li><a href="#accessing-tagged-cache-items">Acceder a elementos de caché etiquetados</a></li> <li><a href="#removing-tagged-cache-items">Eliminar elementos de caché etiquetados</a></li></ul></li> <li><a href="#adding-custom-cache-drivers">Agregar controladores de caché personalizados</a> <ul><li><a href="#writing-the-driver">Escribir el controlador</a></li> <li><a href="#registering-the-driver">Registrar el controlador</a></li></ul></li> <li><a href="#events">Eventos</a></li></ul> <p><a name="configuration"></a></p> <h2 id="configuracion"><a class="header-anchor" href="#configuracion">#</a> Configuración</h2> <p>Laravel proporciona una API expresiva y unificada para varios backends de almacenamiento de caché. La configuración de caché está ubicada en <code>config/cache.php</code>. En este archivo puedes indicar el controlador de caché que desees utilizar por defecto en toda tu aplicación. Laravel es compatible con los almacenamientos en caché más populares, tales como <a href="https://memcached.org" target="_blank" rel="noopener noreferrer">Memcached<OutboundLink></OutboundLink></a> y <a href="https://redis.io" target="_blank" rel="noopener noreferrer">Redis<OutboundLink></OutboundLink></a>.</p> <p>El archivo de configuración de caché contiene otras opciones adicionales, las cuales están documentadas dentro del mismo archivo, por lo que deberás asegurarte de revisar estas opciones. Por defecto, Laravel está configurado para utilizar el controlador de caché <code>file</code>, que almacena los objetos serializados y almacenados en caché en el sistema de archivos. Para aplicaciones más grandes, es recomendable que utilices un controlador más robusto como Memcached o Redis. Incluso puedes configurar múltiples configuraciones de caché para el mismo controlador.</p> <p><a name="driver-prerequisites"></a></p> <h3 id="prerrequisitos-del-controlador"><a class="header-anchor" href="#prerrequisitos-del-controlador">#</a> Prerrequisitos del controlador</h3> <h4 id="base-de-datos"><a class="header-anchor" href="#base-de-datos">#</a> Base de datos</h4> <p>Cuando utilices el controlador de caché <code>database</code>, necesitarás configurar una tabla que contenga los elementos de caché. Puedes encontrar un <code>Schema</code> de ejemplo en la tabla siguiente:</p> <div class="language-php extra-class"><pre v-pre="" class="language-php"><code><span class="token class-name static-context">Schema</span><span class="token operator">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cache'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">unique</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$table</span><span class="token operator">-&gt;</span><span class="token function">integer</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'expiration'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>También puedes utilizar el comando de Artisan <code>php artisan cache:table</code> para generar una migración con el esquema apropiado.</p></div></div><h4 id="memcached"><a href="#memcached" class="header-anchor">#</a> Memcached</h4> <p>Utilizar el controlador Memcached requiere que tengas instalado el <a href="https://pecl.php.net/package/memcached" target="_blank" rel="noopener noreferrer">paquete de Memcached PECL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Puedes listar todos tus servidores de Memcached en el archivo de configuración <code>config/cache.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'memcached'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">11211</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'weight'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><p>También puedes establecer la opción <code>host</code> a la ruta de un socket de UNIX. Si haces esto, la opción <code>port</code> se debe establecer a <code>0</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string single-quoted-string">'memcached'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'host'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'/var/run/memcached/memcached.sock'</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'port'</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'weight'</span> <span class="token operator">=&gt;</span> <span class="token number">100</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h4> <p>Antes de comenzar a utilizar el caché con Redis en Laravel, deberás instalar ya sea la extensión de PHP PhpRedis mediante PECL o instalar el paquete <code>predis/predis</code> (~1.0) mediante Composer.</p> <p>Para más información sobre cómo configurar Redis, consulta la <a href="/redis.html#configuration">página de la documentación de Laravel</a>.</p> <p><a name="cache-usage"></a></p> <h2 id="uso-de-cache"><a href="#uso-de-cache" class="header-anchor">#</a> Uso de caché</h2> <p><a name="obtaining-a-cache-instance"></a></p> <h3 id="obtener-una-instancia-de-cache"><a href="#obtener-una-instancia-de-cache" class="header-anchor">#</a> Obtener una instancia de caché</h3> <p>Los <a href="/contracts.html">contratos</a> <code>Illuminate\Contracts\Cache\Factory</code> y <code>Illuminate\Contracts\Cache\Repository</code> proporcionan acceso a los servicios de caché de Laravel. El contrato <code>Factory</code> proporciona acceso a todos los controladores de caché definidos para tu aplicación. El contrato <code>Repository</code> típicamente es una implementación del controlador de caché predeterminado para tu aplicación según lo especificado en tu archivo de configuración de <code>cache</code>.</p> <p>Sin embargo, también puedes usar el facade <code>Cache</code>, que es lo que usaremos a lo largo de esta documentación. El facade <code>Cache</code> proporciona acceso conveniente y directo a las implementaciones subyacentes de los contratos de caché de Laravel.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Show a list of all users of the application.
    *
    * @return Response
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h4 id="acceder-a-multiples-almacenamientos-de-cache"><a href="#acceder-a-multiples-almacenamientos-de-cache" class="header-anchor">#</a> Acceder a múltiples almacenamientos de caché</h4> <p>Usando el facade <code>Cache</code>, puedes acceder a varios almacenamientos de caché a través del método <code>store</code>. La llave que se pasa al método <code>store</code> debe corresponder a uno de los almacenamientos listados en el arreglo de configuración <code>stores</code> en tu archivo de configuración <code>cache</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">store</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'redis'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bar'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'baz'</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10 Minutes</span>
</code></pre></div><p><a name="retrieving-items-from-the-cache"></a></p> <h3 id="recuperar-elementos-de-cache"><a href="#recuperar-elementos-de-cache" class="header-anchor">#</a> Recuperar elementos de caché</h3> <p>El método <code>get</code> en el facade <code>Cache</code> es utilizado para recuperar elementos desde la caché. Si el elemento no existe en caché, se va a regresar <code>null</code>. Si lo deseas, puedes pasar un segundo argumento al método <code>get</code> indicando el valor predeterminado que deseas retornar en caso de que el elemento no exista:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Incluso puedes pasar una <code>Closure</code> como valor predeterminado. El resultado del <code>Closure</code> será devuelto si el elemento especificado no existe en caché. Pasar un Closure te permite diferir la recuperación de valores predeterminados de una base de datos u otro servicio externo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="comprobar-la-existencia-de-un-elemento"><a href="#comprobar-la-existencia-de-un-elemento" class="header-anchor">#</a> Comprobar la existencia de un elemento</h4> <p>El método <code>has</code> se puede utilizar para determinar la existencia de un elemento en caché. Este método devolverá <code>false</code> si el valor es <code>null</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="incrementando-decrementando-valores"><a href="#incrementando-decrementando-valores" class="header-anchor">#</a> Incrementando / Decrementando valores</h4> <p>Los métodos <code>increment</code> y <code>decrement</code> se pueden usar para ajustar el valor de los elementos enteros en caché. Ambos métodos aceptan un segundo parámetro opcional que indica la cantidad por la cual incrementar o disminuir el valor del elemento:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token variable">$amount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token variable">$amount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="recuperar-y-almacenar"><a href="#recuperar-y-almacenar" class="header-anchor">#</a> Recuperar y almacenar</h4> <p>En ocasiones, es posible que desees recuperar un elemento de la memoria caché, pero también almacenar un valor predeterminado si el elemento no existe. Por ejemplo, puede que desees recuperar todos los usuarios de la memoria caché o, si no existen, recuperarlos desde la base de datos y agregarlos a la caché. Puedes hacer esto utilizando el método <code>Cache::remember</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">remember</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si el elemento no existe en la memoria caché, se ejecutará el <code>Closure</code> pasado al método <code>remember</code> y su resultado se colocará en caché.</p> <p>Puedes utilizar el método <code>rememberForever</code> para recuperar un elemento del caché o almacenarlo para siempre:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">rememberForever</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="recuperar-y-eliminar"><a href="#recuperar-y-eliminar" class="header-anchor">#</a> Recuperar y eliminar</h4> <p>Si necesitas recuperar un elemento del caché y después eliminarlo, puedes utilizar el método <code>pull</code>. Al igual que el método <code>get</code>, se devolverá <code>null</code> si el elemento no existe en la memoria caché:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">pull</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="storing-items-in-the-cache"></a></p> <h3 id="almacenar-elementos-en-cache"><a href="#almacenar-elementos-en-cache" class="header-anchor">#</a> Almacenar elementos en caché</h3> <p>Puedes utilizar el método <code>put</code> en el facade <code>Cache</code> para almacenar elementos en caché:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si el tiempo de almacenamiento no es pasado al método <code>put</code>, el elemento será almacenado indefinidamente:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>En lugar de pasar el número de segundos como un entero, también puedes pasar una instancia de <code>DateTime</code> que represente el tiempo de expiración del elemento almacenado en caché:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="almacenar-si-no-esta-presente"><a href="#almacenar-si-no-esta-presente" class="header-anchor">#</a> Almacenar si no está presente</h4> <p>El método <code>add</code> solo agregará el elemento a caché si éste no existe todavía en la memoria caché. El método va a regresar <code>true</code> si el elemento realmente se agregó a la caché. De otra manera, el método va a regresar <code>false</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="almacenar-elementos-para-siempre"><a href="#almacenar-elementos-para-siempre" class="header-anchor">#</a> Almacenar elementos para siempre</h4> <p>El método <code>forever</code> puede ser utilizado para almacenar un elemento en la memoria caché de manera permanente. Como estos elementos no caducan, se deben eliminar de la memoria caché manualmente utilizando el método <code>forget</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">forever</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si utilizas el controlador de Memcached, los elementos almacenados &quot;permanentemente&quot; podrán ser eliminados una vez que la caché alcance su tamaño límite.</p></div> <p><a name="removing-items-from-the-cache"></a></p> <h3 id="eliminar-elementos-de-la-cache"><a href="#eliminar-elementos-de-la-cache" class="header-anchor">#</a> Eliminar elementos de la caché</h3> <p>Puedes eliminar elementos de caché utilizando el método <code>forget</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">forget</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>También puedes eliminar elementos de caché especificando un TTL cero o negativo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Puedes borrar todo el caché utilizando el método <code>flush</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>La limpieza de caché no respeta el prefijo del caché y borrará todas las entradas del caché. Considera esto cuidadosamente cuando borres un caché que sea compartido por otras aplicaciones.</p></div> <p><a name="atomic-locks"></a></p> <h3 id="bloqueos-atomicos"><a href="#bloqueos-atomicos" class="header-anchor">#</a> Bloqueos atómicos</h3> <div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Para usar esta característica, tu aplicación debe estar haciendo uso de los controladores de caché <code>memcached</code>, <code>dynamodb</code>, o <code>redis</code> como el controlador de caché por defecto de tu aplicación. Adicionalmente, todos los servidores deben estar comunicándose con el mismo servidor de caché central.</p></div> <p>Los bloqueos atómicos permiten la manipulación de bloqueos distribuidos sin que tengas que preocuparte sobre las condiciones de la carrera. Por ejemplo, <a href="https://forge.laravel.com" target="_blank" rel="noopener noreferrer">Laravel Forge<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> usa bloqueos atómicos para asegurarse de que sólo una tarea remota está siendo ejecutada en un servidor a la vez. Puedes crear y administrar bloqueos usando el método <code>Cache::lock</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span class="token punctuation">;</span>

<span class="token variable">$lock</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$lock</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Lock acquired for 10 seconds...</span>

    <span class="token variable">$lock</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>El método <code>get</code> también acepta una Closure. Luego de que la Closure sea ejecutada, Laravel automáticamente liberará el bloqueo:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Lock acquired indefinitely and automatically released...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si el bloqueo no está disponible en el momento en que lo solicitas, puedes instruir a Laravel para que espere un número determinado de segundos. Si el bloqueo no puede ser adquirido dentro del tiempo límite especificado, una excepción <code>Illuminate\Contracts\Cache\LockTimeoutException</code> será mostrada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>LockTimeoutException</span><span class="token punctuation">;</span>

<span class="token variable">$lock</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token variable">$lock</span><span class="token operator">-&gt;</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Lock acquired after waiting maximum of 5 seconds...</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">LockTimeoutException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Unable to acquire lock...</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token function">optional</span><span class="token punctuation">(</span><span class="token variable">$lock</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Lock acquired after waiting maximum of 5 seconds...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="administrando-bloqueos-a-traves-de-procesos"><a href="#administrando-bloqueos-a-traves-de-procesos" class="header-anchor">#</a> Administrando bloqueos a través de procesos</h4> <p>Algunas veces, es posible que desees adquirir un bloqueo en un proceso y liberarlo en otro proceso. Por ejemplo, puedes adquirir un bloqueo durante una solicitud web y desear liberarlo después que se ejecute un trabajo en cola desencadenado por esa solicitud. En este escenario, debes pasar el &quot;token de propietario&quot; (owner token) con alcance del bloqueo al trabajo en cola para que el trabajo pueda volver a crear instancias del bloqueo usando el token especificado:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">// Within Controller...</span>
<span class="token variable">$podcast</span> <span class="token operator">=</span> <span class="token class-name static-context">Podcast</span><span class="token operator">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$lock</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$lock</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name static-context">ProcessPodcast</span><span class="token operator">::</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token variable">$podcast</span><span class="token punctuation">,</span> <span class="token variable">$lock</span><span class="token operator">-&gt;</span><span class="token function">owner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Within ProcessPodcast Job...</span>
<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">restoreLock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">owner</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si deseas liberar un bloqueo sin necesidad de indicar su propietario actual, puedes usar el método <code>forceRelease</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'foo'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">forceRelease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="the-cache-helper"></a></p> <h3 id="el-helper-cache"><a href="#el-helper-cache" class="header-anchor">#</a> El helper cache</h3> <p>Además de usar el facade <code>Cache</code> o <a href="/contracts.html">el contrato de caché</a>, también puedes usar la función global <code>cache</code> para recuperar y almacenar información a través del caché. Cuando se llama a la función <code>cache</code> con un solo argumento, devolverá el valor de la clave dada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">cache</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Si proporcionas un arreglo de pares clave / valor y su tiempo de expiración a la función, almacenará los valores en caché durante la duración especificada:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Cuando la función <code>cache</code> es llamada sin ningún argumento, ésta retorna una instancia de la implementación <code>Illuminate\Contracts\Cache\Factory</code>, permitiéndote llamar a otros métodos de almacenamiento en caché:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">remember</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name static-context">DB</span><span class="token operator">::</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'users'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Al realizar pruebas utilizando la función global <code>cache</code>, deberás usar el método <code>Cache::shouldReceive</code> como si estuvieras <a href="/mocking.html#mocking-facades">probando un facade</a>.</p></div> <p><a name="cache-tags"></a></p> <h2 id="etiquetas-de-cache"><a href="#etiquetas-de-cache" class="header-anchor">#</a> Etiquetas de caché</h2> <div class="custom-block danger"><p class="custom-block-title">Nota</p> <p>Las etiquetas de caché no son compatibles cuando usas los controladores de caché <code>file</code> o <code>database</code>. Además, cuando se utilicen múltiples etiquetas con cachés que son almacenados &quot;permanentemente&quot;, el rendimiento será mejor si utilizas un controlador como <code>memcached</code>, el cual automáticamente purga los registros obsoletos.</p></div> <p><a name="storing-tagged-cache-items"></a></p> <h3 id="almacenar-elementos-de-cache-etiquetados"><a href="#almacenar-elementos-de-cache-etiquetados" class="header-anchor">#</a> Almacenar elementos de caché etiquetados</h3> <p>Las etiquetas de caché te permiten etiquetar elementos relacionados en caché y después limpiar todos los valores almacenados en caché asignados a una etiqueta dada. Puedes acceder a un caché etiquetado al pasar un arreglo ordenado de nombres de etiquetas. Por ejemplo, vamos a acceder a un caché etiquetado y al valor <code>put</code> en el caché:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'people'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'artists'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'John'</span><span class="token punctuation">,</span> <span class="token variable">$john</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'people'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'authors'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Anne'</span><span class="token punctuation">,</span> <span class="token variable">$anne</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="accessing-tagged-cache-items"></a></p> <h3 id="acceder-a-elementos-de-cache-etiquetados"><a href="#acceder-a-elementos-de-cache-etiquetados" class="header-anchor">#</a> Acceder a elementos de caché etiquetados</h3> <p>Para recuperar un elemento de caché etiquetado, pasa la misma lista ordenada de etiquetas al método <code>tags</code> y después haz un llamado al método <code>get</code> con la clave que deseas recuperar:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$john</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'people'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'artists'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'John'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$anne</span> <span class="token operator">=</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'people'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'authors'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Anne'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="removing-tagged-cache-items"></a></p> <h3 id="eliminar-elementos-de-cache-etiquetados"><a href="#eliminar-elementos-de-cache-etiquetados" class="header-anchor">#</a> Eliminar elementos de caché etiquetados</h3> <p>Puedes borrar todos los elementos a los que se les asigna una etiqueta o lista de etiquetas. Por ejemplo, la siguiente sentencia eliminaría todos los cachés etiquetados tanto con <code>people</code>, <code>authors</code> o ambos. Así que, tanto <code>Anne</code> como <code>John</code> serán eliminados de caché:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'people'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'authors'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Por el contrario, la siguiente sentencia eliminará solamente los cachés con la etiqueta <code>authors</code>, por lo tanto se eliminará <code>Anne</code>, pero <code>John</code> no:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">tags</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'authors'</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a name="adding-custom-cache-drivers"></a></p> <h2 id="agregar-controladores-de-cache-personalizados"><a href="#agregar-controladores-de-cache-personalizados" class="header-anchor">#</a> Agregar controladores de caché personalizados</h2> <p><a name="writing-the-driver"></a></p> <h3 id="escribir-el-controlador"><a href="#escribir-el-controlador" class="header-anchor">#</a> Escribir el controlador</h3> <p>Para crear nuestro controlador de caché personalizado, primero necesitamos implementar el <a href="/contracts.html">contrato</a> <code>Illuminate\Contracts\Cache\Store</code>. Por lo tanto, una implementación de caché de MongoDB se vería de la siguiente manera:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Extensions</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Contracts<span class="token punctuation">\</span>Cache<span class="token punctuation">\</span>Store</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MongoStore</span> <span class="token keyword">implements</span> <span class="token class-name">Store</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">many</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">putMany</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$values</span><span class="token punctuation">,</span> <span class="token variable">$seconds</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">forever</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">forget</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>Solo necesitas implementar cada uno de estos métodos utilizando una conexión de MongoDB. Para tener un ejemplo de cómo implementar cada uno de estos métodos, puedes echar un vistazo a <code>Illuminate\Cache\MemcachedStore</code> en el código fuente del framework. Una vez que completes la implementación, puedes finalizar con el registro de tu controlador personalizado.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mongo'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">repository</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MongoStore</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Si te preguntas dónde puedes colocar el código de tu controlador de caché personalizado, puedes crear un espacio de nombres <code>Extensions</code> en tu directorio <code>app</code>. Sin embargo, ten en cuenta que Laravel no tiene una estructura de aplicación rígida y por tanto eres libre de organizar tu aplicación de acuerdo a tus preferencias.</p></div> <p><a name="registering-the-driver"></a></p> <h3 id="registrar-el-controlador"><a href="#registrar-el-controlador" class="header-anchor">#</a> Registrar el controlador</h3> <p>Para registrar el controlador de caché personalizado con Laravel, debes utilizar el método <code>extend</code> en el facade <code>Cache</code>. La llamada a <code>Cache::extend</code> puede hacerse en el método <code>boot</code> del <code>App\Providers\AppServiceProvider</code> predeterminado que contiene cada aplicación nueva de Laravel, o puedes crear tu propio proveedor de servicios para alojar la extensión - solo recuerda registrar el proveedor en el arreglo de proveedores en <code>config/app.php</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Providers</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Extensions<span class="token punctuation">\</span>MongoStore</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>Facades<span class="token punctuation">\</span>Cache</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>ServiceProvider</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CacheServiceProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceProvider</span>
<span class="token punctuation">{</span>
    <span class="token comment">/**
    * Register any application services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
    * Bootstrap any application services.
    *
    * @return void
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mongo'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$app</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name static-context">Cache</span><span class="token operator">::</span><span class="token function">repository</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MongoStore</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>El primer argumento pasado al método <code>extend</code> es el nombre del controlador. Esto corresponde a la opción <code>driver</code> en el archivo de configuración <code>config/cache.php</code>. El segundo argumento es un Closure que debe regresar una instancia de <code>Illuminate\Cache\Repository</code>. El Closure debe pasar una instancia de <code>$app</code>, que es una instancia del <a href="/container.html">contenedor de servicios</a>.</p> <p>Una vez que hayas registrado tu extensión, actualiza la opción <code>driver</code> en tu archivo de configuración <code>config/cache.php</code> con el nombre de tu extensión.</p> <p><a name="events"></a></p> <h2 id="eventos"><a href="#eventos" class="header-anchor">#</a> Eventos</h2> <p>Para ejecutar código en cada operación de caché, puedes escuchar los <a href="/events.html">eventos</a> activados por el caché. Normalmente, debes colocar estos listener de eventos dentro de tu <code>EventServiceProvider</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
* The event listener mappings for the application.
*
* @var array
*/</span>
<span class="token keyword">protected</span> <span class="token variable">$listen</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string single-quoted-string">'Illuminate\Cache\Events\CacheHit'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'App\Listeners\LogCacheHit'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token string single-quoted-string">'Illuminate\Cache\Events\CacheMissed'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'App\Listeners\LogCacheMissed'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token string single-quoted-string">'Illuminate\Cache\Events\KeyForgotten'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'App\Listeners\LogKeyForgotten'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token string single-quoted-string">'Illuminate\Cache\Events\KeyWritten'</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'App\Listeners\LogKeyWritten'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e3311cd2.js" defer></script><script src="/assets/js/2.648c6578.js" defer></script><script src="/assets/js/14.2d9f5c97.js" defer></script>
  </body>
</html>
